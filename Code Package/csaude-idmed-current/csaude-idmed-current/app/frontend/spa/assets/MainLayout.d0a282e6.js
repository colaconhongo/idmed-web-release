import{l as J,c as g,h as E,m as Ve,u as xe,n as De,w as I,i as F,p as N,r as p,q as oe,t as Ce,Q as pe,g as ge,v as he,x as Pe,y as Ie,z as Y,A as Z,B as ee,C as H,D as se,E as Te,G as ye,H as le,I as ie,J as re,K as S,L as k,M as l,f as s,N as ue,O as V,P as te,R as be,S as Qe,U as ce,V as de,W as Le,X as _e,Y as fe,Z as qe,o as ze,_ as ae,$ as ve,a0 as $e,a1 as me,a2 as Me,a3 as G,a4 as R,a5 as A,a6 as Q,a7 as L,a8 as Be,a9 as Re,aa as Ee,ab as Oe,ac as Ge,ad as He}from"./index.28c7e456.js";import{Q as $,a as U,b as K}from"./QMenu.9a83401e.js";import{u as Ne,a as Ae,b as Ue,Q as Fe}from"./QTabs.9968ab83.js";import{Q as We}from"./QBadge.cb49eccd.js";import{Q as je}from"./QList.d4521672.js";import{Q as Ke}from"./QBtnDropdown.23f7ab1d.js";import{Q as Je}from"./QToolbar.a9ffd08a.js";import{C as Xe}from"./ClosePopup.20eb2e56.js";import{Q as Ye,v as Ze}from"./QForm.d27e0ea1.js";import"./position-engine.b3fa6cbd.js";var et=J({name:"QToolbarTitle",props:{shrink:Boolean},setup(n,{slots:h}){const f=g(()=>"q-toolbar__title ellipsis"+(n.shrink===!0?" col-shrink":""));return()=>E("div",{class:f.value},Ve(h.default))}}),M=J({name:"QRouteTab",props:{...xe,...Ne},emits:Ae,setup(n,{slots:h,emit:f}){const m=De({useDisableForRouterLinkProps:!1}),{renderTab:e,$tabs:i}=Ue(n,h,f,{exact:g(()=>n.exact),...m});return I(()=>`${n.name} | ${n.exact} | ${(m.resolvedLink.value||{}).href}`,()=>{i.verifyRouteModel()}),()=>e(m.linkTag.value,m.linkAttrs.value)}}),tt=J({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(n,{slots:h,emit:f}){const{proxy:{$q:m}}=ge(),e=F(he,N);if(e===N)return console.error("QHeader needs to be child of QLayout"),N;const i=p(parseInt(n.heightHint,10)),a=p(!0),t=g(()=>n.reveal===!0||e.view.value.indexOf("H")!==-1||m.platform.is.ios&&e.isContainer.value===!0),o=g(()=>{if(n.modelValue!==!0)return 0;if(t.value===!0)return a.value===!0?i.value:0;const u=i.value-e.scroll.value.position;return u>0?u:0}),r=g(()=>n.modelValue!==!0||t.value===!0&&a.value!==!0),d=g(()=>n.modelValue===!0&&r.value===!0&&n.reveal===!0),y=g(()=>"q-header q-layout__section--marginal "+(t.value===!0?"fixed":"absolute")+"-top"+(n.bordered===!0?" q-header--bordered":"")+(r.value===!0?" q-header--hidden":"")+(n.modelValue!==!0?" q-layout--prevent-focus":"")),b=g(()=>{const u=e.rows.value.top,C={};return u[0]==="l"&&e.left.space===!0&&(C[m.lang.rtl===!0?"right":"left"]=`${e.left.size}px`),u[2]==="r"&&e.right.space===!0&&(C[m.lang.rtl===!0?"left":"right"]=`${e.right.size}px`),C});function x(u,C){e.update("header",u,C)}function z(u,C){u.value!==C&&(u.value=C)}function _({height:u}){z(i,u),x("size",u)}function D(u){d.value===!0&&z(a,!0),f("focusin",u)}I(()=>n.modelValue,u=>{x("space",u),z(a,!0),e.animate()}),I(o,u=>{x("offset",u)}),I(()=>n.reveal,u=>{u===!1&&z(a,n.modelValue)}),I(a,u=>{e.animate(),f("reveal",u)}),I(e.scroll,u=>{n.reveal===!0&&z(a,u.direction==="up"||u.position<=n.revealOffset||u.position-u.inflectionPoint<100)});const T={};return e.instances.header=T,n.modelValue===!0&&x("size",i.value),x("space",n.modelValue),x("offset",o.value),oe(()=>{e.instances.header===T&&(e.instances.header=void 0,x("size",0),x("offset",0),x("space",!1))}),()=>{const u=Ce(h.default,[]);return n.elevated===!0&&u.push(E("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),u.push(E(pe,{debounce:0,onResize:_})),E("header",{class:y.value,style:b.value,onFocusin:D},u)}}}),at=J({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(n,{slots:h,emit:f}){const{proxy:{$q:m}}=ge(),e=F(he,N);if(e===N)return console.error("QFooter needs to be child of QLayout"),N;const i=p(parseInt(n.heightHint,10)),a=p(!0),t=p(Pe.value===!0||e.isContainer.value===!0?0:window.innerHeight),o=g(()=>n.reveal===!0||e.view.value.indexOf("F")!==-1||m.platform.is.ios&&e.isContainer.value===!0),r=g(()=>e.isContainer.value===!0?e.containerHeight.value:t.value),d=g(()=>{if(n.modelValue!==!0)return 0;if(o.value===!0)return a.value===!0?i.value:0;const c=e.scroll.value.position+r.value+i.value-e.height.value;return c>0?c:0}),y=g(()=>n.modelValue!==!0||o.value===!0&&a.value!==!0),b=g(()=>n.modelValue===!0&&y.value===!0&&n.reveal===!0),x=g(()=>"q-footer q-layout__section--marginal "+(o.value===!0?"fixed":"absolute")+"-bottom"+(n.bordered===!0?" q-footer--bordered":"")+(y.value===!0?" q-footer--hidden":"")+(n.modelValue!==!0?" q-layout--prevent-focus"+(o.value!==!0?" hidden":""):"")),z=g(()=>{const c=e.rows.value.bottom,w={};return c[0]==="l"&&e.left.space===!0&&(w[m.lang.rtl===!0?"right":"left"]=`${e.left.size}px`),c[2]==="r"&&e.right.space===!0&&(w[m.lang.rtl===!0?"left":"right"]=`${e.right.size}px`),w});function _(c,w){e.update("footer",c,w)}function D(c,w){c.value!==w&&(c.value=w)}function T({height:c}){D(i,c),_("size",c)}function u(){if(n.reveal!==!0)return;const{direction:c,position:w,inflectionPoint:j}=e.scroll.value;D(a,c==="up"||w-j<100||e.height.value-r.value-w-i.value<300)}function C(c){b.value===!0&&D(a,!0),f("focusin",c)}I(()=>n.modelValue,c=>{_("space",c),D(a,!0),e.animate()}),I(d,c=>{_("offset",c)}),I(()=>n.reveal,c=>{c===!1&&D(a,n.modelValue)}),I(a,c=>{e.animate(),f("reveal",c)}),I([i,e.scroll,e.height],u),I(()=>m.screen.height,c=>{e.isContainer.value!==!0&&D(t,c)});const W={};return e.instances.footer=W,n.modelValue===!0&&_("size",i.value),_("space",n.modelValue),_("offset",d.value),oe(()=>{e.instances.footer===W&&(e.instances.footer=void 0,_("size",0),_("offset",0),_("space",!1))}),()=>{const c=Ie(h.default,[E(pe,{debounce:0,onResize:T})]);return n.elevated===!0&&c.push(E("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),E("footer",{class:x.value,style:z.value,onFocusin:C},c)}}});const{loadPatientDataToOffline:ot,loadSettingParamsToOffline:qt,loadStockDistribuitionData:nt}=Te(),{notifySuccess:st,notifyInfo:lt}=ye();function Se(){function n(){lt("Envio dos Dados do Paciente Iniciado"),Y.getLocalDbPatientsToSync().then(t=>(console.log("patients"+t.length),t)).then(t=>{a(t,0)});function a(t,o){const r=t[o];r!==void 0?Y.syncPatient(r).then(d=>{o=o+1,r.syncStatus="S",Y.putMobile(r),setTimeout(a(t,o),200)}).catch(d=>{o=o+1,setTimeout(a(t,o),200),console.log(d)}):h()}}function h(){Z.getLocalDbPatientServiceIdentifierToSync().then(t=>(console.log("identifiersToSync"+t.length),t)).then(t=>{a(t,0)});function a(t,o){const r=t[o];r!==void 0?(console.log(r),Z.syncPatientServiceIdentifier(r).then(d=>{o=o+1,r.syncStatus="S",Z.putMobile(r),setTimeout(a(t,o),200)}).catch(d=>{o=o+1,setTimeout(a(t,o),200),console.log(d)})):f()}}function f(){ee.getLocalDbEpisodesToSync().then(t=>t).then(t=>{a(t,0)});function a(t,o){const r=t[o];r!==void 0?ee.syncEpisode(r).then(d=>{o=o+1,r.syncStatus="S",ee.putMobile(r),setTimeout(a(t,o),200)}).catch(d=>{o=o+1,setTimeout(a(t,o),200),console.log(d)}):m()}}function m(){H.getLocalDbPatientVisitsToSync().then(a=>a).then(a=>{console.log(a[0]),e(a,0)})}async function e(a,t){const o=a[t];if(o!==void 0){const r=H.setPackagedDrugStockNullToSend(o);console.log(r),await H.postWeb(r).then(d=>{t=t+1,o.syncStatus="S",H.putMobile(o),setTimeout(e(a,t),200)}).catch(d=>{t=t+1,setTimeout(e(a,t),200),console.log(d)})}else st("Envio de Dados do Paciente Terminado"),ot(),nt()}function i(){se.getLocalDbGroupsToSync().then(t=>t).then(t=>{console.log("Groups_To_Sync: ",t),a(t,0)});function a(t,o){const r=t[o];r!==void 0&&se.apiSave(r).then(d=>{o=o+1,r.syncStatus="S",console.log("Group_Syncronized: ",r),setTimeout(this.apiSendGroups(t,o),200)}).catch(d=>{o=o+1,console.log(d)})}}return{getPatientsToSend:n,getGroupsToSend:i}}const{notifySuccess:it,notifyInfo:rt}=ye();function ut(){async function n(){rt("Limpeza de Dados Iniciada");const f=(await H.getLocalDbPatientVisitsSyncedAndWithSyncStatusNull()).reduce((e,i)=>{const a=i.patientId||i.patient_id;return e[a]||(e[a]=[]),e[a].push(i),e},{});for(const e in f)f[e].sort((i,a)=>new Date(i.visitDate)-new Date(a.visitDate));Object.entries(f).map(([e,i])=>{i.sort((o,r)=>new Date(r.visitDate)-new Date(o.visitDate));const a=i.slice(0,3),t=i.slice(3);return{patientId:e,top3Visits:a,remainingVisits:t}}).forEach(e=>{e.remainingVisits.forEach(async i=>{(i.syncStatus==="S"||i.syncStatus===void 0)&&i.patientVisitDetails.forEach(async a=>{const t=await le.getAllMobileByDetailsId(a.id),o=await ie.getPrescriptionMobileById(a.prescription.id),r=await re.getPackMobileById(a.pack.id);le.delete(t.id),ie.delete(o.id),re.delete(r.id),H.delete(i.id)})})}),it("Limpeza de Dados Terminada")}return{getPatientsVisitToWipe:n}}const ct={class:"q-pa-md"},dt={class:"row items-center"},ft=V("span",{class:"q-pl-sm text-subtitle2"},"Login",-1),vt=V("span",{class:"q-pl-sm text-subtitle"},"A sua sess\xE3o Expirou , Por Favor volte a logar para poder sicronizar!",-1),mt={class:"row q-mt-md"},pt={class:"row q-mt-md"},gt={class:"row q-mb-md q-mt-md"},ht={__name:"LoginDialog",setup(n){const h=p(""),f=p(""),m=p(null),e=p(null),i=p(!0),a=p(!1),t=F("showLoginScreen"),{getPatientsToSend:o}=Se();F("stockDistributionCount"),F("getStockDistributionCount");const r=async()=>{a.value=!0,_e.login({username:h.value,password:f.value}).then(d=>{console.log(t),a.value=!1,sessionStorage.setItem("id_token",d.data.access_token),sessionStorage.setItem("refresh_token",d.data.refresh_token),t.value=!1,o()})};return(d,y)=>(S(),k(Le,{style:{width:"500px","max-width":"90vw"}},{default:l(()=>[s(ue,{class:"q-pa-none bg-green-2"},{default:l(()=>[V("div",ct,[V("div",dt,[s(te,{name:"local_pharmacy",size:"sm"}),ft,vt])]),s(be,{color:"grey-13",size:"1px"})]),_:1}),s(ue,{class:"q-px-md"},{default:l(()=>[s(Ye,{class:"q-gutter-md",onSubmit:Qe(r,["prevent"])},{default:l(()=>[V("div",mt,[s(ce,{class:"col",ref_key:"usernameRef",ref:m,modelValue:h.value,"onUpdate:modelValue":y[0]||(y[0]=b=>h.value=b),type:"text",rules:[b=>b.length>=3||"O nome do utilizador deve ter um minimo de 4 caracteres"],"lazy-rules":"",label:"Utilizador"},{append:l(()=>[s(te,{name:"person",color:"primary"})]),_:1},8,["modelValue","rules"])]),V("div",pt,[s(ce,{modelValue:f.value,"onUpdate:modelValue":y[2]||(y[2]=b=>f.value=b),ref_key:"passwordRef",ref:e,class:"col",label:"Senha",rules:[b=>b.length>=4||"A senha deve ter um minimo de 4 caracteres"],type:i.value?"password":"text"},{append:l(()=>[s(te,{name:i.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:y[1]||(y[1]=b=>i.value=!i.value),color:"primary"},null,8,["name"])]),_:1},8,["modelValue","rules","type"])]),V("div",gt,[s(de,{loading:a.value,class:"full-width q-py-sm",unelevated:"",rounded:"",color:"primary",type:"submit",label:"Entrar"},null,8,["loading"]),s(de,{label:"Cancelar",class:"full-width q-py-sm q-mt-md",color:"red",onClickOnce:y[3]||(y[3]=b=>d.$emit("close")),unelevated:"",rounded:""})])]),_:1})]),_:1})]),_:1}))}},yt=V("img",{class:"bg-white",src:He},null,-1),bt={class:"row items-center no-wrap"},_t={class:"text-center q-pa-sm"},St={class:""},kt={class:"gt-sm inline"},zt={__name:"MainLayout",setup(n){const{website:h}=fe(),{isProvincialInstalation:f,isProvincialInstalationPharmacysMode:m,isProvincialInstalationMobileClinic:e}=qe(),i=p(!1),a=p(""),t=p(""),o=p(sessionStorage.getItem("user")),r=p("home"),d=p(!1),{isOnline:y}=fe(),{getPatientsToSend:b,getGroupsToSend:x}=Se(),{getPatientsVisitToWipe:z}=ut(),_=p(0),D=p(null),T=p(!1),u=()=>{sessionStorage.removeItem("authUser"),sessionStorage.removeItem("user"),sessionStorage.removeItem("username"),sessionStorage.removeItem("refresh_token"),window.location.reload()},C=()=>{clearTimeout(D.value),c()},W=()=>{sessionStorage.setItem("tokenExpiration",0),u()},c=()=>{D.value=setTimeout(W,1200*1e4)};ze(async()=>{h.value||y.value?(d.value=!1,await ae.apiGetAll(),await ve.apiWebGetAll()):d.value=!0,["click","mousemove","mousedown","scroll","keypress","load"].forEach(v=>{window.addEventListener(v,C)}),c()}),oe(()=>{clearTimeout(D.value)});const w=g(()=>j.value===null?!1:j.value.value==="true"),j=g(()=>ae.getActiveDataMigration()),O=g(()=>ve.currClinic()),ne=g(()=>{const q=ae.getInstallationType();return q.value==="PROVINCIAL"?$e.getAllProvincesByCode(q.description):null}),B=q=>{const v=sessionStorage.getItem("role_menus");if(v!==null)return!!v.includes(q)},X=async()=>{_e.refreshToken().then(q=>{q.data.refresh_token===void 0?T.value=!0:b()}).catch(q=>{T.value=!0,console.log(q)})},ke=async()=>{z()};return me("stockDistributionCount",_),me("showLoginScreen",T),(q,v)=>{const we=Me("router-view");return S(),k(Ge,{view:"lHh Lpr lFf"},{default:l(()=>[V("div",null,[s(tt,null,{default:l(()=>[s(Je,null,{default:l(()=>[s(G,{size:"100px"},{default:l(()=>[yt]),_:1}),s(et,{class:"text-bold text-italic",style:{"font-family":"'Gill Sans'","font-size":"35px"}},{default:l(()=>[s($,null,{default:l(()=>[s(U,{class:"text-bold text-italic",style:{"font-family":"'Gill Sans'","font-size":"35px"}},{default:l(()=>[R("iDMED")]),_:1}),s(U,{class:"text-bold text-italic",style:{"font-family":"'Gill Sans'","font-size":"25px"}},{default:l(()=>[R(A(O.value!==null?O.value.parentClinic_id!==void 0&&O.value.parentClinic_id!==null?O.value.parentClinic.clinicName+" - "+O.value.clinicName:O.value.clinicName:ne.value!==null?"Provincia - "+ne.value.description:""),1)]),_:1})]),_:1})]),_:1}),s(Fe,{class:"absolute-center","no-caps":"",modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=P=>r.value=P),"active-color":"orange","indicator-color":"orange",align:"justify","narrow-indicator":""},{default:l(()=>[s(M,{exact:"",default:"",to:"/home",name:"home",icon:"home",label:"Inicial"}),B("Pacientes")?(S(),k(M,{key:0,exact:"",to:"/patients",name:"patients",icon:"person_outline",label:"Pacientes/Utentes"})):Q("",!0),B("Grupos")&&!L(f)()&&L(y)?(S(),k(M,{key:1,exact:"",to:"/group/search",name:"groups",icon:"groups",label:"Grupos"})):Q("",!0),B("Stock")&&(!L(f)()||L(m)()||L(e))?(S(),k(M,{key:2,exact:"",to:"/stock",name:"stock",icon:"shopping_cart",label:"Stock"},{default:l(()=>[_.value>0?(S(),k(We,{key:0,color:"red",floating:"",transparent:""},{default:l(()=>[R(A(_.value),1)]),_:1})):Q("",!0)]),_:1})):Q("",!0),B("Dashboard")?(S(),k(M,{key:3,exact:"",to:"/dashboard",name:"dashboard",icon:"dashboard",label:"Dashboard"})):Q("",!0),B("Relatorios")?(S(),k(M,{key:4,exact:"",to:"/reports",name:"reports",icon:"insert_chart_outlined",label:"Relat\xF3rios"})):Q("",!0),B("Administra\xE7\xE3o")&&L(y)?(S(),k(M,{key:5,exact:"",to:"/settings",name:"settings",icon:"settings",label:"Administra\xE7\xE3o"})):Q("",!0),B("Migra\xE7\xE3o")&&w.value&&L(h)&&!L(f)()?(S(),k(M,{key:6,exact:"",to:"/migration",name:"migration",icon:"branding_watermark",label:"Migra\xE7\xE3o"})):Q("",!0),B("DCProvedor")&&!L(f)()&&L(h)?(S(),k(M,{key:7,exact:"",to:"/loadfiledc",name:"migration",icon:"connect_without_contact",label:"DC pelo Provedor"})):Q("",!0)]),_:1},8,["modelValue"]),s(Ke,{unelevated:"",modelValue:i.value,"onUpdate:modelValue":v[5]||(v[5]=P=>i.value=P),"no-caps":"",onClick:a.value},{label:l(()=>[V("div",bt,[s(G,{size:"lg",icon:"account_circle"}),V("div",_t,A(o.value),1)])]),default:l(()=>[s(je,{style:{width:"190px"}},{default:l(()=>[s(K,null,{default:l(()=>[s($,{avatar:""},{default:l(()=>[s(G,{icon:"account_circle"})]),_:1}),s($,null,{default:l(()=>[s(U,{lines:"1"},{default:l(()=>[V("div",St,A(o.value),1)]),_:1})]),_:1})]),_:1}),d.value?(S(),k(K,{key:0,clickable:""},{default:l(()=>[s($,{avatar:"",clickable:"",onClick:v[1]||(v[1]=P=>X())},{default:l(()=>[s(G,{icon:"sync"})]),_:1}),s($,{clickable:"",onClick:v[2]||(v[2]=P=>X())},{default:l(()=>[R("Sincronizar")]),_:1})]),_:1})):Q("",!0),d.value?(S(),k(K,{key:1,clickable:""},{default:l(()=>[s($,{avatar:"",clickable:"",onClick:v[3]||(v[3]=P=>X())},{default:l(()=>[s(G,{icon:"delete"})]),_:1}),s($,{clickable:"",onClick:v[4]||(v[4]=P=>ke())},{default:l(()=>[R("Limpar Dados")]),_:1})]),_:1})):Q("",!0),s(be,{spaced:""}),Be((S(),k(K,{clickable:"",onClick:t.value,to:"/Logout"},{default:l(()=>[s($,{avatar:""},{default:l(()=>[s(G,{icon:"mdi-logout"})]),_:1}),s($,null,{default:l(()=>[s(U,null,{default:l(()=>[R("Sair")]),_:1}),s(U,{caption:""},{default:l(()=>[R("Sair do Sistema")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[Xe]])]),_:1})]),_:1},8,["modelValue","onClick"])]),_:1})]),_:1})]),s(Re,{persistent:"",modelValue:T.value,"onUpdate:modelValue":v[7]||(v[7]=P=>T.value=P)},{default:l(()=>[s(ht,{onClose:v[6]||(v[6]=P=>T.value=!1)})]),_:1},8,["modelValue"]),s(Oe,null,{default:l(()=>[s(we,null,{default:l(({Component:P})=>[(S(),k(Ee(P)))]),_:1})]),_:1}),s(at,{class:"text-right text-caption text-italic",style:{"font-family":"'Gill Sans'"}},{default:l(()=>[V("span",kt,"iDMED v"+A(L(Ze)),1)]),_:1})]),_:1})}}};export{zt as default};
