import{Q as va,a as Da,b as sr}from"./QTabPanels.fab18ecb.js";import{Q as rr}from"./QTabs.9968ab83.js";import{r as S,c as Ke,bg as ut,K as M,L as J,M as A,O as ie,f as F,a_ as se,F as lt,c9 as it,a8 as St,a4 as j,a5 as te,aC as Nt,cc as gn,o as Me,W as bo,i as Be,R as Ti,a7 as ke,Y as ce,bO as P,$ as de,ce as Ge,b as So,U as At,S as bt,dx as ba,ds as cr,c$ as dr,w as ur,a1 as E,a6 as nt,P as Sa,V as Ze,dy as ee,bL as We,dz as Ii,J as st,b8 as He,c1 as gr,be as yo,b4 as Re,a2 as fr,dA as Bi,dB as fn,dC as Oi,cd as wo,H as dt,dl as Yt,dD as Li,dE as ki,dF as No,I as mn,bZ as Vi,cI as mr,cK as zi,cV as et,bf as pr,dG as Ct,bJ as _i,cf as Ui,da as $i,C as vt,dH as xt,dI as at,dJ as Et,z as Mt,A as pn,dK as Hi,dL as Gi,dM as qi,dN as hn,B as hr,cb as vr,aF as Dr,dO as br,a$ as Sr,aa as yr}from"./index.28c7e456.js";import{Q as ya}from"./QBar.e1318611.js";import{Q as wr}from"./QScrollArea.288f8a37.js";import{_ as Rr}from"./TitleBar.f7be41e1.js";import{Q as mt}from"./QSelect.caa108f8.js";import{a as Cr,Q as xr}from"./QBtnDropdown.23f7ab1d.js";import{b as pe,Q as fe}from"./QMenu.9a83401e.js";import{Q as yt}from"./QList.d4521672.js";import{Q as Pt,_ as ae}from"./ListHeader.c33af243.js";import{C as vn}from"./ClosePopup.20eb2e56.js";import{Q as Ro}from"./QExpansionItem.095ed3fd.js";import{R as C}from"./ReportService.c2f34a2e.js";import{E as Ce,M as le,a as K}from"./imageBytes.1a4fecd7.js";import{e as xe,s as Ue,F as _e}from"./exceljs.min.c840c290.js";import{f as Xe,a as Je,D as Oe}from"./NotoSans-Regular.92f6a76e.js";import{r as Ve,R as Wi}from"./ReceivedStockMobileService..72a4bb91.js";import{Q as wa,a as Ra}from"./QPopupProxy.bc9f6d75.js";import{Q as To}from"./QTooltip.f3ef7ac8.js";import{Q as Pr}from"./QBadge.cb49eccd.js";import{Q as Ar}from"./QLinearProgress.c6927d78.js";import{Q as Ca}from"./QSpinnerIos.e4750760.js";import{_ as Fe}from"./plugin-vue_export-helper.21dcd24c.js";import{D as Qi,R as ji}from"./StockMethod.5d6dd1ce.js";import{u as Xi}from"./use-quasar.084c7cba.js";import"./TouchPan.90ce57a2.js";import"./position-engine.b3fa6cbd.js";import"./use-render-cache.3aae9b27.js";import"./QSlideTransition.7e213459.js";import"./StockAlertService.3ee5a37f.js";const Fr={class:"row"},Er={class:"col"},Mr={key:0},Yr={key:1,class:"items-center col"},Nr={key:1,class:"items-center col q-ma-sm"},Tr={__name:"ListReportMenuMobile",emits:["changeTab"],setup(e,{emit:l}){const n=l,o=S(""),i=S(null),a=[{description:"Pacientes",id:1,menuItem:[{description:"Activos na Farm\xE1cia",tabName:"ActivesInDrugStore"},{description:"Lista de Pacientes Com Rastreio de TB",tabName:"TBScreening"},{description:"Lista de Pacientes Rastreados para RAM",tabName:"RAMScreening"},{description:"Lista de Pacientes Monitorados Para Ades\xE3o",tabName:"PatientsMonitoredForAdherence"},{description:"Lista de Pacientes Rastreados Para Gravidez",tabName:"PatientWithPregnancyScreening"},{description:"Lista de Pacientes que Levantaram Medicamentos na US",tabName:"PatientsPickedUpMedsAtUS"},{description:"Lista de Pacientes Esperados no dia",tabName:"expectedOfDay"}]},{description:"Gest\xE3o de Farm\xE1cia",id:2,menuItem:[{description:"Lista de Pacientes Faltosos ao Levantamento",tabName:"AbsentPatients"},{description:"Mapa Mensal de Informa\xE7\xE3o de ARV (MMIA)",tabName:"Mmia"},{description:"Hist\xF3rico de Levantamentos",tabName:"PatientHistory"},{description:"Lista de Dispensas por Frascos",tabName:"PacksByDrugBottles"}]},{description:"Stock",id:4,menuItem:[{description:"Lista de Stock Recebido",tabName:"ReceivedStock"},{description:"Lista de Stock Usado",tabName:"UsedStock"}]},{description:"Monitoria e Avalia\xE7\xE3o",id:5,menuItem:[{description:"Lista de Registro Di\xE1rio de ARV",tabName:"ArvDailyRegister"},{description:"Lista de Dispensas nao sicronizadas",tabName:"NotSynchronizedPackToServer"}]}],s=t=>{o.value=t,n("changeTab",t,i.value)},d=Ke(()=>ut.getAllClinicalServices());return(t,m)=>(M(),J(Pt,{dense:"","inline-actions":"",class:gn([[t.bgColor],"text-white q-pa-none"])},{default:A(()=>[ie("div",Fr,[ie("div",Er,[F(mt,{class:"q-ma-sm items-center","bg-color":"white",dense:"",outlined:"",style:{"max-width":"300px"},ref:"clinicalService",modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=g=>i.value=g),options:d.value,"option-value":"id","option-label":"code",label:"Servi\xE7o de Sa\xFAde"},null,8,["modelValue","options"])]),i.value!==null?(M(),J(yt,{key:0},{default:A(()=>[i.value.code==="TARV"?(M(),se("div",Mr,[F(Cr,{push:""}),(M(),se(lt,null,it(a,g=>F(xr,{color:"orange-6",key:g.id,label:g.description,"header-class":"bg-green-1 text-black",class:"q-ma-sm"},{default:A(()=>[F(yt,{bordered:"",separator:""},{default:A(()=>[(M(!0),se(lt,null,it(g.menuItem,(f,r)=>St((M(),J(pe,{key:r,clickable:"",active:!0,class:"bg-orange-1 q-ma-sm text-black",onClick:p=>s(f.tabName)},{default:A(()=>[F(fe,null,{default:A(()=>[j(te(f.description),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[Nt],[vn]])),128))]),_:2},1024)]),_:2},1032,["label"])),64))])):(M(),se("div",Yr,[F(Pt,{rounded:"",class:"bg-orange-1 text-left text-orange-10"},{default:A(()=>[j(" Nenhum Relat\xF3rio assossiado ao Servi\xE7o de Sa\xFAde Seleccionado!. ")]),_:1})]))]),_:1})):(M(),se("div",Nr,[F(Pt,{rounded:"",class:"bg-orange-1 text-left text-orange-10"},{default:A(()=>[j(" Nenhum Servi\xE7o de Sa\xFAde foi Seleccionado!. ")]),_:1})]))])]),_:1},8,["class"]))}},Ir={class:"q-pa-sm no-margin no-padding full-height",style:{"max-width":"1000px"}},Br={__name:"tarv",emits:["changeTab"],setup(e,{emit:l}){const n=l,o=S(null),i=S(""),a=[{description:"Pacientes",id:1,menuItem:[{description:"Activos na Farm\xE1cia",tabName:"ActivesInDrugStore"},{description:"Pacientes Esperados Num Dia",tabName:"expectedOfDay"},{description:"Pacientes Sem dispensa",tabName:"PatientsWithouDispense"}]},{description:"Gest\xE3o de Farm\xE1cia",id:2,menuItem:[{description:"Lista de Pacientes Faltosos ao Levantamento",tabName:"AbsentPatients"},{description:"Lista de Pacientes Faltosos ao Levantamento de ARV's para Dispensa Trimestral",tabName:"AbsentPatientsDT"},{description:"Lista de Pacientes Faltosos ao Levantamento de ARV's para Dispensa Semestral",tabName:"AbsentPatientsDS"},{description:"Mapa Mensal de Informa\xE7\xE3o de ARV (MMIA)",tabName:"Mmia"},{description:"Linhas Terapeuticas Usadas",tabName:"LinhasTerapeuticasUsadas"},{description:"Segundas Linhas",tabName:"SegundasLinhas"},{description:"Pacientes Abandono",tabName:"PatientsAbandonment"},{description:"Pacientes Abandono Que Retornaram",tabName:"PatientsAbandonmentReturned"},{description:"Hist\xF3rico de Levantamentos",tabName:"PatientHistory"},{description:"Lista de Pacientes Faltosos ao Levantamento de ARV's para APSS",tabName:"AbsentPatientsApss"},{description:"Pacientes em Dispensa Semestral",tabName:"SemiannualDispensation"},{description:"Pacientes em Dispensa Trimestral",tabName:"QuarterlyDispensation"}]},{description:"Refer\xEAncias",id:3,menuItem:[{description:"Lista de Pacientes Referidos Para outras Farmacias",tabName:"ReferredPatients"},{description:"Lista de Pacientes que voltaram da Referencia",tabName:"ReferredBackPatients"},{description:"Lista de Pacientes referidos faltosos em outras Farmacias",tabName:"AbsentReferredPatients"},{description:"Historico de Levantamentos de Pacientes Referidos",tabName:"ReferredPatientDispenseHistory"}]},{description:"Stock",id:4,menuItem:[{description:"Lista de Stock Recebido",tabName:"ReceivedStock"},{description:"Lista de Stock Usado",tabName:"UsedStock"},{description:"Medicamentos Remanescentes (Sobras/Perdas)",tabName:"QuantityRemain"},{description:"Inventario Parcial",tabName:"partialInventory"},{description:"Inventario Geral",tabName:"generalInventory"},{description:"Balancete",tabName:"Balancete"}]},{description:"Monitoria e Avalia\xE7\xE3o",id:5,menuItem:[{description:"Lista de Registro Di\xE1rio de ARV",tabName:"ArvDailyRegister"},{description:"Lista de Possiveis Pacientes Duplicados",tabName:"PossiblePatientDuplicates"},{description:"Lista de Dispensas Nao Sicronizadas Para o OpenMrs",tabName:"NotSynchronizedPack"},{description:"Lista de Pacientes Registados \xE0 partir do iDMED",tabName:"RegisteredInIdmed"}]}],s=d=>{i.value=d,n("changeTab",d,o.value)};return Me(()=>{}),(d,t)=>(M(),se(lt,null,it(a,m=>F(Ro,{key:m.id,group:"somegroup",label:m.description,"header-class":"bg-green-1 text-black","expand-icon-class":"text-black",class:"q-ma-sm"},{default:A(()=>[F(bo,{class:"bg-white"},{default:A(()=>[ie("div",Ir,[F(yt,{bordered:"",separator:""},{default:A(()=>[(M(!0),se(lt,null,it(m.menuItem,(g,f)=>St((M(),J(pe,{key:f,clickable:"",active:!0,class:"bg-orange-1 q-ma-sm text-black",onClick:r=>s(g.tabName)},{default:A(()=>[F(fe,null,{default:A(()=>[j(te(g.description),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[Nt]])),128))]),_:2},1024)])]),_:2},1024)]),_:2},1032,["label"])),64))}},Or={class:"q-pa-sm no-margin no-padding full-height",style:{"max-width":"1000px"}},Lr={__name:"tpt",emits:["changeTab"],setup(e,{emit:l}){const n=l,o=S(null),i=S(""),a=[{description:"Pacientes",id:1,menuItem:[]},{description:"Gest\xE3o de Farm\xE1cia",id:2,menuItem:[{description:"Mapa Mensal de Medicamentos da TB (MMIATB)",tabName:"MmiaTb"},{description:"Hist\xF3rico de Levantamentos TPT",tabName:"PatientHistoryTPT"}]},{description:"Refer\xEAncias",id:3,menuItem:[]},{description:"Stock",id:4,menuItem:[]},{description:"Monitoria e Avalia\xE7\xE3o",id:5,menuItem:[{description:"Lista de Registro Di\xE1rio de TPT",tabName:"TptDailyRegister"}]}],s=d=>{i.value=d,n("changeTab",d,o.value)};return Me(()=>{}),(d,t)=>(M(),se(lt,null,it(a,m=>F(Ro,{key:m.id,group:"somegroup",label:m.description,"header-class":"bg-green-1 text-black","expand-icon-class":"text-black",class:"q-ma-sm"},{default:A(()=>[F(bo,{class:"bg-white"},{default:A(()=>[ie("div",Or,[F(yt,{bordered:"",separator:""},{default:A(()=>[(M(!0),se(lt,null,it(m.menuItem,(g,f)=>St((M(),J(pe,{key:f,clickable:"",active:!0,class:"bg-orange-1 q-ma-sm text-black",onClick:r=>s(g.tabName)},{default:A(()=>[F(fe,null,{default:A(()=>[j(te(g.description),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[Nt]])),128))]),_:2},1024)])]),_:2},1024)]),_:2},1032,["label"])),64))}},kr={class:"q-pa-sm no-margin no-padding full-height",style:{"max-width":"1000px"}},Vr={__name:"prep",emits:["changeTab"],setup(e,{emit:l}){const n=l,o=S(null),i=S(""),a=[{description:"Pacientes",id:1,menuItem:[]},{description:"Gest\xE3o de Farm\xE1cia",id:2,menuItem:[{description:"Hist\xF3rico de Levantamentos PREP",tabName:"PatientHistoryPREP"}]},{description:"Refer\xEAncias",id:3,menuItem:[]},{description:"Stock",id:4,menuItem:[]},{description:"Monitoria e Avalia\xE7\xE3o",id:5,menuItem:[{description:"Lista de Registro Di\xE1rio de PREP",tabName:"PrepDailyRegister"}]}],s=d=>{i.value=d,n("changeTab",d,o.value)};return Me(()=>{}),(d,t)=>(M(),se(lt,null,it(a,m=>F(Ro,{key:m.id,group:"somegroup",label:m.description,"header-class":"bg-green-1 text-black","expand-icon-class":"text-black",class:"q-ma-sm"},{default:A(()=>[F(bo,{class:"bg-white"},{default:A(()=>[ie("div",kr,[F(yt,{bordered:"",separator:""},{default:A(()=>[(M(!0),se(lt,null,it(m.menuItem,(g,f)=>St((M(),J(pe,{key:f,clickable:"",active:!0,class:"bg-orange-1 q-ma-sm text-black",onClick:r=>s(g.tabName)},{default:A(()=>[F(fe,null,{default:A(()=>[j(te(g.description),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[Nt]])),128))]),_:2},1024)])]),_:2},1024)]),_:2},1032,["label"])),64))}},zr={class:"q-pa-sm no-margin no-padding full-height",style:{"max-width":"1000px"}},_r={__name:"tb",emits:["changeTab"],setup(e,{emit:l}){const n=l,o=S(null),i=S(""),a=[{description:"Pacientes",id:1,menuItem:[]},{description:"Gest\xE3o de Farm\xE1cia",id:2,menuItem:[]},{description:"Refer\xEAncias",id:3,menuItem:[]},{description:"Stock",id:4,menuItem:[]},{description:"Monitoria e Avalia\xE7\xE3o",id:5,menuItem:[]}],s=d=>{console.log(d),i.value=d,n("changeTab",d,o.value)};return Me(()=>{}),(d,t)=>(M(),se(lt,null,it(a,m=>F(Ro,{key:m.id,group:"somegroup",label:m.description,"header-class":"bg-green-1 text-black","expand-icon-class":"text-black",class:"q-ma-sm"},{default:A(()=>[F(bo,{class:"bg-white"},{default:A(()=>[ie("div",zr,[F(yt,{bordered:"",separator:""},{default:A(()=>[(M(!0),se(lt,null,it(m.menuItem,(g,f)=>St((M(),J(pe,{key:f,clickable:"",active:!0,class:"bg-orange-1 q-ma-sm text-black",onClick:r=>s(g.tabName)},{default:A(()=>[F(fe,null,{default:A(()=>[j(te(g.description),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[Nt]])),128))]),_:2},1024)])]),_:2},1024)]),_:2},1032,["label"])),64))}},Ur={class:"q-pa-md",style:{"max-width":"500px"}},$r={key:0},Hr={key:1},Gr={key:2},qr={key:3},Wr={key:4,class:"vertical-middle"},Qr={key:1,class:"vertical-middle"},jr={__name:"ListReportMenu",emits:["changeTab"],setup(e,{emit:l}){const n=l,o=S(""),i=S(null),a=Be("servicoActual"),s=Be("codeServicoActual"),d=g=>{a.value=g,s.value=g.code},t=g=>{o.value=g,n("changeTab",g,i.value)},m=Ke(()=>ut.getAllClinicalServices());return(g,f)=>(M(),se("div",null,[F(Pt,{dense:"","inline-actions":"",class:"text-white q-pa-none"},{default:A(()=>[F(mt,{class:"q-ma-sm",dense:"",outlined:"",filled:"",ref:"clinicalService",modelValue:i.value,"onUpdate:modelValue":[f[0]||(f[0]=r=>i.value=r),f[1]||(f[1]=r=>d(r))],options:m.value,"option-value":"id","option-label":"code",label:"Servi\xE7o de Sa\xFAde"},null,8,["modelValue","options"]),F(Ti),ie("div",Ur,[i.value!==null?(M(),J(yt,{key:0,bordered:""},{default:A(()=>[ke(s)==="TARV"?(M(),se("div",$r,[F(Br,{onChangeTab:t})])):ke(s)==="TPT"?(M(),se("div",Hr,[F(Lr,{onChangeTab:t})])):ke(s)==="PREP"?(M(),se("div",Gr,[F(Vr,{onChangeTab:t})])):ke(s)==="TB"?(M(),se("div",qr,[F(_r,{onChangeTab:t})])):(M(),se("div",Wr,[F(Pt,{rounded:"",class:"bg-orange-1 text-left text-orange-10"},{default:A(()=>[j(" Nenhum Relat\xF3rio assossiado ao Servi\xE7o de Sa\xFAde Seleccionado!. ")]),_:1})]))]),_:1})):(M(),se("div",Qr,[F(Pt,{rounded:"",class:"bg-orange-1 text-left text-orange-10"},{default:A(()=>[j(" Nenhum Servi\xE7o de Sa\xFAde foi Seleccionado!. ")]),_:1})]))])]),_:1})]))}},{isMobile:xa,isOnline:Pa}=ce(),Dn="PacientesActivosNaFarmacia",Xr=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Jr="Lista de Pacientes Activos na Farm\xE1cia",Io=Dn.concat("_"+P(new Date).format("DD-MM-YYYY"));var kt={async downloadPDF(e,l,n,o,i){const a=await Xe(Je),s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});d.addFileToVFS("NotoSans-Regular.ttf",a.split(",")[1]),d.addFont("NotoSans-Regular.ttf","NotoSans","normal"),d.setFont("NotoSans");const t=o[0];d.setProperties({title:Io.concat(".pdf")});const m=new Image;m.src="data:image/png;base64,"+le;const g=[[{content:"Lista de Pacientes Activos na Farm\xE1cia",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" \xE0 "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+t.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+t.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:g}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(m,"png",28,15,10,10);const f=["ORD","NID","Nome","Idade","Contacto","Tipo Paciente","Linha Terap\xEAutica","Regime Terap\xEAutico","Data Levant.","Data Prox. Levant."],r=o,p=[];let v=1;for(const b in r){const D=[];D.push(v),D.push(r[b].nid),D.push(r[b].firstNames+" "+r[b].lastNames),D.push(r[b].age),D.push(r[b].cellphone),D.push(r[b].patientType),D.push(r[b].therapeuticLine),D.push(r[b].therapeuticRegimen),D.push(P(new Date(r[b].pickupDate)).format("DD-MM-YYYY")),D.push(P(new Date(r[b].nextPickUpDate)).format("DD-MM-YYYY")),p.push(D),v+=1}if(v=0,K(d,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:15},1:{cellWidth:45},2:{cellWidth:45},3:{cellWidth:20},4:{cellWidth:25},5:{cellWidth:20},6:{cellWidth:25},7:{cellWidth:30}},didDrawPage:function(b){const D="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const u=d.internal.pageSize,c=u.height?u.height:u.getHeight();d.text(D,b.settings.margin.right,c-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[f],body:p}),Pa.value&&!xa.value)window.open(d.output("bloburl")),i.value=!1;else{const b=d.output();Oe.downloadFile(Io,".pdf",b,i)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Dn),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getRow(15),_=t.getColumn("A"),N=t.getColumn("B"),O=t.getColumn("C"),T=t.getColumn("D"),q=t.getColumn("E"),I=t.getColumn("F"),X=t.getColumn("G"),$=t.getColumn("H"),w=t.getColumn("I"),V=t.getColumn("J");g.alignment=f.alignment=R.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Xr,f.value=Jr,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=l,x.value=n,r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A13:I13"),R.height=30,_.width=20,N.width=20,O.width=30,T.width=15,q.width=20,I.width=15,X.width=15,$.width=15,w.width=15,V.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Dn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1},{name:"Tipo Paciente",totalsRowFunction:"none",filterButton:!1},{name:"Linha Terap\xEAutica",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terap\xEAutico",totalsRowFunction:"none",filterButton:!1},{name:"Data Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data Prox. Levant.",totalsRowFunction:"none",filterButton:!1}],rows:s});const U=t.lastRow.number!==void 0?t.lastRow.number:0;for(let k=14;k<=U;k++)t.getRow(k).eachCell({includeEmpty:!0},B=>{B.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},B.alignment={vertical:"middle",horizontal:"center",wrapText:!0},k===14&&(B.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},B.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const z=await d.xlsx.writeBuffer(),Q="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Z=".xlsx",L=new Blob([z],{type:Q});if(Pa.value&&!xa.value)Ue(L,Io+Z),i.value=!1;else{const k="PacientesActivos";Oe.downloadFile(k,".xlsx",L,i)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(e[o].age),i.push(e[o].cellphone),i.push(e[o].patientType),i.push(e[o].therapeuticLine),i.push(e[o].therapeuticRegimen),i.push(P(new Date(e[o].pickupDate)).format("DD-MM-YYYY")),i.push(P(new Date(e[o].nextPickUpDate)).format("DD-MM-YYYY")),l.push(i),n+=1}return n=0,e=[],l}};function Kr(){function e(l){const n=Ge({barVal:0,percentVal:"0%"});return n.barVal=l.toFixed(2)/100,n.percentVal=l.toFixed(0)+"%",n}return{barAndPercentProgressVal:e}}const Zr={class:"row q-mb-md"},ec={__name:"SemesterPeriod",setup(e){const l=Be("initProcessing"),n=Be("reportParams"),o=Be("errorCount"),i=Be("resultFromLocalStorage"),a=Be("serviceAux"),s=S(null);let d=S(new Date().getFullYear());const t=S([{id:1,description:"Semestre 1"},{id:2,description:"Semestre 2"}]),m=S(null),g=S(null),f=()=>{let v=0;m.value.validate(),m.value.hasError&&v++,g.value.validate(),g.value.hasError&&v++,o(v)},r=v=>{n.value.monthSemesterQuarterView=v,n.value.period=v.id},p=v=>{n.value.year=v};return Me(()=>{n.value&&(a.value=ut.getClinicalServicePersonalizedById(n.value.clinicalService),i.value=!0,d.value=n.value.year,s.value=n.value.monthSemesterQuarterView)}),(v,b)=>(M(),se("form",{onSubmit:bt(f,["prevent"])},[ie("div",Zr,[F(mt,{class:"col q-mr-md",dense:"",outlined:"","transition-show":"flip-up","transition-hide":"flip-down",options:t.value,modelValue:s.value,"onUpdate:modelValue":[b[0]||(b[0]=D=>s.value=D),b[1]||(b[1]=D=>r(D))],ref_key:"semesterPeriodRef",ref:m,"option-value":"id","option-label":"description",rules:[D=>!!D||" Por favor indique o Semestre"],"lazy-rules":"",label:"Semestre",disable:ke(l)},null,8,["options","modelValue","rules","disable"]),F(At,{disable:ke(l),class:"col q-mr-md",dense:"",outlined:"",ref_key:"yearSemesterPeriodRef",ref:g,type:"number",rules:[D=>!!D||" Por favor indique o ano"],modelValue:ke(d),"onUpdate:modelValue":[b[2]||(b[2]=D=>So(d)?d.value=D:d=D),b[3]||(b[3]=D=>p(D))]},null,8,["disable","rules","modelValue"])])],32))}},tc={class:"row q-mb-md"},oc={__name:"MonthlyPeriod",setup(e){const l=Be("initProcessing"),n=Be("reportParams"),o=Be("errorCount"),i=Be("resultFromLocalStorage"),a=Be("serviceAux");let s=S(parseInt(new Date().getFullYear()));const d=S(null),t=S(null),m=S(null),g=S([{id:1,description:"Janeiro"},{id:2,description:"Fevereiro"},{id:3,description:"Mar\xE7o"},{id:4,description:"Abril"},{id:5,description:"Maio"},{id:6,description:"Junho"},{id:7,description:"Julho"},{id:8,description:"Agosto"},{id:9,description:"Setembro"},{id:10,description:"Outubro"},{id:11,description:"Novembro"},{id:12,description:"Dezembro"}]),f=()=>{let v=0;d.value.validate(),d.value.hasError&&v++,t.value.validate(),t.value.hasError&&v++,o(v)},r=v=>{n.value.monthSemesterQuarterView=v,n.value.period=v.id},p=v=>{n.value.year=v};return Me(()=>{n.value.id&&(a.value=ut.getClinicalServicePersonalizedById(n.value.clinicalService),i.value=!0,s.value=n.value.year,m.value=n.value.monthSemesterQuarterView)}),(v,b)=>(M(),se("form",{onSubmit:bt(f,["prevent"])},[ie("div",tc,[F(mt,{class:"col q-mr-md",dense:"",outlined:"","transition-show":"flip-up","transition-hide":"flip-down",options:g.value,modelValue:m.value,"onUpdate:modelValue":[b[0]||(b[0]=D=>m.value=D),b[1]||(b[1]=D=>r(D))],ref_key:"monthlyPeriodRef",ref:d,"option-value":"id","option-label":"description",rules:[D=>!!D||"Por favor indique o M\xEAs"],"lazy-rules":"",label:"M\xEAs",disable:ke(l)},null,8,["options","modelValue","rules","disable"]),F(At,{disable:ke(l),class:"col q-mr-md",dense:"",outlined:"",modelValue:ke(s),"onUpdate:modelValue":[b[2]||(b[2]=D=>So(s)?s.value=D:s=D),b[3]||(b[3]=D=>p(D))],type:"number",ref_key:"yearMonthlyPeriodRef",ref:t,rules:[D=>!!D||"Por favor indique o ano"]},null,8,["disable","modelValue","rules"])])],32))}},nc={class:"row q-mb-md"},ac={__name:"QuarterlyPeriod",setup(e){const l=Be("initProcessing"),n=Be("reportParams"),o=Be("errorCount"),i=Be("resultFromLocalStorage"),a=Be("serviceAux"),s=S(null);let d=S(new Date().getFullYear());const t=S([{id:1,description:"Trimestre 1"},{id:2,description:"Trimestre 2"},{id:3,description:"Trimestre 3"},{id:4,description:"Trimestre 4"}]),m=S(null),g=S(null),f=()=>{let v=0;m.value.validate(),m.value.hasError&&v++,g.value.validate(),g.value.hasError&&v++,o(v)},r=v=>{n.value.monthSemesterQuarterView=v,n.value.period=v.id},p=v=>{n.value.year=v};return Me(()=>{n.value&&(a.value=ut.getClinicalServicePersonalizedById(n.value.clinicalService),i.value=!0,d.value=n.value.year,s.value=n.value.monthSemesterQuarterView)}),(v,b)=>(M(),se("form",{onSubmit:bt(f,["prevent"])},[ie("div",nc,[F(mt,{class:"col q-mr-md",dense:"",outlined:"","transition-show":"flip-up","transition-hide":"flip-down",options:t.value,modelValue:s.value,"onUpdate:modelValue":[b[0]||(b[0]=D=>s.value=D),b[1]||(b[1]=D=>r(D))],ref_key:"quarterlyPeriodRef",ref:m,"option-value":"id","option-label":"description",rules:[D=>!!D||"Por favor indique o Trimestre"],"lazy-rules":"",label:"Trimestre",disable:ke(l)},null,8,["options","modelValue","rules","disable"]),F(At,{disable:ke(l),class:"col q-mr-md",dense:"",outlined:"",type:"number",ref_key:"yearQuarterlyPeriodRef",ref:g,rules:[D=>!!D||"Por favor indique o ano"],modelValue:ke(d),"onUpdate:modelValue":[b[2]||(b[2]=D=>So(d)?d.value=D:d=D),b[3]||(b[3]=D=>p(D))]},null,8,["disable","rules","modelValue"])])],32))}},lc={class:"row q-mb-md"},ic={__name:"AnnualPeriod",setup(e){const l=Be("initProcessing"),n=Be("reportParams"),o=Be("errorCount"),i=Be("resultFromLocalStorage"),a=Be("serviceAux");let s=S(new Date().getFullYear());const d=S(null),t=()=>{let g=0;d.value.validate(),d.value.hasError&&g++,o(g)},m=g=>{n.value.year=g};return Me(()=>{n.value&&(a.value=ut.getClinicalServicePersonalizedById(n.value.clinicalService),i.value=!0,s.value=n.value.year)}),(g,f)=>(M(),se("form",{onSubmit:bt(t,["prevent"])},[ie("div",lc,[F(At,{class:"col q-mr-md",dense:"",disable:ke(l),outlined:"",modelValue:ke(s),"onUpdate:modelValue":[f[0]||(f[0]=r=>So(s)?s.value=r:s=r),f[1]||(f[1]=r=>m(r))],type:"number",label:"Ano",rules:[r=>!!r||" Por favor indique o ano"],ref_key:"annualPeriodRef",ref:d},null,8,["disable","modelValue","rules"])])],32))}};const sc={class:"row"},rc={class:"col row q-pt-md"},cc={key:2,class:"row q-mb-md"},dc={class:"row items-center justify-end"},uc={class:"row items-center justify-end"},gc={class:""},fc={class:"q-mr-md q-pt-xs items-center",style:{width:"250px"}},mc={class:"absolute-full flex flex-center"},pc={class:"row q-ml-md"},hc={class:"col"},Aa=0,ye={__name:"FiltersInput",props:["clinicalService","menuSelected","id","progress","reportType","progressValue","applicablePeriods","tabName","params"],emits:["initReportProcessing","updateProgressBar","generateReport"],setup(e,{emit:l}){ce();const{barAndPercentProgressVal:n}=Kr(),o=e,i=l,a=S(!1),s=Be("currClinic"),d=S(0),t=S(""),m=S(null),g=S(null),f=S(""),r=S(""),p=S(""),v=S(""),b=S(""),D=Be("downloadingXls"),u=Be("downloadingPdf"),c=S(.01),h=S({id:null,provinceId:null,districtId:null,clinicId:null,clinic:null,province:null,district:null,endDateParam:null,startDateParam:null,clinicalService:null,year:new Date().getFullYear(),period:null,periodTypeView:null,monthSemesterQuarterView:null,reportType:null,progress:0,localOrOnline:"",startDate:null,endDate:null,online:!0,tabName:null}),y=S(!1),x=S(!1),R=S([{id:1,description:"Especifico",code:"SPECIFIC"},{id:2,description:"Mensal",code:"MONTH"},{id:3,description:"Trimestral",code:"QUARTER"},{id:4,description:"Semestral",code:"SEMESTER"},{id:5,description:"Anual",code:"ANNUAL"},{id:6,description:"N/A",code:"NOT_APPLICABLE"}]),_=Ke(()=>y.value?R.value.filter(ne=>ne.code==="MONTH"):x.value?R.value.filter(ne=>ne.code==="NOT_APPLICABLE"):R.value.filter(ne=>ne.code!=="NOT_APPLICABLE")),N=S(!1),O=S(!1),T=S(null),q=Be("getProcessingStatus");Me(()=>{a.value=N.value,B(),o.params&&(N.value=!0,O.value=!0,h.value=o.params,q(h.value),T.value=h.value.periodTypeView),(o.tabName==="Mmia"||o.tabName==="MmiaTb")&&(y.value=!0),(o.tabName==="PossiblePatientDuplicates"||o.tabName==="PossiblePatientDuplicates")&&(x.value=!0,T.value=R.value.filter(ne=>ne.code==="NOT_APPLICABLE")[0],h.value.period=T.value.id,h.value.periodTypeView=T.value,T.value=T.value)});const I=()=>{setInterval(()=>{c.value>=1?c.value=w.value.barVal:c.value+=.01},300)},X=Ke(()=>O.value?o.params.progress>=100:o.progress>=100),$=Ke(()=>O.value?o.params.progress==.001:o.progress==.001),w=Ke(()=>O.value?n(o.params.progress):n(o.progress)),V=Ke(()=>ba.query().with("districts").has("code").get()),G=()=>h.value.province!==null?o.province.districts:null,U=Ke(()=>h.value.district!==null?cr.query().with("districts").where("district_id",h.value.districtId).get():null),z=Ke(()=>!1),Q=Ke(()=>!0);Ke(()=>ba.query().with("districts").where("id",dr.getItem("currProvince").id).first());const Z=ne=>o.tabName==="ExpectedPatients"||o.tabName==="ExpectedPatients"?!0:S(P(ne).format("YYYY/MM/DD")).value<=P(new Date).format("YYYY/MM/DD"),L=ne=>{Aa=ne},k=()=>{let ne=0;t.value.validate(),t.value.hasError&&ne++,m.value!==void 0&&m.value!==null&&(m.value.validate(),ne=m.value.hasError?ne+1:ne),g.value!==void 0&&g.value!==null&&(g.value.validate(),ne=g.value.hasError?ne+1:ne),(f.value!==null&&f.value!==void 0?f:r.value!==null&&r.value!==void 0?r:p.value!==null&&p.value!==void 0?p:v.value!==null&&v.value!==void 0?v:null)!==null&&b.value.click(),ne===0&&Aa===0&&Y()},H=ne=>{h.value.endDateParam=null,h.value.startDateParam=null,h.value.year=new Date().getFullYear(),h.value.period=ne.id,h.value.periodTypeView=ne,T.value=ne,h.value.progress=0},B=()=>{Q.value?(h.value.clinicId=s.value.id,h.value.clinic=s.value):(h.value.provinceId=s.value.province.id,h.value.province=s.value.province)},W=ne=>{h.value.year=ne},oe=ne=>{h.value.period=ne.id},Y=()=>{h.value.id=o.id,h.value.clinicalService=o.clinicalService.id,h.value.periodTypeView!==null&&(h.value.periodType=h.value.periodTypeView.code),o.reportType!==null&&(h.value.reportType=o.reportType),h.value.district!==null&&(h.value.districtId=h.value.district.id),he(),N.value=!0,i("initReportProcessing",h.value),i("updateProgressBar",d.value)},he=()=>{h.value.tabName=o.tabName,h.value.clinic=null;const ne=JSON.parse(JSON.stringify(h.value));ee.set(h.value.id,ne),h.value.clinic=s.value},Pe=ne=>{ne==="PDF"?u.value=!0:D.value=!0,i("generateReport",o.id,ne,h.value)};return ur(()=>$.value,ne=>{ne&&I()}),E("initProcessing",N),E("errorCount",L),E("setSelectedPeriod",oe),E("setSelectedYear",W),E("reportParams",h),(ne,re)=>(M(),se("form",{onSubmit:bt(k,["prevent"])},[ie("div",sc,[ie("div",rc,[z.value?(M(),J(mt,{key:0,dense:"",outlined:"",disable:"",class:"col q-mr-md",options:V.value,modelValue:h.value.province,"onUpdate:modelValue":re[0]||(re[0]=me=>h.value.province=me),ref:"province","option-value":"id","option-label":"description",label:"Prov\xEDncia"},null,8,["options","modelValue"])):nt("",!0),z.value?(M(),J(mt,{key:1,class:"col q-mr-md",dense:"",outlined:"",options:G,modelValue:h.value.district,"onUpdate:modelValue":re[1]||(re[1]=me=>h.value.district=me),ref:"district","option-value":"id","option-label":"description",label:"Distrito",disable:N.value},null,8,["modelValue","disable"])):nt("",!0),F(mt,{class:"col q-mr-md",dense:"",outlined:"",disable:Q.value,options:U.value,modelValue:h.value.clinic,"onUpdate:modelValue":re[2]||(re[2]=me=>h.value.clinic=me),ref:"clinic","option-value":"id","option-label":"clinicName",label:"Farm\xE1cia"},null,8,["disable","options","modelValue"]),F(mt,{class:"col q-mr-md",dense:"",outlined:"",options:_.value,modelValue:T.value,"onUpdate:modelValue":[re[3]||(re[3]=me=>T.value=me),re[4]||(re[4]=me=>H(me))],ref_key:"period",ref:t,"option-value":"code","option-label":"description",rules:[me=>me!=null||" Por favor indique o per\xEDodo"],"lazy-rules":"",label:"Per\xEDodo *",disable:N.value||x.value},null,8,["options","modelValue","rules","disable"]),h.value.periodTypeView!==null&&h.value.periodTypeView.id===1?(M(),se("div",cc,[F(At,{dense:"",outlined:"",disable:N.value,class:"col q-mr-sm",modelValue:h.value.startDateParam,"onUpdate:modelValue":re[6]||(re[6]=me=>h.value.startDateParam=me),rules:[me=>!!me||"Por favor indique a data de in\xEDcio"],ref_key:"startDate",ref:g,label:"Data In\xEDcio"},{append:A(()=>[F(Sa,{name:"event",class:"cursor-pointer"},{default:A(()=>[F(wa,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:A(()=>[F(Ra,{modelValue:h.value.startDateParam,"onUpdate:modelValue":re[5]||(re[5]=me=>h.value.startDateParam=me),mask:"DD-MM-YYYY"},{default:A(()=>[ie("div",dc,[St(F(Ze,{label:"Close",color:"primary",flat:""},null,512),[[vn]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["disable","modelValue","rules"]),F(At,{style:{width:"100px"},dense:"",outlined:"",disable:N.value,ref_key:"endDate",ref:m,class:"col q-mr-sm",modelValue:h.value.endDateParam,"onUpdate:modelValue":re[8]||(re[8]=me=>h.value.endDateParam=me),rules:[me=>!!me||"Por favor indique a data de fim"],label:"Data Fim"},{append:A(()=>[F(Sa,{name:"event",class:"cursor-pointer"},{default:A(()=>[F(wa,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:A(()=>[F(Ra,{modelValue:h.value.endDateParam,"onUpdate:modelValue":re[7]||(re[7]=me=>h.value.endDateParam=me),mask:"DD-MM-YYYY",options:Z},{default:A(()=>[ie("div",uc,[St(F(Ze,{label:"Close",color:"primary",flat:""},null,512),[[vn]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["disable","modelValue","rules"])])):h.value.periodTypeView!==null&&h.value.periodTypeView.id===2?(M(),J(oc,{key:3,initProcessing:N.value,onSetSelectedQuarter:oe,onSetSelectedYearQuarter:W,onErrorCount:L,ref_key:"periodoRef",ref:f},null,8,["initProcessing"])):h.value.periodTypeView!==null&&h.value.periodTypeView.id===3?(M(),J(ac,{key:4,initProcessing:N.value,onSetSelectedQuarter:oe,onSetSelectedYearQuarter:W,onErrorCount:L,ref_key:"quarterlyPeriod",ref:r},null,8,["initProcessing"])):h.value.periodTypeView!==null&&h.value.periodTypeView.id===4?(M(),J(ec,{key:5,initProcessing:N.value,onSetSelectedSemester:oe,onSetSelectedSemesterYear:W,onErrorCount:L,ref_key:"semesterPeriod",ref:p},null,8,["initProcessing"])):h.value.periodTypeView!==null&&h.value.periodTypeView.id===5?(M(),J(ic,{key:6,initProcessing:N.value,onSetSelectedYearAnnual:W,onErrorCount:L,ref_key:"annualPeriod",ref:v},null,8,["initProcessing"])):nt("",!0),ie("div",gc,[F(Ze,{type:"submit",ref_key:"submitForm",ref:b,class:"gt-xs",color:X.value?"grey-6":"green-6",disable:N.value,dense:"",rounded:"",icon:"chevron_right"},{default:A(()=>[F(To,{class:"bg-primary"},{default:A(()=>[j("Processar o Relat\xF3rio")]),_:1})]),_:1},8,["color","disable"])]),ie("div",fc,[F(Ar,{class:"col q-mx-md",size:"25px",stripe:"",rounded:"",buffer:c.value,value:$.value?.02:w.value.barVal,color:"secondary"},{default:A(()=>[ie("div",mc,[F(Pr,{color:"white","text-color":"accent","animation-speed":"1200",dark:"",label:$.value?"Processamento iniciado...":w.value.percentVal},null,8,["label"])])]),_:1},8,["buffer","value"])])]),ie("div",pc,[ie("div",hc,[ke(D)?(M(),J(Ca,{key:0,class:"row gt-xs",dense:"",color:"primary",size:"2em"})):nt("",!0),ke(D)?nt("",!0):(M(),J(Ze,{key:1,color:X.value?"green-6":"grey-6",class:"row gt-xs",flat:"",dense:"",icon:"article",disable:!X.value,onClick:re[9]||(re[9]=bt(me=>Pe("XLS"),["stop"]))},{default:A(()=>[F(To,{class:"bg-primary"},{default:A(()=>[j("Imprimir Excel")]),_:1}),j(" .Xls ")]),_:1},8,["color","disable"])),ke(u)?(M(),J(Ca,{key:2,class:"gt-xs",dense:"",color:"primary",size:"2em"})):nt("",!0),ke(u)?nt("",!0):(M(),J(Ze,{key:3,color:X.value?"green-6":"grey-6",class:"gt-xs",flat:"",dense:"",onClick:re[10]||(re[10]=bt(me=>Pe("PDF"),["stop"])),disable:!X.value,icon:"article",title:".pdf"},{default:A(()=>[F(To,{class:"bg-primary"},{default:A(()=>[j("Imprimmir Pdf")]),_:1}),j(" .Pdf ")]),_:1},8,["color","disable"]))])])])],32))}},Fa=We[Ii.entity],{idadeReportCalculator:vc}=yo();var Ea={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e),n=de.getById(l.clinicId),[o]=await Promise.all([st.getAllActivePatientByEndDateFromDexie(l.startDate,l.endDate)]);let i=o.reduce((a,s)=>{const d=a[s.patientvisitDetails.patientVisit.patient.id];return(!d||new Date(s.pickupDate)>new Date(d.pickupDate))&&(a[s.patientvisitDetails.patientVisit.patient.id]=s),a},[]);i=Object.values(i);for(const a of i){const s=a.patientvisitDetails.patientVisit.patient,d=a.patientvisitDetails.episode.patientServiceIdentifier,t=a.patientvisitDetails.prescription.prescriptionDetails,m=t.length>0?t[0].therapeuticLine:"",g=t.length>0?t[0].therapeuticRegimen:"",f=a.patientvisitDetails.prescription.patientType==="N/A"?a.patientvisitDetails.prescription.patientStatus:a.patientvisitDetails.prescription.patientType,r=new Ii;r.reportId=l.id,r.year=l.year,r.startDate=l.startDate,r.endDate=l.endDate,r.province=n.province.description,r.clinic=n.clinicName,r.district=n.district.description,r.nid=d.value,r.firstNames=s.firstNames,r.middleNames=s.middleNames,r.lastNames=s.lastNames,r.cellphone=s.cellphone,r.patientType=f,r.pickupDate=a.pickupDate,r.nextPickUpDate=a.nextPickUpDate,r.therapeuticRegimen=g.description,r.therapeuticLine=m.description,r.age=vc(s.dateOfBirth),r.id=He(),this.localDbAddOrUpdate(r)}},groupedPatientVisits(e,l){const o=e.filter(a=>a.pack!==void 0).sort((a,s)=>a.patientVisit.visitDate-s.patientVisit.visitDate);return this.groupedMapChild(o)},getStartStopReasonTypeById(e){return gr.getById(e)},groupedMapChild(e){return e.reduce((l,n)=>l.set(n.patientVisit.patient.id,[...l.get(n.patientVisit.patient.id)||[],n]),new Map)},localDbAddOrUpdate(e){return Fa.add(e).catch(l=>{})},async localDbGetAllByReportId(e){return Fa.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const Dc={class:"param-container"},bc="ActivesInDrugStore",Sc="ACTIVOS",yc={__name:"ActivesInDrugStore",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=e,i=S(0),a=S(""),s=S(0),d=S(0),t=S(!1),m=S(!1),g=S(!1),f=(c,h)=>{h.value||ee.set(c.id,c)},r=c=>{if(a.value.remove(),c){const h=c.id;g.value=!0,ee.remove(h)}else g.value=!0,ee.remove(o.id)},p=S(null),v=S(!1),b=c=>{if(i.value=.001,l.value)f(c,g),C.apiInitActiveInDrugStoreProcessing(c).then(h=>{D(c)});else{const h=Ve.determineStartEndDate(c);Ea.getDataLocalDb(h).then(y=>{i.value=100,c.progress=100,f(c,g)})}},D=c=>{l.value&&C.getProcessingStatus("activePatientReport",c).then(h=>{h.data.progress>.001?(i.value=h.data.progress,i.value<100?(f(c,g),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(i.value=100,c.progress=100,f(c,g))):setTimeout(()=>{D(c)},3e3)})},u=async(c,h)=>{if(l.value)C.apiPrintActivePatientReport(c).then(y=>{if(!y.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1,t.value=!1;else{const x=y.data[0];h==="PDF"?kt.downloadPDF(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y.data,t):kt.downloadExcel(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y.data,m)}});else{const y=await Ea.localDbGetAllByReportId(c);if(y.length===0)n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1,t.value=!1;else{const x=y[0];h==="PDF"?await kt.downloadPDF(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y,t):await kt.downloadExcel(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y,m)}}};return Me(()=>{o.params&&D(o.params)}),E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",p),E("resultFromLocalStorage",v),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:a},[v.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>r(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(p.value!==null?p.value.code:"")+": Activos na Farm\xE1cia ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>r(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Activos na Farm\xE1cia ",1)]),_:1})),ie("div",Dc,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,reportType:Sc,tabName:bc,params:e.params,totalRecords:s.value,progress:i.value,qtyProcessed:d.value,clinicalService:e.selectedService,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","params","totalRecords","progress","qtyProcessed","clinicalService"])]),_:1})]),_:1})])],512))}};var wc=Fe(yc,[["__scopeId","data-v-337782fe"]]);const Rc={class:"param-container"},Cc={class:"text-grey-8 q-gutter-xs"},xc={__name:"GuestList",props:["selectedService"],setup(e){const l=S("");onMounted(()=>{console.log(selectedService)});const n=()=>{l.value.remove()};return(o,i)=>(M(),se("div",{ref_key:"filterGuestListSection",ref:l},[F(ae,{addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:n,bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Visitantes ",1)]),_:1}),ie("div",Rc,[F(pe,null,{default:A(()=>[F(fe,null,{default:A(()=>[j(" Lista de Visitantes ")]),_:1}),F(fe,{top:"",side:""},{default:A(()=>[ie("div",Cc,[F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Excel")]),_:1}),j(" | "),F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Pdf")]),_:1})])]),_:1})]),_:1})])],512))}};var Pc=Fe(xc,[["__scopeId","data-v-dd66b8ac"]]);const{isMobile:Ma,isOnline:Ya}=ce(),bn="PacientesSemDispensa",Ac=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Fc="Lista de Pacientes Sem Dispensas",Bo=bn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Na={async downloadPDF(e,l,n,o){const i=de.currClinic(),a=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),s=o[0];a.setProperties({title:Bo.concat(".pdf")});const d=new Image;d.src="data:image/png;base64,"+le;const t=[[{content:"Lista de Pacientes Sem Dispensas",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+P(new Date(l)).format("DD-MM-YYYY")+" \xE0 "+P(new Date(n)).format("DD-MM-YYYY"),colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+s.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+s.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(a,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),a.setFontSize(8),a.text("Rep\xFAblica de Mo\xE7ambique ",16,28),a.text("Minist\xE9rio da Sa\xFAde ",20,32),a.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),a.addImage(d,"png",28,15,10,10);const m=["ORD","NID","Nome","UUID do OpenMrs","Data de criacao"],g=o,f=[];let r=1;for(const p in g){const v=[];v.push(r),v.push(g[p].nid),v.push(g[p].firstNames+" "+g[p].middleNames+" "+g[p].lastNames),v.push(g[p].uuidOpenMrs),v.push(P(new Date(g[p].createDate)).format("DD-MM-YYYY")),f.push(v),r+=1}if(r=0,K(a,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:14},1:{cellWidth:50},2:{cellWidth:55},3:{cellWidth:75},4:{cellWidth:75}},didDrawPage:function(p){const v="P\xE1gina "+a.internal.getNumberOfPages();a.setFontSize(8);const b=a.internal.pageSize,D=b.height?b.height:b.getHeight();a.text(v,p.settings.margin.right,D-10)},startY:a.lastAutoTable.finalY,theme:"grid",head:[m],body:f}),Ya.value&&!Ma.value)window.open(a.output("bloburl"));else{const p=a.output();this.downloadFile(Bo,"pdf",p)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(bn),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getRow(15),_=t.getColumn("A"),N=t.getColumn("B"),O=t.getColumn("C"),T=t.getColumn("D"),q=t.getColumn("E"),I=t.getColumn("F"),X=t.getColumn("G"),$=t.getColumn("H"),w=t.getColumn("I"),V=t.getColumn("J");g.alignment=f.alignment=R.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Ac,f.value=Fc,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=P(new Date(l)).format("DD-MM-YYYY"),x.value=P(new Date(n)).format("DD-MM-YYYY"),r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A13:I13"),R.height=30,_.width=20,N.width=20,O.width=30,T.width=15,q.width=20,I.width=15,X.width=15,$.width=15,w.width=15,V.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:bn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Uuid do openMrs",totalsRowFunction:"none",filterButton:!1},{name:"Data de criacao",totalsRowFunction:"none",filterButton:!1}],rows:s});const U=t.lastRow.number!==void 0?t.lastRow.number:0;for(let k=14;k<=U;k++)t.getRow(k).eachCell({includeEmpty:!0},B=>{B.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},B.alignment={vertical:"middle",horizontal:"center",wrapText:!0},k===14&&(B.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},B.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const z=await d.xlsx.writeBuffer(),Q="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Z=".xlsx",L=new Blob([z],{type:Q});if(Ya.value&&!Ma.value)Ue(L,Bo+Z);else{let k=function(Pe,ne){const re=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(re,function(me){H(me,Pe,ne)},W)},H=function(Pe,ne,re){Pe.getFile(ne,{create:!0,exclusive:!1},function(me){B(me,re)},oe)},B=function(Pe,ne){Pe.createWriter(function(re){re.onwriteend=function(){console.log("Successful file write..."),Y()},re.onerror=function(me){console.log("Failed file write: "+me)},re.write(ne)})},W=function(Pe){console.log(Pe)},oe=function(Pe){console.log("errorr: "+Pe.toString())},Y=function(){const Pe=he;console.log("file system 44444: "+Pe);const ne=cordova.file.externalRootDirectory+"Download/"+Pe;console.log("file system 2222: "+ne);const re=decodeURIComponent(ne);cordova.plugins.fileOpener2.open(re,"application/vnd.ms-excel",{error:function(me){console.log("file system open3333366: "+me+re)},success:function(){}})};const he="PaciendtesSemDispensa.xlsx";k(he,L)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(e[o].uuidOpenMrs),i.push(P(new Date(e[o].createDate)).format("DD-MM-YYYY")),l.push(i),n+=1}return n=0,e=[],l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Ec={class:"param-container"},Ta="PatientsWithoutDispense",Mc="PACIENTES_SEM_DISPENSAS",Yc={__name:"PatientsWihoutDispense",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(!1),g=u=>{if(s.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},f=S(null),r=S(!1),p=(u,c)=>{c.value||ee.set(u.id,u)},v=async u=>{a.value=.001,l.value?(p(u,m),C.apiInitReportProcess("patientWithoutDispense",u).then(c=>{b(u)})):p(u,m)},b=u=>{C.getProcessingStatus("patientWithoutDispense",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(p(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,p(u,m))):setTimeout(()=>{b(u)},3e3)})},D=async(u,c)=>{l.value&&C.apiPrintPatientsWithoutDispenseReport(u).then(h=>{if(!h.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const y=h.data[0];c==="PDF"?(Na.downloadPDF(y.province,y.startDate,y.endDate,h.data),d.value=!1):(Na.downloadExcel(y.province,y.startDate,y.endDate,h.data),t.value=!1)}})};return Me(()=>{console.log(Ta)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",f),E("resultFromLocalStorage",r),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterPatientsWithouDispenseSection",ref:s},[r.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(f.value!==null?f.value.code:"")+": Pacientes Sem Dispensa ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Sem Dispensa ",1)]),_:1})),ie("div",Ec,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:Mc,progress:a.value,tabName:Ta,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var Nc=Fe(Yc,[["__scopeId","data-v-7f5573ee"]]);const Tc={class:"param-container"},Ic={class:"text-grey-8 q-gutter-xs"},Bc={__name:"ImportedPatientList",setup(e){const l=S("");onMounted(()=>{console.log(selectedService)});const n=()=>{l.value.remove()};return(o,i)=>{const a=fr("ListHeader");return M(),se("div",{ref_key:"filterImportedPatient",ref:l},[F(a,{addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:n,bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(o.selectedService!==null?o.selectedService.code:"")+": Lista de Pacientes importados de outros sistemas ",1)]),_:1}),ie("div",Tc,[F(pe,null,{default:A(()=>[F(fe,null,{default:A(()=>[j(" Lista de Pacientes importados de outros sistemas ")]),_:1}),F(fe,{top:"",side:""},{default:A(()=>[ie("div",Ic,[F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Excel")]),_:1}),j(" | "),F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Pdf")]),_:1})])]),_:1})]),_:1})])],512)}}};var Oc=Fe(Bc,[["__scopeId","data-v-3ee0ad42"]]);const Lc={class:"param-container"},kc={class:"text-grey-8 q-gutter-xs"},Vc={__name:"TransferedFrom",props:["selectedService"],setup(e){const l=S("");onMounted(()=>{console.log(selectedService)});const n=()=>{l.value.remove()};return(o,i)=>(M(),se("div",{ref_key:"filterTransferedFrom",ref:l},[F(ae,{addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:n,bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Pacientes transferidos de ",1)]),_:1}),ie("div",Lc,[F(pe,null,{default:A(()=>[F(fe,null,{default:A(()=>[j(" Lista de Pacientes transferidos de ")]),_:1}),F(fe,{top:"",side:""},{default:A(()=>[ie("div",kc,[F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Excel")]),_:1}),j(" | "),F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Pdf")]),_:1})])]),_:1})]),_:1})])],512))}};var zc=Fe(Vc,[["__scopeId","data-v-5ec6bcf3"]]);const _c={class:"param-container"},Uc={class:"text-grey-8 q-gutter-xs"},$c={__name:"TransferedTo",props:["selectedService"],setup(e){const l=S("");onMounted(()=>{console.log(selectedService)});const n=()=>{l.value.remove()};return(o,i)=>(M(),se("div",{ref_key:"filterTransferedTo",ref:l},[F(ae,{addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:n,bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Pacientes transferidos PARA ",1)]),_:1}),ie("div",_c,[F(pe,null,{default:A(()=>[F(fe,null,{default:A(()=>[j(" Lista de Pacientes transferidos PARA ")]),_:1}),F(fe,{top:"",side:""},{default:A(()=>[ie("div",Uc,[F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Excel")]),_:1}),j(" | "),F(Ze,{class:"gt-xs",size:"12px",flat:"",dense:"",round:""},{default:A(()=>[j("Pdf")]),_:1})])]),_:1})]),_:1})])],512))}};var Hc=Fe($c,[["__scopeId","data-v-5ff844d1"]]);const Ia=We[Bi.entity],Ba=We[fn.entity],Oa=We[Oi.entity];var $e={async getMmiaStockReport(e){const[l]=await Promise.all([wo.getAllWithStocksFromDexie()]),n=await Ve.determineStartEndDate(e);for(const o of l){let i=Number(0),a=Number(0),s=Number(0),d=Number(0),t=Number(0),m=Number(0),g=Number(0),f=Number(0);o.stocks.map(p=>{P(p.entrance.dateReceived)>=P(n.startDate)&&P(p.entrance.dateReceived)<=P(n.endDate)?a+=p.unitsReceived:P(p.entrance.dateReceived)<P(n.startDate)&&(i+=p.unitsReceived),p.packagedDrugStocks.map(v=>{P(v.packagedDrug.pack.pickupDate)>=P(n.startDate)&&P(v.packagedDrug.pack.pickupDate)<=P(n.endDate)?d+=v.quantitySupplied:P(v.packagedDrug.pack.pickupDate)<P(n.startDate)&&(s+=v.quantitySupplied)}),p.adjustments.map(v=>{v.inventory.endDate!==null&&v.inventory.endDate!==void 0&&(P(v.inventory.endDate)>=P(n.startDate)&&P(v.inventory.endDate)<=P(n.endDate)?v.operation.code==="AJUSTE_POSETIVO"?m+=v.adjustedValue:v.operation.code==="AJUSTE_NEGATIVO"&&(f+=v.adjustedValue):P(v.inventory.endDate)<P(n.startDate)&&(v.operation.code==="AJUSTE_POSETIVO"?t+=v.adjustedValue:v.operation.code==="AJUSTE_NEGATIVO"&&(g+=v.adjustedValue)))}),p.referedAdjustments.map(v=>{v.captureDate!==null&&v.captureDate!==void 0&&(P(v.captureDate)>=P(n.startDate)&&P(v.captureDate)<=P(n.endDate)?v.operation.code==="AJUSTE_POSETIVO"?m+=v.adjustedValue:v.operation.code==="AJUSTE_NEGATIVO"&&(f+=v.adjustedValue):P(v.captureDate)<P(n.startDate)&&(v.operation.code==="AJUSTE_POSETIVO"?t+=v.adjustedValue:v.operation.code==="AJUSTE_NEGATIVO"&&(g+=v.adjustedValue)))})});const r=new Bi;r.unit=String(o.packSize).concat(" "+o.form.code),r.fnmCode=o.fnmCode,r.drugName=o.name,r.balance=i+t-(s+g),r.initialEntrance=a,r.outcomes=d,r.lossesAdjustments=m-f,r.actualStock=0,r.inventory=Number(r.balance)+Number(r.initialEntrance)+Number(r.lossesAdjustments)-Number(r.outcomes),console.log("O REPORT ",r),o.stocks.length>0&&(r.expireDate=P(o.stocks[0].expireDate).format("DD-MM-YYYY")),r.reportId=n.id,r.year=n.year,r.endDate=n.endDate,r.id=He(),this.localDbAddOrUpdateStockReport(r)}return n},async getMmiaRegimenSubReport(e){const l=[],[n]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(e.startDate,e.endDate)]);n.map(a=>{const s=a.patientvisitDetails,d=s.prescription,t=d==null?void 0:d.prescriptionDetails[0],m=s.episode,g=t?t.therapeuticRegimen:"",f=t?t.therapeuticLine:"",r=new fn;r.id=He(),r.reportId=e.id,r.code=g.code,r.regimen=g.description,r.lineCode=f.code,r.line=f.description,r.comunitaryClinic=0,r.totalPatients=0,this.isReferido(m)?(r.comunitaryClinic=Number(r.comunitaryClinic)+1,String(f.code).includes("1")?r.totaldcline1++:String(f.code).includes("2")?r.totaldcline2++:String(f.code).includes("3")&&r.totaldcline3++):(r.totalPatients=Number(r.totalPatients)+1,String(f.code).includes("1")?r.totalline1++:String(f.code).includes("2")?r.totalline2++:String(f.code).includes("3")&&r.totalline3++),r.totalrefline1=0,r.totalrefline2=0,r.totalrefline3=0,l.push(r)});const o=l.reduce((a,s)=>{if(!a.has(s.code))a.set(s.code,{code:s.code,regimen:s.regimen,lineCode:s.lineCode,line:s.line,totalPatients:Number(s.totalPatients),comunitaryClinic:Number(s.comunitaryClinic)});else{const d=a.get(s.code);d.totalPatients+=Number(s.totalPatients),d.comunitaryClinic+=Number(s.comunitaryClinic),d.regimen=s.regimen,d.lineCode=s.lineCode,d.line=s.line}return a},new Map),i=Array.from(o.values());return console.log(i),l},async getMmiaReport(e,l){let n=0,o=0,i=0;const a=new Oi;a.totalPacientesInicio=Number(0),a.totalPacientesManter=Number(0),a.totalPacientesAlterar=Number(0),a.totalPacientesTransito=Number(0),a.totalPacientesTransferidoDe=Number(0),a.totalPacientesAdulto=Number(0),a.totalPacientes04=Number(0),a.totalPacientes59=Number(0),a.totalPacientes1014=Number(0),a.totalPacientesPPE=Number(0),a.totalPacientesPREP=Number(0),a.totalpacientesCE=Number(0),a.dsM0=Number(0),a.dsM1=Number(0),a.dsM2=Number(0),a.dsM3=Number(0),a.dsM4=Number(0),a.dsM5=Number(0),a.dtM0=Number(0),a.dtM1=Number(0),a.dtM2=Number(0),a.dbM0=Number(0),a.dbM1=Number(0),a.dM=Number(0);const[s]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(e.startDate,e.endDate)]);s.map(async d=>{const t=d.patientvisitDetails,m=t.patientVisit,g=t.episode,f=g.patientServiceIdentifier.service,r=t.prescription,p=r==null?void 0:r.prescriptionDetails[0],v=p.dispenseType!==null&&p.dispenseType!==void 0?p.dispenseType.code:"";f.code==="PREP"&&a.totalPacientesPREP++,f.code==="PPE"&&a.totalPacientesPPE++,f.code==="CE"&&a.totalpacientesCE++,a.reportId=e.id;const b=P(m.patient.dateOfBirth),D=P(e.endDate,"YYYY/MM/DDDD").diff(b,"years");D>=18?a.totalPacientesAdulto++:D>=0&&D<=4?a.totalPacientes04++:D>=5&&D<=9?a.totalPacientes59++:D>=10&&D<=14&&a.totalPacientes1014++,(g.startStopReason.code==="NOVO"||g.startStopReason.code==="NOVO_PACIENTE")&&(r.patient_type==="N/A"||r.patient_type===null||r.patient_type==="Inicio")&&v==="DM"?a.totalPacientesInicio++:g.startStopReason.code==="NOVO_PACIENTE"&&P(g.episode_date).add(3,"days")<P(d.pickupDate)||g.startStopReason.code==="MANUNTENCAO"||g.startStopReason.code==="VOLTOU_REFERENCIA"||g.startStopReason.code==="REINICIO_TRATAMETO"||g.startStopReason.code==="REFERIDO_DC"||g.startStopReason.code==="OUTRO"||g.startStopReason.code==="INICIO_CCR"?a.totalPacientesManter++:g.startStopReason.code==="ALTERACAO"?a.totalPacientesAlterar++:g.startStopReason.code==="TRANSITO"||g.startStopReason.code==="INICIO_MATERNIDADE"?a.totalPacientesTransito++:g.startStopReason.code==="TRANSFERIDO_DE"&&a.totalPacientesTransferido++;for(const u of l)this.localDbAddOrUpdateReportRegimen(u);p!=null&&(v==="DM"?n++:v==="DT"?i++:v==="DS"&&o++),a.dsM1=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DS",e.clinicalService,this.determineDate(e.startDate,1),this.determineDate(e.endDate,1)),a.dsM2=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DS",e.clinicalService,this.determineDate(e.startDate,2),this.determineDate(e.endDate,2)),a.dsM3=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DS",e.clinicalService,this.determineDate(e.startDate,3),this.determineDate(e.endDate,3)),a.dsM4=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DS",e.clinicalService,this.determineDate(e.startDate,4),this.determineDate(e.endDate,4)),a.dsM5=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DS",e.clinicalService,this.determineDate(e.startDate,5),this.determineDate(e.endDate,5)),a.dtM1=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DT",e.clinicalService,this.determineDate(e.startDate,1),this.determineDate(e.endDate,1)),a.dtM2=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DT",e.clinicalService,this.determineDate(e.startDate,2),this.determineDate(e.endDate,2)),a.dbM0=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DB",e.clinicalService,this.determineDate(e.startDate,1),this.determineDate(e.endDate,1)),a.dbM1=await dt.countPacksByDispenseTypeAndServiceOnPeriod("DB",e.clinicalService,this.determineDate(e.startDate,2),this.determineDate(e.endDate,2))}),a.dM=n,a.dtM0=i,a.dsM0=o,a.id=He(),this.localDbAddOrUpdateMmia(a)},determineDate(e,l){return P(e,"DD-MM-YYYY").subtract(l,"months")},isReferido(e){return e.startStopReason.code==="TRANSFERIDO_DE"},groupedMap(e,l){return e.reduce((n,o)=>n.set(o[l],[...n.get(o[l])||[],o],console.log(o[l])),new Map)},groupedMapChild(e,l){return e.reduce((n,o)=>n.set(o.adjustedStock.drug.id,[...n.get(o.adjustedStock.drug.id)||[],o],console.log(o.adjustedStock.drug.id)),new Map)},groupedMapChildPack(e,l){return e.reduce((n,o)=>n.set(o.drug.id,[...n.get(o.drug.id)||[],o],console.log(o.drug.id)),new Map)},groupedMapChildAdjustments(e,l){return e.reduce((n,o)=>n.set(o.adjustedStock.id,[...n.get(o.adjustedStock.id)||[],o],console.log(o.adjustedStock.id)),new Map)},getStockOperationTypeById(e){return Yt.getStockOperatinTypeById(e)},localDbAddOrUpdateStockReport(e){return Ia.put(e).catch(l=>{console.log(l)})},async getDataLocalReportStock(e){return Ia.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)},localDbAddOrUpdateReportRegimen(e){return Ba.put(e).catch(l=>{console.log(l)})},getDataLocalReportRegimen(e){return Ba.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)},createNewMmiaRegimenSubReport(e,l,n){const o=new fn;return o.reportId=l,o.code=e.therapeuticRegimen.code,o.regimen=e.therapeuticRegimen.description,o.lineCode=e.getTherapeuticLine.code,o.line=e.therapeuticLine.description,n?o.comunitaryClinic++:o.totalPatients++,o.totalReferidos=0,o},localDbAddOrUpdateMmia(e){return Oa.put(e).catch(l=>{console.log(l)})},async getDataLocalReportMmia(e){return Oa.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const{isMobile:ct,isOnline:ze}=ce(),Gc=`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,qc=`MMIA 
 MAPA MENSAL DE INFORMA\xC7\xC3O ARV`,qe="MMIA",Oo=qe.concat("_"+P(new Date).format("DD-MM-YYYY")),La=["Janeiro","Fevereiro","Mar\xE7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];var ka={async downloadPDF(e,l){const n=await Xe(Je),o=new Ce({orientation:"p",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});o.addFileToVFS("NotoSans-Regular.ttf",n.split(",")[1]),o.addFont("NotoSans-Regular.ttf","NotoSans","normal"),o.setFont("NotoSans"),o.setFontSize(10);const i=new Image;i.src="data:image/png;base64,"+le,o.setProperties({title:Oo.concat(".pdf")});const a=["FNM","MEDICAMENTO","Unidade","Saldo Inicial","Entradas","Sa\xEDdas","Perdas e Ajustes","Invent\xE1rio","Validade"],s=de.currClinic();let d={},t=[],m=[],g=[];if(ze.value){if(d=await C.get("mmiaReport",e),d.status===204||d.data.length===0)return 204;t=d.data,g=t.mmiaStockSubReportItemList,m=t.mmiaRegimenSubReportList}else{if(t=await $e.getDataLocalReportMmia(e),t===void 0||t.length===0)return 204;g=await $e.getDataLocalReportStock(e),m=await $e.getDataLocalReportRegimen(e)}const f=this.createArrayOfArrayRow(g),r=this.createRegimenArrayOfArrayRow(m),p=this.createMmiaTipoDoentesArrayRow(t),v=this.createMmiaFaixaEtariaArrayRow(t),b=this.createMmiaProfilaxiaArrayRow(t),D=this.createRegimenTotalArrayRow(t,ze.value?t.mmiaRegimenSubReportList:m,"PDF"),u=this.createLinesSumaryArrayRow(t,ze.value?t.mmiaRegimenSubReportList:m,"PDF"),c=this.createLinesSumaryTotalArrayRow(t,ze.value?t.mmiaRegimenSubReportList:m,"PDF"),h=this.createMmiaDispenseTypeDSArrayRow(t),y=this.createMmiaDispenseTypeDTArrayRow(t),x=this.createMmiaDispenseTypeDBArrayRow(t),R=this.createMmiaDispenseTypeDMArrayRow(t),_=this.createMmiaAjustePercentageArrayRow(t),N=this.createFotterTableRow(),O=La[new Date(ze.value?t.endDate:g[0].endDate).getMonth()],T=["C\xF3digo","Regime Terap\xEAutico","Total doentes","Farm\xE1cia Comunit\xE1ria","Doentes Referidos"],q=[],I=[],X=[],$=[];I.push(i),I.push({content:`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,styles:{font:"NotoSans",halign:"left",valign:"middle",fontStyle:"bold",textColor:0}}),I.push({content:`MMIA 
 MAPA MENSAL DE INFORMA\xC7\xC3O ARV`,styles:{font:"NotoSans",halign:"center",valign:"middle",fontStyle:"bold",textColor:0}}),I.push({content:"M\xEAs: "+O,styles:{font:"NotoSans",valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}),X.push({content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:3,styles:{font:"NotoSans",halign:"left",fontStyle:"bold",textColor:0}}),$.push({colSpan:2,content:"Distrito: "+s.district.description,styles:{font:"NotoSans",halign:"left",fontStyle:"bold",textColor:0}}),$.push({content:"Prov\xEDncia: "+s.province.description,styles:{font:"NotoSans",halign:"left",fontStyle:"bold",textColor:0}}),X.push({rowSpan:2,content:"Ano: "+ze.value?t.year:g[0].year,styles:{font:"NotoSans",valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}),q.push(I),q.push(X),q.push($),K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6,textColor:0},columnStyles:{0:{cellWidth:14}},styles:{maxCellHeight:4},body:q,startY:10}),o.addImage(i,"PNG",16,10,10,10),K(o,{theme:"grid",styles:{maxCellHeight:4},bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:13},1:{halign:"left"},2:{cellWidth:15},3:{cellWidth:15},4:{cellWidth:16},5:{cellWidth:13},6:{cellWidth:16},7:{cellWidth:17},8:{cellWidth:17}},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8,fillColor:[75,76,77]},head:[a],body:f,startY:o.lastAutoTable.finalY});const w=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:13},2:{cellWidth:15.1},3:{cellWidth:18},4:{cellWidth:21.2}},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[T],body:r,startY:w+1,margin:{right:90.1}});const V=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{1:{cellWidth:15.1},2:{cellWidth:18},3:{cellWidth:21.2}},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:D,startY:V,margin:{right:90.1}});const G=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},columnStyles:{0:{fillColor:[240,241,242]}},head:[[{content:`Linhas Terap\xEAuticas
`,colSpan:4,styles:{halign:"center",fillColor:[75,76,77]}}]],headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:u,startY:G+1,margin:{right:90.1}});const U=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},columnStyles:{1:{cellWidth:15.1},2:{cellWidth:18},3:{cellWidth:21.2}},headStyles:{halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:c,startY:U,margin:{right:90.1}}),K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},columnStyles:{0:{halign:"left",fillColor:[240,241,242]},1:{cellWidth:30}},head:[[{content:`Tipo de doentes em 
TARV`,colSpan:2,styles:{halign:"center",fillColor:[75,76,77]}}]],headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:p,startY:w+1,margin:{left:121.1}});const z=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},columnStyles:{0:{halign:"left",fillColor:[240,241,242]},1:{cellWidth:30}},head:[[{content:`Faixa Et\xE1ria dos Pacientes 
TARV`,colSpan:2,styles:{halign:"center",fillColor:[75,76,77]}}]],headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:v,startY:z+1,margin:{left:121.1}});const Q=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},columnStyles:{0:{halign:"left",fillColor:[240,241,242]},1:{cellWidth:30}},head:[[{content:`Profilaxia 
`,colSpan:2,styles:{halign:"center",fillColor:[75,76,77]}}]],headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:2},body:b,startY:Q+1,margin:{left:121.1}});const Z=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},head:[[{content:`Tipo de Dispensa
`,styles:{halign:"center",fillColor:[75,76,77]}}]],headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},startY:Z+1,margin:{left:121.1}});const L=o.lastAutoTable.finalY,k=[["","DS","","","",""]];for(let Y=0;Y<h.length;Y++)Y==0&&(h[Y].push(""),h[Y].push(""),h[Y].push(_[0][0]),h[Y].push(_[0][1])),Y==1&&(h[Y].push(""),h[Y].push(""),h[Y].push(""),h[Y].push("")),Y==2&&(h[Y].push("DT"),h[Y].push(""),h[Y].push(""),h[Y].push("")),Y==3&&(h[Y].push(y[0][0]),h[Y].push("DB"),h[Y].push(""),h[Y].push("")),Y==4&&(h[Y].push(y[1][0]),h[Y].push(x[0][0]),h[Y].push("DM"),h[Y].push("Total")),Y==5&&(h[Y].push(y[2][0]),h[Y].push(x[1][0]),h[Y].push(R[0][0]),h[Y].push(R[0][1])),Y==6&&(h[Y].push(y[3][0]),h[Y].push(x[2][0]),h[Y].push(R[1][0]),h[Y].push(R[1][1])),k.push(h[Y]);K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:6},columnStyles:{0:{cellWidth:12,halign:"right",fillColor:[240,241,242]},1:{cellWidth:10}},styles:{maxCellHeight:4},body:k,startY:L,margin:{left:121.1},didParseCell:function(Y){Y.row.section==="body"&&Y.column.index===1&&Y.cell.raw==="DS"&&(Y.cell.styles.fillColor=[75,76,77],Y.cell.styles.textColor=[255,255,255]),Y.row.section==="body"&&Y.column.index===2&&Y.cell.raw==="DT"&&(Y.cell.styles.fillColor=[75,76,77],Y.cell.styles.textColor=[255,255,255]),Y.row.section==="body"&&Y.column.index===3&&Y.cell.raw==="DB"&&(Y.cell.styles.fillColor=[75,76,77],Y.cell.styles.textColor=[255,255,255]),Y.row.section==="body"&&Y.column.index===4&&Y.cell.raw==="DM"&&(Y.cell.styles.fillColor=[75,76,77],Y.cell.styles.textColor=[255,255,255]),Y.row.section==="body"&&Y.column.index===3&&Y.cell.raw==="Ajuste"&&(Y.cell.styles.fillColor=[75,76,77],Y.cell.styles.textColor=[255,255,255]),Y.row.section==="body"&&Y.column.index===5&&Y.cell.raw==="Total"&&(Y.cell.styles.fillColor=[75,76,77],Y.cell.styles.textColor=[255,255,255])}});const H=o.lastAutoTable.finalY;K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"center",fontSize:6},columnStyles:{0:{halign:"left"}},styles:{maxCellHeight:2},body:[["Observa\xE7\xE3oes:"],[` 







`]],startY:H+1,margin:{left:121.1}}),K(o,{theme:"grid",bodyStyles:{font:"NotoSans",halign:"left",fontSize:6},columnStyles:{1:{cellWidth:60},2:{cellWidth:55}},styles:{maxCellHeight:2},body:N,startY:o.lastAutoTable.finalY+2}),o.setFontSize(7),o.text(`Nota: Mapa de Preenchimento Obrigat\xF3rio Mensal pela Farm\xE1cia da Unidade Sanit\xE1ria 
Vers\xE3o no 8 19 Nov 2019 DS TLD90 MDS e ARVs de nova gera\xE7\xE3o`,15,o.lastAutoTable.finalY+5);const B="P\xE1gina "+o.internal.getNumberOfPages();o.setFontSize(8);const W=o.internal.pageSize,oe=W.height?W.height:W.getHeight();if(o.text(B,15,oe-10),ze.value&&!ct.value)window.open(o.output("bloburl")),l.value=!1;else{const Y=o.output();Oe.downloadFile(Oo,".pdf",Y,l)}},async downloadExcel(e,l){const n=de.currClinic();let o={},i=[],a=[],s=[];if(ze.value){if(o=await C.get("mmiaReport",e),o.status===204||o.data.length===0)return 204;i=o.data,s=i.mmiaStockSubReportItemList,a=i.mmiaRegimenSubReportList}else{if(i=await $e.getDataLocalReportMmia(e),i===void 0||i.length===0)return 204;s=await $e.getDataLocalReportStock(e),a=await $e.getDataLocalReportRegimen(e)}const d=this.createArrayOfArrayRow(s),t=this.createRegimenArrayOfArrayRow(a),m=this.createMmiaTipoDoentesArrayRow(i),g=this.createMmiaFaixaEtariaArrayRow(i),f=this.createMmiaProfilaxiaArrayRow(i),r=this.createRegimenTotalArrayRow(i,ze.value?i.mmiaRegimenSubReportList:a,"XLS"),p=this.createLinesSumaryArrayRow(i,ze.value?i.mmiaRegimenSubReportList:a,"XLS"),v=this.createLinesSumaryTotalArrayRow(i,ze.value?i.mmiaRegimenSubReportList:a,"XLS"),b=this.createMmiaDispenseTypeDSArrayRow(i),D=this.createMmiaDispenseTypeDTArrayRow(i),u=this.createMmiaDispenseTypeDBArrayRow(i),c=this.createMmiaDispenseTypeDMArrayRow(i),h=this.createMmiaAjustePercentageArrayRow(i),y=this.createFotterTableRow(),x=new xe.exports.Workbook;x.creator="CSAUDE",x.lastModifiedBy="CSAUDE",x.created=new Date,x.modified=new Date,x.lastPrinted=new Date;const R=x.addWorksheet(qe),_=x.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),N=R.getCell("B1"),O=R.getCell("C1"),T=R.getCell("A8"),q=R.getCell("A9"),I=R.getCell("C9"),X=R.getCell("I1"),$=R.getCell("I8"),w=R.getRow(11),V=R.getColumn("A"),G=R.getColumn("B"),U=R.getColumn("C"),z=R.getColumn("D"),Q=R.getColumn("E"),Z=R.getColumn("F"),L=R.getColumn("G"),k=R.getColumn("H"),H=R.getColumn("I"),B=R.getColumn("J");X.alignment=O.alignment=w.alignment=$.alignment={vertical:"middle",horizontal:"center",wrapText:!0},T.alignment=N.alignment=q.alignment=I.alignment={vertical:"middle",horizontal:"left",wrapText:!1},$.border=X.border=N.border=O.border=T.border=q.border=I.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},N.value=Gc,O.value=qc,X.value="M\xEAs: "+La[new Date(i.endDate).getMonth()],$.value="Ano: "+i.year,T.value="Unidade Sanit\xE1ria: "+n.clinicName,q.value="Distrito: "+n.district.description,I.value="Prov\xEDncia: "+n.province.description,R.mergeCells("A1:A7"),R.mergeCells("B1:B7"),R.mergeCells("C1:H7"),R.mergeCells("I1:I7"),R.mergeCells("A8:H8"),R.mergeCells("A9:B9"),R.mergeCells("C9:H9"),R.mergeCells("I8:I9"),w.height=30,V.width=13,G.width=70,U.width=15,z.width=15,Q.width=15,Z.width=9,L.width=10,k.width=12,H.width=13,B.width=14,O.font=q.font=I.font=T.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},R.addImage(_,{tl:{col:0,row:1},ext:{width:119,height:98}}),R.addTable({name:qe,ref:"A10",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"FNM",totalsRowLabel:"Totals:",filterButton:!1},{name:"Medicamento",totalsRowFunction:"none",filterButton:!1},{name:"Unidade",totalsRowFunction:"none",filterButton:!1},{name:"Saldo Inicial",totalsRowFunction:"none",filterButton:!1},{name:"Entradas",totalsRowFunction:"none",filterButton:!1},{name:"Sa\xEDdas",totalsRowFunction:"none",filterButton:!1},{name:"Perdas e Ajustes",totalsRowFunction:"none",filterButton:!1},{name:"Invent\xE1rio",totalsRowFunction:"none",filterButton:!1},{name:"Validade",totalsRowFunction:"none",filterButton:!1}],rows:d});const W=Number(R.lastRow.number)+1;R.addTable({name:qe,ref:"A"+(Number(R.lastRow.number)+1),headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"C\xF3digo",totalsRowLabel:"Totals:",filterButton:!1},{name:"Regime Terap\xEAutico",totalsRowFunction:"none",filterButton:!1},{name:"Total doentes",totalsRowFunction:"none",filterButton:!1},{name:"Farm\xE1cia Comunit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Doentes Referidos",totalsRowFunction:"none",filterButton:!1}],rows:t}),R.mergeCells("A"+(Number(R.lastRow.number)+1)+":B"+(Number(R.lastRow.number)+1));const oe=R.getCell("B"+Number(R.lastRow.number));R.addTable({name:qe,ref:"B"+Number(R.lastRow.number),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Total",totalsRowLabel:"Totals:",filterButton:!1},{name:"toatl1",totalsRowFunction:"none",filterButton:!1},{name:"total2",totalsRowFunction:"none",filterButton:!1},{name:"total3",totalsRowFunction:"none",filterButton:!1}],rows:r}),R.mergeCells("A"+(Number(R.lastRow.number)+1)+":E"+(Number(R.lastRow.number)+1));const Y=R.getCell("A"+Number(R.lastRow.number));Y.value="Linhas Terap\xEAuticas";const he="B"+(Number(R.lastRow.number)+1);R.mergeCells("A"+(Number(R.lastRow.number)+1)+":B"+(Number(R.lastRow.number)+1)),R.mergeCells("A"+(Number(R.lastRow.number)+1)+":B"+(Number(R.lastRow.number)+1)),R.mergeCells("A"+(Number(R.lastRow.number)+1)+":B"+(Number(R.lastRow.number)+1)),R.addTable({name:qe,ref:he,headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Total",totalsRowLabel:"Totals:",filterButton:!1},{name:"toatl1",totalsRowFunction:"none",filterButton:!1},{name:"total2",totalsRowFunction:"none",filterButton:!1},{name:"total3",totalsRowFunction:"none",filterButton:!1}],rows:p}),R.mergeCells("A"+(Number(R.lastRow.number)+1)+":B"+(Number(R.lastRow.number)+1));const Pe=R.getCell("B"+Number(R.lastRow.number));R.addTable({name:qe,ref:"B"+Number(R.lastRow.number),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Total",totalsRowLabel:"Totals:",filterButton:!1},{name:"toatl1",totalsRowFunction:"none",filterButton:!1},{name:"total2",totalsRowFunction:"none",filterButton:!1},{name:"total3",totalsRowFunction:"none",filterButton:!1}],rows:v}),R.mergeCells("F"+W+":I"+W),R.mergeCells("F"+(W+1)+":H"+(W+1)),R.mergeCells("F"+(W+2)+":H"+(W+2)),R.mergeCells("F"+(W+3)+":H"+(W+3)),R.mergeCells("F"+(W+4)+":H"+(W+4)),R.mergeCells("F"+(W+5)+":H"+(W+5));const ne=R.getCell("F"+W);ne.value="Tipo de doentes em TARV",R.addTable({name:qe,ref:"H"+(W+1),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"desc",totalsRowLabel:"Totals:",filterButton:!1},{name:"value",totalsRowFunction:"none",filterButton:!1}],rows:m});const re=W+6,me=R.getCell("F"+re);me.value="Faixa Et\xE1ria dos Pacientes TARV",R.mergeCells("F"+re+":I"+re),R.mergeCells("F"+(re+1)+":H"+(re+1)),R.mergeCells("F"+(re+2)+":H"+(re+2)),R.mergeCells("F"+(re+3)+":H"+(re+3)),R.mergeCells("F"+(re+4)+":H"+(re+4)),R.addTable({name:qe,ref:"H"+(re+1),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"desc",totalsRowLabel:"Totals:",filterButton:!1},{name:"value",totalsRowFunction:"none",filterButton:!1}],rows:g});const Ye=re+5,Ne=R.getCell("F"+Ye);me.value="Faixa Et\xE1ria dos Pacientes TARV",R.mergeCells("F"+Ye+":I"+Ye),R.mergeCells("F"+(Ye+1)+":H"+(Ye+1)),R.mergeCells("F"+(Ye+2)+":H"+(Ye+2)),R.mergeCells("F"+(Ye+3)+":H"+(Ye+3)),R.mergeCells("F"+(Ye+4)+":H"+(Ye+4)),Ne.value="Profilaxia",R.addTable({name:qe,ref:"H"+(Ye+1),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"desc",totalsRowLabel:"Totals:",filterButton:!1},{name:"value",totalsRowFunction:"none",filterButton:!1}],rows:f});const we=Ye+6,ge=R.getCell("E"+we);ge.value="Tipo de Dispensa",R.mergeCells("E"+we+":I"+we),R.addTable({name:qe,ref:"D"+(we+1),headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"-",totalsRowLabel:"Totals:",filterButton:!1},{name:"DS",totalsRowFunction:"none",filterButton:!1}],rows:b}),R.addTable({name:qe,ref:"F"+(we+4),headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"DT",totalsRowFunction:"none",filterButton:!1}],rows:D}),R.addTable({name:qe,ref:"G"+(we+5),headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"DB",totalsRowFunction:"none",filterButton:!1}],rows:u}),R.addTable({name:qe,ref:"H"+(we+6),headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"DM",totalsRowFunction:"none",filterButton:!1},{name:"Total",totalsRowFunction:"none",filterButton:!1}],rows:c}),R.addTable({name:qe,ref:"H"+(we+2),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ajuste",totalsRowFunction:"none",filterButton:!1},{name:"value",totalsRowFunction:"none",filterButton:!1}],rows:h});const De=R.getCell("H"+(we+2));R.mergeCells("E"+(we+9)+":I"+(we+9)),R.mergeCells("E"+(we+10)+":I"+(we+10)),R.mergeCells("E"+(we+11)+":I"+(we+11));const be=R.getCell("E"+(we+9));be.value="Observa\xE7\xF5es:",be.alignment={horizontal:"left"},R.mergeCells("A"+(Number(R.lastRow.number)+2)+":B"+(Number(R.lastRow.number)+2)),R.mergeCells("C"+Number(R.lastRow.number)+":F"+Number(R.lastRow.number)),R.mergeCells("G"+Number(R.lastRow.number)+":I"+Number(R.lastRow.number)),R.addTable({name:qe,ref:"B"+Number(R.lastRow.number),headerRow:!1,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ajuste",totalsRowFunction:"none",filterButton:!1},{name:"visto",totalsRowFunction:"none",filterButton:!1},{name:"value",totalsRowFunction:"none",filterButton:!1}],rows:y}),R.mergeCells("A"+(Number(R.lastRow.number)+1)+":I"+(Number(R.lastRow.number)+2));const Le=R.getCell("A"+R.lastRow.number);Le.value=`Nota: Mapa de Preenchimento Obrigat\xF3rio Mensal pela Farm\xE1cia da Unidade Sanit\xE1ria 
Vers\xE3o no 8 19 Nov 2019 DS TLD90 MDS e ARVs de nova gera\xE7\xE3o`,Le.alignment={horizontal:"right"},ge.alignment=Y.alignment=Ne.alignment=me.alignment=ne.alignment={vertical:"middle",horizontal:"center",wrapText:!0},oe.alignment=Pe.alignment={horizontal:"right",wrapText:!0};const Ie=R.getCell("E"+Number(we+1)),Se=R.getCell("F"+Number(we+4)),Ee=R.getCell("G"+Number(we+5)),ue=R.getCell("H"+Number(we+6)),ve=R.getCell("I"+Number(we+6));oe.fill=Pe.fill={type:"pattern",pattern:"solid",fgColor:{argb:"dedfe0"},bgColor:{argb:"dedfe0"}},ve.fill=ue.fill=Ie.fill=Se.fill=Ee.fill=De.fill=ge.fill=Y.fill=Ne.fill=me.fill=ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"4b4c4d"},bgColor:{argb:"4b4c4d"}},ge.font=Y.font=Ne.font=me.font=ve.font=ue.font=Ie.font=Se.font=Ee.font=De.font=ne.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0};const Te=R.lastRow.number!==void 0?R.lastRow.number:0;for(let ft=10;ft<=Te;ft++)R.getRow(ft).eachCell({includeEmpty:!0},wt=>{wt.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},wt.alignment={vertical:"middle",horizontal:"center",wrapText:!0},(ft==10||ft==W)&&(wt.fill={type:"pattern",pattern:"solid",fgColor:{argb:"4b4c4d"},bgColor:{argb:"4b4c4d"}},wt.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const Ft=await x.xlsx.writeBuffer(),Co="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xo=".xlsx",Tt=new Blob([Ft],{type:Co});if(ze.value&&!ct.value)_e.exports.saveAs(Tt,Oo+xo),l.value=!1;else{const ft="Mmia.xlsx";Oe.downloadFile(ft,".xlsx",Tt,l)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].fnmCode),o.push(e[n].drugName),o.push(e[n].unit),ze.value?o.push(e[n].inventory-e[n].initialEntrance+e[n].outcomes-e[n].lossesAdjustments):o.push(e[n].balance),o.push(e[n].initialEntrance),o.push(e[n].outcomes),o.push(e[n].lossesAdjustments),o.push(e[n].inventory),ze.value?o.push(P(e[n].expireDate).format("DD-MM-YYYY")):o.push(e[n].expireDate),l.push(o)}return l},createRegimenArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].code),o.push(e[n].regimen),o.push(e[n].totalPatients),o.push(e[n].cumunitaryClinic),o.push(e[n].totalReferidos),l.push(o)}return l},createMmiaTipoDoentesArrayRow(e){const l=[],n=[],o=[],i=[],a=[],s=[];return ze.value&&!ct.value?(n.push("Novos"),n.push(e.totalPacientesInicio),o.push("Manuten\xE7\xE3o"),o.push(e.totalPacientesManter),i.push("Altera\xE7\xE3o"),i.push(e.totalPacientesAlterar),a.push("Tr\xE2nsito"),a.push(e.totalPacientesTransito),s.push("Transfer\xEAncias"),s.push(e.totalPacientesTransferidoDe)):(n.push("Novos"),n.push(e[0].totalPacientesInicio),o.push("Manuten\xE7\xE3o"),o.push(e[0].totalPacientesManter),i.push("Altera\xE7\xE3o"),i.push(e[0].totalPacientesAlterar),a.push("Tr\xE2nsito"),a.push(e[0].totalPacientesTransito),s.push("Transfer\xEAncias"),s.push(e[0].totalPacientesTransferidoDe)),l.push(n),l.push(o),l.push(i),l.push(a),l.push(s),l},createMmiaFaixaEtariaArrayRow(e){const l=[],n=[],o=[],i=[],a=[];return n.push("Adultos"),o.push("Pedi\xE1tricos 0 aos 4"),i.push("Pedi\xE1tricos 5 aos 9"),a.push("Pedi\xE1tricos 10 aos 14"),ze.value&&!ct.value?(n.push(e.totalPacientesAdulto),o.push(e.totalPacientes04),i.push(e.totalPacientes59),a.push(e.totalPacientes1014)):(n.push(e[0].totalPacientesAdulto),o.push(e[0].totalPacientes04),i.push(e[0].totalPacientes59),a.push(e[0].totalPacientes1014)),l.push(n),l.push(o),l.push(i),l.push(a),l},createMmiaProfilaxiaArrayRow(e){const l=[],n=[],o=[],i=[],a=[];return n.push("PPE"),o.push("PrEP"),i.push("Crian\xE7as Expostas"),a.push("Total de pacientes em TARV na US"),a.push("Ver Resumo Mensal"),ze.value&&!ct.value?(n.push(e.totalPacientesPPE),o.push(e.totalPacientesPREP),i.push(e.totalpacientesCE)):(n.push(e[0].totalPacientesPPE),o.push(e[0].totalPacientesPREP),i.push(e[0].totalpacientesCE)),l.push(n),l.push(o),l.push(i),l.push(a),l},createRegimenTotalArrayRow(e,l,n){const o=[];let i=0,a=0,s=0;for(const t in l)i+=l[t].totalPatients,a+=l[t].cumunitaryClinic,s+=l[t].totalReferidos;const d=[];return n=="PDF"?d.push({content:"Total",styles:{halign:"right",fillColor:[204,204,204]}}):d.push("Total"),d.push(i),d.push(a),d.push(s),o.push(d),o},createLinesSumaryArrayRow(e,l,n){const o=[];let i=0,a=0,s=0,d=0,t=0,m=0,g=0,f=0,r=0;for(const D in l)i+=l[D].totalline1,d+=l[D].totaldcline1,g+=l[D].totalrefline1,a+=l[D].totalline2,t+=l[D].totaldcline2,f+=l[D].totalrefline2,s+=l[D].totalline3,m+=l[D].totaldcline3,r+=l[D].totalrefline3;const p=[],v=[],b=[];return n=="PDF"?p.push({content:"1as Linhas",styles:{halign:"right"}}):p.push("1as Linhas"),p.push(i),p.push(d),p.push(g),n=="PDF"?v.push({content:"2as Linhas",styles:{halign:"right"}}):v.push("2as Linhas"),console.log(n),n=="PDF"?(v.push({content:a,styles:{cellWidth:15.1}}),v.push({content:t,styles:{cellWidth:18}}),v.push({content:f,styles:{cellWidth:21.2}})):(v.push(a),v.push(t),v.push(f)),n=="PDF"?b.push({content:"3as Linhas",styles:{halign:"right"}}):b.push("3as Linhas"),b.push(s),b.push(m),b.push(r),o.push(p),o.push(v),o.push(b),o},createLinesSumaryTotalArrayRow(e,l,n){const o=[];let i=0,a=0,s=0;for(const t in l)i+=l[t].totalline1+l[t].totalline2+l[t].totalline3,a+=l[t].totaldcline1+l[t].totaldcline2+l[t].totaldcline3,s+=l[t].totalrefline1+l[t].totalrefline2+l[t].totalrefline3;const d=[];return n=="PDF"?d.push({content:"Total",styles:{halign:"right",fillColor:[204,204,204]}}):d.push("Total"),d.push(i),d.push(a),d.push(s),o.push(d),o},createMmiaDispenseTypeDSArrayRow(e){const l=[],n=[],o=[],i=[],a=[],s=[],d=[],t=[];return n.push("M\xEAs-5"),o.push("M\xEAs-4"),i.push("M\xEAs-3"),a.push("M\xEAs-2"),s.push("M\xEAs-1"),d.push("No M\xEAs"),t.push("Total"),ze.value&&!ct.value?(n.push(e.dsM5),o.push(e.dsM4),i.push(e.dsM3),a.push(e.dsM2),s.push(e.dsM1),d.push(e.dsM0),t.push(e.dsM5+e.dsM4+e.dsM3+e.dsM2+e.dsM1+e.dsM0)):(n.push(e[0].dsM5),o.push(e[0].dsM4),i.push(e[0].dsM3),a.push(e[0].dsM2),s.push(e[0].dsM1),d.push(e[0].dsM0),t.push(e[0].dsM5+e[0].dsM4+e[0].dsM3+e[0].dsM2+e[0].dsM1+e[0].dsM0)),l.push(n),l.push(o),l.push(i),l.push(a),l.push(s),l.push(d),l.push(t),l},createMmiaDispenseTypeDTArrayRow(e){const l=[],n=[],o=[],i=[],a=[];return ze.value&&!ct.value?(n.push(e.dtM2),o.push(e.dtM1),i.push(e.dtM0),a.push(e.dtM2+e.dtM1+e.dtM0)):(n.push(e[0].dtM2),o.push(e[0].dtM1),i.push(e[0].dtM0),a.push(e[0].dtM2+e[0].dtM1+e[0].dtM0)),l.push(n),l.push(o),l.push(i),l.push(a),l},createMmiaDispenseTypeDBArrayRow(e){const l=[],n=[],o=[],i=[];return ze.value&&!ct.value?(n.push(e.dbM1),o.push(e.dbM0),i.push(e.dbM1+e.dbM0)):(n.push(e[0].dbM1),o.push(e[0].dbM0),i.push(e[0].dbM1+e[0].dbM0)),l.push(n),l.push(o),l.push(i),l},createMmiaDispenseTypeDMArrayRow(e){const l=[],n=[],o=[];return ze.value&&!ct.value?(n.push(e.dM),n.push(e.dM+e.dsM0+e.dtM0+e.dbM0),o.push(e.dM),o.push(e.dM+e.dtM2+e.dtM1+e.dtM0+e.dbM0+e.dbM1+e.dsM5+e.dsM4+e.dsM3+e.dsM2+e.dsM1+e.dsM0)):(n.push(e[0].dM),n.push(e[0].dM+e[0].dsM0+e[0].dtM0+e[0].dbM0),o.push(e[0].dM),o.push(e[0].dM+e[0].dtM2+e[0].dtM1+e[0].dtM0+e[0].dbM0+e[0].dbM1+e[0].dsM5+e[0].dsM4+e[0].dsM3+e[0].dsM2+e[0].dsM1+e[0].dsM0)),l.push(n),l.push(o),l},createMmiaAjustePercentageArrayRow(e){const l=[],n=[];return n.push("Ajuste"),ze.value&&!ct.value?n.push(Math.round((e.dM+e.dtM2+e.dtM1+e.dtM0+e.dbM0+e.dbM1+e.dsM5+e.dsM4+e.dsM3+e.dsM2+e.dsM1+e.dsM0)/(e.dM+e.dsM0+e.dtM0+e.dbM0)*100)+"%"):n.push(Math.round((e[0].dM+e[0].dtM2+e[0].dtM1+e[0].dtM0+e[0].dbM0+e[0].dbM1+e[0].dsM5+e[0].dsM4+e[0].dsM3+e[0].dsM2+e[0].dsM1+e[0].dsM0)/(e[0].dM+e[0].dsM0+e[0].dtM0+e[0].dbM0)*100)+"%"),l.push(n),l},createFotterTableRow(){const e=[],l=[];return l.push("Elaborado por"),l.push("Visto:"),l.push("Data de elabora\xE7\xE3o: "+P(new Date).format("DD-MM-YYYY")),e.push(l),e},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const Wc={class:"param-container"},Qc="Mmia",jc="MAPA_MENSAL_DE_INFORMACAO_ARV",Xc={__name:"Mmia",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(null),i=S(!1),a=e,s=S(0),d=S(0),t=S(""),m=S(!1),g=S(!1),f={id:2,description:"Mensal",code:"MONTH"},r=S(!1);S({type:"",visible:!1,msg:""});const p=S(0),v=h=>{if(t.value.remove(),h){const y=h.id;r.value=!0,ee.remove(y)}else r.value=!0,ee.remove(a.id)},b=(h,y)=>{y.value||ee.set(h.id,h)},D=async h=>{if(h.periodType!=="MONTH")n("O per\xEDodo seleccionado n\xE3o \xE9 aplicavel a este relat\xF3rio, por favor seleccionar o per\xEDodo [Mensal]");else if(p.value=.001,l.value)b(h,r),C.apiInitMmiaProcessing(h).then(y=>{u(h)});else{b(h,r);const y=await $e.getMmiaStockReport(h),x=await $e.getMmiaRegimenSubReport(y);await $e.getMmiaReport(y,x),p.value=100,h.progress=100}},u=h=>{l.value&&C.getProcessingStatus("mmiaReport",h).then(y=>{y.data.progress>.001?(p.value=y.data.progress,p.value<100?(b(h,r),h.progress=y.data.progress,setTimeout(()=>{u(h)},3e3)):(p.value=100,h.progress=100,b(h,r))):(p.value=100,h.progress=100,b(h,r))})},c=(h,y)=>{y==="PDF"?ka.downloadPDF(h,m).then(x=>{x===204&&(n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)}):ka.downloadExcel(h,g).then(x=>{x===204&&(n("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",o),E("resultFromLocalStorage",i),E("getProcessingStatus",u),(h,y)=>(M(),se("div",{ref_key:"filterMmiaSection",ref:t},[i.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:y[0]||(y[0]=x=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(o.value!==null?o.value.code:"")+": Mapa Mensal de Informa\xE7\xE3o de ARV (MMIA) ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:y[1]||(y[1]=x=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Mapa Mensal de Informa\xE7\xE3o de ARV (MMIA) ",1)]),_:1})),ie("div",Wc,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:s.value,qtyProcessed:d.value,reportType:jc,progress:p.value,tabName:Qc,params:e.params,typeService:e.selectedService,clinicalService:e.selectedService,applicablePeriods:f,onGenerateReport:c,onInitReportProcessing:D},null,8,["id","totalRecords","qtyProcessed","progress","params","typeService","clinicalService"])]),_:1})]),_:1})])],512))}};var Jc=Fe(Xc,[["__scopeId","data-v-aab9ec18"]]);const{isMobile:Va,isOnline:Vt}=ce(),za=`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,_a=`LINHAS TERAPEUTICAS 
 USADAS`,Sn="Linhas_Usadas",Lo=Sn.concat("_"+P(new Date).format("DD-MM-YYYY"));function Ua(e){return e.reduce((l,n)=>{const{codigoRegime:o,regimeTerapeutico:i,totalPrescricoes:a,linhaTerapeutica:s}=n;return l[o]||(l[o]={regimeTerapeutico:i,"1\xAA Linha":0,"2\xAA Linha":0,"3\xAA Linha":0,total:0}),l[o][s]+=a,l[o].total+=a,l},{})}function $a(e){return Object.entries(e).map(([l,n])=>[l,n.regimeTerapeutico,n["1\xAA Linha"],n["2\xAA Linha"],n["3\xAA Linha"],n.total])}var Ha={async downloadPDF(e){const l=new Ce({orientation:"p",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});l.setFontSize(10);const n=new Image;n.src="data:image/png;base64,"+le,l.setProperties({title:Lo.concat(".pdf")});const o=de.currClinic();let i=[],a=[[]];if(Vt.value){const g=await C.printReportOther("linhasUsadasReport",e);if(g.status===204||!g.data.length)return 204;i=g.data;const f=Ua(g.data);a=$a(f)}const s=["C\xF3digo","Regime Terap\xEAutico","1\xAA Linha","2\xAA Linha","3\xAA Linha","Total"],d=[[n,{content:za,styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}},{colSpan:2,content:_a,styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}}],[{content:"Unidade Sanit\xE1ria: "+o.clinicName,colSpan:3,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Data Inicio: "+C.getFormatDDMMYYYY(i[0].startDate),styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}],[{colSpan:2,content:"Distrito: "+o.district.description,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Prov\xEDncia: "+o.province.description,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Data Fim: "+C.getFormatDDMMYYYY(i[0].endDate),styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}]];K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6,textColor:0},columnStyles:{0:{cellWidth:14}},styles:{maxCellHeight:4},body:d,startY:10}),l.addImage(n,"PNG",16,10,10,10),K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:13},2:{cellWidth:15},3:{cellWidth:18}},headStyles:{halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[s],body:a,startY:l.lastAutoTable.finalY}),l.setFontSize(8);const t=l.internal.pageSize,m=t.height||t.getHeight();if(l.text("P\xE1gina "+l.internal.getNumberOfPages(),15,m-10),Vt.value&&!Va.value)window.open(l.output("bloburl"));else{const g=l.output();Kc(Lo,"pdf",g)}},async downloadExcel(e){const l=de.currClinic();console.log(l);let n={},o=[],i=[[]];if(Vt.value){if(n=await C.printReportOther("linhasUsadasReport",e),console.log(n),n.status===204||n.data.length===0)return 204;o=n.data;const U=Ua(n.data);i=$a(U),console.log(i)}const a=new xe.exports.Workbook;a.creator="CSAUDE",a.lastModifiedBy="CSAUDE",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(Sn),d=a.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("C12"),p=s.getCell("E11"),v=s.getCell("E12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("D12"),c=s.getCell("F11"),h=s.getCell("F12"),y=s.getRow(14),x=s.getRow(15),R=s.getColumn("A"),_=s.getColumn("B"),N=s.getColumn("C"),O=s.getColumn("D"),T=s.getColumn("E"),q=s.getColumn("F");t.alignment=m.alignment=y.alignment=x.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=za,m.value=_a,b.value=l==null?void 0:l.clinicName,u.value=l==null?void 0:l.province.description,D.value=l==null?void 0:l.district.description,c.value=C.getFormatDDMMYYYY(o[0].startDate),h.value=C.getFormatDDMMYYYY(o[0].endDate),g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:F10"),s.mergeCells("B11:D11"),x.height=30,y.height=30,R.width=20,_.width=20,N.width=30,O.width=15,T.width=20,q.width=15,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Sn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"C\xF3digo",totalsRowLabel:"none",filterButton:!1},{name:"Regime Terap\xEAutico",totalsRowLabel:"none:",filterButton:!1},{name:"1\xAA Linha",totalsRowFunction:"none",filterButton:!1},{name:"2\xAA Linha",totalsRowFunction:"none",filterButton:!1},{name:"3\xAA Linha",totalsRowFunction:"none",filterButton:!1},{name:"Total",totalsRowFunction:"none",filterButton:!1}],rows:i});const X=s.lastRow.number!==void 0?s.lastRow.number:0;for(let U=14;U<=X;U++)s.getRow(U).eachCell({includeEmpty:!0},Q=>{Q.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Q.alignment={vertical:"middle",horizontal:"center",wrapText:!0},U===14&&(Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const $=await a.xlsx.writeBuffer(),w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=".xlsx",G=new Blob([$],{type:w});if(Vt.value&&!Va.value)_e.exports.saveAs(G,Lo+V);else{let U=function(B,W){const oe=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(oe,function(Y){z(Y,B,W)},Z)},z=function(B,W,oe){B.getFile(W,{create:!0,exclusive:!1},function(Y){Q(Y,oe)},L)},Q=function(B,W){B.createWriter(function(oe){oe.onwriteend=function(){console.log("Successful file write..."),k()},oe.onerror=function(Y){console.log("Failed file write: "+Y)},oe.write(W)})},Z=function(B){console.log(B)},L=function(B){console.log("errorr: "+B.toString())},k=function(){const B=H;console.log("file system 44444: "+B);const W=cordova.file.externalRootDirectory+"Download/"+B;console.log("file system 2222: "+W);const oe=decodeURIComponent(W);cordova.plugins.fileOpener2.open(oe,"application/vnd.ms-excel",{error:function(Y){console.log("file system open3333366: "+Y+oe)},success:function(){}})};const H="PacientesActivos.xlsx";U(H,G)}}};function Kc(e,l,n){let o=l==="pdf"?".pdf":".xlsx";const i=new Blob([n],{type:l==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});_e.exports.saveAs(i,e.concat(o))}const Zc={class:"param-container"},ed="LinhasTerapeuticasUsadas",td="LINHAS_TERAPEUTICAS_USADAS",od={__name:"LinhasUsadas",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(null),i=S(!1),a=S(0),s=S(0),d=S(""),t=S(!1),m=S(!1),g={id:2,description:"Mensal",code:"MONTH"},f=S(!1);S({type:"",visible:!1,msg:""});const r=S(0),p=c=>{if(d.value.remove(),c){const h=c.id;f.value=!0,ee.remove(h)}},v=(c,h)=>{h.value||ee.set(c.id,c)},b=async c=>{console.log(c),r.value=.001,l.value&&(v(c,f),C.apiInitLinhasUsadasProcessing(c).then(h=>{D(c)}))},D=c=>{C.getProcessingStatus("linhasUsadasReport",c).then(h=>{h.data.progress>.001?(r.value=h.data.progress,r.value<100?(v(c,f),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(r.value=100,c.progress=100,v(c,f))):(r.value=100,c.progress=100,v(c,f))})},u=(c,h)=>{h==="PDF"?Ha.downloadPDF(c).then(y=>{console.log(y),y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1}):Ha.downloadExcel(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",o),E("resultFromLocalStorage",i),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterLinhasUsadasSection",ref:d},[i.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(o.value!==null?o.value.code:"")+": Linhas Terapeuticas Usadas ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Linhas Terapeuticas Usadas ",1)]),_:1})),ie("div",Zc,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:a.value,qtyProcessed:s.value,reportType:td,progress:r.value,tabName:ed,params:e.params,typeService:e.selectedService,clinicalService:e.selectedService,applicablePeriods:g,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","totalRecords","qtyProcessed","progress","params","typeService","clinicalService"])]),_:1})]),_:1})])],512))}};var nd=Fe(od,[["__scopeId","data-v-766f0195"]]);const{isMobile:Ga,isOnline:zt}=ce(),qa=`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,Wa="SEGUNDAS LINHAS TERAP\xCAUTICAS USADAS",yn="segundas_linhas",ko=yn.concat("_"+P(new Date).format("DD-MM-YYYY"));function Qa(e){return e.reduce((l,n)=>{const{codigoRegime:o,regimeTerapeutico:i,totalPrescricoes:a,linhaTerapeutica:s}=n;return l[o]||(l[o]={regimeTerapeutico:i,total:0}),l[o][s]+=a,l[o].total+=a,l},{})}function ja(e){return Object.entries(e).map(([l,n])=>[l,n.regimeTerapeutico,n.total])}var Xa={async downloadPDF(e){const l=new Ce({orientation:"p",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});l.setFontSize(10);const n=new Image;n.src="data:image/png;base64,"+le,l.setProperties({title:ko.concat(".pdf")});const o=de.currClinic();let i=[],a=[[]];if(zt.value){const g=await C.printReportOther("segundasLinhasReport",e);if(g.status===204||!g.data.length)return 204;i=g.data;const f=Qa(g.data);a=ja(f)}const s=["C\xF3digo","Regime Terap\xEAutico","Total"],d=[[n,{content:qa,styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}},{colSpan:2,content:Wa,styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}}],[{content:"Unidade Sanit\xE1ria: "+o.clinicName,colSpan:3,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Data Inicio: "+C.getFormatDDMMYYYY(i[0].startDate),styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}],[{colSpan:2,content:"Distrito: "+o.district.description,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Prov\xEDncia: "+o.province.description,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Data Fim: "+C.getFormatDDMMYYYY(i[0].endDate),styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}]];K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6,textColor:0},columnStyles:{0:{cellWidth:14}},styles:{maxCellHeight:4},body:d,startY:10}),l.addImage(n,"PNG",16,10,10,10),K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:13},2:{cellWidth:15},3:{cellWidth:18}},headStyles:{halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[s],body:a,startY:l.lastAutoTable.finalY}),l.setFontSize(8);const t=l.internal.pageSize,m=t.height||t.getHeight();if(l.text("P\xE1gina "+l.internal.getNumberOfPages(),15,m-10),zt.value&&!Ga.value)window.open(l.output("bloburl"));else{const g=l.output();ad(ko,"pdf",g)}},async downloadExcel(e){const l=de.currClinic();console.log(l);let n={},o=[],i=[[]];if(zt.value){if(n=await C.printReportOther("segundasLinhasReport",e),console.log(n),n.status===204||n.data.length===0)return 204;o=n.data;const U=Qa(n.data);i=ja(U),console.log(i)}const a=new xe.exports.Workbook;a.creator="CSAUDE",a.lastModifiedBy="CSAUDE",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(yn),d=a.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("C12"),p=s.getCell("E11"),v=s.getCell("E12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("D12"),c=s.getCell("F11"),h=s.getCell("F12"),y=s.getRow(14),x=s.getRow(15),R=s.getColumn("A"),_=s.getColumn("B"),N=s.getColumn("C"),O=s.getColumn("D"),T=s.getColumn("E"),q=s.getColumn("F");t.alignment=m.alignment=y.alignment=x.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=qa,m.value=Wa,b.value=l==null?void 0:l.clinicName,u.value=l==null?void 0:l.province.description,D.value=l==null?void 0:l.district.description,c.value=C.getFormatDDMMYYYY(o[0].startDate),h.value=C.getFormatDDMMYYYY(o[0].endDate),g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:F10"),s.mergeCells("B11:D11"),x.height=30,y.height=30,R.width=20,_.width=20,N.width=30,O.width=15,T.width=20,q.width=15,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:yn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"C\xF3digo",totalsRowLabel:"none",filterButton:!1},{name:"Regime Terap\xEAutico",totalsRowLabel:"none:",filterButton:!1},{name:"Total",totalsRowFunction:"none",filterButton:!1}],rows:i});const X=s.lastRow.number!==void 0?s.lastRow.number:0;for(let U=14;U<=X;U++)s.getRow(U).eachCell({includeEmpty:!0},Q=>{Q.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Q.alignment={vertical:"middle",horizontal:"center",wrapText:!0},U===14&&(Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const $=await a.xlsx.writeBuffer(),w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=".xlsx",G=new Blob([$],{type:w});if(zt.value&&!Ga.value)_e.exports.saveAs(G,ko+V);else{let U=function(B,W){const oe=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(oe,function(Y){z(Y,B,W)},Z)},z=function(B,W,oe){B.getFile(W,{create:!0,exclusive:!1},function(Y){Q(Y,oe)},L)},Q=function(B,W){B.createWriter(function(oe){oe.onwriteend=function(){console.log("Successful file write..."),k()},oe.onerror=function(Y){console.log("Failed file write: "+Y)},oe.write(W)})},Z=function(B){console.log(B)},L=function(B){console.log("errorr: "+B.toString())},k=function(){const B=H;console.log("file system 44444: "+B);const W=cordova.file.externalRootDirectory+"Download/"+B;console.log("file system 2222: "+W);const oe=decodeURIComponent(W);cordova.plugins.fileOpener2.open(oe,"application/vnd.ms-excel",{error:function(Y){console.log("file system open3333366: "+Y+oe)},success:function(){}})};const H="PacientesActivos.xlsx";U(H,G)}}};function ad(e,l,n){let o=l==="pdf"?".pdf":".xlsx";const i=new Blob([n],{type:l==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});_e.exports.saveAs(i,e.concat(o))}const ld={class:"param-container"},id="SegundasLinhas",sd="SEGUNDAS_LINHAS",rd={__name:"SegundasLinhas",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(null),i=S(!1),a=S(0),s=S(0),d=S(""),t=S(!1),m=S(!1),g={id:2,description:"Mensal",code:"MONTH"},f=S(!1);S({type:"",visible:!1,msg:""});const r=S(0),p=c=>{if(d.value.remove(),c){const h=c.id;f.value=!0,ee.remove(h)}},v=(c,h)=>{h.value||ee.set(c.id,c)},b=async c=>{r.value=.001,l.value&&(v(c,f),C.apiInitSegundasLinhasProcessing(c).then(h=>{D(c)}))},D=c=>{C.getProcessingStatus("segundasLinhasReport",c).then(h=>{h.data.progress>.001?(r.value=h.data.progress,r.value<100?(v(c,f),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(r.value=100,c.progress=100,v(c,f))):(r.value=100,c.progress=100,v(c,f))})},u=(c,h)=>{h==="PDF"?Xa.downloadPDF(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1}):Xa.downloadExcel(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",o),E("resultFromLocalStorage",i),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterSegundasLinhasSection",ref:d},[i.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(o.value!==null?o.value.code:"")+": Segundas Linhas ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Segundas Linhas ",1)]),_:1})),ie("div",ld,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:a.value,qtyProcessed:s.value,reportType:sd,progress:r.value,tabName:id,params:e.params,typeService:e.selectedService,clinicalService:e.selectedService,applicablePeriods:g,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","totalRecords","qtyProcessed","progress","params","typeService","clinicalService"])]),_:1})]),_:1})])],512))}};var cd=Fe(rd,[["__scopeId","data-v-3247d2ea"]]);const Ja=We[Li.entity];var Qe={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e),[n]=await Promise.all([st.getAllPatientsLastPackForTARVFromDexie()]),[o]=await Promise.all([st.getAllAbsentPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate,n)]);let i=o.reduce((a,s)=>{const d=a[s.patientvisitDetails.patientVisit.patient.id];return(!d||new Date(s.pickupDate)>new Date(d.pickupDate))&&(a[s.patientvisitDetails.patientVisit.patient.id]=s),a},[]);i=Object.values(i);for(const a of i){const s=a.patientvisitDetails.patientVisit.patient,d=a.patientvisitDetails.episode.patientServiceIdentifier;if(d.service.id===l.clinicalService){const t=new Li;if(s){const m=P(a.nextPickUpDate).add(60,"d").format("YYYY/MM/DD");t.nid=d.value,t.name=s.firstNames+" "+s.lastNames,t.cellphone=s.cellphone,t.dateBackUs=null,t.dateMissedPickUp=a.nextPickUpDate,t.dateIdentifiedAbandonment=m>P(l.endDate).format("YYYY/MM/DD")?m:"",t.returnedPickUp=null,t.reportId=l.id,t.year=l.year,t.endDate=l.endDate,t.id=He(),this.localDbAddOrUpdate(t)}}}},groupedPatientVisits(e){const n=e.filter(i=>i.pack!==void 0).sort((i,a)=>new Date(a.patientVisit.visitDate)-new Date(i.patientVisit.visitDate));return this.groupedMapChild(n)},groupedMapChild(e){return e.reduce((l,n)=>{const o=n.patientVisit.patient.id;return l.has(o)||l.set(o,n),l},new Map)},localDbAddOrUpdate(e){return Ja.add(e).catch(l=>{console.log(l)})},localDbGetAllByReportId(e){return Ja.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const{isMobile:Ka,isOnline:_t}=ce(),wn="PacientesAbandono",dd=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,ud="Pacientes Abandono",Vo=wn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Ut={async downloadPDF(e,l,n){console.log(n);let o="",i=[],a={};if(_t.value){const f=await C.printReport("patientsAbandonmentReport",e,l);if(console.log(f),f.status===204||f.data.length===0)return 204;const r=f.data[0];r.startDate!==null&&r.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(r.startDate),n.endDateParam=C.getFormatDDMMYYYY(r.endDate)),o=this.createArrayOfArrayRow(f.data)}else{if(i=await Qe.localDbGetAllByReportId(e),i.length===0)return 204;a=i[0],a.startDate!==null&&a.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(a.startDate),n.endDateParam=C.getFormatDDMMYYYY(a.endDate)),o=this.createArrayOfArrayRow(i)}const s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=new Image;t.src="data:image/png;base64,"+le,d.internal.pageSize.getWidth(),d.setProperties({title:Vo.concat(".pdf")});const m=[[{content:"Pacientes Abandono",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?s.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?s.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:m}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(t,"png",28,15,10,10);const g=["NID","NOME","ENDERE\xC7O","Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)","Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)","Data em que Regressou \xE0 Unidade Sanit\xE1ria","Contacto"];if(K(d,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{},didDrawPage:function(f){const r="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const p=d.internal.pageSize,v=p.height?p.height:p.getHeight();d.text(r,f.settings.margin.right,v-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[g],body:o}),_t.value&&!Ka.value)window.open(d.output("bloburl"));else{const f=d.output();this.downloadFile(Vo,"pdf",f)}},async downloadExcel(e,l,n){const o=de.currClinic();let i="",a=[],s={};if(_t.value){const w=await C.printReport("patientsAbandonmentReport",e,l);if(w.status===204||w.data.length===0)return 204;const V=w.data[0];n.startDateParam=C.getFormatDDMMYYYY(V.startDate),n.endDateParam=C.getFormatDDMMYYYY(V.endDate),i=this.createArrayOfArrayRow(w.data)}else{if(a=await Qe.localDbGetAllByReportId(e),a.length===0)return 204;s=a[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),i=this.createArrayOfArrayRow(a)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(wn),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("B11"),v=t.getCell("E11"),b=t.getCell("E12"),D=t.getCell("F11"),u=t.getCell("F12"),c=t.getRow(15),h=t.getColumn("A"),y=t.getColumn("B"),x=t.getColumn("C"),R=t.getColumn("D"),_=t.getColumn("E"),N=t.getColumn("F");g.alignment=f.alignment=c.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=v.alignment=b.alignment={vertical:"middle",horizontal:"left",wrapText:!1},f.border=r.border=p.border=v.border=D.border=b.border=u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=dd,f.value=ud,p.value=o==null?void 0:o.clinicName,D.value=n.startDateParam,u.value=n.endDateParam,r.value="Unidade Sanit\xE1ria",v.value="Data In\xEDcio",b.value="Data Fim",t.mergeCells("A1:A7"),t.mergeCells("A9:F10"),t.mergeCells("B11:D11"),t.mergeCells("A12:D12"),c.height=30,h.width=25,y.width=30,x.width=25,R.width=25,_.width=25,N.width=20,f.font=v.font=b.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:wn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Endere\xE7o",totalsRowFunction:"none",filterButton:!1},{name:"Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Regressou \xE0 Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1}],rows:i});const T=t.lastRow.number!==void 0?t.lastRow.number:0;for(let w=14;w<=T;w++)t.getRow(w).eachCell({includeEmpty:!0},G=>{G.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},G.alignment={vertical:"middle",horizontal:"center",wrapText:!0},w===14&&(G.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},G.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const q=await d.xlsx.writeBuffer(),I="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",X=".xlsx",$=new Blob([q],{type:I});if(_t.value&&!Ka.value)Ue($,Vo+X);else{let w=function(L,k){const H=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(H,function(B){V(B,L,k)},U)},V=function(L,k,H){L.getFile(k,{create:!0,exclusive:!1},function(B){G(B,H)},z)},G=function(L,k){L.createWriter(function(H){H.onwriteend=function(){Q()},H.onerror=function(B){console.log("Failed file write: "+B)},H.write(k)})},U=function(L){console.log(L)},z=function(L){console.log("errorr: "+L.toString())},Q=function(){const L=Z,k=cordova.file.externalRootDirectory+"Download/"+L,H=decodeURIComponent(k);cordova.plugins.fileOpener2.open(H,"application/vnd.ms-excel",{error:function(B){console.log("file system open3333366: "+B+H)},success:function(){}})};const Z="PacientesAbandono.xlsx";w(Z,$)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(e[n].address),o.push(P(new Date(e[n].dateMissedPickUp)).format("DD-MM-YYYY"));const i=e[n].dateIdentifiedAbandonment;o.push(i!==null&&i!==""?P(new Date(e[n].dateIdentifiedAbandonment)).format("DD-MM-YYYY"):""),o.push(e[n].returnedPickUp!==null?P(new Date(e[n].returnedPickUp)).format("DD-MM-YYYY"):""),o.push(e[n].contact),l.push(o)}return l},downloadFile(e,l,n){const o=e+l;i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o,f=cordova.file.externalRootDirectory+"Download/"+g,r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Za=We[ki.entity],{idadeReportCalculator:gd}=yo();var je={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);const[n]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.patientvisitDetails.patientVisit.patient,a=o.patientvisitDetails.episode.patientServiceIdentifier,s=o.patientvisitDetails.prescription.prescriptionDetails,d=s.length>0?s[0].therapeuticRegimen:"",t=s.length>0?s[0].dispenseType:"";if(a.service.id===l.clinicalService){const m=new ki;m.reportId=l.id,m.year=l.year,m.startDate=l.startDate,m.endDate=l.endDate,m.dispenseType=t.description,m.nid=a.value,m.firstNames=i.firstNames,m.middleNames=i.middleNames,m.lastNames=i.lastNames,m.cellphone=i.cellphone,m.pickUpDate=o.pickupDate,m.nexPickUpDate=o.nextPickUpDate,m.therapeuticalRegimen=d.description,m.age=gd(i.dateOfBirth),m.dispenseMode=o.dispenseMode.description,m.clinicalService=a.service.description,m.clinic=o.clinic.clinicName,m.clinicsector=de.currClinic().clinicName,m.id=He(),this.localDbAddOrUpdate(m),console.log(m)}}},localDbAddOrUpdate(e){return Za.add(e).catch(l=>{console.log(l)})},localDbGetAllByReportId(e){return Za.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const fd={class:"param-container"},md="PatientsAbandonment",pd="PATIENTES_ABANDONMENT",hd={__name:"PatientsAbandonment",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),n=S(0),o=S(0),i=S(0),a=S(""),s=S(!1),d=S(!1),t=S(null),m=S(!1),g=S(!1),f=(D,u)=>{u.value||ee.set(D.id,D)},r=D=>{if(a.value.remove(),D){const u=D.id;g.value=!0,ee.remove(u)}},p=D=>{i.value=.001,l.value?(f(D,g),C.apiInitReportProcess("patientsAbandonmentReport",D).then(u=>{setTimeout(()=>{v(D)},3e3)})):(f(D,g),je.getDataLocalDb(D),i.value=100,D.progress=100)},v=D=>{C.getProcessingStatus("patientsAbandonmentReport",D).then(u=>{u.data.progress>.001?(i.value=u.data.progress,i.value<100?(f(D,g),D.progress=u.data.progress,setTimeout(()=>{v(D)},3e3)):(i.value=100,D.progress=100,f(D,g))):setTimeout(()=>{v(D)},3e3)})},b=(D,u,c)=>{l.value?u==="PDF"?(s.value=!0,Ut.downloadPDF(D,u,c),s.value=!1):(d.value=!0,Ut.downloadExcel(D,u,c),d.value=!1):je.localDbGetAllByReportId(D).then(h=>{const y=h[0];u==="PDF"?(Ut.downloadPDF("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h),s.value=!1):(Ut.downloadExcel("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h),d.value=!1)})};return E("downloadingPdf",s),E("downloadingXls",d),E("serviceAux",t),E("resultFromLocalStorage",m),E("getProcessingStatus",v),(D,u)=>(M(),se("div",{ref_key:"filterPatientsAbandonmentSection",ref:a},[m.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:u[0]||(u[0]=c=>r(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(t.value!==null?t.value.code:"")+": Pacientes Abandono ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:u[1]||(u[1]=c=>r(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Abandono ",1)]),_:1})),ie("div",fd,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:n.value,qtyProcessed:o.value,progress:i.value,reportType:pd,tabName:md,params:e.params,clinicalService:e.selectedService,onGenerateReport:b,onInitReportProcessing:p},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var vd=Fe(hd,[["__scopeId","data-v-bc4f3522"]]);const{isMobile:el,isOnline:$t}=ce(),Rn="PacientesAbandonoQueRetornaram",Dd=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,bd="Pacientes Abandono que Retornaram",zo=Rn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Ht={async downloadPDF(e,l,n){let o="",i=[],a={};if($t.value){const f=await C.printReport("patientsAbandonmentReport",e,l);if(f.status===204||f.data.length===0)return 204;const r=f.data[0];r.startDate!==null&&r.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(r.startDate),n.endDateParam=C.getFormatDDMMYYYY(r.endDate)),o=this.createArrayOfArrayRow(f.data)}else{if(i=await Qe.localDbGetAllByReportId(e),i.length===0)return 204;a=i[0],a.startDate!==null&&a.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(a.startDate),n.endDateParam=C.getFormatDDMMYYYY(a.endDate)),o=this.createArrayOfArrayRow(i)}const s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=new Image;t.src="data:image/png;base64,"+le,d.internal.pageSize.getWidth(),d.setProperties({title:zo.concat(".pdf")});const m=[[{content:"Pacientes Abandono que Retornaram",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?s.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?s.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:m}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(t,"png",28,15,10,10);const g=["NID","NOME","ENDERE\xC7O","Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)","Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)","Data em que Regressou \xE0 Unidade Sanit\xE1ria","Contacto"];if(K(d,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{},didDrawPage:function(f){const r="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const p=d.internal.pageSize,v=p.height?p.height:p.getHeight();d.text(r,f.settings.margin.right,v-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[g],body:o}),$t.value&&!el.value)window.open(d.output("bloburl"));else{const f=d.output();this.downloadFile(zo,"pdf",f)}},async downloadExcel(e,l,n){const o=de.currClinic();let i="",a=[],s={};if($t.value){const w=await C.printReport("patientsAbandonmentReport",e,l);if(w.status===204||w.data.length===0)return 204;const V=w.data[0];n.startDateParam=C.getFormatDDMMYYYY(V.startDate),n.endDateParam=C.getFormatDDMMYYYY(V.endDate),i=this.createArrayOfArrayRow(w.data)}else{if(a=await Qe.localDbGetAllByReportId(e),a.length===0)return 204;s=a[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),i=this.createArrayOfArrayRow(a)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Rn),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("B11"),v=t.getCell("E11"),b=t.getCell("E12"),D=t.getCell("F11"),u=t.getCell("F12"),c=t.getRow(15),h=t.getColumn("A"),y=t.getColumn("B"),x=t.getColumn("C"),R=t.getColumn("D"),_=t.getColumn("E"),N=t.getColumn("F");g.alignment=f.alignment=c.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=v.alignment=b.alignment={vertical:"middle",horizontal:"left",wrapText:!1},f.border=r.border=p.border=v.border=D.border=b.border=u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Dd,f.value=bd,p.value=o==null?void 0:o.clinicName,D.value=n.startDateParam,u.value=n.endDateParam,r.value="Unidade Sanit\xE1ria",v.value="Data In\xEDcio",b.value="Data Fim",t.mergeCells("A1:A7"),t.mergeCells("A9:F10"),t.mergeCells("B11:D11"),t.mergeCells("A12:D12"),c.height=30,h.width=25,y.width=30,x.width=25,R.width=25,_.width=25,N.width=20,f.font=v.font=b.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Rn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"NOME",totalsRowFunction:"none",filterButton:!1},{name:"ENDERE\xC7O",totalsRowFunction:"none",filterButton:!1},{name:"Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Regressou \xE0 Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1}],rows:i});const T=t.lastRow.number!==void 0?t.lastRow.number:0;for(let w=14;w<=T;w++)t.getRow(w).eachCell({includeEmpty:!0},G=>{G.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},G.alignment={vertical:"middle",horizontal:"center",wrapText:!0},w===14&&(G.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},G.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const q=await d.xlsx.writeBuffer(),I="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",X=".xlsx",$=new Blob([q],{type:I});if($t.value&&!el.value)Ue($,zo+X);else{let w=function(L,k){const H=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(H,function(B){V(B,L,k)},U)},V=function(L,k,H){L.getFile(k,{create:!0,exclusive:!1},function(B){G(B,H)},z)},G=function(L,k){L.createWriter(function(H){H.onwriteend=function(){Q()},H.onerror=function(B){console.log("Failed file write: "+B)},H.write(k)})},U=function(L){console.log(L)},z=function(L){console.log("errorr: "+L.toString())},Q=function(){const L=Z,k=cordova.file.externalRootDirectory+"Download/"+L,H=decodeURIComponent(k);cordova.plugins.fileOpener2.open(H,"application/vnd.ms-excel",{error:function(B){console.log("file system open3333366: "+B+H)},success:function(){}})};const Z="PacientesAbandono.xlsx";w(Z,$)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(e[n].address),o.push(P(new Date(e[n].dateMissedPickUp)).format("DD-MM-YYYY"));const i=e[n].dateIdentifiedAbandonment;o.push(i!==null&&i!==""?P(new Date(e[n].dateIdentifiedAbandonment)).format("DD-MM-YYYY"):""),o.push(e[n].returnedPickUp!==null?P(new Date(e[n].returnedPickUp)).format("DD-MM-YYYY"):""),o.push(e[n].contact),l.push(o)}return l},downloadFile(e,l,n){const o=e+l;i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o,f=cordova.file.externalRootDirectory+"Download/"+g,r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Sd={class:"param-container"},yd="PatientsAbandonmentReturned",wd="PATIENTES_ABANDONMENT_RETURNED",Rd={__name:"PatientsAbandonmentReturned",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,l.value?(r(u,f),C.apiInitReportProcess("patientsAbandonmentReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})):(r(u,f),je.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("patientsAbandonmentReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{l.value?c==="PDF"?(d.value=!0,Ht.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1}),d.value=!1):(t.value=!0,Ht.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1}),t.value=!1):je.localDbGetAllByReportId(u).then(y=>{const x=y[0];c==="PDF"?Ht.downloadPDF("",P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y).then(R=>{R===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1}):Ht.downloadExcel("",P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y).then(R=>{R===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1})})};return E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterPatientsAbandonmentSection",ref:s},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Pacientes Abandono Que Retornaram ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Abandono Que Retornaram ",1)]),_:1})),ie("div",Sd,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,progress:a.value,reportType:wd,tabName:yd,params:e.params,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var Cd=Fe(Rd,[["__scopeId","data-v-d2e787a2"]]);const{isMobile:tl,isOnline:Gt}=ce(),xd=`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,Pd="BALANCETE",Ad="balancete",_o=Ad.concat("_"+P(new Date).format("DD-MM-YYYY"));var ol={async downloadPDF(e){const l=new Ce({orientation:"p",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});l.setFontSize(10);const n=new Image;n.src="data:image/png;base64,"+le,l.setProperties({title:_o.concat(".pdf")});const o=de.currClinic();let i=[];if(Gt.value){const t=await C.printReportOther("balanceteReport",e);if(t.status===204||!t.data.length)return 204;i=t.data}const a=i.reduce((t,m)=>(t[m.medicamento]||(t[m.medicamento]=[]),t[m.medicamento].push(m),t),{}),s=t=>[[{content:"FNM",styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{colSpan:2,content:"Medicamento",styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{content:"Unidade",styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{colSpan:2,content:"Prazo de Validade",styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}}],[{content:t.fnm,styles:{halign:"left",textColor:0,fillColor:[255,255,255],lineWidth:.2}},{colSpan:2,content:t.medicamento,styles:{halign:"center",valign:"middle",textColor:0,fillColor:[255,255,255],lineWidth:.2}},{content:t.unidade,styles:{valign:"middle",halign:"left",textColor:0,fillColor:[255,255,255],lineWidth:.2}},{colSpan:2,content:C.getFormatDDMMYYYY(t.validadeMedicamento),styles:{halign:"center",valign:"middle",textColor:0,fillColor:[255,255,255],lineWidth:.2}}],[{content:"Data de Movimento",styles:{halign:"left",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{content:"Entradas",styles:{halign:"left",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{content:"Perdas e Ajustes",styles:{valign:"middle",halign:"left",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{content:"Saidas",styles:{halign:"left",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{content:"Stock Existente",styles:{halign:"left",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}},{content:"Notas",styles:{valign:"middle",halign:"left",fontStyle:"bold",textColor:0,fillColor:[211,211,211],lineWidth:.2}}]],d=[[n,{content:xd,styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}},{colSpan:2,content:Pd,styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}}],[{content:"Unidade Sanit\xE1ria: "+o.clinicName,colSpan:3,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Data Inicio: "+C.getFormatDDMMYYYY(i[0].startDate),styles:{valign:"middle",halign:"left",fontStyle:"bold",textColor:0}}],[{colSpan:2,content:"Distrito: "+o.district.description,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Prov\xEDncia: "+o.province.description,styles:{halign:"left",fontStyle:"bold",textColor:0}},{content:"Data Fim: "+C.getFormatDDMMYYYY(i[0].endDate),styles:{valign:"middle",halign:"left",fontStyle:"bold",textColor:0}}]];if(K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6,textColor:0},columnStyles:{0:{cellWidth:20}},styles:{maxCellHeight:4},body:d,startY:10}),l.addImage(n,"PNG",16,10,10,10),Object.keys(a).forEach(t=>{const m=a[t][0],g=s(m);let f=m.stockExistente;const r=a[t].map(p=>(f+=(p.entradas||0)-(p.perdasEAjustes||0)-(p.saidas||0),[C.getFormatDDMMYYYY(p.diaDoEvento),p.entradas,p.perdasEAjustes,p.saidas,f,p.notas]));K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:20},2:{cellWidth:15},3:{cellWidth:18}},headStyles:{halign:"center",valign:"middle",fontSize:6},head:g,body:r,startY:l.lastAutoTable.finalY+3})}),Gt.value&&!tl.value)window.open(l.output("bloburl"));else{const t=l.output();Fd(_o,"pdf",t)}},async downloadExcel(e){const l=de.currClinic();let n=[],o={},i={};if(Gt.value){const x=await C.printReportOther("balanceteReport",e);if(x.status===204||!x.data.length)return 204;n=x.data,x.data,o=n[0],i.startDateParam=C.getFormatDDMMYYYY(o.startDate),i.endDateParam=C.getFormatDDMMYYYY(o.endDate)}const a=new xe.exports.Workbook;a.creator="CSAUDE",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet("Balancete"),d=a.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("B11"),r=s.getCell("E11"),p=s.getCell("E12"),v=s.getCell("F11"),b=s.getCell("F12");t.alignment=m.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},m.border=g.border=f.border=r.border=v.border=p.border=b.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value="Rep\xFAblica de Mo\xE7ambique",m.value="Balancete",f.value=l==null?void 0:l.clinicName,v.value=i.startDateParam,b.value=i.endDateParam,g.value="Unidade Sanit\xE1ria",r.value="Data In\xEDcio",p.value="Data Fim",s.mergeCells("A1:A7"),s.mergeCells("A9:F10"),s.mergeCells("B11:D11"),s.mergeCells("A12:D12"),s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}});const D=n.reduce((x,R)=>(x[R.medicamento]||(x[R.medicamento]=[]),x[R.medicamento].push(R),x),{});Object.keys(D).forEach(x=>{const R=D[x][0];s.addRow(["FNM","Medicamento","Unidade","Validade Medicamento"]);const _=s.lastRow;_==null||_.eachCell(I=>{I.fill={type:"pattern",pattern:"solid",fgColor:{argb:"D3D3D3"}},I.font={bold:!0}});const N=[R.fnm,R.medicamento,R.unidade,C.getFormatDDMMYYYY(R.validadeMedicamento)];s.addRow(N),s.addRow(["Data de Movimento","Entradas","Perdas e Ajustes","Saidas","Stock Existente","Notas"]);const O=s.lastRow;O==null||O.eachCell(I=>{I.fill={type:"pattern",pattern:"solid",fgColor:{argb:"D3D3D3"}},I.font={bold:!0}});let T=R.stockExistente;D[x].map(I=>(T+=(I.entradas||0)-(I.perdasEAjustes||0)-(I.saidas||0),[C.getFormatDDMMYYYY(I.diaDoEvento),I.entradas,I.perdasEAjustes,I.saidas,T,I.notas])).forEach(I=>s.addRow(I)),s.addRow([])}),s.getColumn(1).width=20,s.getColumn(2).width=20,s.getColumn(3).width=20,s.getColumn(4).width=20,s.getColumn(5).width=20,s.getColumn(6).width=20;const u=await a.xlsx.writeBuffer(),c="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",h=".xlsx",y=new Blob([u],{type:c});if(Gt.value&&!tl.value)_e.exports.saveAs(y,_o+h);else{let x=function(I,X){const $=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL($,function(w){R(w,I,X)},N)},R=function(I,X,$){I.getFile(X,{create:!0,exclusive:!1},function(w){_(w,$)},O)},_=function(I,X){I.createWriter(function($){$.onwriteend=function(){console.log("Successful file write..."),T()},$.onerror=function(w){console.log("Failed file write: "+w)},$.write(X)})},N=function(I){console.log(I)},O=function(I){console.log("errorr: "+I.toString())},T=function(){const I=q;console.log("file system 44444: "+I);const X=cordova.file.externalRootDirectory+"Download/"+I;console.log("file system 2222: "+X);const $=decodeURIComponent(X);cordova.plugins.fileOpener2.open($,"application/vnd.ms-excel",{error:function(w){console.log("file system open3333366: "+w+$)},success:function(){}})};const q="Balancete.xlsx";x(q,y)}}};function Fd(e,l,n){let o=l==="pdf"?".pdf":".xlsx";const i=new Blob([n],{type:l==="pdf"?"application/pdf":"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});_e.exports.saveAs(i,e.concat(o))}const Ed={class:"param-container"},Md="balancete",Yd="BALANCETE",Nd={__name:"Balancete",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(null),i=S(!1),a=S(0),s=S(0),d=S(""),t=S(!1),m=S(!1),g={id:2,description:"Mensal",code:"MONTH"},f=S(!1);S({type:"",visible:!1,msg:""});const r=S(0),p=c=>{if(d.value.remove(),c){const h=c.id;f.value=!0,ee.remove(h)}},v=(c,h)=>{h.value||ee.set(c.id,c)},b=async c=>{r.value=.001,l.value&&(v(c,f),C.apiInitBalanceteProcessing(c).then(h=>{D(c)}))},D=c=>{C.getProcessingStatus("balanceteReport",c).then(h=>{h.data.progress>.001?(r.value=h.data.progress,r.value<100?(v(c,f),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(r.value=100,c.progress=100,v(c,f))):(r.value=100,c.progress=100,v(c,f))})},u=(c,h)=>{h==="PDF"?ol.downloadPDF(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1}):ol.downloadExcel(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",o),E("resultFromLocalStorage",i),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterBalanceteSection",ref:d},[i.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(o.value!==null?o.value.code:"")+": Balancete ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Balancete ",1)]),_:1})),ie("div",Ed,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:a.value,qtyProcessed:s.value,reportType:Yd,progress:r.value,tabName:Md,params:e.params,typeService:e.selectedService,clinicalService:e.selectedService,applicablePeriods:g,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","totalRecords","qtyProcessed","progress","params","typeService","clinicalService"])]),_:1})]),_:1})])],512))}};var Td=Fe(Nd,[["__scopeId","data-v-c6f30b52"]]);const{isOnline:nl}=ce(),Id=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,al="Lista de Pacientes Referidos para outra Farm\xE1cia",Cn="ReferredPatients",ll=Cn.concat("_"+P(new Date).format("DD-MM-YYYY"));var qt={async downloadPDF(e,l,n){const o=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),i=new Image;i.src="data:image/png;base64,"+le;const a=o.internal.pageSize.getWidth();o.setProperties({title:ll.concat(".pdf")});let s=[];const d=de.getById(n.clinicId),t=["NID","Nome","Idade","Data da Ultima da Prescri\xE7\xE3o","Regime Terapeutico","Tipo Dispensa","Data Prox. Levant.","Data de Refer\xEAncia","Farmacia da Refer\xEAncia"];let m=[];if(nl.value){if(s=await C.printReport("referredPatientsReport",e,l),s.status===204)return s.status;const g=s.data[0];n.startDateParam=C.getFormatDDMMYYYY(g.startDate),n.endDateParam=C.getFormatDDMMYYYY(g.endDate),m=this.createArrayOfArrayRow(s.data)}K(o,{margin:{top:60},bodyStyles:{halign:"center"},headStyles:{halign:"center",valign:"middle"},didDrawPage:function(g){o.setFontSize(10),o.setTextColor(40),o.addImage(i,"PNG",g.settings.margin.left+15,5,25,25),o.text("REP\xDABLICA DE MO\xC7AMBIQUE",g.settings.margin.left+2,35),o.text("MINIST\xC9RIO DA SA\xDADE",g.settings.margin.left+7,40),o.text("SERVI\xC7O NACIONAL DE SA\xDADE",g.settings.margin.left,45),o.setFontSize(16),o.text(al,a/2,40,{align:"center"}),o.setFontSize(10),o.text("Unidade Sanitaria: "+(d==null?void 0:d.clinicName),a/15,57),o.text("Periodo: "+n.startDateParam+" \xE0 "+n.endDateParam,a/2+90,57)},theme:"grid",head:[t],body:m}),window.open(o.output("bloburl"))},async downloadExcel(e,l,n){let o=[];de.getById(n.clinicId);let i=[];if(nl.value){if(o=await C.printReport("referredPatientsReport",e,l),o.status===204)return o.status;const Q=o.data[0];n.startDateParam=C.getFormatDDMMYYYY(Q.startDate),n.endDateParam=C.getFormatDDMMYYYY(Q.endDate),i=this.createArrayOfArrayRow(o.data)}const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(Cn),d=a.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("D12"),p=s.getCell("G11"),v=s.getCell("G12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("E12"),c=s.getCell("H11"),h=s.getCell("H12"),y=s.getRow(14),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H"),X=s.getColumn("I");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=Id,m.value=al,b.value=n.clinic!==null?n.clinic.clinicName:"",c.value=P(n.startDateParam,"DD-MM-YYYY").format("DD-MM-YYYY"),h.value=P(n.endDateParam,"DD-MM-YYYY").format("DD-MM-YYYY"),g.value="Farm\xE1cia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A1:A7"),s.mergeCells("A9:H10"),s.mergeCells("B11:F11"),s.mergeCells("B12:C12"),s.mergeCells("E12:F12"),s.mergeCells("A13:H13"),y.height=30,x.width=30,R.width=30,_.width=10,N.width=15,O.width=25,T.width=25,q.width=15,I.width=15,X.width=25,m.font=f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Cn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data da Ultima da Prescri\xE7\xE3o",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terapeutico",totalsRowFunction:"none",filterButton:!1},{name:"Tipo Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"Data Prox. Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data de Refer\xEAncia",totalsRowFunction:"none",filterButton:!1},{name:"Farmacia da Refer\xEAncia.",totalsRowFunction:"none",filterButton:!1}],rows:i});const w=s.lastRow.number!==void 0?s.lastRow.number:0;for(let Q=14;Q<=w;Q++)s.getRow(Q).eachCell({includeEmpty:!0},L=>{L.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},L.alignment={vertical:"middle",horizontal:"center",wrapText:!0},Q==14&&(L.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},L.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const V=await a.xlsx.writeBuffer(),G="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",U=".xlsx",z=new Blob([V],{type:G});_e.exports.saveAs(z,ll+U)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(e[n].age),o.push(this.getFormatDDMMYYYY(e[n].lastPrescriptionDate)),o.push(e[n].therapeuticalRegimen),o.push(e[n].dispenseType),o.push(this.getFormatDDMMYYYY(e[n].nextPickUpDate)),o.push(this.getFormatDDMMYYYY(e[n].referrenceDate)),o.push(e[n].referralPharmacy),l.push(o)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const{idadeCalculator:Bd,getDDMMYYYFromJSDate:Od}=yo();var Do={saveReferredPatientsOnNano(e,l,n){var o,i,a,s,d;for(const t of e){const m=new No;m.reportId=l.id,m.year=l.year,m.startDate=l.startDate,m.endDate=l.endDate,m.province=n.province.description,m.id=He(),m.nid=t.nid,m.name=t.firstNames+" "+t.middleNames+" "+t.lastNames,m.age=Bd(new Date(Od(new Date(t.dateOfBirth)))),m.referrenceDate=t.referenceDate,m.nextPickUpDate=t.nextPickUpDate;const g=mn.getPrescriptionByID(t.prescriptionId),f=Vi.getById((o=g==null?void 0:g.prescriptionDetails[0])==null?void 0:o.therapeutic_regimen_id),r=mr.getById((i=g==null?void 0:g.prescriptionDetails[0])==null?void 0:i.therapeutic_line_id),p=zi.getById((a=g==null?void 0:g.prescriptionDetails[0])==null?void 0:a.dispense_type_id);f!==null&&(m.therapeuticRegimen=f.code),r!==null&&(m.therapeuticLine=r.code),p!==null&&(m.dispenseType=p.code),m.referralPharmacy=(s=t.referralClinic)==null?void 0:s.clinicName,m.lastPrescriptionDate=(d=mn.getLastPrescriptionFromPatientVisitDetails(t.prescriptionId))==null?void 0:d.prescriptionDate,m.notes=t.notes,this.localDbAddOrUpdate(m)}},localDbAddOrUpdate(e){return et.nSQL(No.entity).query("upsert",JSON.parse(JSON.stringify(e))).exec()},getDataLocalReport(e){return et.nSQL(No.entity).query("select").where(["reportId","=",e]).exec().then(l=>l)},idadeCalculator(e){if(P(e,"YYYY/MM/DDDD").isValid()){const l=P(e,"YYYY/MM/DDDD");return P(new Date).diff(l,"years")}}};const Ld={class:"param-container"},kd="ReferredPatients",Vd="REFERIDO_PARA",zd={__name:"ReferredPatients",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=e,i=S(0),a=S(0),s=S(0),d=S(""),t=S(!1),m=S(!1);Me(()=>{o.params&&D(o.params)});const g=S(null),f=S(!1);Me(()=>{o.params&&D(o.params)});const r=S(!1),p=(c,h)=>{h.value||ee.set(c.id,c)},v=c=>{if(d.value.remove(),c){const h=c.id;r.value=!0,ee.remove(h)}},b=c=>{if(s.value=.001,l.value)p(c,r),C.apiInitReferredPatientsProcessing(c).then(h=>{s.value=h.data.progress,setTimeout(()=>{D(c)},3e3)});else{p(c,r);const h=Ve.determineStartEndDate(c);C.referredPatientsMobileOffline(h.startDate,h.endDate,h.clinicId).then(y=>{const x=de.getById(h.clinicId);Do.saveReferredPatientsOnNano(y,h,x),s.value=100,c.progress=100})}},D=c=>{C.getProcessingStatus("referredPatientsReport",c).then(h=>{h.data.progress>.001?(s.value=h.data.progress,s.value<100?(p(c,r),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(s.value=100,c.progress=100,p(c,r))):setTimeout(()=>{D(c)},3e3)})},u=async(c,h,y)=>{l.value?h==="PDF"?(t.value=!0,qt.downloadPDF(c,h,y).then(x=>{x===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1})):(m.value=!0,qt.downloadExcel(c,h,y).then(x=>{x===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1})):Do.getDataLocalReport(c).then(x=>{x<=0?n("N\xE3o existem Dados para o per\xEDodo selecionado"):h==="PDF"?(qt.downloadPDF(x,y),t.value=!1):(qt.downloadExcel(x,y),m.value=!1)})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",g),E("resultFromLocalStorage",f),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:d},[f.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(g.value!==null?g.value.code:"")+": Referidos Para Outras Farmacias ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Referidos Para Outras Farmacias ",1)]),_:1})),ie("div",Ld,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:i.value,qtyProcessed:a.value,progress:s.value,reportType:Vd,tabName:kd,params:e.params,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var _d=Fe(zd,[["__scopeId","data-v-473b8d9d"]]);const{isOnline:il}=ce(),Ud=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,sl=`Relat\xF3rio de Pacientes Referenciados que 
 Regressaram \xE0 Unidade Sanit\xE1ria`,xn="ReferredBackPatients",rl=xn.concat("_"+new Date);var Wt={async downloadPDF(e,l){const n=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),o=new Image;o.src="data:image/png;base64,"+le;const i=n.internal.pageSize.getWidth();n.setProperties({title:rl.concat(".pdf")});let a=[];const s=de.getById(l.clinicId),d=["NID","Nome","Idade","Data de Refer\xEAncia","Data do \xDAltimo Levantamento","Farmacia da Refer\xEAncia","Data de Retorno a US","Notas"];let t=[];if(il.value){if(a=await C.printReportOther("referredPatientsReport",l.id),a.status===204)return a.status;const m=a.data[0];l.startDateParam=C.getFormatDDMMYYYY(m.startDate),l.endDateParam=C.getFormatDDMMYYYY(m.endDate),t=this.createArrayOfArrayRow(a.data)}else a=e,t=this.createArrayOfArrayRow(a);K(n,{margin:{top:60},bodyStyles:{halign:"center"},headStyles:{halign:"center",valign:"middle"},didDrawPage:function(m){n.setFontSize(10),n.setTextColor(40),n.addImage(o,"PNG",m.settings.margin.left+15,5,25,25),n.text("REP\xDABLICA DE MO\xC7AMBIQUE",m.settings.margin.left+2,35),n.text("MINIST\xC9RIO DA SA\xDADE",m.settings.margin.left+7,40),n.text("SERVI\xC7O NACIONAL DE SA\xDADE",m.settings.margin.left,45),n.setFontSize(16),n.text(sl,i/2,40,{align:"center"}),n.setFontSize(10),n.text("Unidade Sanitaria: "+s.clinicName,i/15,57),n.text("Periodo: "+l.startDateParam+" \xE0 "+l.endDateParam,i/2+90,57)},theme:"grid",head:[d],body:t}),window.open(n.output("bloburl"))},async downloadExcel(e,l){let n=[];de.getById(l.clinicId);let o=[];if(il.value){if(n=await C.printReportOther("referredPatientsReport",l.id),n.status===204)return n.status;const U=n.data[0];l.startDateParam=C.getFormatDDMMYYYY(U.startDate),l.endDateParam=C.getFormatDDMMYYYY(U.endDate),o=this.createArrayOfArrayRow(n.data)}else n=e,o=this.createArrayOfArrayRow(n);const i=new xe.exports.Workbook;i.creator="FGH",i.lastModifiedBy="FGH",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addWorksheet(xn),s=i.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),d=a.getCell("A8"),t=a.getCell("A9"),m=a.getCell("A11"),g=a.getCell("A12"),f=a.getCell("D12"),r=a.getCell("G11"),p=a.getCell("G12"),v=a.getCell("B11"),b=a.getCell("B12"),D=a.getCell("E12"),u=a.getCell("H11"),c=a.getCell("H12"),h=a.getRow(14),y=a.getColumn("A"),x=a.getColumn("B"),R=a.getColumn("C"),_=a.getColumn("D"),N=a.getColumn("E"),O=a.getColumn("F"),T=a.getColumn("G"),q=a.getColumn("H");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=Ud,t.value=sl,v.value=l.clinic!==null?l.clinic.clinicName:"",u.value=P(l.startDateParam,"DD-MM-YYYY").format("DD/MM/YYYY"),c.value=P(l.endDateParam,"DD-MM-YYYY").format("DD/MM/YYYY"),m.value="Farm\xE1cia",p.value="Data Fim",a.mergeCells("A1:A7"),a.mergeCells("A9:H10"),a.mergeCells("B11:F11"),a.mergeCells("B12:C12"),a.mergeCells("E12:F12"),a.mergeCells("A13:H13"),h.height=30,y.width=30,x.width=30,R.width=10,_.width=15,N.width=25,O.width=25,T.width=15,q.width=25,t.font=g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},a.addImage(s,{tl:{col:0,row:1},ext:{width:144,height:98}}),a.addTable({name:xn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data de Refer\xEAncia",totalsRowFunction:"none",filterButton:!1},{name:"Data do \xDAltimo Levantamento",totalsRowFunction:"none",filterButton:!1},{name:"Farmacia da Refer\xEAncia",totalsRowFunction:"none",filterButton:!1},{name:"Data de Retorno a US",totalsRowFunction:"none",filterButton:!1},{name:"Notas",totalsRowFunction:"none",filterButton:!1}],rows:o});const X=a.lastRow.number!==void 0?a.lastRow.number:0;for(let U=14;U<=X;U++)a.getRow(U).eachCell({includeEmpty:!0},Q=>{Q.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Q.alignment={vertical:"middle",horizontal:"center",wrapText:!0},U==14&&(Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const $=await i.xlsx.writeBuffer(),w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=".xlsx",G=new Blob([$],{type:w});_e.exports.saveAs(G,rl+V)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(e[n].age),o.push(this.getFormatDDMMYYYY(e[n].referrenceDate)),o.push(this.getFormatDDMMYYYY(e[n].lastPickUpDate)),o.push(e[n].referralPharmacy),o.push(this.getFormatDDMMYYYY(e[n].dateBackUs)),o.push(e[n].notes),l.push(o)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const $d={class:"param-container"},Hd="ReferredBackPatients",Gd="VOLTOU_REFERENCIA",qd={__name:"ReferredBackPatients",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=e,i=S(0),a=S(0),s=S(0),d=S(""),t=S(null),m=S(!1),g=S(!1),f=S(!1);Me(()=>{o.params&&D(o.params)});const r=S(!1),p=(c,h)=>{h.value||ee.set(c.id,c)},v=c=>{if(d.value.remove(),c){const h=c.id;r.value=!0,ee.remove(h)}},b=c=>{if(s.value=.001,l.value)p(c,r),C.apiInitReportProcess("referredPatientsReport",c).then(h=>{s.value=h.data.progress,setTimeout(()=>{D(c)},3e3)});else{p(c,r);const h=Ve.determineStartEndDate(c);C.referredBackPatientsMobileOffline(h.startDate,h.endDate,h.clinicId).then(y=>{const x=de.getById(h.clinicId);Do.saveReferredPatientsOnNano(y,h,x),s.value=100,c.progress=100})}},D=c=>{C.getProcessingStatus("referredPatientsReport",c).then(h=>{h.data.progress>.001?(s.value=h.data.progress,s.value<100?(p(c,r),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(s.value=100,c.progress=100,p(c,r))):setTimeout(()=>{D(c)},3e3)})},u=(c,h,y)=>{l.value?h==="PDF"?Wt.downloadPDF(null,y).then(x=>{x===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1}):Wt.downloadExcel(null,y).then(x=>{x===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1}):Do.getDataLocalReport(c).then(x=>{x<=0?n("N\xE3o existem Dados para o per\xEDodo selecionado"):h==="PDF"?(m.value=!0,Wt.downloadPDF(x,y),m.value=!1):(g.value=!0,Wt.downloadExcel(x,y),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",t),E("resultFromLocalStorage",f),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:d},[f.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(t.value!==null?t.value.code:"")+": Voltaram da Referencia ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Voltaram da Referencia ",1)]),_:1})),ie("div",$d,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:i.value,qtyProcessed:a.value,reportType:Gd,progress:s.value,tabName:Hd,params:e.params,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var Wd=Fe(qd,[["__scopeId","data-v-14eacd6a"]]);const Qd=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,jd=`HIST\xD3RICO DE LEVANTAMENTOS PARA 
 PACIENTES REFERIDOS`,Pn="HistoricoDeLevanPaciRefere",cl=Pn.concat("_"+P(new Date).format("DD-MM-YYYY"));var dl={async downloadPDF(e){const l=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});l.setProperties({title:cl.concat(".pdf")});const n=await C.printReportOther("referredPatientsReport",e.id);if(n.status===204)return n.status;const o=n.data[0],i=pr.getDistrictById(o.districtId),a=i==null?void 0:i.province;e.startDateParam=C.getFormatDDMMYYYY(o.startDate),e.endDateParam=C.getFormatDDMMYYYY(o.endDate);const s=this.createArrayOfArrayRow(n.data),d=new Image;d.src="data:image/png;base64,"+le,l.internal.pageSize.getWidth();const t=[[{content:`HIST\xD3RICO DE LEVANTAMENTOS PARA 
PACIENTES REFERIDOS`,styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+e.clinic.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+e.startDateParam+" \xE0 "+e.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(i==null?void 0:i.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+a.description,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+e.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(l,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),l.setFontSize(8),l.text("Rep\xFAblica de Mo\xE7ambique ",16,28),l.text("Minist\xE9rio da Sa\xFAde ",20,32),l.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),l.addImage(d,"png",28,15,10,10);const m=["ORD","NID","Nome","Tipo TARV","Regime Terapeutico","Tipo De Dispensa","Data Levant.","Data Prox. Levant.","Farmacia"];K(l,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},didDrawPage:function(g){const f="P\xE1gina "+l.internal.getNumberOfPages();l.setFontSize(8);const r=l.internal.pageSize,p=r.height?r.height:r.getHeight();l.text(f,g.settings.margin.right,p-10)},startY:l.lastAutoTable.finalY,theme:"grid",head:[m],body:s}),window.open(l.output("bloburl"))},async downloadExcel(e){const l=await C.printReportOther("referredPatientsReport",e.id);if(l.status===204)return l.status;const n=l.data[0];e.startDateParam=C.getFormatDDMMYYYY(n.startDate),e.endDateParam=C.getFormatDDMMYYYY(n.endDate);const o=this.createArrayOfArrayRow(l.data),i=new xe.exports.Workbook;i.creator="FGH",i.lastModifiedBy="FGH",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),s=i.addWorksheet(Pn),d=s.getCell("A8"),t=s.getCell("A9"),m=s.getCell("A11"),g=s.getCell("A12"),f=s.getCell("D12"),r=s.getCell("G11"),p=s.getCell("G12"),v=s.getCell("B11"),b=s.getCell("B12"),D=s.getCell("E12"),u=s.getCell("H11"),c=s.getCell("H12"),h=s.getRow(14),y=s.getColumn("A"),x=s.getColumn("B"),R=s.getColumn("C"),_=s.getColumn("D"),N=s.getColumn("E"),O=s.getColumn("F"),T=s.getColumn("G"),q=s.getColumn("H"),I=s.getColumn("I");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=Qd,t.value=jd,v.value=e.clinic!==null?e.clinic.clinicName:"",D.value=e.province!==null?e.province.description:"",b.value=e.district!==null?e.district.description:"",u.value=P(e.startDateParam,"DD-MM-YYYY").format("DD/MM/YYYY"),c.value=P(e.endDateParam,"DD-MM-YYYY").format("DD/MM/YYYY"),m.value="Farm\xE1cia",g.value="Distrito",f.value="Prov\xEDncia",r.value="Data In\xEDcio",p.value="Data Fim",s.mergeCells("A1:A7"),s.mergeCells("A9:H10"),s.mergeCells("B11:F11"),s.mergeCells("B12:C12"),s.mergeCells("E12:F12"),s.mergeCells("A13:H13"),h.height=30,y.width=10,x.width=30,R.width=25,_.width=25,N.width=20,O.width=20,T.width=20,q.width=20,I.width=20,t.font=g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(a,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Pn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Ord",totalsRowLabel:"Totals:",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Tipo TARV",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terapeutico",totalsRowFunction:"none",filterButton:!1},{name:"Tipo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"Data Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data Prox. Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Farmacia",totalsRowFunction:"none",filterButton:!1}],rows:o});const $=s.lastRow.number!==void 0?s.lastRow.number:0;for(let z=14;z<=$;z++)s.getRow(z).eachCell({includeEmpty:!0},Z=>{Z.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Z.alignment={vertical:"middle",horizontal:"center",wrapText:!0},z==14&&(Z.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Z.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const w=await i.xlsx.writeBuffer(),V="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",G=".xlsx",U=new Blob([w],{type:V});_e.exports.saveAs(U,cl+G)},createArrayOfArrayRow(e){const l=[];let n=0;for(const o in e){const i=[];i.push(++n),i.push(e[o].nid),i.push(e[o].name),i.push(e[o].tarvType),i.push(e[o].therapeuticalRegimen),i.push(e[o].dispenseType),i.push(this.getFormatDDMMYYYY(e[o].pickUpDate)),i.push(this.getFormatDDMMYYYY(e[o].nextPickUpDate)),i.push(e[o].referralPharmacy),l.push(i)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const Xd={class:"param-container"},Jd="ReferredPatientDispenseHistory",Kd="HISTORICO_LEVANTAMENTO_PACIENTES_REFERIDOS",Zd={__name:"ReferredPatientDispenseHistory",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=S(!1),g=S(!1);Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,r(u,f),C.apiInitReportProcess("referredPatientsReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})},b=u=>{C.getProcessingStatus("referredPatientsReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?dl.downloadPDF(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1}):dl.downloadExcel(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Historico de Levantamento de Pacientes Referidos ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Historico de Levantamento de Pacientes Referidos ",1)]),_:1})),ie("div",Xd,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:Kd,progress:a.value,tabName:Jd,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var eu=Fe(Zd,[["__scopeId","data-v-2624672c"]]);const tu=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,ul=`Relat\xF3rio de Pacientes Referidos que Faltaram 
 ao Levantamento de ARVs`,An="AbsentReferredPatients",gl=An.concat("_"+P(new Date).format("DD-MM-YYYY"));var fl={async downloadPDF(e){const l=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),n=new Image;n.src="data:image/png;base64,"+le;const o=l.internal.pageSize.getWidth();l.setProperties({title:gl.concat(".pdf")});const i=["NID","Nome",`Data que Faltou Levantamento 
 de ARVs [0-59 dias faltoso] (d-m-a)`,`Data em que Identificou 
 o Abandono ao TARV [>59 dias faltoso] (d-m-a)`,"Data em que Regressou \xE0 Unidade Sanit\xE1ria","Farmacia da Refer\xEAncia","Contacto"],a=await C.printReportOther("referredPatientsReport",e.id);if(a.status===204)return a.status;const s=a.data[0];e.startDateParam=C.getFormatDDMMYYYY(s.startDate),e.endDateParam=C.getFormatDDMMYYYY(s.endDate);const d=this.createArrayOfArrayRow(a.data);K(l,{margin:{top:60},bodyStyles:{halign:"center"},headStyles:{halign:"center",valign:"middle"},didDrawPage:function(t){l.setFontSize(10),l.setTextColor(40),l.text("REP\xDABLICA DE MO\xC7AMBIQUE",t.settings.margin.left+2,35),l.text("MINIST\xC9RIO DA SA\xDADE",t.settings.margin.left+7,40),l.text("SERVI\xC7O NACIONAL DE SA\xDADE",t.settings.margin.left,45),l.setFontSize(16),l.text(ul,o/2,40,{align:"center"}),l.setFontSize(10),l.text("Unidade Sanitaria: "+e.clinic.clinicName,o/15,57),l.text("Periodo: "+e.startDateParam+" \xE0 "+e.endDateParam,o/2+90,57)},theme:"grid",head:[i],body:d}),window.open(l.output("bloburl"))},async downloadExcel(e){const l=await C.printReportOther("referredPatientsReport",e.id);if(l.status===204)return l.status;const n=l.data[0];e.startDateParam=C.getFormatDDMMYYYY(n.startDate),e.endDateParam=C.getFormatDDMMYYYY(n.endDate);const o=this.createArrayOfArrayRow(l.data),i=new xe.exports.Workbook;i.creator="FGH",i.lastModifiedBy="FGH",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addWorksheet(An),s=i.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),d=a.getCell("A8"),t=a.getCell("A9"),m=a.getCell("A11"),g=a.getCell("A12"),f=a.getCell("D12"),r=a.getCell("G11"),p=a.getCell("G12"),v=a.getCell("B11"),b=a.getCell("B12"),D=a.getCell("E12"),u=a.getCell("F11"),c=a.getCell("F12"),h=a.getRow(14),y=a.getColumn("A"),x=a.getColumn("B"),R=a.getColumn("C"),_=a.getColumn("D"),N=a.getColumn("E"),O=a.getColumn("F"),T=a.getColumn("G");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=tu,t.value=ul,v.value=e.clinic!==null?e.clinic.clinicName:"",D.value=e.province!==null?e.province.description:"",b.value=e.district!==null?e.district.description:"",u.value=e.startDateParam,c.value=e.endDateParam,m.value="Farm\xE1cia",g.value="Distrito",f.value="Prov\xEDncia",r.value="Data In\xEDcio",p.value="Data Fim",a.mergeCells("A1:A7"),a.mergeCells("A9:F10"),a.mergeCells("B11:D11"),a.mergeCells("B12:C12"),a.mergeCells("E12:F12"),a.mergeCells("A13:F13"),h.height=40,y.width=30,x.width=30,R.width=25,_.width=25,N.width=20,O.width=20,T.width=20,t.font=g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},a.addImage(s,{tl:{col:0,row:1},ext:{width:144,height:98}}),a.addTable({name:An,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Data que Faltou Levantamento de ARVs [0-59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Regressou \xE0 Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Farmacia da Refer\xEAncia",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1}],rows:o});const I=a.lastRow.number!==void 0?a.lastRow.number:0;for(let G=14;G<=I;G++)a.getRow(G).eachCell({includeEmpty:!0},z=>{z.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},z.alignment={vertical:"middle",horizontal:"center",wrapText:!0},G==14&&(z.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},z.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const X=await i.xlsx.writeBuffer(),$="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",w=".xlsx",V=new Blob([X],{type:$});_e.exports.saveAs(V,gl+w)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(this.getFormatDDMMYYYY(e[n].dateMissedPickUp)),o.push(e[n].dateIdentifiedAbandonment!==null?this.getFormatDDMMYYYY(e[n].dateIdentifiedAbandonment):""),o.push(e[n].dateBackUs!==null?this.getFormatDDMMYYYY(e[n].dateBackUs):""),o.push(e[n].referralPharmacy),o.push(e[n].contact),l.push(o)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const ou={class:"param-container"},nu="AbsentReferredPatients",au="REFERIDOS_FALTOSOS_AO_LEVANTAMENTO",lu={__name:"AbsentReferredPatients",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),{isOnline:n}=ce(),o=e,i=S(0),a=S(0),s=S(0),d=S(""),t=S(!1),m=S(!1),g=S(null),f=S(!1);Me(()=>{o.params&&D(o.params)});const r=S(!1),p=(c,h)=>{h.value||ee.set(c.id,c)},v=c=>{if(d.value.remove(),c){const h=c.id;r.value=!0,ee.remove(h)}},b=c=>{s.value=.001,n.value&&(p(c,r),C.apiInitReportProcess("referredPatientsReport",c).then(h=>{setTimeout(()=>{D(c)},3e3)}))},D=c=>{C.getProcessingStatus("referredPatientsReport",c).then(h=>{h.data.progress>.001?(s.value=h.data.progress,s.value<100?(p(c,r),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(s.value=100,c.progress=100,p(c,r))):setTimeout(()=>{D(c)},3e3)})},u=(c,h,y)=>{h==="PDF"?fl.downloadPDF(y).then(x=>{x===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1}):fl.downloadExcel(y).then(x=>{x===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",g),E("resultFromLocalStorage",f),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:d},[f.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(g.value!==null?g.value.code:"")+": Referidos Faltosos ao levantamento ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Referidos Faltosos ao levantamento ",1)]),_:1})),ie("div",ou,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:i.value,qtyProcessed:a.value,reportType:au,progress:s.value,tabName:nu,params:e.params,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var iu=Fe(lu,[["__scopeId","data-v-541daeb0"]]);const{isMobile:ml,isOnline:Qt}=ce(),su=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,ru="Lista de Stock Recebido",Fn="ListaDeStockRecebido",Uo=Fn.concat("_"+C.getFormatDDMMYYYY(new Date)),Ji=new Image;Ji.src="data:image/png;base64,"+le;var pl={async downloadPDF(e,l,n){const o=await Xe(Je),i=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});i.addFileToVFS("NotoSans-Regular.ttf",o.split(",")[1]),i.addFont("NotoSans-Regular.ttf","NotoSans","normal"),i.setFont("NotoSans"),i.internal.pageSize.getWidth(),i.setProperties({title:Uo.concat(".pdf")});const a=de.currClinic();let s=[];if(Qt.value){if(s=await C.printReportOther("stockReportTemp",e),s.status===204||s.length===0)return 204;const m=s.data[0];n.startDateParam=C.getFormatDDMMYYYY(m.startDate),n.endDateParam=C.getFormatDDMMYYYY(m.endDate),s=this.createArrayOfArrayRow(s.data)}else{if(s=await this.getDataLocalReport(e),s.length===0)return 204;const m=s[0];n.startDateParam=C.getFormatDDMMYYYY(m.startDate),n.endDateParam=C.getFormatDDMMYYYY(m.endDate)}const d=[[{content:"Lista de Stock Recebido",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold",font:"NotoSans"}],[{content:"Unidade Sanit\xE1ria: "+a.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?a.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?a.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(i,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:d}),i.setFontSize(8),i.text("Rep\xFAblica de Mo\xE7ambique ",16,28),i.text("Minist\xE9rio da Sa\xFAde ",20,32),i.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),i.addImage(Ji,"png",28,15,10,10);const t=["Ordem","Entrada","Medicamento","Lote","Data de Validade","Recebidos","Fornecedor"];if(K(i,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},didDrawPage:function(m){const g="P\xE1gina "+i.internal.getNumberOfPages();i.setFontSize(8);const f=i.internal.pageSize,r=f.height?f.height:f.getHeight();i.text(g,m.settings.margin.right,r-10)},startY:i.lastAutoTable.finalY,theme:"grid",head:[t],body:s}),Qt.value&&!ml.value)window.open(i.output("bloburl"));else{console.log(i);const m=i.output();console.log(m),this.downloadFile(Uo,".pdf",m)}},async downloadExcel(e,l,n){let o=[];if(Qt.value){const U=await C.printReportOther("stockReportTemp",e);if(U.status===204||U.data.length===0)return 204;const z=U.data[0];n.startDateParam=C.getFormatDDMMYYYY(z.startDate),n.endDateParam=C.getFormatDDMMYYYY(z.endDate),o=this.createArrayOfArrayRow(U.data)}else{const U=await this.getDataLocalReport(e);if(U===void 0||U.length===0)return 204;o=this.createArrayOfArrayRow(U),n.startDateParam=C.getFormatDDMMYYYY(o[0].startDate),n.endDateParam=C.getFormatDDMMYYYY(o[0].endDate)}const i=new xe.exports.Workbook;i.creator="FGH",i.lastModifiedBy="FGH",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addWorksheet(Fn),s=i.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),d=a.getCell("A8"),t=a.getCell("A9"),m=a.getCell("A11"),g=a.getCell("A12"),f=a.getCell("D12"),r=a.getCell("F11"),p=a.getCell("F12"),v=a.getCell("B11"),b=a.getCell("B12"),D=a.getCell("E12"),u=a.getCell("G11"),c=a.getCell("G12"),h=a.getRow(14),y=a.getColumn("A"),x=a.getColumn("B"),R=a.getColumn("C"),_=a.getColumn("D"),N=a.getColumn("E"),O=a.getColumn("F"),T=a.getColumn("G"),q=a.getColumn("H");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=su,t.value=ru,v.value=n.clinic!==null?n.clinic.clinicName:"",D.value=n.province!==null?n.province.description:"",b.value=n.district!==null?n.district.description:"",u.value=n.startDateParam,c.value=n.endDateParam,m.value="Farm\xE1cia",g.value="Distrito",f.value="Prov\xEDncia",r.value="Data In\xEDcio",p.value="Data Fim",a.mergeCells("A1:A7"),a.mergeCells("A9:G9"),a.mergeCells("B11:E11"),a.mergeCells("B12:C12"),a.mergeCells("A13:G13"),h.height=30,y.width=20,x.width=20,R.width=40,_.width=15,N.width=25,O.width=25,T.width=20,q.width=20,t.font=g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},a.addImage(s,{tl:{col:0,row:1},ext:{width:144,height:98}}),a.addTable({name:Fn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Ordem",filterButton:!1},{name:"Entrada",totalsRowFunction:"none",filterButton:!1},{name:"Medicamento",totalsRowFunction:"none",filterButton:!1},{name:"Lote",totalsRowFunction:"none",filterButton:!1},{name:"Validade",totalsRowFunction:"none",filterButton:!1},{name:"Recebidos",totalsRowFunction:"none",filterButton:!1},{name:"Fornecedor",totalsRowFunction:"none",filterButton:!1}],rows:o});const X=a.lastRow.number!==void 0?a.lastRow.number:0;for(let U=14;U<=X;U++){const z=a.getRow(U);z.height=30,z.eachCell({includeEmpty:!0},Q=>{Q.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Q.alignment={vertical:"middle",horizontal:"center",wrapText:!0},U===14&&(Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}const $=await i.xlsx.writeBuffer(),w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=".xlsx",G=new Blob([$],{type:w});if(Qt.value&&!ml.value)_e.exports.saveAs(G,Uo+V);else{let U=function(B,W){const oe=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(oe,function(Y){z(Y,B,W)},Z)},z=function(B,W,oe){B.getFile(W,{create:!0,exclusive:!1},function(Y){Q(Y,oe)},L)},Q=function(B,W){B.createWriter(function(oe){oe.onwriteend=function(){console.log("Successful file write..."),k()},oe.onerror=function(Y){console.log("Failed file write: "+Y)},oe.write(W)})},Z=function(B){console.log(B)},L=function(B){console.log("errorr: "+B.toString())},k=function(){const B=H;console.log("file system 44444: "+B);const W=cordova.file.externalRootDirectory+"Download/"+B;console.log("file system 2222: "+W);const oe=decodeURIComponent(W);cordova.plugins.fileOpener2.open(oe,"application/vnd.ms-excel",{error:function(Y){console.log("file system open3333366: "+Y+oe)},success:function(){}})};const H="StockRecebido.xlsx";console.log("result"+H),U(H,G)}},createArrayOfArrayRow(e){const l=[];let n=0;for(const o in e){const i=[];n=n+1,i.push(n),i.push(C.getFormatDDMMYYYY(e[o].dateReceived)),i.push(e[o].drugName),i.push(e[o].batchNumber),i.push(C.getFormatDDMMYYYY(e[o].expiryDate)),i.push(e[o].unitsReceived),i.push(e[o].manufacture),l.push(i)}return l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}},async getDataLocalReport(e){let l=[];const n=await Wi.localDbGetAllByReportId(e);return l=this.createArrayOfArrayRow(n),l}};const cu={class:"param-container"},du="ReceivedStock",uu={__name:"ReceivedStock",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=S(!1),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,l.value?(r(u,f),C.apiInitReportProcess("stockReportTemp",u).then(c=>{a.value=c.data.progress,setTimeout(()=>{b(u)},3e3)})):(r(u,f),Ve.determineStartEndDate(u),Wi.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("stockReportTemp",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?pl.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1}):c==="XLS"&&pl.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterReceivedStockSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Stock Recebido ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Stock Recebido ",1)]),_:1})),ie("div",cu,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,progress:a.value,totalRecords:o.value,qtyProcessed:i.value,reportType:u.report,clinicalService:e.selectedService,tabName:du,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","progress","totalRecords","qtyProcessed","reportType","clinicalService","params"])]),_:1})]),_:1})])],512))}};var gu=Fe(uu,[["__scopeId","data-v-2061e437"]]);const hl=Ct.entity,fu=_i(Ct);var En={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);let n=[],o=[],i=[],a=[],s=[],d=[];const t=await Ui.localDbGetAll();console.log(t);const m=t.filter(N=>N.entrance.dateReceived>=l.startDate&&N.entrance.dateReceived<=l.endDate&&N.drug.clinical_service_id===l.clinicalService);console.log(m),n=this.groupedMap(m,"drug_id"),console.log(n),d=Array.from(n.keys()),console.log(d);const f=(await $i.localDbGetAll()).filter(N=>N.inventory.startDate>=l.startDate&&N.inventory.endDate<=l.endDate&&d.includes(N.adjustedStock.drug.id));o=this.groupedMapChild(f,"adjustedStock.drug.id"),console.log(o);const r=await vt.localDbGetPacks(),p=[],v=r.filter(N=>N!==void 0&&N.pickupDate>=l.startDate&&N.pickupDate<=l.endDate);console.log(v),v.forEach(N=>{N.packagedDrugs.forEach(O=>{p.push(O)})}),console.log(p),s=this.groupedMapChildPack(p,"drug_id"),console.log(s);const b=await Qi.localDbGetAll(),D=[];let u=[];console.log(b),u=b.filter(N=>N.date>=l.startDate&&N.date<=l.endDate),console.log(u),u.forEach(N=>{N.adjustments.forEach(O=>{D.push(O)})}),i=this.groupedMapChildAdjustments(D,"adjustedStock"),console.log(i);const c=await ji.localDbGetAll(),h=[];let y=[];console.log(c),y=c.filter(N=>N.date>=l.startDate&&N.date<=l.endDate),console.log(y),y.forEach(N=>{N.adjustments.forEach(O=>{h.push(O)})}),a=this.groupedMapChildAdjustments(h,"adjustedStock"),console.log(a);const x=Array.from(n.keys()),R=Array.from(i.keys()),_=Array.from(a.keys());console.log(x),console.log(R),console.log(_);for(const N of x){const O=await wo.getCleanDrugById(N),T=new Ct;T.fnmCode=O.fnmCode,T.drugName=O.name,T.actualStock=0,console.log(n.get(O.id)),T.receivedStock=0,T.adjustment=0,n.get(O.id).forEach(I=>{T.receivedStock+=I.unitsReceived,T.actualStock+=I.unitsReceived,R.forEach(X=>{X===I.id&&i.get(X).forEach($=>{T.adjustment-=$.adjustedValue,T.actualStock-=$.adjustedValue})}),_.forEach(X=>{X===I.id&&a.get(X).forEach($=>{const w=Yt.getStockOperatinTypeById($.operation.id);w.code==="AJUSTE_POSETIVO"?(T.adjustment+=$.adjustedValue,T.actualStock+=$.adjustedValue):w.code==="AJUSTE_NEGATIVO"&&(T.adjustment-=$.adjustedValue,T.actualStock-=$.adjustedValue)})})});const q=o.get(O.id)===void 0?[]:o.get(O.id);for(const I of q)I.operation.code==="AJUSTE_POSETIVO"?(T.adjustment+=I.adjustedValue,T.actualStock+=I.adjustedValue):I.operation.code==="AJUSTE_NEGATIVO"&&(T.adjustment-=I.adjustedValue,T.actualStock-=I.adjustedValue);s.get(O.id)!==void 0&&s.get(O.id).forEach(I=>{T.stockIssued+=I.quantitySupplied,T.actualStock-=I.quantitySupplied}),console.log(T),T.reportId=l.id,T.year=l.year,T.endDate=l.endDate,T.id=He(),this.localDbAddOrUpdate(T)}},groupedMap(e,l){return e.reduce((n,o)=>n.set(o[l],[...n.get(o[l])||[],o],console.log(o[l])),new Map)},groupedMapChild(e,l){return e.reduce((n,o)=>n.set(o.adjustedStock.drug.id,[...n.get(o.adjustedStock.drug.id)||[],o],console.log(o.adjustedStock.drug.id)),new Map)},groupedMapChildPack(e,l){return e.reduce((n,o)=>n.set(o.drug.id,[...n.get(o.drug.id)||[],o],console.log(o.drug.id)),new Map)},groupedMapChildAdjustments(e,l){return e.reduce((n,o)=>n.set(o.adjustedStock.id,[...n.get(o.adjustedStock.id)||[],o],console.log(o.adjustedStock.id)),new Map)},getStockOperationTypeById(e){return console.log(xt.query().where("id",e).first()),xt.query().where("id",e).first()},getStockOperationToVue(){Yt.localDbGetAll().then(e=>{xt.insert({data:e})})},localDbAddOrUpdate(e){return We[hl].add(JSON.parse(JSON.stringify(e))).then(()=>{fu.save(e)}).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return await We[hl].where("reportId").equalsIgnoreCase(e).toArray()}};const{isOnline:jt,isMobile:vl}=ce(),mu=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,pu="Lista de Stock Usado",Mn="ListaDeStockUsado",$o=Mn.concat("_"+C.getFormatDDMMYYYY(new Date)),Ki=new Image;Ki.src="data:image/png;base64,"+le;var Dl={async downloadPDF(e,l,n){const o=await Xe(Je);console.log(n);const i=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});i.addFileToVFS("NotoSans-Regular.ttf",o.split(",")[1]),i.addFont("NotoSans-Regular.ttf","NotoSans","normal"),i.setFont("NotoSans"),i.internal.pageSize.getWidth(),i.setProperties({title:$o.concat(".pdf")});const a=de.getById(n.clinicId),s=[[{content:"Lista de Stock Usado",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+a.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?a.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?a.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(i,{bodyStyles:{halign:"left",valign:"middle",fontSize:8,font:"NotoSans"},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:s}),i.setFontSize(8),i.text("Rep\xFAblica de Mo\xE7ambique ",16,28),i.text("Minist\xE9rio da Sa\xFAde ",20,32),i.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),i.addImage(Ki,"png",28,15,10,10);const d=["Medicamento","FNM","Saldo","Recebidos","Sa\xEDdas","Ajustes","Stock Actual"];let t=[];if(jt.value){const m=await C.printReport("usedStockReportTemp",e,l);if(m.status===204||m.data.length===0)return 204;const g=m.data[0];n.startDateParam=C.getFormatDDMMYYYY(g.startDate),n.endDateParam=C.getFormatDDMMYYYY(g.endDate),t=this.createArrayOfArrayRow(m.data)}else{const m=await En.localDbGetAllByReportId(e);if(m.length===0)return 204;n.startDateParam=C.getFormatDDMMYYYY(m[0].startDate),n.endDateParam=C.getFormatDDMMYYYY(m[0].endDate),t=this.createArrayOfArrayRow(m)}if(K(i,{bodyStyles:{halign:"center",fontSize:8,font:"NotoSans"},headStyles:{halign:"center",valign:"middle",fontSize:8},didDrawPage:function(m){const g="P\xE1gina "+i.internal.getNumberOfPages();i.setFontSize(8);const f=i.internal.pageSize,r=f.height?f.height:f.getHeight();i.text(g,m.settings.margin.right,r-10)},startY:i.lastAutoTable.finalY,theme:"grid",head:[d],body:t}),jt.value&&!vl.value)window.open(i.output("bloburl"));else{const m=i.output();this.downloadFile($o,".pdf",m)}},async downloadExcel(e,l,n){const o=de.getById(n.clinicId);let i=[];if(jt.value){const z=await C.printReport("usedStockReportTemp",e,l);if(z.status===204||z.data.length===0)return 204;const Q=z.data[0];n.startDateParam=C.getFormatDDMMYYYY(Q.startDate),n.endDateParam=C.getFormatDDMMYYYY(Q.endDate),i=this.createArrayOfArrayRow(z.data)}else{const z=await En.localDbGetAllByReportId(e);if(z===void 0||z.length===0)return 204;i=this.createArrayOfArrayRow(z)}const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(Mn),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("D12"),p=s.getCell("F11"),v=s.getCell("F12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("E12"),c=s.getCell("G11"),h=s.getCell("G12"),y=s.getRow(14),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=mu,m.value=pu,b.value=n.clinic!==null?n.clinic.clinicName:o.clinicName,u.value=n.province!==null?n.province.description:o.province.description,D.value=n.district!==null?n.district.description:o.district.description,c.value=n.startDateParam,h.value=n.endDateParam,g.value="Farm\xE1cia",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A1:A7"),s.mergeCells("A9:G9"),s.mergeCells("B11:E11"),s.mergeCells("B12:C12"),s.mergeCells("A13:G13"),y.height=30,x.width=60,R.width=30,_.width=15,N.width=15,O.width=15,T.width=15,q.width=15,I.width=15,m.font=f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Mn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Medicamento",filterButton:!1},{name:"FNM",filterButton:!1},{name:"Saldo",totalsRowFunction:"none",filterButton:!1},{name:"Recebidos",totalsRowFunction:"none",filterButton:!1},{name:"Sa\xEDdas",totalsRowFunction:"none",filterButton:!1},{name:"Ajustes",totalsRowFunction:"none",filterButton:!1},{name:"Stock Actual",totalsRowFunction:"none",filterButton:!1}],rows:i});const $=s.lastRow.number!==void 0?s.lastRow.number:0;for(let z=14;z<=$;z++){const Q=s.getRow(z);Q.height=30,Q.eachCell({includeEmpty:!0},Z=>{Z.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Z.alignment={vertical:"middle",horizontal:"center",wrapText:!0},z===14&&(Z.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Z.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}const w=await a.xlsx.writeBuffer(),V="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",G=".xlsx",U=new Blob([w],{type:V});if(jt.value&&!vl.value)_e.exports.saveAs(U,$o+G);else{let z=function(W,oe){const Y=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(Y,function(he){Q(he,W,oe)},L)},Q=function(W,oe,Y){W.getFile(oe,{create:!0,exclusive:!1},function(he){Z(he,Y)},k)},Z=function(W,oe){W.createWriter(function(Y){Y.onwriteend=function(){H()},Y.onerror=function(he){console.log("Failed file write: "+he)},Y.write(oe)})},L=function(W){console.log(W)},k=function(W){console.log("errorr: "+W.toString())},H=function(){const W=B;console.log("file system 44444: "+W);const oe=cordova.file.externalRootDirectory+"Download/"+W;console.log("file system 2222: "+oe);const Y=decodeURIComponent(oe);cordova.plugins.fileOpener2.open(Y,"application/vnd.ms-excel",{error:function(he){console.log("file system open3333366: "+he+Y)},success:function(){}})};const B="STockUsado.xlsx";z(B,U)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].drugName),o.push(e[n].fnName),o.push(Number(e[n].actualStock)),o.push(e[n].receivedStock),o.push(e[n].stockIssued),o.push(e[n].adjustment),o.push(e[n].actualStock+Number(e[n].receivedStock)-Number(e[n].stockIssued)-Number(e[n].adjustment)),l.push(o)}return l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const hu={class:"param-container"},vu="UsedStock",Du="USED_STOCK",bu={__name:"UsedStock",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(""),i=S(0),a=S(0),s=S(!1),d=S(!1),t=S(0),m=S(!1),g=(u,c)=>{c.value||ee.set(u.id,u)},f=u=>{if(o.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},r=S(null),p=S(!1),v=u=>{t.value=.001,l.value?(g(u,m),C.apiInitReportProcess("usedStockReportTemp",u).then(c=>{t.value=c.data.progress,setTimeout(()=>{b(u)},3e3)})):(g(u,m),En.getDataLocalDb(u),t.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("usedStockReportTemp",u).then(c=>{c.data.progress>.001?(t.value=c.data.progress,t.value<100?(g(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(t.value=100,u.progress=100,g(u,m))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Dl.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),s.value=!1}):c==="XLS"&&Dl.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1})};return E("downloadingPdf",s),E("downloadingXls",d),E("serviceAux",r),E("resultFromLocalStorage",p),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterUsedStockSection",ref:o},[p.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(r.value!==null?r.value.code:"")+": Lista de Stock Usado ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Stock Usado ",1)]),_:1})),ie("div",hu,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{totalRecords:i.value,qtyProcessed:a.value,reportType:Du,tabName:vu,params:e.params,id:e.id,progress:t.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["totalRecords","qtyProcessed","params","id","progress","clinicalService"])]),_:1})]),_:1})])],512))}};var Su=Fe(bu,[["__scopeId","data-v-ca789540"]]),Yn={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);let n=[],o=[],i=[],a=[],s=[],d=[];const t=await Ui.localDbGetUsedStock(e);console.log(t);const m=t.filter(N=>N.entrance.dateReceived>=l.startDate&&N.entrance.dateReceived<=l.endDate);console.log(m),n=this.groupedMap(m,"drug_id"),console.log(n),d=Array.from(n.keys()),console.log(d);const f=(await $i.localDbGetAll()).filter(N=>N.inventory.startDate>=l.startDate&&N.inventory.endDate<=l.endDate&&d.includes(N.adjustedStock.drug.id));o=this.groupedMapChild(f,"adjustedStock.drug.id"),console.log(o);const r=await vt.localDbGetPacks(),p=[],v=r.filter(N=>N!==void 0&&N.pickupDate>=l.startDate&&N.pickupDate<=l.endDate);console.log(v),v.forEach(N=>{N.packagedDrugs.forEach(O=>{p.push(O)})}),console.log(p),s=this.groupedMapChildPack(p,"drug_id"),console.log(s);const b=await Qi.localDbGetAll(),D=[];let u=[];console.log(b),u=b.filter(N=>N.date>=l.startDate&&N.date<=l.endDate),console.log(u),u.forEach(N=>{N.adjustments.forEach(O=>{D.push(O)})}),i=this.groupedMapChildAdjustments(D,"adjustedStock"),console.log(i);const c=await ji.localDbGetAll(),h=[];let y=[];console.log(c),y=c.filter(N=>N.date>=l.startDate&&N.date<=l.endDate),console.log(y),y.forEach(N=>{N.adjustments.forEach(O=>{h.push(O)})}),a=this.groupedMapChildAdjustments(h,"adjustedStock"),console.log(a);const x=Array.from(n.keys()),R=Array.from(i.keys()),_=Array.from(a.keys());console.log(x),console.log(R),console.log(_);for(const N of x){const O=await wo.getCleanDrugById(N),T=new Ct;T.fnmCode=O.fnmCode,T.drugName=O.name,T.actualStock=0,console.log(n.get(O.id)),T.receivedStock=0,T.adjustment=0,n.get(O.id).forEach(I=>{T.receivedStock+=I.unitsReceived,T.actualStock+=I.unitsReceived,R.forEach(X=>{X===I.id&&i.get(X).forEach($=>{T.adjustment-=$.adjustedValue,T.actualStock-=$.adjustedValue})}),_.forEach(X=>{X===I.id&&a.get(X).forEach($=>{const w=Yt.getStockOperatinTypeById($.operation.id);w.code==="AJUSTE_POSETIVO"?(T.adjustment+=$.adjustedValue,T.actualStock+=$.adjustedValue):w.code==="AJUSTE_NEGATIVO"&&(T.adjustment-=$.adjustedValue,T.actualStock-=$.adjustedValue)})})});const q=o.get(O.id)===void 0?[]:o.get(O.id);for(const I of q)I.operation.code==="AJUSTE_POSETIVO"?(T.adjustment+=I.adjustedValue,T.actualStock+=I.adjustedValue):I.operation.code==="AJUSTE_NEGATIVO"&&(T.adjustment-=I.adjustedValue,T.actualStock-=I.adjustedValue);s.get(O.id)!==void 0&&s.get(O.id).forEach(I=>{T.stockIssued+=I.quantitySupplied,T.actualStock-=I.quantitySupplied}),console.log(T),T.reportId=l.id,T.year=l.year,T.endDate=l.endDate,this.localDbAddOrUpdate(T)}},groupedMap(e,l){return e.reduce((n,o)=>n.set(o[l],[...n.get(o[l])||[],o],console.log(o[l])),new Map)},groupedMapChild(e,l){return e.reduce((n,o)=>n.set(o.adjustedStock.drug.id,[...n.get(o.adjustedStock.drug.id)||[],o],console.log(o.adjustedStock.drug.id)),new Map)},groupedMapChildPack(e,l){return e.reduce((n,o)=>n.set(o.drug.id,[...n.get(o.drug.id)||[],o],console.log(o.drug.id)),new Map)},groupedMapChildAdjustments(e,l){return e.reduce((n,o)=>n.set(o.adjustedStock.id,[...n.get(o.adjustedStock.id)||[],o],console.log(o.adjustedStock.id)),new Map)},getStockOperationTypeById(e){return console.log(xt.query().where("id",e).first()),xt.query().where("id",e).first()},getStockOperationToVue(){Yt.localDbGetAll().then(e=>{xt.insert({data:e})})},localDbAddOrUpdate(e){return et.nSQL().onConnected(()=>{et.nSQL(Ct.entity).query("upsert",e).exec()})},async localDbGetAllByReportId(e){return et.nSQL(Ct.entity).query("select").where(["reportId","=",e]).exec().then(l=>l!==void 0?l:null)}};const{isOnline:Xt,isMobile:bl}=ce(),yu=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,wu="Medicamentos Remanescentes (Sobras/Perdas) das dispensas",Nn="MedicamentosRemanescentes",Ho=Nn.concat("_"+C.getFormatDDMMYYYY(new Date)),Zi=new Image;Zi.src="data:image/png;base64,"+le;var Sl={async downloadPDF(e,l,n){console.log(n);const o=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});o.internal.pageSize.getWidth(),o.setProperties({title:Ho.concat(".pdf")}),console.log(n);const i=de.getById(n.clinicId),a=[[{content:"Medicamentos Remanescentes (Sobras/Perdas) das dispensas",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?i.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?i.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(o,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:a}),o.setFontSize(8),o.text("Rep\xFAblica de Mo\xE7ambique ",16,28),o.text("Minist\xE9rio da Sa\xFAde ",20,32),o.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),o.addImage(Zi,"png",28,15,10,10);const s=["FNM","Medicamento","Unidade","Entrada","Sa\xEDdas","Saldo Existente","Sobras/Perdas","Observa\xE7\xE3o"];let d=[];if(Xt.value){const t=await C.printReport("usedStockReportTemp",e,l);if(t.status===204||t.data.length===0)return 204;const m=t.data[0];n.startDateParam=C.getFormatDDMMYYYY(m.startDate),n.endDateParam=C.getFormatDDMMYYYY(m.endDate),d=this.createArrayOfArrayRow(t.data)}else{const t=await Yn.localDbGetAllByReportId(e);if(t.length===0)return 204;n.startDateParam=C.getFormatDDMMYYYY(t[0].startDate),n.endDateParam=C.getFormatDDMMYYYY(t[0].endDate),d=this.createArrayOfArrayRow(t)}if(K(o,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},didDrawPage:function(t){const m="P\xE1gina "+o.internal.getNumberOfPages();o.setFontSize(8);const g=o.internal.pageSize,f=g.height?g.height:g.getHeight();o.text(m,t.settings.margin.right,f-10)},startY:o.lastAutoTable.finalY,theme:"grid",head:[s],body:d}),Xt.value&&!bl.value)window.open(o.output("bloburl"));else{const t=o.output();this.downloadFile(Ho,"pdf",t)}},async downloadExcel(e,l,n){const o=de.getById(n.clinicId);let i=[];if(Xt.value){const z=await C.printReport("usedStockReportTemp",e,l);if(z.status===204||z.data.length===0)return 204;const Q=z.data[0];n.startDateParam=C.getFormatDDMMYYYY(Q.startDate),n.endDateParam=C.getFormatDDMMYYYY(Q.endDate),i=this.createArrayOfArrayRow(z.data)}else{const z=await Yn.localDbGetAllByReportId(e);if(z===void 0||z.length===0)return 204;i=this.createArrayOfArrayRow(z)}const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(Nn),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("D12"),p=s.getCell("F11"),v=s.getCell("F12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("E12"),c=s.getCell("G11"),h=s.getCell("G12"),y=s.getRow(14),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=yu,m.value=wu,b.value=n.clinic!==null?n.clinic.clinicName:o.clinicName,u.value=n.province!==null?n.province.description:o.province.description,D.value=n.district!==null?n.district.description:o.district.description,c.value=n.startDateParam,h.value=n.endDateParam,g.value="Farm\xE1cia",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A1:A7"),s.mergeCells("A9:G9"),s.mergeCells("B11:E11"),s.mergeCells("B12:C12"),s.mergeCells("A13:G13"),y.height=30,x.width=60,R.width=30,_.width=15,N.width=15,O.width=15,T.width=15,q.width=15,I.width=15,m.font=f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Nn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"FNM",filterButton:!1},{name:"Medicamento",filterButton:!1},{name:"Unidade",filterButton:!1},{name:"Recebidos",totalsRowFunction:"none",filterButton:!1},{name:"Sa\xEDdas",totalsRowFunction:"none",filterButton:!1},{name:"Saldo Existente",totalsRowFunction:"none",filterButton:!1},{name:"Sobras/Perdas",totalsRowFunction:"none",filterButton:!1},{name:"Observa\xE7\xE3o",totalsRowFunction:"none",filterButton:!1}],rows:i});const $=s.lastRow.number!==void 0?s.lastRow.number:0;for(let z=14;z<=$;z++){const Q=s.getRow(z);Q.height=30,Q.eachCell({includeEmpty:!0},Z=>{Z.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Z.alignment={vertical:"middle",horizontal:"center",wrapText:!0},z===14&&(Z.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Z.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}const w=await a.xlsx.writeBuffer(),V="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",G=".xlsx",U=new Blob([w],{type:V});if(Xt.value&&!bl.value)_e.exports.saveAs(U,Ho+G);else{let z=function(W,oe){const Y=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(Y,function(he){Q(he,W,oe)},L)},Q=function(W,oe,Y){W.getFile(oe,{create:!0,exclusive:!1},function(he){Z(he,Y)},k)},Z=function(W,oe){W.createWriter(function(Y){Y.onwriteend=function(){H()},Y.onerror=function(he){console.log("Failed file write: "+he)},Y.write(oe)})},L=function(W){console.log(W)},k=function(W){console.log("errorr: "+W.toString())},H=function(){const W=B;console.log("file system 44444: "+W);const oe=cordova.file.externalRootDirectory+"Download/"+W;console.log("file system 2222: "+oe);const Y=decodeURIComponent(oe);cordova.plugins.fileOpener2.open(Y,"application/vnd.ms-excel",{error:function(he){console.log("file system open3333366: "+he+Y)},success:function(){}})};const B="STockUsado.xlsx";z(B,U)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].fnName),o.push(e[n].drugName),o.push(e[n].packSize),o.push(e[n].receivedStock),o.push(e[n].stockIssued),o.push(Number(e[n].balance)),o.push(e[n].quantityRemain),o.push(e[n].notes),l.push(o)}return l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Ru={class:"param-container"},Cu="QuantityRemain",xu="QUANTITY_REMAIN",Pu={__name:"QuantityRemain",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(""),i=S(0),a=S(0),s=S(!1),d=S(!1),t=S(0),m=S(!1),g=(u,c)=>{c.value||ee.set(u.id,u)},f=u=>{if(o.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},r=S(null),p=S(!1),v=u=>{t.value=.001,l.value?(g(u,m),C.apiInitReportProcess("usedStockReportTemp",u).then(c=>{t.value=c.data.progress,setTimeout(()=>{b(u)},3e3)})):(g(u,m),Yn.getDataLocalDb(u),t.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("usedStockReportTemp",u).then(c=>{c.data.progress>.001?(t.value=c.data.progress,t.value<100?(g(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(t.value=100,u.progress=100,g(u,m))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Sl.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),s.value=!1}):c==="XLS"&&Sl.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1})};return E("downloadingPdf",s),E("downloadingXls",d),E("serviceAux",r),E("resultFromLocalStorage",p),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterQuantityRemainSection",ref:o},[p.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(r.value!==null?r.value.code:"")+": Medicamentos Remanescentes (Sobras/Perdas) ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Medicamentos Remanescentes (Sobras/Perdas) ",1)]),_:1})),ie("div",Ru,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{totalRecords:i.value,qtyProcessed:a.value,reportType:xu,tabName:Cu,params:e.params,id:e.id,progress:t.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["totalRecords","qtyProcessed","params","id","progress","clinicalService"])]),_:1})]),_:1})])],512))}};var Au=Fe(Pu,[["__scopeId","data-v-083f6f66"]]);const yl=We[at.entity],Fu=_i(at);var es={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);const[n]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.patientvisitDetails.patientVisit.patient,a=o.patientvisitDetails.episode,s=o.patientvisitDetails.episode.patientServiceIdentifier,d=o.patientvisitDetails.prescription.prescriptionDetails,t=d.length>0?d[0].therapeuticLine:"",m=d.length>0?d[0].therapeuticRegimen:"",g=o.patientvisitDetails.prescription.patientType==="N/A"?o.patientvisitDetails.prescription.patientStatus:o.patientvisitDetails.prescription.patientType,f=d.length>0?d[0].dispenseType:"";if(s.service.id===l.clinicalService){const r=new at;r.reportId=l.id,r.year=l.year,r.startDate=l.startDate,r.endDate=l.endDate,r.nid=s.value,r.patientName=i.firstNames+" "+i.middleNames+" "+i.lastNames,r.patientType=g,r.startReason=a.startStopReason.reason;const p=this.idadeCalculator(i.dateOfBirth);r.ageGroup_0_4=p>=0&&p<4?"Sim":"Nao",r.ageGroup_5_9=p>=5&&p<=9?"Sim":"Nao",r.ageGroup_10_14=p>=10&&p<=14?"Sim":"Nao",r.ageGroup_Greater_than_15=p>=15?"Sim":"Nao",r.pickUpDate=o.pickupDate,r.nexPickUpDate=o.nextPickUpDate,r.regime=m.description,r.dispensationType=f.description,r.therapeuticLine=t.description,r.clinic=o.clinic.clinicName,r.prep=ut.localDbGetById(l.clinicalService).code==="PREP"?"Sim":"",r.ppe=ut.localDbGetById(l.clinicalService).code==="PPE"?"Sim":"";const v=[];for(const b of o.packagedDrugs){const D={};D.drugName=b.drug.name,D.quantity=b.quantitySupplied,console.log(D),v.push(D),console.log(r)}console.log(v),r.drugQuantityTemps=v,r.id=He(),this.localDbAddOrUpdate(r)}}},localDbAddOrUpdate(e){return yl.add(JSON.parse(JSON.stringify(e))).then(()=>{Fu.save(e)}).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return yl.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)},idadeCalculator(e){if(P(e,"YYYY/MM/DDDD").isValid()){const l=P(e,"YYYY/MM/DDDD"),o=P(new Date).diff(l,"years");return console.log(o),o}}};const ts=new Image;ts.src="data:image/png;base64,"+le;const{isOnline:Jt,isMobile:wl}=ce(),Eu=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Mu="LIVRO DE REGISTO DI\xC1RIO DE ARVs",Tn="ArvDailyListReport",Go=Tn.concat("_"+C.getFormatDDMMYYYY(new Date));var Rl={async downloadPDF(e,l,n){const o=await Xe(Je),i=de.currClinic();let a=[],s=[],d={};if(Jt.value){if(a=await C.printReport("arvDailyRegisterReportTemp",e,l),a.status===204||a.data.length===0)return 204;d=a.data[0],n.startDateParam=C.getFormatDDMMYYYY(d.startDate),n.endDateParam=C.getFormatDDMMYYYY(d.endDate);const f=Object.values(C.mapaDeAgrupamento(a.data));s=this.createArrayOfArrayRow(f)}else{if(a=await this.getDataLocalReport(e),a.length===0)return 204;d=a[0],n.startDateParam=C.getFormatDDMMYYYY(d.startDate),n.endDateParam=C.getFormatDDMMYYYY(d.endDate),s=this.createArrayOfArrayRow(a)}const t=new Ce({orientation:"l",unit:"mm",format:"a3",putOnlyUsedFonts:!0,floatPrecision:"smart"});t.addFileToVFS("NotoSans-Regular.ttf",o.split(",")[1]),t.addFont("NotoSans-Regular.ttf","NotoSans","normal"),t.setFont("NotoSans");const m=[[{content:"LIVRO DE REGISTO DI\xC1RIO DE ARVs",styles:{minCellHeight:20,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?i.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?i.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]],g=[[{content:"ORD",rowSpan:2},{content:"NID",rowSpan:2},{content:"NOME",rowSpan:2},{content:"Tipo de paciente",rowSpan:2},{content:"Faixa Et\xE1ria",colSpan:4},{content:"Tipo TARV",rowSpan:2},{content:"Regime",rowSpan:2},{content:"Produtos e Quantidades",rowSpan:2,styles:{cellWidth:50}},{content:"Tipo de Dispensa",rowSpan:2},{content:"Linha",rowSpan:2},{content:"Data de Levant.",rowSpan:2},{content:"Data Proxi. Levant.",rowSpan:2},{content:"PROFILAXIA",colSpan:3}],[{content:"[0-4]"},{content:"[5-9]:"},{content:"[10-14]"},{content:"[>15]"},{content:"PPE"},{content:"PREP"},{content:"Cr. Exp."}]];if(K(t,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:m}),t.setFontSize(8),t.text("Rep\xFAblica de Mo\xE7ambique ",16,28),t.text("Minist\xE9rio da Sa\xFAde ",20,32),t.addImage(ts,"png",28,15,10,10),K(t,{bodyStyles:{font:"NotoSans",overflow:"linebreak",cellWidth:"wrap",valign:"middle",fontSize:6,overflowColumns:"linebreak"},headStyles:{valign:"bottom",halign:"center",fontSize:6,lineWidth:.5,lineColor:[230,230,230],fillColor:[255,255,255],textColor:[96,96,96]},didDrawPage:function(f){const r="P\xE1gina "+t.internal.getNumberOfPages();t.setFontSize(6);const p=t.internal.pageSize,v=p.height?p.height:p.getHeight();t.text(r,f.settings.margin.right,v-10)},theme:"grid",head:g,body:s}),Jt.value&&!wl.value)return t.save(Go.concat(".pdf"));{const f=t.output();this.downloadFile(Go,".pdf",f)}},async downloadExcel(e,l,n){const o=de.currClinic();let i=[],a=[],s={};if(Jt.value){if(i=await C.printReport("arvDailyRegisterReportTemp",e,l),i.status===204||i.data.length===0)return 204;s=i.data[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate);const ge=Object.values(C.mapaDeAgrupamento(i.data));a=this.createArrayOfArrayRow(ge)}else{if(i=await this.getDataLocalReport(e),s=i[0],i.length===0)return 204;n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),a=this.createArrayOfArrayRow(i)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Tn),m=d.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("F11"),D=t.getCell("F12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("G11"),x=t.getCell("G12"),R=t.getCell("E13"),_=t.getCell("P13"),N=t.getRow(14),O=t.getRow(13),T=t.getColumn("A"),q=t.getColumn("B"),I=t.getColumn("C"),X=t.getColumn("D"),$=t.getColumn("E"),w=t.getColumn("F"),V=t.getColumn("G"),G=t.getColumn("H"),U=t.getColumn("I"),z=t.getColumn("J"),Q=t.getColumn("K"),Z=t.getColumn("L"),L=t.getColumn("M"),k=t.getColumn("N"),H=t.getColumn("O"),B=t.getColumn("P"),W=t.getColumn("Q"),oe=t.getColumn("R"),Y=t.getColumn("S");_.alignment=R.alignment=g.alignment=f.alignment=N.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},c.border=p.border=v.border=h.border=D.border=x.border={bottom:{style:"thin"}},_.border=R.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Eu,f.value=Mu,u.value=o.clinicName,h.value=o.province.description,c.value=o.district.description,y.value=n.startDateParam,x.value=n.endDateParam,r.value="Farm\xE1cia",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",R.value="Faixa Et\xE1ria",_.value="Profilaxia",t.mergeCells("A9:G9"),t.mergeCells("B11:E11"),t.mergeCells("B12:C12"),t.mergeCells("E13:G13"),t.mergeCells("P13:R13"),t.getCell("A13").fill=t.getCell("B13").fill=t.getCell("C13").fill=t.getCell("D13").fill=t.getCell("E13").fill=t.getCell("F13").fill=t.getCell("G13").fill=t.getCell("H13").fill=t.getCell("I13").fill=t.getCell("J13").fill=t.getCell("K13").fill=t.getCell("L13").fill=t.getCell("M13").fill=t.getCell("N13").fill=t.getCell("O13").fill=t.getCell("P13").fill=t.getCell("Q13").fill=t.getCell("R13").fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},R.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},_.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},N.height=30,O.height=30,T.width=10,q.width=30,I.width=30,X.width=20,$.width=10,w.width=10,V.width=10,G.width=10,U.width=15,z.width=25,Q.width=50,Z.width=15,L.width=15,k.width=15,H.width=15,B.width=15,W.width=10,oe.width=10,Y.width=10,f.font=p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Tn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",filterButton:!1},{name:"NID",filterButton:!1},{name:"NOME ",filterButton:!1},{name:"TIPO DE PACIENTE",totalsRowFunction:"none",filterButton:!1},{name:"[0 -4]",totalsRowFunction:"none",filterButton:!1},{name:"[5-9]",totalsRowFunction:"none",filterButton:!1},{name:"[10-14]",totalsRowFunction:"none",filterButton:!1},{name:"[>15]",totalsRowFunction:"none",filterButton:!1},{name:"TIPO TARV.",totalsRowFunction:"none",filterButton:!1},{name:"REGIME",totalsRowFunction:"none",filterButton:!1},{name:"PRODUTOS - (QUANTIDADES) ",totalsRowFunction:"none",filterButton:!1},{name:"TIPO DE DISPENSA",totalsRowFunction:"none",filterButton:!1},{name:"LINHA",totalsRowFunction:"none",filterButton:!1},{name:"DATA DE LEVANTAMENTO",totalsRowFunction:"none",filterButton:!1},{name:"DATA PROXIM. LEVANTAMENTO",totalsRowFunction:"none",filterButton:!1},{name:"PPE",totalsRowFunction:"none",filterButton:!1},{name:"PREP",totalsRowFunction:"none",filterButton:!1},{name:"CR. Exp",totalsRowFunction:"none",filterButton:!1}],rows:a});const Pe=t.lastRow.number!==void 0?t.lastRow.number:0;for(let ge=14;ge<=Pe;ge++){const De=t.getRow(ge);De.height=50,De.halign="left",De.wrapText=!0,De.eachCell({includeEmpty:!0},be=>{be.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},be.alignment={vertical:"middle",horizontal:"center",wrapText:!0},ge===14&&(be.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},be.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}let ne=15,re={};n.isOnline?re=rows.data:re=i;for(let ge=0;ge<=re.length;ge++){const De=re[ge];if(De!==void 0){let be="";for(const Ie in De.drugQuantityTemps)be=be+(De.drugQuantityTemps[Ie].drugName+" - ("+De.drugQuantityTemps[Ie].quantity+");                                       ");const Le=t.getCell("K"+ne);Le.value=be,ne++}}const me=await d.xlsx.writeBuffer(),Ye="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Ne=".xlsx",we=new Blob([me],{type:Ye});if(Jt.value&&!wl.value)_e.exports.saveAs(we,Go+Ne);else{let ge=function(ue,ve){const Ae=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(Ae,function(Te){De(Te,ue,ve)},Le)},De=function(ue,ve,Ae){ue.getFile(ve,{create:!0,exclusive:!1},function(Te){be(Te,Ae)},Ie)},be=function(ue,ve){ue.createWriter(function(Ae){Ae.onwriteend=function(){console.log("Successful file write..."),Se()},Ae.onerror=function(Te){console.log("Failed file write: "+Te)},Ae.write(ve)})},Le=function(ue){console.log(ue)},Ie=function(ue){console.log("errorr: "+ue.toString())},Se=function(){const ue=Ee;console.log("file system 44444: "+ue);const ve=cordova.file.externalRootDirectory+"Download/"+ue;console.log("file system 2222: "+ve);const Ae=decodeURIComponent(ve);cordova.plugins.fileOpener2.open(Ae,"application/vnd.ms-excel",{error:function(Te){console.log("file system open3333366: "+Te+Ae)},success:function(){}})};const Ee="LivroDiarioDeArvs.xlsx";console.log("result"+Ee),ge(Ee,we)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n++),i.push(e[o].nid),i.push(e[o].patientName),i.push(e[o].startReason),i.push(e[o].ageGroup_0_4),i.push(e[o].ageGroup_5_9),i.push(e[o].ageGroup_10_14),i.push(e[o].ageGroup_Greater_than_15),i.push(e[o].patientType),i.push(e[o].regime),i.push(C.createDrugArrayOfArrayRow(e[o].drugQuantityTemps).join(`; 
`)),i.push(e[o].dispensationType),i.push(e[o].therapeuticLine),i.push(C.getFormatDDMMYYYY(e[o].pickupDate)),i.push(C.getFormatDDMMYYYY(e[o].nextPickupDate)),i.push(e[o].ppe),i.push(e[o].prep),i.push(""),l.push(i)}return l},async getDataLocalReport(e){const l=await es.localDbGetAllByReportId(e);return l===null||l.length===0?"204":l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Yu={class:"param-container"},Nu="LIVRO_DIARIO",Tu="ArvDailyRegister",Iu={__name:"ArvDailyRegister",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(""),i=S(!1),a=S(!1),s=S(0),d=S(0),t=S(0),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(o.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{t.value=.001,l.value?(r(u,f),C.apiInitReportProcess("arvDailyRegisterReportTemp",u).then(c=>{t.value=c.data.progress,setTimeout(()=>{b(u)},3e3)})):(r(u,f),es.getDataLocalDb(u),t.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("arvDailyRegisterReportTemp",u).then(c=>{c.data.progress>.001?(t.value=c.data.progress,t.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(t.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Rl.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),i.value=!1}):c==="XLS"&&Rl.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),a.value=!1})};return E("downloadingPdf",i),E("downloadingXls",a),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterArvDailyRegisterSection",ref:o},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Lista de Registro Di\xE1rio de ARV ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Registro Di\xE1rio de ARV ",1)]),_:1})),ie("div",Yu,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:s.value,qtyProcessed:d.value,reportType:Nu,tabName:Tu,params:e.params,progress:t.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}};var Bu=Fe(Iu,[["__scopeId","data-v-3f7d5558"]]);const{isMobile:Cl,isOnline:Kt}=ce(),In="PacientesFaltosos",Ou=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Lu=`Relat\xF3rio de Pacientes Faltosos ao 
 Levantamento de ARV's`,qo=In.concat("_"+P(new Date).format("DD-MM-YYYY"));var xl={async downloadPDF(e,l,n,o){const i=de.currClinic(),a=await Xe(Je),s=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});s.addFileToVFS("NotoSans-Regular.ttf",a.split(",")[1]),s.addFont("NotoSans-Regular.ttf","NotoSans","normal"),s.setFont("NotoSans");const d=new Image;d.src="data:image/png;base64,"+le,s.internal.pageSize.getWidth(),s.setProperties({title:qo.concat(".pdf")});const t=[[{content:"Faltosos ao Levantamento de ARV\xB4s",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?i.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?i.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(s,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:t}),s.setFontSize(8),s.text("Rep\xFAblica de Mo\xE7ambique ",16,28),s.text("Minist\xE9rio da Sa\xFAde ",20,32),s.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),s.addImage(d,"png",28,15,10,10);const m=["NID","NOME","Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)","Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)","Data em que Regressou \xE0 Unidade Sanit\xE1ria","Contacto"];let g="",f=[];if(Kt.value){const r=await C.printReportOther("absentPatientsReport",e);if(r.status===204||r.data.length===0)return 204;g=this.createArrayOfArrayRow(r.data)}else{if(f=await Qe.localDbGetAllByReportId(e),f.length===0)return 204;g=this.createArrayOfArrayRow(f)}if(K(s,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:40},1:{cellWidth:55},2:{cellWidth:55},3:{cellWidth:55},4:{cellWidth:40}},didDrawPage:function(r){const p="P\xE1gina "+s.internal.getNumberOfPages();s.setFontSize(8);const v=s.internal.pageSize,b=v.height?v.height:v.getHeight();s.text(p,r.settings.margin.right,b-10)},startY:s.lastAutoTable.finalY,theme:"grid",head:[m],body:g}),Kt.value&&!Cl.value)window.open(s.output("bloburl")),o.value=!1;else{const r=s.output();Oe.downloadFile(qo,".pdf",r,o)}},async downloadExcel(e,l,n,o){const i=de.currClinic();let a="",s=[],d={};if(Kt.value){const V=await C.printReportOther("absentPatientsReport",e);if(V.status===204||V.data.length===0)return 204;const G=V.data[0];n.startDateParam=C.getFormatDDMMYYYY(G.startDate),n.endDateParam=C.getFormatDDMMYYYY(G.endDate),a=this.createArrayOfArrayRow(V.data)}else{if(s=await Qe.localDbGetAllByReportId(e),s.length===0)return 204;d=s[0],n.startDateParam=C.getFormatDDMMYYYY(d.startDate),n.endDateParam=C.getFormatDDMMYYYY(d.endDate),a=this.createArrayOfArrayRow(s)}const t=new xe.exports.Workbook;t.creator="FGH",t.lastModifiedBy="FGH",t.created=new Date,t.modified=new Date,t.lastPrinted=new Date;const m=t.addWorksheet(In),g=t.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),f=m.getCell("A8"),r=m.getCell("A9"),p=m.getCell("A11"),v=m.getCell("B11"),b=m.getCell("E11"),D=m.getCell("E12"),u=m.getCell("F11"),c=m.getCell("F12"),h=m.getRow(15),y=m.getColumn("A"),x=m.getColumn("B"),R=m.getColumn("C"),_=m.getColumn("D"),N=m.getColumn("E"),O=m.getColumn("F");f.alignment=r.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},p.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},r.border=p.border=v.border=b.border=u.border=D.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},f.value=Ou,r.value=Lu,v.value=i==null?void 0:i.clinicName,u.value=n.startDateParam,c.value=n.endDateParam,p.value="Unidade Sanit\xE1ria",b.value="Data In\xEDcio",D.value="Data Fim",m.mergeCells("A1:A7"),m.mergeCells("A9:F10"),m.mergeCells("B11:D11"),m.mergeCells("A12:D12"),h.height=30,y.width=25,x.width=30,R.width=25,_.width=25,N.width=25,O.width=20,r.font=b.font=D.font=p.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},m.addImage(g,{tl:{col:0,row:1},ext:{width:144,height:98}}),m.addTable({name:In,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Regressou \xE0 Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1}],rows:a});const q=m.lastRow.number!==void 0?m.lastRow.number:0;for(let V=14;V<=q;V++)m.getRow(V).eachCell({includeEmpty:!0},U=>{U.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},U.alignment={vertical:"middle",horizontal:"center",wrapText:!0},V===14&&(U.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},U.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const I=await t.xlsx.writeBuffer(),X="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",$=".xlsx",w=new Blob([I],{type:X});if(Kt.value&&!Cl.value)Ue(w,qo+$),o.value=!1;else{const V="PacientesFaltosos.xlsx";Oe.downloadFile(V,".xlsx",w,o)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(P(new Date(e[n].dateMissedPickUp)).format("DD-MM-YYYY"));const i=e[n].dateIdentifiedAbandonment;o.push(i!==null&&i!==""?P(new Date(e[n].dateIdentifiedAbandonment)).format("DD-MM-YYYY"):""),o.push(e[n].returnedPickUp!==null?P(new Date(e[n].returnedPickUp)).format("DD-MM-YYYY"):""),o.push(e[n].contact),l.push(o)}return l}};const ku={class:"param-container"},Vu="AbsentPatients",zu="FALTOSOS_AO_LEVANTAMENTO",_u={__name:"AbsentPatients",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=e,i=S(0),a=S(0),s=S(0),d=S(""),t=Ge(S(!1)),m=Ge(S(!1)),g=S(!1),f=c=>{if(d.value.remove(),c){const h=c.id;g.value=!0,ee.remove(h)}else g.value=!0,ee.remove(o.id)},r=S(null),p=S(!1),v=(c,h)=>{h.value||ee.set(c.id,c)},b=async c=>{s.value=.001,l.value?(v(c,g),C.apiInitReportProcess("absentPatientsReport",c).then(h=>{D(c)})):(await Qe.getDataLocalDb(c),s.value=100,c.progress=100,v(c,g))},D=c=>{l.value&&C.getProcessingStatus("absentPatientsReport",c).then(h=>{h.data.progress>.001?(s.value=h.data.progress,s.value<100?(v(c,g),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(s.value=100,c.progress=100,v(c,g))):setTimeout(()=>{D(c)},3e3)})},u=(c,h,y)=>{h==="PDF"?xl.downloadPDF(c,h,y,t).then(x=>{x===204&&(n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1)}):h==="XLS"&&xl.downloadExcel(c,h,y,m).then(x=>{x===204&&(n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)})};return Me(()=>{o.params&&D(o.params)}),E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",r),E("resultFromLocalStorage",p),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:d},[p.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(r.value!==null?r.value.code:"")+": Pacientes Faltosos ao levantamento ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Faltosos ao levantamento ",1)]),_:1})),ie("div",ku,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:i.value,qtyProcessed:a.value,reportType:zu,progress:s.value,tabName:Vu,params:e.params,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var Uu=Fe(_u,[["__scopeId","data-v-6022efc2"]]);const{isMobile:Pl,isOnline:Rt}=ce(),os="PacientesFaltososAPSS",$u=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Hu=`Relat\xF3rio de Pacientes Faltosos ao 
 Levantamento de ARV's para APSS`,Zt=os.concat("_"+P(new Date).format("DD-MM-YYYY")),Wo=["TARV","TB","CPN","CCR","SAAJ"];var Al={async downloadPDF(e,l){const n=de.currClinic();let o=[],i=[],a={},s=[];if(Rt.value){const d=await C.printReportOther("absentPatientsReport",e);if(d.status===204||d.data.length===0)return 204;s=d.data,a=d.data[0],l.startDateParam=C.getFormatDDMMYYYY(a.startDate),l.endDateParam=C.getFormatDDMMYYYY(a.endDate)}else{if(i=await Qe.localDbGetAllByReportId(e),i.length===0)return 204;a=i[0],s=i,l.startDateParam=C.getFormatDDMMYYYY(a.startDate),l.endDateParam=C.getFormatDDMMYYYY(a.endDate)}for(const d of Wo){Rt.value?o=this.createArrayOfArrayRow(s,d):o=this.createArrayOfArrayRow(s,d);const t=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),m=new Image;m.src="data:image/png;base64,"+le;const g=new Image;g.src="data:image/png;base64,"+le;const f=[[{content:"Faltosos ao Levantamento de ARV\xB4s para APSS",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+n.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l.startDateParam+" \xE0 "+l.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(l.district===null?n.district.description:l.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(l.province===null?n.province.description:l.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+l.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]],r=[[{content:"NID",rowSpan:2},{content:"NOME",rowSpan:2},{content:"IDADE",rowSpan:2},{content:"CONTACTO",rowSpan:2},{content:"ENDERECO",rowSpan:2},{content:"Servi\xE7o que Serve",colSpan:5},{content:"Tipo de Chamada",colSpan:2},{content:"Relat\xF3rio da Chamada",colSpan:6},{content:"Retornos e Refer\xEAncias",colSpan:3}],[{content:"TARV"},{content:"TB"},{content:"CPN"},{content:"CCR"},{content:"SAAJ"},{content:"Chamada de Apoio"},{content:"Chamada de Reintegra\xE7\xE3o"},{content:"Paciente Incontactavel"},{content:"O Paciente Esqueceu a data da Consulta"},{content:"O Paciente est\xE1 doente"},{content:"O Paciente n\xE3o tem transporte"},{content:"O Paciente viajou"},{content:"\xD3bito"},{content:"PPE"},{content:"PREP"},{content:"Cr.Exp."}]];if(K(t,{bodyStyles:{halign:"left",valign:"middle",fontSize:6},headStyles:{halign:"left",valign:"middle",fontSize:6},theme:"grid",body:f}),t.setFontSize(8),t.text("Rep\xFAblica de Mo\xE7ambique ",16,28),t.text("Minist\xE9rio da Sa\xFAde ",20,32),t.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),t.addImage(g,"png",28,15,10,10),K(t,{bodyStyles:{overflow:"linebreak",cellWidth:"wrap",valign:"middle",fontSize:6,overflowColumns:"linebreak"},headStyles:{valign:"bottom",halign:"center",fontSize:5,lineWidth:.5,lineColor:[230,230,230],fillColor:[255,255,255],textColor:[96,96,96]},columnStyles:{4:{cellWidth:40,fontSize:5},11:{cellWidth:25}},didDrawPage:function(p){const v="P\xE1gina "+t.internal.getNumberOfPages();t.setFontSize(6);const b=t.internal.pageSize,D=b.height?b.height:b.getHeight();t.text(v,p.settings.margin.right,D-8)},theme:"grid",head:r,body:o}),Rt.value&&!Pl.value)t.save(`${Zt}_${d}.pdf`);else{const p=t.output();Oe.downloadFile(`${Zt}_${d}`,".pdf",p)}}},async downloadExcel(e,l){const n=de.currClinic();let o=[],i=[],a={},s=[];if(Rt.value){const r=await C.printReportOther("absentPatientsReport",e);if(r.status===204||r.data.length===0)return 204;s=r.data,a=r.data[0],l.startDateParam=C.getFormatDDMMYYYY(a.startDate),l.endDateParam=C.getFormatDDMMYYYY(a.endDate)}else{if(i=await Qe.localDbGetAllByReportId(e),i.length===0)return 204;a=i[0],s=i,l.startDateParam=C.getFormatDDMMYYYY(a.startDate),l.endDateParam=C.getFormatDDMMYYYY(a.endDate)}const d=new xe.exports.Workbook;d.creator="CSAUDE",d.lastModifiedBy="CSAUDE",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;for(const r of Wo){Rt.value?o=this.createArrayOfArrayRow(s,r):o=this.createArrayOfArrayRow(s,r);let p=r;r==="TARV"&&(p="ADULTO E PEDIATRICO");const v=d.addWorksheet(p),b=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),D=v.getCell("A8"),u=v.getCell("A9"),c=v.getCell("A11"),h=v.getCell("B11"),y=v.getCell("A12"),x=v.getCell("B12"),R=v.getCell("C12"),_=v.getCell("D12"),N=v.getCell("F13"),O=v.getCell("K13"),T=v.getCell("M13"),q=v.getCell("S13"),I=v.getCell("T11"),X=v.getCell("T12"),$=v.getCell("U11"),w=v.getCell("U12");v.getRow(14);const V=v.getRow(15),G=v.getColumn("A"),U=v.getColumn("B"),z=v.getColumn("C"),Q=v.getColumn("D"),Z=v.getColumn("E"),L=v.getColumn("F"),k=v.getColumn("G"),H=v.getColumn("H"),B=v.getColumn("I"),W=v.getColumn("J"),oe=v.getColumn("K"),Y=v.getColumn("L"),he=v.getColumn("M"),Pe=v.getColumn("N"),ne=v.getColumn("O"),re=v.getColumn("P"),me=v.getColumn("Q"),Ye=v.getColumn("R"),Ne=v.getColumn("S"),we=v.getColumn("T"),ge=v.getColumn("U");v.getCell("A13").fill=v.getCell("B13").fill=v.getCell("C13").fill=v.getCell("D13").fill=v.getCell("E13").fill=v.getCell("F13").fill=v.getCell("G13").fill=v.getCell("H13").fill=v.getCell("I13").fill=v.getCell("J13").fill=v.getCell("K13").fill=v.getCell("L13").fill=v.getCell("M13").fill=v.getCell("N13").fill=v.getCell("O13").fill=v.getCell("P13").fill=v.getCell("Q13").fill=v.getCell("R13").fill=v.getCell("S13").fill=v.getCell("T13").fill=v.getCell("U13").fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},N.font=O.font=T.font=q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},N.alignment=O.alignment=T.alignment=q.alignment=D.alignment=u.alignment=V.alignment={vertical:"middle",horizontal:"center",wrapText:!0},c.alignment=I.alignment=X.alignment={vertical:"middle",horizontal:"left",wrapText:!1},D.border=u.border=c.border=h.border=y.border=x.border=R.border=_.border=I.border=$.border=X.border=w.border=q.border=T.border=O.border=N.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},D.value=$u,u.value=Hu,h.value=n==null?void 0:n.clinicName,$.value=l.startDateParam,x.value=l.district===null?n==null?void 0:n.district.description:l==null?void 0:l.district.description,_.value=l.province===null?n==null?void 0:n.province.description:l==null?void 0:l.province.description,w.value=l.endDateParam,c.value="Unidade Sanit\xE1ria",y.value="Distrito",R.value="Provincia",I.value="Data In\xEDcio",X.value="Data Fim",N.value="Servi\xE7o que Serve",O.value="Tipo de Chamada",T.value="Relat\xF3rio da Chamada",q.value="Retornos e Refer\xEAncias",v.mergeCells("A1:A7"),v.mergeCells("A9:U10"),v.mergeCells("B11:S11"),v.mergeCells("D12:S12"),v.mergeCells("F13:J13"),v.mergeCells("K13:L13"),v.mergeCells("M13:R13"),v.mergeCells("S13:U13"),V.height=30,G.width=25,U.width=30,z.width=25,Q.width=25,Z.width=25,L.width=20,k.width=25,H.width=30,B.width=25,W.width=25,oe.width=25,Y.width=20,he.width=25,Pe.width=30,ne.width=25,re.width=25,me.width=25,Ye.width=20,Ne.width=25,we.width=25,ge.width=25,u.font=I.font=X.font=c.font=y.font=R.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},v.addImage(b,{tl:{col:0,row:1},ext:{width:144,height:98}}),v.addTable({name:os+"_"+r.name,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"NOME",totalsRowFunction:"none",filterButton:!1},{name:"IDADE",totalsRowFunction:"none",filterButton:!1},{name:"CONTACTO",totalsRowFunction:"none",filterButton:!1},{name:"ENDERECO",totalsRowFunction:"none",filterButton:!1},{name:"TARV",totalsRowFunction:"none",filterButton:!1},{name:"TB",totalsRowFunction:"none",filterButton:!1},{name:"CPN",totalsRowFunction:"none",filterButton:!1},{name:"CCR",totalsRowFunction:"none",filterButton:!1},{name:"SAAJ",totalsRowFunction:"none",filterButton:!1},{name:"Chamada de Apoio",totalsRowFunction:"none",filterButton:!1},{name:"Chamada de Reintegra\xE7\xE3o",totalsRowFunction:"none",filterButton:!1},{name:"Paciente Incontactavel",totalsRowFunction:"none",filterButton:!1},{name:"O Paciente Esqueceu a data da Consulta",totalsRowFunction:"none",filterButton:!1},{name:"O Paciente est\xE1 doente",totalsRowFunction:"none",filterButton:!1},{name:"O Paciente n\xE3o tem transport",totalsRowFunction:"none",filterButton:!1},{name:"O Paciente viajou",totalsRowFunction:"none",filterButton:!1},{name:"\xD3bito",totalsRowFunction:"none",filterButton:!1},{name:"PPE",totalsRowFunction:"none",filterButton:!1},{name:"PREP",totalsRowFunction:"none",filterButton:!1},{name:"Cr. Exp.",totalsRowFunction:"none",filterButton:!1}],rows:o}),v.addRows([]);const be=v.lastRow.number!==void 0?v.lastRow.number:0;for(let Le=14;Le<=be;Le++)v.getRow(Le).eachCell({includeEmpty:!0},Se=>{Se.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Se.alignment={vertical:"middle",horizontal:"center",wrapText:!0},Le===14&&(Se.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Se.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}const t=await d.xlsx.writeBuffer(),m="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",g=".xlsx",f=new Blob([t],{type:m});Rt.value&&!Pl.value?Ue(f,Zt+g):Oe.downloadFile(Zt,".xlsx",f)},createArrayOfArrayRow(e,l){const n=[];for(const o in e)if(e[o].servedService===l){const i=[];i.push(e[o].nid),i.push(e[o].name),i.push(e[o].idade),i.push(e[o].contact),i.push(e[o].address);const a=e[o].servedService;Wo.forEach(s=>{i.push(a===s?"SIM":"NAO")}),n.push(i)}return n},drawRotatedHeader(e,l,n,o,i){const a=i||10,s=o||10;l.forEach((d,t)=>{d.forEach((m,g)=>{const f=e.getStringUnitWidth(m.content)*e.internal.getFontSize(),r=e.internal.getLineHeight(),p=s+g*f*Math.cos(n)+t*r*Math.sin(n),v=a+t*f*Math.sin(n)+g*r*Math.cos(n);e.text(m.content,p,v,{angle:n})})})},downloadFile(e,l,n){const o=e+l;i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o,f=cordova.file.externalRootDirectory+"Download/"+g,r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Gu={class:"param-container"},Fl="AbsentPatientsApss",qu="FALTOSOS_AO_LEVANTAMENTO_APSS",Wu={__name:"AbsentPatientsApss",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(!1),g=(u,c)=>{c.value||ee.set(u.id,u)},f=u=>{if(s.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},r=S(null),p=S(!1),v=async u=>{a.value=.001,l.value?(g(u,m),C.apiInitReportProcess("absentPatientsReport",u).then(c=>{b(u)})):(g(u,m),await Qe.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("absentPatientsReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(g(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,g(u,m))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Al.downloadPDF(u,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1}):c==="XLS"&&Al.downloadExcel(u,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1})};return Me(()=>{console.log(Fl)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",r),E("resultFromLocalStorage",p),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[p.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(r.value!==null?r.value.code:"")+": Pacientes Faltosos ao Levantamento de ARV's para APSS ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Faltosos ao Levantamento de ARV's para APSS ",1)]),_:1})),ie("div",Gu,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:qu,progress:a.value,tabName:Fl,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var Qu=Fe(Wu,[["__scopeId","data-v-c4add588"]]);const{isMobile:El,isOnline:eo}=ce(),Bn="PacientesFaltososDT",ju=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Xu=`Relat\xF3rio de Pacientes Faltosos ao 
 Levantamento de ARV's para dispensa trimestral`,Qo=Bn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Ml={async downloadPDF(e,l,n){let o="",i=[],a={};if(eo.value){const f=await C.printReportOther("absentPatientsReport",e);if(f.status===204||f.data.length===0)return 204;const r=f.data[0];r.startDate!==null&&r.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(r.startDate),n.endDateParam=C.getFormatDDMMYYYY(r.endDate)),o=this.createArrayOfArrayRow(f.data)}else{if(i=await Qe.localDbGetAllByReportId(e),i.length===0)return 204;a=i[0],a.startDate!==null&&a.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(a.startDate),n.endDateParam=C.getFormatDDMMYYYY(a.endDate)),o=this.createArrayOfArrayRow(i)}const s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=new Image;t.src="data:image/png;base64,"+le,d.internal.pageSize.getWidth(),d.setProperties({title:Qo.concat(".pdf")});const m=[[{content:"Faltosos ao Levantamento de ARV\xB4s para dispensa trimestral",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?s.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?s.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:m}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(t,"png",28,15,10,10);const g=["NID","NOME","Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)","Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)","Data em que Regressou \xE0 Unidade Sanit\xE1ria","Contacto"];if(K(d,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:40},1:{cellWidth:55},2:{cellWidth:55},3:{cellWidth:55},4:{cellWidth:40}},didDrawPage:function(f){const r="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const p=d.internal.pageSize,v=p.height?p.height:p.getHeight();d.text(r,f.settings.margin.right,v-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[g],body:o}),eo.value&&!El.value)window.open(d.output("bloburl"));else{const f=d.output();this.downloadFile(Qo,"pdf",f)}},async downloadExcel(e,l,n){const o=de.currClinic();let i="",a=[],s={};if(eo.value){const w=await C.printReportOther("absentPatientsReport",e);if(w.status===204||w.data.length===0)return 204;const V=w.data[0];n.startDateParam=C.getFormatDDMMYYYY(V.startDate),n.endDateParam=C.getFormatDDMMYYYY(V.endDate),i=this.createArrayOfArrayRow(w.data)}else{if(a=await Qe.localDbGetAllByReportId(e),a.length===0)return 204;s=a[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),i=this.createArrayOfArrayRow(a)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Bn),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("B11"),v=t.getCell("E11"),b=t.getCell("E12"),D=t.getCell("F11"),u=t.getCell("F12"),c=t.getRow(15),h=t.getColumn("A"),y=t.getColumn("B"),x=t.getColumn("C"),R=t.getColumn("D"),_=t.getColumn("E"),N=t.getColumn("F");g.alignment=f.alignment=c.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=v.alignment=b.alignment={vertical:"middle",horizontal:"left",wrapText:!1},f.border=r.border=p.border=v.border=D.border=b.border=u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=ju,f.value=Xu,p.value=o==null?void 0:o.clinicName,D.value=n.startDateParam,u.value=n.endDateParam,r.value="Unidade Sanit\xE1ria",v.value="Data In\xEDcio",b.value="Data Fim",t.mergeCells("A1:A7"),t.mergeCells("A9:F10"),t.mergeCells("B11:D11"),t.mergeCells("A12:D12"),c.height=30,h.width=25,y.width=30,x.width=25,R.width=25,_.width=25,N.width=20,f.font=v.font=b.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Bn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Regressou \xE0 Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1}],rows:i});const T=t.lastRow.number!==void 0?t.lastRow.number:0;for(let w=14;w<=T;w++)t.getRow(w).eachCell({includeEmpty:!0},G=>{G.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},G.alignment={vertical:"middle",horizontal:"center",wrapText:!0},w===14&&(G.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},G.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const q=await d.xlsx.writeBuffer(),I="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",X=".xlsx",$=new Blob([q],{type:I});if(eo.value&&!El.value)Ue($,Qo+X);else{let w=function(L,k){const H=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(H,function(B){V(B,L,k)},U)},V=function(L,k,H){L.getFile(k,{create:!0,exclusive:!1},function(B){G(B,H)},z)},G=function(L,k){L.createWriter(function(H){H.onwriteend=function(){Q()},H.onerror=function(B){console.log("Failed file write: "+B)},H.write(k)})},U=function(L){console.log(L)},z=function(L){console.log("errorr: "+L.toString())},Q=function(){const L=Z,k=cordova.file.externalRootDirectory+"Download/"+L,H=decodeURIComponent(k);cordova.plugins.fileOpener2.open(H,"application/vnd.ms-excel",{error:function(B){console.log("file system open3333366: "+B+H)},success:function(){}})};const Z="PacientesFaltosos.xlsx";w(Z,$)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(P(new Date(e[n].dateMissedPickUp)).format("DD-MM-YYYY"));const i=e[n].dateIdentifiedAbandonment;o.push(i!==null&&i!==""?P(new Date(e[n].dateIdentifiedAbandonment)).format("DD-MM-YYYY"):""),o.push(e[n].returnedPickUp!==null?P(new Date(e[n].returnedPickUp)).format("DD-MM-YYYY"):""),o.push(e[n].contact),l.push(o)}return l},downloadFile(e,l,n){const o=e+l;i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o,f=cordova.file.externalRootDirectory+"Download/"+g,r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Ju={class:"param-container"},Yl="AbsentPatientsDT",Ku="FALTOSOS_AO_LEVANTAMENTO_DT",Zu={__name:"AbsentPatientsDT",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(!1),g=u=>{if(s.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},f=S(null),r=S(!1),p=(u,c)=>{c.value||ee.set(u.id,u)},v=async u=>{a.value=.001,l.value?(p(u,m),C.apiInitReportProcess("absentPatientsReport",u).then(c=>{b(u)})):(p(u,m),await Qe.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("absentPatientsReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(p(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,p(u,m))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Ml.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1}):c==="XLS"&&Ml.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1})};return Me(()=>{console.log(Yl)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",f),E("resultFromLocalStorage",r),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterAbsentPatientSection",ref:s},[r.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(f.value!==null?f.value.code:"")+": Pacientes Faltosos ao levantamento para Dispensa trimestral ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Faltosos ao levantamento para Dispensa trimestral ",1)]),_:1})),ie("div",Ju,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:Ku,progress:a.value,tabName:Yl,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var eg=Fe(Zu,[["__scopeId","data-v-1969275d"]]);const{isMobile:Nl,isOnline:to}=ce(),On="PacientesFaltososDS",tg=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,og=`Relat\xF3rio de Pacientes Faltosos ao 
 Levantamento de ARV's para dispensa Semestral`,jo=On.concat("_"+P(new Date).format("DD-MM-YYYY"));var Tl={async downloadPDF(e,l,n){let o="",i=[],a={};if(to.value){const f=await C.printReportOther("absentPatientsReport",e);if(f.status===204||f.data.length===0)return 204;const r=f.data[0];r.startDate!==null&&r.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(r.startDate),n.endDateParam=C.getFormatDDMMYYYY(r.endDate)),o=this.createArrayOfArrayRow(f.data)}else{if(i=await Qe.localDbGetAllByReportId(e),i.length===0)return 204;a=i[0],a.startDate!==null&&a.startDate!==void 0&&(n.startDateParam=C.getFormatDDMMYYYY(a.startDate),n.endDateParam=C.getFormatDDMMYYYY(a.endDate)),o=this.createArrayOfArrayRow(i)}const s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=new Image;t.src="data:image/png;base64,"+le,d.internal.pageSize.getWidth(),d.setProperties({title:jo.concat(".pdf")});const m=[[{content:"Faltosos ao Levantamento de ARV\xB4s para dispensa Semestral",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?s.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?s.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:m}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(t,"png",28,15,10,10);const g=["NID","NOME","Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)","Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)","Data em que Regressou \xE0 Unidade Sanit\xE1ria","Contacto"];if(K(d,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:40},1:{cellWidth:55},2:{cellWidth:55},3:{cellWidth:55},4:{cellWidth:40}},didDrawPage:function(f){const r="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const p=d.internal.pageSize,v=p.height?p.height:p.getHeight();d.text(r,f.settings.margin.right,v-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[g],body:o}),to.value&&!Nl.value)window.open(d.output("bloburl"));else{const f=d.output();this.downloadFile(jo,"pdf",f)}},async downloadExcel(e,l,n){const o=de.currClinic();let i="",a=[],s={};if(to.value){const w=await C.printReportOther("absentPatientsReport",e);if(w.status===204||w.data.length===0)return 204;const V=w.data[0];n.startDateParam=C.getFormatDDMMYYYY(V.startDate),n.endDateParam=C.getFormatDDMMYYYY(V.endDate),i=this.createArrayOfArrayRow(w.data)}else{if(a=await Qe.localDbGetAllByReportId(e),a.length===0)return 204;s=a[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),i=this.createArrayOfArrayRow(a)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(On),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("B11"),v=t.getCell("E11"),b=t.getCell("E12"),D=t.getCell("F11"),u=t.getCell("F12"),c=t.getRow(15),h=t.getColumn("A"),y=t.getColumn("B"),x=t.getColumn("C"),R=t.getColumn("D"),_=t.getColumn("E"),N=t.getColumn("F");g.alignment=f.alignment=c.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=v.alignment=b.alignment={vertical:"middle",horizontal:"left",wrapText:!1},f.border=r.border=p.border=v.border=D.border=b.border=u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=tg,f.value=og,p.value=o==null?void 0:o.clinicName,D.value=n.startDateParam,u.value=n.endDateParam,r.value="Unidade Sanit\xE1ria",v.value="Data In\xEDcio",b.value="Data Fim",t.mergeCells("A1:A7"),t.mergeCells("A9:F10"),t.mergeCells("B11:D11"),t.mergeCells("A12:D12"),c.height=30,h.width=25,y.width=30,x.width=25,R.width=25,_.width=25,N.width=20,f.font=v.font=b.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:On,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Data que Faltou ao Levantamento de ARVs [0-59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Identificou o Abandono ao TARV [>59 dias faltoso] (d-m-a)",totalsRowFunction:"none",filterButton:!1},{name:"Data em que Regressou \xE0 Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1}],rows:i});const T=t.lastRow.number!==void 0?t.lastRow.number:0;for(let w=14;w<=T;w++)t.getRow(w).eachCell({includeEmpty:!0},G=>{G.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},G.alignment={vertical:"middle",horizontal:"center",wrapText:!0},w===14&&(G.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},G.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const q=await d.xlsx.writeBuffer(),I="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",X=".xlsx",$=new Blob([q],{type:I});if(to.value&&!Nl.value)Ue($,jo+X);else{let w=function(L,k){const H=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(H,function(B){V(B,L,k)},U)},V=function(L,k,H){L.getFile(k,{create:!0,exclusive:!1},function(B){G(B,H)},z)},G=function(L,k){L.createWriter(function(H){H.onwriteend=function(){Q()},H.onerror=function(B){console.log("Failed file write: "+B)},H.write(k)})},U=function(L){console.log(L)},z=function(L){console.log("errorr: "+L.toString())},Q=function(){const L=Z,k=cordova.file.externalRootDirectory+"Download/"+L,H=decodeURIComponent(k);cordova.plugins.fileOpener2.open(H,"application/vnd.ms-excel",{error:function(B){console.log("file system open3333366: "+B+H)},success:function(){}})};const Z="PacientesFaltosos.xlsx";w(Z,$)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].name),o.push(P(new Date(e[n].dateMissedPickUp)).format("DD-MM-YYYY"));const i=e[n].dateIdentifiedAbandonment;o.push(i!==null&&i!==""?P(new Date(e[n].dateIdentifiedAbandonment)).format("DD-MM-YYYY"):""),o.push(e[n].returnedPickUp!==null?P(new Date(e[n].returnedPickUp)).format("DD-MM-YYYY"):""),o.push(e[n].contact),l.push(o)}return l},downloadFile(e,l,n){const o=e+l;i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o,f=cordova.file.externalRootDirectory+"Download/"+g,r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const ng={class:"param-container"},Il="AbsentPatientsDS",ag="FALTOSOS_AO_LEVANTAMENTO_DS",lg={__name:"AbsentPatientsDS",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(!1),g=u=>{if(s.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},f=S(null),r=S(!1),p=(u,c)=>{c.value||ee.set(u.id,u)},v=async u=>{a.value=.001,l.value?(p(u,m),C.apiInitReportProcess("absentPatientsReport",u).then(c=>{b(u)})):(p(u,m),await Qe.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("absentPatientsReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(p(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,p(u,m))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Tl.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1}):c==="XLS"&&Tl.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1})};return Me(()=>{console.log(Il)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",f),E("resultFromLocalStorage",r),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterAbsentPatientSection",ref:s},[r.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(f.value!==null?f.value.code:"")+": Pacientes Faltosos ao levantamento para Dispensa semestral ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Faltosos ao levantamento para Dispensa semestral ",1)]),_:1})),ie("div",ng,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:ag,progress:a.value,tabName:Il,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var ig=Fe(lg,[["__scopeId","data-v-89d2e1da"]]);const{isMobile:Bl,isOnline:Ol}=ce(),Ln="HistoricoDeLevantamento",sg=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,rg="HIST\xD3RICO DE LEVANTAMENTO",Xo=Ln.concat("_"+P(new Date).format("DD-MM-YYYY")),ns=new Image;ns.src="data:image/png;base64,"+le;var ot={async downloadPDF(e,l,n,o,i,a){const s=await Xe(Je),d=new Ce({orientation:"l",unit:"mm",format:[205,313],putOnlyUsedFonts:!0,floatPrecision:"smart"});d.addFileToVFS("NotoSans-Regular.ttf",s.split(",")[1]),d.addFont("NotoSans-Regular.ttf","NotoSans","normal"),d.setFont("NotoSans");const t=o[0];d.setProperties({title:Xo.concat(".pdf")});const m=[[{content:"HIST\xD3RICO DE LEVANTAMENTO",styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+t.clinic,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" \xE0 "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+t.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+t.province,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+t.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:m}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(ns,"png",28,15,10,10);const g=["ORD","NID","Nome","Idade","Contacto",i==="tarv"?"Tipo TARV":"Tipo Paciente","Regime Terap\xEAutica","Tipo de Dispensa","Modo de Dispensa","Data Levant.","Data Prox. Levant.","Sector Cl\xEDnico","Utilizador"],f=o,r=[];let p=1;for(const v in f){const b=[];b.push(p),b.push(f[v].nid),b.push(String(f[v].firstNames+" "+f[v].middleNames+" "+f[v].lastNames).replaceAll("null","").replace("  "," ")),b.push(f[v].age),b.push(f[v].cellphone),b.push(f[v].tipoTarv),b.push(f[v].therapeuticalRegimen),b.push(f[v].dispenseType),b.push(f[v].dispenseMode),b.push(P(new Date(f[v].pickUpDate)).format("DD-MM-YYYY")),b.push(P(new Date(f[v].nexPickUpDate)).format("DD-MM-YYYY")),b.push(f[v].clinicsector),b.push(f[v].idmeduser),r.push(b),p+=1}if(p=0,K(d,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:10},1:{cellWidth:35},2:{cellWidth:35},3:{cellWidth:10},4:{cellWidth:20},5:{cellWidth:20},6:{cellWidth:25},7:{cellWidth:25},8:{cellWidth:25},9:{cellWidth:20},10:{cellWidth:20},11:{cellWidth:20},12:{cellWidth:20}},didDrawPage:function(v){const b="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const D=d.internal.pageSize,u=D.height?D.height:D.getHeight();d.text(b,v.settings.margin.right,u-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[g],body:r}),Ol.value&&!Bl.value)window.open(d.output("bloburl")),a.value=!1;else{const v=d.output();Oe.downloadFile(Xo,".pdf",v,a)}},async downloadExcel(e,l,n,o,i,a){const s=o,d=this.createArrayOfArrayRow(s),t=new xe.exports.Workbook;t.creator="FGH",t.lastModifiedBy="FGH",t.created=new Date,t.modified=new Date,t.lastPrinted=new Date;const m=t.addWorksheet(Ln),g=t.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),f=m.getCell("A8"),r=m.getCell("A9"),p=m.getCell("A11"),v=m.getCell("A12"),b=m.getCell("E12"),D=m.getCell("L11"),u=m.getCell("L12"),c=m.getCell("B11"),h=m.getCell("B12"),y=m.getCell("F12"),x=m.getCell("M11"),R=m.getCell("M12"),_=m.getRow(15),N=m.getColumn("A"),O=m.getColumn("B"),T=m.getColumn("C"),q=m.getColumn("D"),I=m.getColumn("E"),X=m.getColumn("F"),$=m.getColumn("G"),w=m.getColumn("H"),V=m.getColumn("I"),G=m.getColumn("J"),U=m.getColumn("K"),z=m.getColumn("L"),Q=m.getColumn("M");f.alignment=r.alignment=_.alignment={vertical:"middle",horizontal:"center",wrapText:!0},p.alignment=v.alignment=b.alignment=D.alignment=u.alignment={vertical:"middle",horizontal:"left",wrapText:!1},f.border=r.border=p.border=h.border=v.border=c.border=b.border=y.border=D.border=x.border=u.border=R.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},f.value=sg,r.value=rg,c.value=o[0].clinic,y.value=e,h.value=o[0].district,x.value=l,R.value=n,p.value="Unidade Sanit\xE1ria",v.value="Distrito",b.value="Prov\xEDncia",D.value="Data In\xEDcio",u.value="Data Fim",m.mergeCells("A9:M10"),m.mergeCells("B11:K11"),m.mergeCells("B12:D12"),m.mergeCells("F12:K12"),m.mergeCells("A13:K13"),_.height=30,N.width=20,O.width=20,T.width=30,q.width=10,I.width=15,X.width=20,$.width=20,w.width=20,V.width=20,G.width=20,U.width=20,z.width=20,Q.width=20,v.font=b.font=D.font=u.font=p.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},m.addImage(g,{tl:{col:0,row:1},ext:{width:144,height:98}}),m.addTable({name:Ln,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1},{name:i==="tarv"?"Tipo TARV":"Tipo Paciente",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terap\xEAutica",totalsRowFunction:"none",filterButton:!1},{name:"Tipo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"Modo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"DATA LEVANT.",totalsRowFunction:"none",filterButton:!1},{name:"DATA PR\xD3X. LEVANT.",totalsRowFunction:"none",filterButton:!1},{name:"Sector Cl\xEDnico",totalsRowFunction:"none",filterButton:!1},{name:"Utilizador",totalsRowFunction:"none",filterButton:!1}],rows:d});const L=m.lastRow.number!==void 0?m.lastRow.number:0;for(let oe=14;oe<=L;oe++)m.getRow(oe).eachCell({includeEmpty:!0},he=>{he.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},he.alignment={vertical:"middle",horizontal:"center",wrapText:!0},oe===14&&(he.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},he.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const k=await t.xlsx.writeBuffer(),H="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",B=".xlsx",W=new Blob([k],{type:H});if(Ol.value&&!Bl.value)Ue(W,Xo+B),a.value=!1;else{const oe="HistoricoDeLevantamento.xlsx";Oe.downloadFile(oe,".xlsx",W,a)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(e[o].age),i.push(e[o].cellphone),i.push(e[o].tipoTarv),i.push(e[o].therapeuticalRegimen),i.push(e[o].dispenseType),i.push(e[o].dispenseMode),i.push(P(new Date(e[o].pickUpDate)).format("DD-MM-YYYY")),i.push(P(new Date(e[o].nexPickUpDate)).format("DD-MM-YYYY")),i.push(e[o].clinicsector),i.push(e[o].idmeduser),l.push(i),n+=1}return n=0,e=[],l}};const cg={class:"param-container"},dg="PatientHistory",ug="HISTORICO_DE_LEVANTAMENTO",gg={__name:"PatientHistory",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=e,i=S(0),a=S(0),s=S(0),d=S(""),t=Ge(S(!1)),m=Ge(S(!1)),g=S(null),f=S(!1),r=S(!1),p=(c,h)=>{h.value||ee.set(c.id,c)};Me(()=>{o.params&&D(o.params)});const v=c=>{if(d.value.remove(),c){const h=c.id;r.value=!0,ee.remove(h)}else r.value=!0,ee.remove(o.id)},b=c=>{s.value=.001,l.value?(p(c,r),C.apiInitReportProcess("historicoLevantamentoReport",c).then(h=>{setTimeout(()=>{D(c)},3e3)})):(p(c,r),je.getDataLocalDb(c),s.value=100,c.progress=100)},D=c=>{l.value&&C.getProcessingStatus("historicoLevantamentoReport",c).then(h=>{h.data.progress>.001?(s.value=h.data.progress,s.value<100?(p(c,r),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(s.value=100,c.progress=100,p(c,r))):setTimeout(()=>{D(c)},3e3)})},u=(c,h)=>{l.value?C.printReport("historicoLevantamentoReport",c,h).then(y=>{if(!y.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1,t.value=!1;else{const x=y.data[0];h==="PDF"?(t.value=!0,ot.downloadPDF(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y.data,"tarv",t)):(m.value=!0,ot.downloadExcel(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y.data,"tarv",m))}}):je.localDbGetAllByReportId(c).then(y=>{const x=y[0];h==="PDF"?ot.downloadPDF("",P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y,t):ot.downloadExcel("",P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y,m)})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",g),E("resultFromLocalStorage",f),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterDPatientHistorySection",ref:d},[f.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(g.value!==null?g.value.code:"")+": Hist\xF3rico de Levantamento ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>v(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Hist\xF3rico de Levantamento ",1)]),_:1})),ie("div",cg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:i.value,qtyProcessed:a.value,progress:s.value,reportType:ug,tabName:dg,params:e.params,clinicalService:e.selectedService,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var fg=Fe(gg,[["__scopeId","data-v-3e2b804e"]]);const mg={class:"param-container"},pg="PatientHistoryPREP",hg="HISTORICO_DE_LEVANTAMENTO_PREP",vg={__name:"PatientHistory",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,l.value?(r(u,f),C.apiInitReportProcess("historicoLevantamentoReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})):(r(u,f),je.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("historicoLevantamentoReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c)=>{l.value?C.printReport("historicoLevantamentoReport",u,c).then(h=>{if(!h.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),d.value=!1,t.value=!1;else{const y=h.data[0];c==="PDF"?(d.value=!0,ot.downloadPDF(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"prep",d)):(t.value=!0,ot.downloadExcel(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"prep",t))}}):je.localDbGetAllByReportId(u).then(h=>{const y=h[0];c==="PDF"?ot.downloadPDF("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,"",d):ot.downloadExcel("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,"",t)})};return E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDPatientHistorySection",ref:s},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Hist\xF3rico de Levantamento ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Hist\xF3rico de Levantamento ",1)]),_:1})),ie("div",mg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,progress:a.value,reportType:hg,tabName:pg,params:e.params,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var Dg=Fe(vg,[["__scopeId","data-v-eca81d16"]]);const bg={class:"param-container"},Sg="PatientHistoryTPT",yg="HISTORICO_DE_LEVANTAMENTO_TPT",wg={__name:"PatientHistory",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,l.value?(r(u,f),C.apiInitReportProcess("historicoLevantamentoReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})):(r(u,f),je.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("historicoLevantamentoReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c)=>{l.value?C.printReport("historicoLevantamentoReport",u,c).then(h=>{if(!h.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const y=h.data[0];c==="PDF"?(d.value=!0,ot.downloadPDF(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"tpt",d)):(t.value=!0,ot.downloadExcel(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"tpt",t),t.value=!1)}}):je.localDbGetAllByReportId(u).then(h=>{const y=h[0];c==="PDF"?ot.downloadPDF("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,"",d):(ot.downloadExcel("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,"",t),t.value=!1)})};return E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDPatientHistorySection",ref:s},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Hist\xF3rico de Levantamento ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Hist\xF3rico de Levantamento ",1)]),_:1})),ie("div",bg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,progress:a.value,reportType:yg,tabName:Sg,params:e.params,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var Rg=Fe(wg,[["__scopeId","data-v-5301ca26"]]);const Cg=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Ll="Registos De Erro Na Interroperabilidade Com Openmrs",kn="NotSynchronizedPack",kl=kn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Vl={async downloadPDF(e){let l={};const n=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),o=new Image;o.src="data:image/png;base64,"+le;const i=n.internal.pageSize.getWidth();n.setProperties({title:kl.concat(".pdf")});const a=["NID","Uuid Paciente","Data Levant.","Data Pr\xF3x. Levant.","Data Registo","Mensagem De Erro","Servi\xE7o Cl\xEDnico"],s=await C.printReportOther("notSynchronizingPacksOpenMrsReport",e.id);if(s.status===204)return s.status;l=s.data[0],e.startDateParam=C.getFormatDDMMYYYY(l.startDate),e.endDateParam=C.getFormatDDMMYYYY(l.endDate);const d=this.createArrayOfArrayRow(s.data);K(n,{margin:{top:60},bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle"},didDrawPage:function(t){n.setFontSize(10),n.setTextColor(40),n.addImage(o,"PNG",t.settings.margin.left+15,5,25,25),n.text("REP\xDABLICA DE MO\xC7AMBIQUE",t.settings.margin.left+2,35),n.text("MINIST\xC9RIO DA SA\xDADE",t.settings.margin.left+7,40),n.text("SERVI\xC7O NACIONAL DE SA\xDADE",t.settings.margin.left,45),n.setFontSize(16),n.text(Ll,i/2,40,{align:"center"}),n.setFontSize(10),n.text("Unidade Sanitaria: "+e.clinic.clinicName,i/15,57),n.text("Periodo: "+e.startDateParam+" \xE0 "+e.endDateParam,i/2+90,57)},theme:"grid",head:[a],body:d}),window.open(n.output("bloburl"))},async downloadExcel(e){let l={};const n=await C.printReportOther("notSynchronizingPacksOpenMrsReport",e.id);if(n.status===204)return n.status;l=n.data[0],e.startDateParam=C.getFormatDDMMYYYY(l.startDate),e.endDateParam=C.getFormatDDMMYYYY(l.endDate);const o=this.createArrayOfArrayRow(n.data),i=new xe.exports.Workbook;i.creator="FGH",i.lastModifiedBy="FGH",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addWorksheet(kn),s=i.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),d=a.getCell("A8"),t=a.getCell("A9"),m=a.getCell("A11"),g=a.getCell("A12"),f=a.getCell("D12"),r=a.getCell("G11"),p=a.getCell("G12"),v=a.getCell("B11"),b=a.getCell("B12"),D=a.getCell("E12"),u=a.getCell("H11"),c=a.getCell("H12"),h=a.getRow(14),y=a.getColumn("A"),x=a.getColumn("B"),R=a.getColumn("C"),_=a.getColumn("D"),N=a.getColumn("E"),O=a.getColumn("F"),T=a.getColumn("G"),q=a.getColumn("H"),I=a.getColumn("I");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=Cg,t.value=Ll,v.value=e.clinic!==null?e.clinic.clinicName:"",u.value=P(e.startDateParam,"DD-MM-YYYY").format("DD-MM-YYYY"),c.value=P(e.endDateParam,"DD-MM-YYYY").format("DD-MM-YYYY"),m.value="Farm\xE1cia",r.value="Data In\xEDcio",p.value="Data Fim",a.mergeCells("A1:A7"),a.mergeCells("A9:H10"),a.mergeCells("B11:F11"),a.mergeCells("B12:C12"),a.mergeCells("E12:F12"),a.mergeCells("A13:H13"),h.height=30,y.width=30,x.width=30,R.width=10,_.width=15,N.width=25,O.width=25,T.width=15,q.width=15,I.width=25,t.font=g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},a.addImage(s,{tl:{col:0,row:1},ext:{width:144,height:98}}),a.addTable({name:kn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Uuid Paciente",totalsRowFunction:"none",filterButton:!1},{name:"Data Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data Pr\xF3x. Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data Registo",totalsRowFunction:"none",filterButton:!1},{name:"Mensagem De Erro",totalsRowFunction:"none",filterButton:!1},{name:"Servico Clinico",totalsRowFunction:"none",filterButton:!1}],rows:o});const $=a.lastRow.number!==void 0?a.lastRow.number:0;for(let z=14;z<=$;z++)a.getRow(z).eachCell({includeEmpty:!0},Z=>{Z.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Z.alignment={vertical:"middle",horizontal:"center",wrapText:!0},z==14&&(Z.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Z.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const w=await i.xlsx.writeBuffer(),V="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",G=".xlsx",U=new Blob([w],{type:V});_e.exports.saveAs(U,kl+G)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].patient),o.push(this.getFormatDDMMYYYY(e[n].pickupDate)),o.push(e[n].returnPickupDate!==null&&e[n].returnPickupDate!==void 0?this.getFormatDDMMYYYY(e[n].returnPickupDate):" - "),o.push(this.getFormatDDMMYYYY(e[n].dateCreated)),o.push(e[n].errorDescription),o.push(e[n].clinicalService),l.push(o)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const xg={class:"param-container"},Pg="NotSynchronizedPack",Ag="DISPENSAS_NAO_SINCRONIZADAS",Fg={__name:"NotSynchronizedPack",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=S(!1),g=S(!1);Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{r(u,f),a.value=.001,C.apiInitReportProcess("notSynchronizingPacksOpenMrsReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})},b=u=>{C.getProcessingStatus("notSynchronizingPacksOpenMrsReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Vl.downloadPDF(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1}):Vl.downloadExcel(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Dispensas N\xE3o Sicronizadas ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Dispensas N\xE3o Sicronizadas ",1)]),_:1})),ie("div",xg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:Ag,tabName:Pg,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},Eg=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,zl="Lista de Possiveis Pacientes duplicados",Vn="PossiblePatientDuplicates",_l=Vn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Ul={async downloadPDF(e){const l=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),n=new Image;n.src="data:image/png;base64,"+le;const o=l.internal.pageSize.getWidth();l.setProperties({title:_l.concat(".pdf")});const i=["NID","Nome Completo","Data de Nascimento","Genero","Vezes Contadas"],a=await C.printReportOther("possiblePatientDuplicatesReport",e.id);if(a.status===204)return a.status;a.data[0];const s=this.createArrayOfArrayRow(a.data);K(l,{margin:{top:60},bodyStyles:{halign:"center"},headStyles:{halign:"center",valign:"middle"},didDrawPage:function(d){l.setFontSize(10),l.setTextColor(40),l.addImage(n,"PNG",d.settings.margin.left+15,5,25,25),l.text("REP\xDABLICA DE MO\xC7AMBIQUE",d.settings.margin.left+2,35),l.text("MINIST\xC9RIO DA SA\xDADE",d.settings.margin.left+7,40),l.text("SERVI\xC7O NACIONAL DE SA\xDADE",d.settings.margin.left,45),l.setFontSize(16),l.text(zl,o/2,40,{align:"center"}),l.setFontSize(10),l.text("Unidade Sanitaria: "+e.clinic.clinicName,o/15,57)},theme:"grid",head:[i],body:s}),window.open(l.output("bloburl"))},async downloadExcel(e){const l=await C.printReportOther("possiblePatientDuplicatesReport",e.id);if(l.status===204)return l.status;l.data[0];const n=this.createArrayOfArrayRow(l.data),o=new xe.exports.Workbook;o.creator="FGH",o.lastModifiedBy="FGH",o.created=new Date,o.modified=new Date,o.lastPrinted=new Date;const i=o.addWorksheet(Vn),a=o.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),s=i.getCell("A8"),d=i.getCell("A9"),t=i.getCell("A11"),m=i.getCell("A12"),g=i.getCell("D12"),f=i.getCell("G11"),r=i.getCell("G12"),p=i.getCell("B11"),v=i.getCell("B12"),b=i.getCell("E12"),D=i.getCell("H11"),u=i.getCell("H12"),c=i.getRow(14),h=i.getColumn("A"),y=i.getColumn("B"),x=i.getColumn("C"),R=i.getColumn("D"),_=i.getColumn("E"),N=i.getColumn("F"),O=i.getColumn("G"),T=i.getColumn("H"),q=i.getColumn("I");s.alignment=d.alignment=c.alignment={vertical:"middle",horizontal:"center",wrapText:!0},t.alignment=m.alignment=g.alignment=f.alignment=r.alignment={vertical:"middle",horizontal:"left",wrapText:!1},s.border=d.border=t.border=v.border=m.border=p.border=g.border=b.border=f.border=D.border=r.border=u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},s.value=Eg,d.value=zl,p.value=e.clinic!==null?e.clinic.clinicName:"",t.value="Farm\xE1cia",i.mergeCells("A1:A7"),i.mergeCells("A9:H10"),i.mergeCells("B11:F11"),i.mergeCells("B12:C12"),i.mergeCells("E12:F12"),i.mergeCells("A13:H13"),c.height=30,h.width=30,y.width=30,x.width=10,R.width=15,_.width=25,N.width=25,O.width=15,T.width=15,q.width=25,d.font=m.font=g.font=f.font=r.font=t.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},i.addImage(a,{tl:{col:0,row:1},ext:{width:144,height:98}}),i.addTable({name:Vn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowFunction:"none",filterButton:!1},{name:"Nome Completo",totalsRowFunction:"none",filterButton:!1},{name:"Data de Nascimento",totalsRowFunction:"none",filterButton:!1},{name:"Genero",totalsRowFunction:"none",filterButton:!1},{name:"Vezes Contadas",totalsRowFunction:"none",filterButton:!1}],rows:n});const X=i.lastRow.number!==void 0?i.lastRow.number:0;for(let U=14;U<=X;U++)i.getRow(U).eachCell({includeEmpty:!0},Q=>{Q.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Q.alignment={vertical:"middle",horizontal:"center",wrapText:!0},U==14&&(Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const $=await o.xlsx.writeBuffer(),w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=".xlsx",G=new Blob([$],{type:w});_e.exports.saveAs(G,_l+V)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].patientName),o.push(this.getFormatDDMMYYYY(e[n].dateOfBirth)),o.push(e[n].gender),o.push(e[n].numberOfTimes),l.push(o)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const Mg={class:"param-container"},Yg="PossiblePatientDuplicates",Ng="Possiveis_Pacientes_Duplicados",Tg={__name:"PossiblePatientDuplicates",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=S(!1),g=S(!1);Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{r(u,f),a.value=.001,C.apiInitReportProcess("possiblePatientDuplicatesReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})},b=u=>{C.getProcessingStatus("possiblePatientDuplicatesReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Ul.downloadPDF(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1}):Ul.downloadExcel(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Dispensas N\xE3o Sicronizadas ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Possiveis Pacientes Duplicados ",1)]),_:1})),ie("div",Mg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:Ng,tabName:Yg,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},Ig=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,$l="Lista de Pacientes Registados \xE0 partir do iDMED",zn="Registados_no _iDMED",Hl=zn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Gl={async downloadPDF(e){const l=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),n=new Image;n.src="data:image/png;base64,"+le;const o=l.internal.pageSize.getWidth();l.setProperties({title:Hl.concat(".pdf")});const i=["NID","Nome ","Apelido","Data de Nascimento","Genero","Data de Registo"],a=await C.printReportOther("registeredInIdmedReport",e.id);if(a.status===204)return a.status;a.data[0];const s=this.createArrayOfArrayRow(a.data);K(l,{margin:{top:60},bodyStyles:{halign:"center"},headStyles:{halign:"center",valign:"middle"},didDrawPage:function(d){l.setFontSize(10),l.setTextColor(40),l.addImage(n,"PNG",d.settings.margin.left+15,5,25,25),l.text("REP\xDABLICA DE MO\xC7AMBIQUE",d.settings.margin.left+2,35),l.text("MINIST\xC9RIO DA SA\xDADE",d.settings.margin.left+7,40),l.text("SERVI\xC7O NACIONAL DE SA\xDADE",d.settings.margin.left,45),l.setFontSize(16),l.text($l,o/2,40,{align:"center"}),l.setFontSize(10),l.text("Unidade Sanitaria: "+e.clinic.clinicName,o/15,57)},theme:"grid",head:[i],body:s}),window.open(l.output("bloburl"))},async downloadExcel(e){const l=await C.printReportOther("registeredInIdmedReport",e.id);if(l.status===204)return l.status;l.data[0];const n=this.createArrayOfArrayRow(l.data),o=new xe.exports.Workbook;o.creator="FGH",o.lastModifiedBy="FGH",o.created=new Date,o.modified=new Date,o.lastPrinted=new Date;const i=o.addWorksheet(zn),a=o.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),s=i.getCell("A8"),d=i.getCell("A9"),t=i.getCell("A11"),m=i.getCell("A12"),g=i.getCell("D12"),f=i.getCell("G11"),r=i.getCell("G12"),p=i.getCell("B11"),v=i.getCell("B12"),b=i.getCell("E12"),D=i.getCell("H11"),u=i.getCell("H12"),c=i.getRow(14),h=i.getColumn("A"),y=i.getColumn("B"),x=i.getColumn("C"),R=i.getColumn("D"),_=i.getColumn("E"),N=i.getColumn("F"),O=i.getColumn("G"),T=i.getColumn("H"),q=i.getColumn("I");s.alignment=d.alignment=c.alignment={vertical:"middle",horizontal:"center",wrapText:!0},t.alignment=m.alignment=g.alignment=f.alignment=r.alignment={vertical:"middle",horizontal:"left",wrapText:!1},s.border=d.border=t.border=v.border=m.border=p.border=g.border=b.border=f.border=D.border=r.border=u.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},s.value=Ig,d.value=$l,p.value=e.clinic!==null?e.clinic.clinicName:"",f.value="Data In\xEDcio",r.value="Data Fim",t.value="Unidade Sanitaria",i.mergeCells("A1:A7"),i.mergeCells("A9:H10"),i.mergeCells("B11:F11"),i.mergeCells("B12:C12"),i.mergeCells("E12:F12"),i.mergeCells("A13:H13"),c.height=30,h.width=30,y.width=30,x.width=10,R.width=15,_.width=25,N.width=25,O.width=15,T.width=15,q.width=25,d.font=m.font=g.font=f.font=r.font=t.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},i.addImage(a,{tl:{col:0,row:1},ext:{width:144,height:98}}),i.addTable({name:zn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowFunction:"none",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Apelido",totalsRowFunction:"none",filterButton:!1},{name:"Data de Nascimento",totalsRowFunction:"none",filterButton:!1},{name:"Genero",totalsRowFunction:"none",filterButton:!1},{name:"Data de Cria\xE7\xE3o",totalsRowFunction:"none",filterButton:!1}],rows:n});const X=i.lastRow.number!==void 0?i.lastRow.number:0;for(let U=14;U<=X;U++)i.getRow(U).eachCell({includeEmpty:!0},Q=>{Q.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},Q.alignment={vertical:"middle",horizontal:"center",wrapText:!0},U==14&&(Q.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},Q.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const $=await o.xlsx.writeBuffer(),w="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",V=".xlsx",G=new Blob([$],{type:w});_e.exports.saveAs(G,Hl+V)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(e[n].firstName),o.push(e[n].lastName),o.push(this.getFormatDDMMYYYY(e[n].dateOfBirth)),o.push(e[n].gender),o.push(this.getFormatDDMMYYYY(e[n].creationDate)),l.push(o)}return l},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")}};const Bg={class:"param-container"},Og="RegisteredInIdmed",Lg="Registados_no_iDMED",kg={__name:"RegisteredInIdmed",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=S(!1),g=S(!1);Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{r(u,f),a.value=.001,C.apiInitReportProcess("registeredInIdmedReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})},b=u=>{C.getProcessingStatus("registeredInIdmedReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?Gl.downloadPDF(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1}):Gl.downloadExcel(h).then(y=>{y===204&&l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Pacientes Registados \xE0 partir do iDMED ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Pacientes Registados \xE0 partir do iDMED ",1)]),_:1})),ie("div",Bg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:Lg,tabName:Og,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},{isMobile:ql,isOnline:Wl}=ce(),_n="PacientesComRastreioTB",Vg=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,zg="Lista de Pacientes Com rastreio de TB",Jo=_n.concat("_"+P(new Date).format("DD-MM-YYYY"));var Ql={async downloadPDF(e,l,n,o,i){const a=await Xe(Je),s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});d.addFileToVFS("NotoSans-Regular.ttf",a.split(",")[1]),d.addFont("NotoSans-Regular.ttf","NotoSans","normal"),d.setFont("NotoSans");const t=o[0];d.setProperties({title:Jo.concat(".pdf")});const m=new Image;m.src="data:image/png;base64,"+le;const g=[[{content:"Lista de Pacientes Com rastreio de TB",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" a "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+t.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+t.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:g}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(m,"png",28,15,10,10);const f=["ORD","NID","Nome","Sexo","Idade","Data de criacao","Unidade Sanitaria","Suspeito"],r=o,p=[];let v=1;for(const b in r){const D=[];D.push(v),D.push(r[b].nid),D.push(r[b].name),D.push(r[b].gender),D.push(r[b].age),D.push(P(new Date(r[b].dateRegister)).format("DD-MM-YYYY")),D.push(r[b].clinic),D.push(r[b].wasTBScreened),p.push(D),v+=1}if(v=0,K(d,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:14},1:{cellWidth:45},2:{cellWidth:40},3:{cellWidth:30},4:{cellWidth:25},5:{cellWidth:40},6:{cellWidth:40},7:{cellWidth:35}},didDrawPage:function(b){const D="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const u=d.internal.pageSize,c=u.height?u.height:u.getHeight();d.text(D,b.settings.margin.right,c-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[f],body:p}),Wl.value&&!ql.value)window.open(d.output("bloburl")),i.value=!1;else{const b=d.output();Oe.downloadFile(Jo,".pdf",b,i)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(_n),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getRow(15),_=t.getColumn("A"),N=t.getColumn("B"),O=t.getColumn("C"),T=t.getColumn("D"),q=t.getColumn("E"),I=t.getColumn("F"),X=t.getColumn("G"),$=t.getColumn("H"),w=t.getColumn("I"),V=t.getColumn("J");g.alignment=f.alignment=R.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Vg,f.value=zg,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=l,x.value=n,r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A13:I13"),R.height=30,_.width=20,N.width=20,O.width=30,T.width=15,q.width=20,I.width=15,X.width=15,$.width=15,w.width=15,V.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:_n,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Sexo",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data de criacao",totalsRowFunction:"none",filterButton:!1},{name:"Unidade Sanitaria",totalsRowFunction:"none",filterButton:!1},{name:"Suspeito",totalsRowFunction:"none",filterButton:!1}],rows:s});const U=t.lastRow.number!==void 0?t.lastRow.number:0;for(let k=14;k<=U;k++)t.getRow(k).eachCell({includeEmpty:!0},B=>{B.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},B.alignment={vertical:"middle",horizontal:"center",wrapText:!0},k===14&&(B.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},B.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const z=await d.xlsx.writeBuffer(),Q="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Z=".xlsx",L=new Blob([z],{type:Q});if(Wl.value&&!ql.value)Ue(L,Jo+Z),i.value=!1;else{const k="TBScreening.xlsx";Oe.downloadFile(k,".xlsx",L,i)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].name),i.push(e[o].gender),i.push(e[o].age),i.push(P(new Date(e[o].dateRegister)).format("DD-MM-YYYY")),i.push(e[o].clinic),i.push(e[o].wasTBScreened),l.push(i),n+=1}return n=0,e=[],l}};const jl=We[Et.entity],{idadeCalculator:oo}=yo();var gt={async getDataLocalDbForPregnancyScreening(e){const l=Ve.determineStartEndDate(e),[n]=await Promise.all([vt.getAllByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n)if(o.pregnancyScreenings.length>0){const i=new Et,a=P(e.endDate).format("YYYY-MM-DD"),s=P(e.startDate).format("YYYY-MM-DD"),d=await Mt.getPatientByIdMobile(o.patient.id);let t=d.identifiers[0];i.reportId=l.id,i.startDate=s,i.endDate=a,i.year=l.year,i.id=He(),t&&(i.nid=t.value,i.firstNames=d.firstNames,i.middleNames=d.middleNames,i.lastNames=d.lastNames,i.cellphone=d.cellphone,i.gender=d.gender,i.age=oo(d.dateOfBirth),i.visitDate=o.visitDate,i.clinic=o.clinic,o.pregnancyScreenings[0].pregnant===!0?i.isPregnant="Sim":i.isPregnant="N\xE3o",this.localDbAddOrUpdate(i),console.log(i))}},async getDataLocalDbMonitoredForAdherence(e){const l=Ve.determineStartEndDate(e),[n]=await Promise.all([vt.getAllByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n)if(o.adherenceScreenings.length>0){const i=new Et,a=P(e.endDate).format("YYYY-MM-DD"),s=P(e.startDate).format("YYYY-MM-DD");i.reportId=l.id,i.startDate=s,i.endDate=a,i.year=l.year,i.id=He();const d=await Mt.getPatientByIdMobile(o.patient.id);let t=d.identifiers[0];t&&(i.nid=t.value,i.firstNames=d.firstNames,i.middleNames=d.middleNames,i.lastNames=d.lastNames,i.cellphone=d.cellphone,i.gender=d.gender,i.age=oo(d.dateOfBirth),i.visitDate=o.visitDate,i.clinic=o.clinic,this.localDbAddOrUpdate(i),console.log(i))}},async getDataLocalDbForTBScreening(e){const l=Ve.determineStartEndDate(e),[n]=await Promise.all([vt.getAllByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.tbScreenings.length>0?o.tbScreenings[0]:[],a=new Et;if(o.tbScreenings.length>0){const s=await Mt.getPatientByIdMobile(o.patient.id);let d=s.identifiers[0];d||(d=(await pn.getAllMobileByPatientId(o.patient.id))[0]),a.id=He(),a.nid=d.value,a.name=s.firstNames+" "+s.middleNames+" "+s.lastNames,a.age=oo(s.dateOfBirth),a.gender=s.gender,a.dateRegister=o.visitDate,a.clinic=de.getById(o.clinic.id).clinicName,a.reportId=l.id,a.year=l.year,a.endDate=l.endDate,a.startDate=l.startDate,i.cough===!0||i.fever===!0||i.losingWeight===!0||i.sweating===!0||i.fatigueOrTirednessLastTwoWeeks===!0?a.wasTBScreened="Sim":a.wasTBScreened="N\xE3o",this.localDbAddOrUpdate(a)}}},async getDataLocalDbRAM(e){const l=Ve.determineStartEndDate(e);console.log(l);const[n]=await Promise.all([vt.getAllByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.ramScreenings.length>0?o.ramScreenings[0]:[],a=new Et;if(o.ramScreenings.length>0){const s=await Mt.getPatientByIdMobile(o.patient.id);let d=s.identifiers[0];d||(d=(await pn.getAllMobileByPatientId(o.patient.id))[0]),a.id=He(),a.nid=d.value,a.name=s.firstNames+" "+s.middleNames+" "+s.lastNames,a.age=oo(s.dateOfBirth),a.gender=s.gender,a.dateRegister=o.visitDate,a.clinic=de.getById(o.clinic.id).clinicName,a.reportId=l.id,a.year=l.year,a.endDate=l.endDate,a.startDate=l.startDate,i.adverseReactionMedicine===!0||i.adverseReactionMedicine==="true"?a.wasRAMScreened="Sim":a.wasRAMScreened="N\xE3o",this.localDbAddOrUpdate(a)}}},localDbAddOrUpdate(e){return jl.add(e).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return jl.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const _g={class:"param-container"},Xl="TBScreening",Ug="TB_SCREENING",$g={__name:"TBScreening",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=Ge(S(!1)),t=Ge(S(!1)),m=S(!1),g=u=>{if(s.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},f=S(null),r=S(!1),p=(u,c)=>{c.value||ee.set(u.id,u)},v=async u=>{a.value=.001,l.value||(gt.getDataLocalDbForTBScreening(u),a.value=100,u.progress=100,p(u,m))},b=u=>{C.getProcessingStatus("TBScreening",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(p(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,p(u,m))):setTimeout(()=>{b(u)},3e3)})},D=async(u,c)=>{if(!l.value){const h=await gt.localDbGetAllByReportId(u);if(h.length===0)n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const y=h[0];c==="PDF"?Ql.downloadPDF(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,d):Ql.downloadExcel(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,t)}}};return Me(()=>{console.log(Xl)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",f),E("resultFromLocalStorage",r),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterTbScreeningSection",ref:s},[r.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(f.value!==null?f.value.code:"")+": Rastreio de pacietes de TB ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Rastreio de pacietes de TB ",1)]),_:1})),ie("div",_g,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:Ug,progress:a.value,tabName:Xl,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var Hg=Fe($g,[["__scopeId","data-v-195f5994"]]);const{isMobile:Jl,isOnline:Kl}=ce(),Un="PacientesComRastreioRAM",Gg=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,qg="Lista de Pacientes Com rastreio de RAM",Ko=Un;var Zl={async downloadPDF(e,l,n,o,i){const a=await Xe(Je),s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=o[0];d.addFileToVFS("NotoSans-Regular.ttf",a.split(",")[1]),d.addFont("NotoSans-Regular.ttf","NotoSans","normal"),d.setFont("NotoSans"),d.setProperties({title:Ko.concat(".pdf")});const m=new Image;m.src="data:image/png;base64,"+le;const g=[[{content:"Lista de Pacientes Com rastreio de RAM",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" a "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+t.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+t.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:g}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde",16,36),d.addImage(m,"png",28,15,10,10);const f=["ORD","NID","Nome","Sexo","Idade","Data de cria\xE7\xE3o","Unidade Sanit\xE1ria","Suspeito"],r=o,p=[];let v=1;for(const b in r){const D=[];D.push(v),D.push(r[b].nid),D.push(r[b].name),D.push(r[b].gender),D.push(r[b].age),D.push(P(new Date(r[b].dateRegister)).format("DD-MM-YYYY")),D.push(r[b].clinic),D.push(r[b].wasRAMScreened),p.push(D),v+=1}if(v=0,K(d,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:14},1:{cellWidth:45},2:{cellWidth:40},3:{cellWidth:30},4:{cellWidth:25},5:{cellWidth:40},6:{cellWidth:40},7:{cellWidth:35}},didDrawPage:function(b){const D="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const u=d.internal.pageSize,c=u.height?u.height:u.getHeight();d.text(D,b.settings.margin.right,c-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[f],body:p}),Kl.value&&!Jl.value)window.open(d.output("bloburl")),i.value=!1;else{const b=d.output();Oe.downloadFile(Ko,".pdf",b,i)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Un),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getRow(15),_=t.getColumn("A"),N=t.getColumn("B"),O=t.getColumn("C"),T=t.getColumn("D"),q=t.getColumn("E"),I=t.getColumn("F"),X=t.getColumn("G"),$=t.getColumn("H"),w=t.getColumn("I"),V=t.getColumn("J");g.alignment=f.alignment=R.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Gg,f.value=qg,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=l,x.value=n,r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A13:I13"),R.height=30,_.width=20,N.width=20,O.width=30,T.width=15,q.width=20,I.width=15,X.width=15,$.width=15,w.width=15,V.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Un,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Sexo",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data de criacao",totalsRowFunction:"none",filterButton:!1},{name:"Unidade Sanitaria",totalsRowFunction:"none",filterButton:!1},{name:"Suspeito",totalsRowFunction:"none",filterButton:!1}],rows:s});const U=t.lastRow.number!==void 0?t.lastRow.number:0;for(let k=14;k<=U;k++)t.getRow(k).eachCell({includeEmpty:!0},B=>{B.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},B.alignment={vertical:"middle",horizontal:"center",wrapText:!0},k===14&&(B.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},B.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const z=await d.xlsx.writeBuffer(),Q="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Z=".xlsx",L=new Blob([z],{type:Q});if(Kl.value&&!Jl.value)Ue(L,Ko+Z),i.value=!1;else{const k="RAMScreening.xlsx";Oe.downloadFile(k,".xlsx",L,i)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].name),i.push(e[o].gender),i.push(e[o].age),i.push(P(new Date(e[o].dateRegister)).format("DD-MM-YYYY")),i.push(e[o].clinic),i.push(e[o].wasRAMScreened),l.push(i),n+=1}return n=0,e=[],l}};const Wg={class:"param-container"},ei="TBScreening",Qg="TB_SCREENING",jg={__name:"RAMScreening",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=Ge(S(!1)),t=Ge(S(!1)),m=S(!1),g=u=>{if(s.value.remove(),u){const c=u.id;m.value=!0,ee.remove(c)}},f=S(null),r=S(!1),p=(u,c)=>{c.value||ee.set(u.id,u)},v=async u=>{a.value=.001,l.value||(gt.getDataLocalDbRAM(u),a.value=100,u.progress=100,p(u,m))},b=u=>{C.getProcessingStatus("TBScreening",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(p(u,m),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,p(u,m))):setTimeout(()=>{b(u)},3e3)})},D=async(u,c)=>{if(!l.value){const h=await gt.localDbGetAllByReportId(u);if(h.length===0)n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const y=h[0];c==="PDF"?Zl.downloadPDF(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,d):Zl.downloadExcel(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h,t)}}};return Me(()=>{console.log(ei)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",f),E("resultFromLocalStorage",r),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterTbScreeningSection",ref:s},[r.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(f.value!==null?f.value.code:"")+": Rastreio de pacientes de RAM ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>g(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Rastreio de pacientes de RAM ",1)]),_:1})),ie("div",Wg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:Qg,progress:a.value,tabName:ei,params:e.params,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var Xg=Fe(jg,[["__scopeId","data-v-4522b9ad"]]);const ti=Hi.entity;var $n={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);const n=await vt.getLocalDbPatientVisitsBetweenDates(e.startDate,e.endDate);console.log(n);const o=this.groupAndSumByDrugFromPatientVisits(n);console.log(o),Object.values(o).forEach(async i=>{const a=new Hi,s=P(e.endDate).format("YYYY-MM-DD"),d=P(e.startDate).format("YYYY-MM-DD");a.reportId=l.id,a.startDate=d,a.endDate=s,a.year=l.year,a.id=He();const t=await wo.getMobileDrugById(i.drug_id);a.drugName=t.name,a.bottles_packed=i.quantitySupplied,this.localDbAddOrUpdate(a),console.log(a)})},localDbAddOrUpdate(e){return We[ti].add(e).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return We[ti].where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)},idadeCalculator(e){if(P(e,"YYYY/MM/DDDD").isValid()){const l=P(e,"YYYY/MM/DDDD"),o=P(new Date).diff(l,"years");return console.log(o),o}},groupAndSumByDrugFromPatientVisits(e){return e.reduce((l,n)=>(n.patientVisitDetails.forEach(o=>{o.pack.packagedDrugs.forEach(i=>{const{drug_id:a,quantitySupplied:s}=i;l[a]||(l[a]={drug_id:a,quantitySupplied:0}),l[a].quantitySupplied+=parseFloat(s)})}),l),{})}};ce();const po="DispensasPorFrascos",Jg=`REPUBLICA DE MO\xC7AMBIQUE 
 MINISTERIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SAUDE`,Kg="Relatorio Estatistico de Dispensas Por Frasco",oi=po.concat("_"+P(new Date).format("DD-MM-YYYY")),as=new Image;as.src="data:image/png;base64,"+le;var ni={async downloadPDF(e,l){const n=new Ce({orientation:"l",unit:"mm",format:[205,313],putOnlyUsedFonts:!0,floatPrecision:"smart"}),o=await $n.localDbGetAllByReportId(e.id);console.log(e),console.log(o[0]);const i=o[0];if(o.length===0)return 204;n.setProperties({title:oi.concat(".pdf")});const a=[[{content:"Relatorio Estatistico de Dispensas Por Frasco",styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Sector Clinic: "+e.clinic.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Periodo: "+e.startDate+" a "+e.endDate,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+i.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Provincia: "+i.province,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+i.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(n,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:a}),n.setFontSize(8),n.text("Republica de Mocambique ",16,28),n.text("Ministerio da Saude ",20,32),n.text("Servi\xE7o Nacional de Saude ",16,36),n.addImage(as,"png",28,15,10,10);const s=["Medicamento","Total de Frascos Dispensados"],d=o,t=[];for(const g in d){const f=[];f.push(d[g].drugName),f.push(d[g].bottles_packed),t.push(f)}K(n,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:100},1:{cellWidth:50}},didDrawPage:function(g){const f="P\xE1gina "+n.internal.getNumberOfPages();n.setFontSize(8);const r=n.internal.pageSize,p=r.height?r.height:r.getHeight();n.text(f,g.settings.margin.right,p-10)},startY:n.lastAutoTable.finalY,theme:"grid",head:[s],body:t}),console.log(n);const m=n.output();Oe.downloadFile(oi,".pdf",m,l)},async downloadExcel(e,l){const n=await $n.localDbGetAllByReportId(e.id),o=n;if(n.length===0)return 204;const i=this.createArrayOfArrayRow(o);console.log(i);const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(po),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("E12"),p=s.getCell("L11"),v=s.getCell("L12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("F12"),c=s.getCell("M11"),h=s.getCell("M12"),y=s.getRow(15),x=s.getColumn("A"),R=s.getColumn("B");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=Jg,m.value=Kg,b.value=n[0].clinic,u.value="",D.value=n[0].district,c.value=e.startDate,h.value=e.endDate,g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:M10"),s.mergeCells("B11:K11"),s.mergeCells("B12:D12"),s.mergeCells("F12:K12"),s.mergeCells("A13:K13"),y.height=30,x.width=70,R.width=70,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:po,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Medicamento",totalsRowLabel:"none",filterButton:!1},{name:"Total de Frascos Dispensados",totalsRowLabel:"Totals:",filterButton:!1}],rows:i});const N=s.lastRow.number!==void 0?s.lastRow.number:0;for(let I=14;I<=N;I++)s.getRow(I).eachCell({includeEmpty:!0},$=>{$.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},$.alignment={vertical:"middle",horizontal:"center",wrapText:!0},I===14&&($.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},$.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const O=await a.xlsx.writeBuffer(),T="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",q=new Blob([O],{type:T});Oe.downloadFile(po,".xlsx",q,l)},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].drugName),o.push(e[n].bottles_packed),l.push(o)}return l}};const Zg={class:"param-container"},ef="PacksByDrugBottles",tf="PACKS_BY_BOTTLE",of={__name:"PacksByDrugBottles",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=Ge(S(!1)),g=Ge(S(!1));Me(()=>{n.params});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(console.log(n.params),s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}else f.value=!0,ee.remove(n.id)},v=u=>{r(u,f),$n.getDataLocalDb(u),a.value=100,u.progress=100},b=u=>{a.value=100,u.progress=100},D=(u,c,h)=>{c==="PDF"?ni.downloadPDF(h,m).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)}):ni.downloadExcel(h,g).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Dispensas por Frascos ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Dispensas por Frascos ",1)]),_:1})),ie("div",Zg,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:tf,tabName:ef,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},{isMobile:nf,isOnline:af}=ce(),Hn="RelatorioRastreioDeGravidez",lf=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,sf="Relatorio de Pacientes Rastreados Para Gravidez",Zo=Hn,ls=new Image;ls.src="data:image/png;base64,"+le;var ai={async downloadPDF(e,l){const n=await Xe(Je),o=new Ce({orientation:"l",unit:"mm",format:[205,313],putOnlyUsedFonts:!0,floatPrecision:"smart"});o.addFileToVFS("NotoSans-Regular.ttf",n.split(",")[1]),o.addFont("NotoSans-Regular.ttf","NotoSans","normal"),o.setFont("NotoSans");const i=await gt.localDbGetAllByReportId(e.id);if(i.length===0)return 204;i[0],o.setProperties({title:Zo.concat(".pdf")});const a=[[{content:"Relatorio de Pacientes Rastreados Para Gravidez",styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Clinica/Sector: "+e.clinic.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+e.startDate+" a "+e.endDate,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}]];K(o,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:a}),o.setFontSize(8),o.text("Rep\xFAblica de Mo\xE7ambique ",16,28),o.text("Minist\xE9rio da Sa\xFAde ",20,32),o.text("Servi\xE7o Nacional de Sa\xFAde",16,36),o.addImage(ls,"png",28,15,10,10);const s=["NID","Nome","Genero","Idade","Data da Consulta","Gravida","Unidade Sanit\xE1ria"],d=i,t=this.createArrayOfArrayRow(d);K(o,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:100},1:{cellWidth:50}},didDrawPage:function(g){const f="P\xE1gina "+o.internal.getNumberOfPages();o.setFontSize(8);const r=o.internal.pageSize,p=r.height?r.height:r.getHeight();o.text(f,g.settings.margin.right,p-10)},startY:o.lastAutoTable.finalY,theme:"grid",head:[s],body:t});const m=o.output();Oe.downloadFile(Zo,".pdf",m,l)},async downloadExcel(e,l){const n=await gt.localDbGetAllByReportId(e.id);if(n.length===0)return 204;const o=n,i=this.createArrayOfArrayRow(o),a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(Hn),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("E12"),p=s.getCell("L11"),v=s.getCell("L12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("F12"),c=s.getCell("M11"),h=s.getCell("M12"),y=s.getRow(15),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H"),X=s.getColumn("I"),$=s.getColumn("J"),w=s.getColumn("K");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=lf,m.value=sf,b.value=n[0].clinic,u.value="",D.value=n[0].district,c.value=e.startDate,h.value=e.endDate,g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:M10"),s.mergeCells("B11:K11"),s.mergeCells("B12:D12"),s.mergeCells("F12:K12"),s.mergeCells("A13:K13"),y.height=30,x.width=20,R.width=20,_.width=30,N.width=10,O.width=15,T.width=20,q.width=20,I.width=20,X.width=20,$.width=20,w.width=20,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Hn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"none",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Genero",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data da Consulta",totalsRowFunction:"none",filterButton:!1},{name:"Gravida",totalsRowFunction:"none",filterButton:!1},{name:"Unidade Sanitaria",totalsRowFunction:"none",filterButton:!1}],rows:i});const G=s.lastRow.number!==void 0?s.lastRow.number:0;for(let L=14;L<=G;L++)s.getRow(L).eachCell({includeEmpty:!0},H=>{H.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},H.alignment={vertical:"middle",horizontal:"center",wrapText:!0},L===14&&(H.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},H.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const U=await a.xlsx.writeBuffer(),z="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Q=".xlsx",Z=new Blob([U],{type:z});if(af.value&&!nf.value)Ue(Z,Zo+Q),l.value=!1;else{const L="RelatorioRastreioDeGravidez";console.log("result"+L),Oe.downloadFile(L,".xlsx",Z,l)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(String(e[n].firstNames+" "+e[n].middleNames+" "+e[n].lastNames).replaceAll("null","").replace("  "," ")),o.push(e[n].gender),o.push(e[n].age),o.push(P(new Date(e[n].visitDate)).format("DD-MM-YYYY")),o.push(e[n].isPregnant),o.push(e[n].clinic.clinicName),l.push(o)}return l}};const rf={class:"param-container"},cf="PatientWithPregnancyScreening",df="Patients_with_pregnancy_screening",uf={__name:"PatientsWithPregnancyScreening",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=S(!1),g=S(!1);Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(console.log(n.params),s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}else f.value=!0,ee.remove(n.id)},v=u=>{gt.getDataLocalDbForPregnancyScreening(u),a.value=100,u.progress=100,r(u,f)},b=u=>{a.value=100,u.progress=100},D=(u,c,h)=>{c==="PDF"?ai.downloadPDF(h,m).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)}):ai.downloadExcel(h,g).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Pacientes Com Rastreio de Gravidez ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Pacientes Com Rastreio de Gravidez ",1)]),_:1})),ie("div",rf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:df,tabName:cf,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},li=Gi.entity;var Gn={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e),[n]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.patientvisitDetails.patientVisit,a=o.patientvisitDetails.patientVisit.patient,s=o.patientvisitDetails.episode.patientServiceIdentifier,d=o.patientvisitDetails.episode.patientServiceIdentifier.service,t=o.patientvisitDetails.prescription.prescriptionDetails,m=t.length>0?t[0].therapeuticRegimen:"",g=t.length>0?t[0].dispenseType:"",f=o.dispenseMode;if(i.syncStatus==="R"){const r=new Gi;r.dispenseType=g.description,r.reportId=l.id,r.year=l.year,r.startDate=l.startDate,r.endDate=l.endDate,r.nid=s.value,r.firstNames=a.firstNames,r.middleNames=a.middleNames,r.lastNames=a.lastNames,r.cellphone=a.cellphone,r.pickUpDate=o.pickupDate,r.nexPickUpDate=o.nextPickUpDate,r.therapeuticalRegimen=m.description,r.age=this.idadeCalculator(a.dateOfBirth),r.dispenseMode=f.description,r.clinicalService=d.description,r.clinic=o.clinic.clinicName,r.id=He(),this.localDbAddOrUpdate(r),console.log(r)}}},localDbAddOrUpdate(e){return We[li].add(e).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return We[li].where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)},idadeCalculator(e){if(P(e,"YYYY/MM/DDDD").isValid()){const l=P(e,"YYYY/MM/DDDD"),o=P(new Date).diff(l,"years");return console.log(o),o}}};const{isMobile:gf,isOnline:ff}=ce(),qn="DispensasNaoSicronizadasParaServidor",mf=`REPUBLICA DE MO\xC7AMBIQUE 
 MINISTERIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SAUDE`,pf="HISTORICO DE LEVANTAMENTO",en=qn.concat("_"+P(new Date).format("DD-MM-YYYY")),is=new Image;is.src="data:image/png;base64,"+le;var ii={async downloadPDF(e,l){const n=await Xe(Je),o=new Ce({orientation:"l",unit:"mm",format:[205,313],putOnlyUsedFonts:!0,floatPrecision:"smart"});o.addFileToVFS("NotoSans-Regular.ttf",n.split(",")[1]),o.addFont("NotoSans-Regular.ttf","NotoSans","normal"),o.setFont("NotoSans");const i=await Gn.localDbGetAllByReportId(e.id);console.log(e),console.log(i[0]);const a=i[0];if(i.length===0)return 204;o.setProperties({title:en.concat(".pdf")});const s=[[{content:"LISTA DE DISPENSAS NAO SICRONIZADAS",styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Sector Clinico: "+de.currClinic().clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Periodo: "+e.startDate+" \xE0 "+e.endDate,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+a.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Provincia: "+a.province,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+a.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(o,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:s}),o.setFontSize(8),o.text("Republica de Mocambique ",16,28),o.text("Ministerio da Saude ",20,32),o.text("Servi\xE7o Nacional de Saude ",16,36),o.addImage(is,"png",28,15,10,10);const d=["ORD","NID","Nome","Idade","Contacto","Tipo TARV","Regime Terapeutica","Tipo de Dispensa","Modo de Dispensa","Data Levant.","Data Prox. Levant."],t=i,m=[];let g=1;for(const r in t){const p=[];p.push(g),p.push(t[r].nid),p.push(String(t[r].firstNames+" "+t[r].middleNames+" "+t[r].lastNames).replaceAll("null","").replace("  "," ")),p.push(t[r].age),p.push(t[r].cellphone),p.push(t[r].tipoTarv),p.push(t[r].therapeuticalRegimen),p.push(t[r].dispenseType),p.push(t[r].dispenseMode),p.push(P(new Date(t[r].pickUpDate)).format("DD-MM-YYYY")),p.push(P(new Date(t[r].nexPickUpDate)).format("DD-MM-YYYY")),m.push(p),g+=1}g=0,K(o,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:10},1:{cellWidth:35},2:{cellWidth:35},3:{cellWidth:10},4:{cellWidth:20},5:{cellWidth:20},6:{cellWidth:25},7:{cellWidth:25},8:{cellWidth:25},9:{cellWidth:20},10:{cellWidth:20},11:{cellWidth:20},12:{cellWidth:20}},didDrawPage:function(r){const p="P\xE1gina "+o.internal.getNumberOfPages();o.setFontSize(8);const v=o.internal.pageSize,b=v.height?v.height:v.getHeight();o.text(p,r.settings.margin.right,b-10)},startY:o.lastAutoTable.finalY,theme:"grid",head:[d],body:m});const f=o.output();Oe.downloadFile(en,".pdf",f,l)},async downloadExcel(e,l){const n=await Gn.localDbGetAllByReportId(e.id),o=n;if(n.length===0)return 204;const i=this.createArrayOfArrayRow(o);console.log(i);const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(qn),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("E12"),p=s.getCell("L11"),v=s.getCell("L12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("F12"),c=s.getCell("M11"),h=s.getCell("M12"),y=s.getRow(15),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H"),X=s.getColumn("I"),$=s.getColumn("J"),w=s.getColumn("K");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=mf,m.value=pf,b.value=de.currClinic().clinicName,u.value="",D.value=n[0].district,c.value=e.startDate,h.value=e.endDate,g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:M10"),s.mergeCells("B11:K11"),s.mergeCells("B12:D12"),s.mergeCells("F12:K12"),s.mergeCells("A13:K13"),y.height=30,x.width=20,R.width=20,_.width=30,N.width=10,O.width=15,T.width=20,q.width=20,I.width=20,X.width=20,$.width=20,w.width=20,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:qn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Contacto",totalsRowFunction:"none",filterButton:!1},{name:"Tipo TARV",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terap\xEAutica",totalsRowFunction:"none",filterButton:!1},{name:"Tipo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"Modo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"DATA LEVANT.",totalsRowFunction:"none",filterButton:!1},{name:"DATA PR\xD3X. LEVANT.",totalsRowFunction:"none",filterButton:!1}],rows:i});const G=s.lastRow.number!==void 0?s.lastRow.number:0;for(let L=14;L<=G;L++)s.getRow(L).eachCell({includeEmpty:!0},H=>{H.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},H.alignment={vertical:"middle",horizontal:"center",wrapText:!0},L===14&&(H.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},H.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const U=await a.xlsx.writeBuffer(),z="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Q=".xlsx",Z=new Blob([U],{type:z});if(ff.value&&!gf.value)Ue(Z,en+Q),l.value=!1;else{const L="RelatorioDeDispensasNaoSicronizadas";console.log("result"+L),Oe.downloadFile(L,".xlsx",Z,l)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(e[o].age),i.push(e[o].cellphone),i.push(e[o].tipoTarv),i.push(e[o].therapeuticalRegimen),i.push(e[o].dispenseType),i.push(e[o].dispenseMode),i.push(P(new Date(e[o].pickUpDate)).format("DD-MM-YYYY")),i.push(P(new Date(e[o].nexPickUpDate)).format("DD-MM-YYYY")),l.push(i),n+=1}return n=0,e=[],l}};const hf={class:"param-container"},vf="NotSynchronizedPackToServer",Df="PACKS_NOT_SYNCRONIZED_TO_SERVER",bf={__name:"NotSyncronizedPacksToServer",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=Ge(S(!1)),g=Ge(S(!1));Me(()=>{n.params});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{r(u,f),Gn.getDataLocalDb(u),a.value=100,u.progress=100},b=u=>{a.value=100,u.progress=100},D=(u,c,h)=>{c==="PDF"?ii.downloadPDF(h,m).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)}):ii.downloadExcel(h,g).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Dispensas N\xE3o Sicronizadas Para Servidor ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Dispensas N\xE3o Sicronizadas Para Servidor ",1)]),_:1})),ie("div",hf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:Df,tabName:vf,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},{isMobile:Sf,isOnline:yf}=ce(),Wn="RelatorioMonitoriaAdesao",wf=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Rf="Relatorio De Pacientes Monitorados a Adesao",tn=Wn.concat("_"+P(new Date).format("DD-MM-YYYY")),ss=new Image;ss.src="data:image/png;base64,"+le;var si={async downloadPDF(e,l){const n=await Xe(Je),o=new Ce({orientation:"l",unit:"mm",format:[205,313],putOnlyUsedFonts:!0,floatPrecision:"smart"}),i=await gt.localDbGetAllByReportId(e.id);if(i.length===0)return 204;o.addFileToVFS("NotoSans-Regular.ttf",n.split(",")[1]),o.addFont("NotoSans-Regular.ttf","NotoSans","normal"),o.setFont("NotoSans"),i[0],o.setProperties({title:tn.concat(".pdf")});const a=[[{content:"Relatorio de Pacientes Pacientes Monitorados a Adesao",styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Clinica/Sector: "+e.clinic.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+e.startDate+" a "+e.endDate,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}]];K(o,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:a}),o.setFontSize(8),o.text("Rep\xFAblica de Mo\xE7ambique ",16,28),o.text("Minist\xE9rio da Sa\xFAde ",20,32),o.text("Servi\xE7o Nacional de Sa\xFAde",16,36),o.addImage(ss,"png",28,15,10,10);const s=["NID","Nome","Genero","Idade","Data da Consulta","Unidade Sanit\xE1ria"],d=i,t=this.createArrayOfArrayRow(d);K(o,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:100},1:{cellWidth:50}},didDrawPage:function(g){const f="P\xE1gina "+o.internal.getNumberOfPages();o.setFontSize(8);const r=o.internal.pageSize,p=r.height?r.height:r.getHeight();o.text(f,g.settings.margin.right,p-10)},startY:o.lastAutoTable.finalY,theme:"grid",head:[s],body:t});const m=o.output();Oe.downloadFile(tn,".pdf",m,l)},async downloadExcel(e,l){const n=await gt.localDbGetAllByReportId(e.id);if(n.length===0)return 204;const o=n,i=this.createArrayOfArrayRow(o);console.log(i);const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(Wn),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("E12"),p=s.getCell("L11"),v=s.getCell("L12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("F12"),c=s.getCell("M11"),h=s.getCell("M12"),y=s.getRow(15),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H"),X=s.getColumn("I"),$=s.getColumn("J");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=wf,m.value=Rf,b.value=n[0].clinic,u.value="",D.value=n[0].district,c.value=e.startDate,h.value=e.endDate,g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:M10"),s.mergeCells("B11:K11"),s.mergeCells("B12:D12"),s.mergeCells("F12:K12"),s.mergeCells("A13:K13"),y.height=30,x.width=20,R.width=20,_.width=30,N.width=10,O.width=15,T.width=20,q.width=20,I.width=20,X.width=20,$.width=20,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:Wn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"none",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Genero",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data da Consulta",totalsRowFunction:"none",filterButton:!1},{name:"Unidade Sanitaria",totalsRowFunction:"none",filterButton:!1}],rows:i});const V=s.lastRow.number!==void 0?s.lastRow.number:0;for(let Z=14;Z<=V;Z++)s.getRow(Z).eachCell({includeEmpty:!0},k=>{k.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},k.alignment={vertical:"middle",horizontal:"center",wrapText:!0},Z===14&&(k.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},k.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const G=await a.xlsx.writeBuffer(),U="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",z=".xlsx",Q=new Blob([G],{type:U});if(yf.value&&!Sf.value)Ue(Q,tn+z),l.value=!1;else{const Z="RelatorioRastreioDeGravidez";Oe.downloadFile(Z,".xlsx",Q,l)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(String(e[n].firstNames+" "+e[n].middleNames+" "+e[n].lastNames).replaceAll("null","").replace("  "," ")),o.push(e[n].gender),o.push(e[n].age),o.push(P(new Date(e[n].visitDate)).format("DD-MM-YYYY")),o.push(e[n].clinic.clinicName),l.push(o)}return l}};const Cf={class:"param-container"},xf="PatientsMonitoredForAdherence",Pf="Patients_monitored_for_adherence",Af={__name:"PatientsMonitoredForAdherence",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=Ge(S(!1)),g=Ge(S(!1));Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(console.log(n.params),s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}else f.value=!0,ee.remove(n.id)},v=u=>{gt.getDataLocalDbMonitoredForAdherence(u),a.value=100,u.progress=100,r(u,f)},b=u=>{a.value=100,u.progress=100},D=(u,c,h)=>{c==="PDF"?si.downloadPDF(h,m).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)}):si.downloadExcel(h,g).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Pacientes Monitorados Para Ades\xE3o ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Pacientes Monitorados Para Ades\xE3o ",1)]),_:1})),ie("div",Cf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:Pf,tabName:xf,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},ri=We[qi.entity];var Qn={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e),n=de.currClinic()!==null?de.currClinic().id:"",[o]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const i of o){const a=i.patientvisitDetails.patientVisit.patient,s=i.patientvisitDetails.prescription.prescriptionDetails,d=i.patientvisitDetails.episode.patientServiceIdentifier,t=s.length>0?s[0].therapeuticRegimen:"",m=s.length>0?s[0].dispenseType:"";if(d.service.id===l.clinicalService&&n!==i.origin){const g=new qi;g.dispenseType=m.description,g.reportId=l.id,g.year=l.year,g.startDate=l.startDate,g.endDate=l.endDate,g.nid=d.value,g.firstNames=a.firstNames,g.middleNames=a.middleNames,g.lastNames=a.lastNames,g.cellphone=a.cellphone,g.pickUpDate=i.pickupDate,g.nexPickUpDate=i.nextPickUpDate,g.therapeuticalRegimen=t.description,g.dispenseMode=i.dispenseMode.description,g.clinicalService=d.service.description,g.clinic=i.clinic.clinicName,g.id=He(),this.localDbAddOrUpdate(g),console.log(g)}}},localDbAddOrUpdate(e){return ri.add(e).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return ri.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const{isMobile:Ff,isOnline:Ef}=ce(),jn="RelatorioDePacientesQueLevantaramNaUS",Mf=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Yf="Relatorio de Pacientes Que Levantaram Medicamentos na US",on=jn.concat("_"+P(new Date).format("DD-MM-YYYY")),rs=new Image;rs.src="data:image/png;base64,"+le;var ci={async downloadPDF(e,l){const n=await Xe(Je),o=new Ce({orientation:"l",unit:"mm",format:[205,313],putOnlyUsedFonts:!0,floatPrecision:"smart"});o.addFileToVFS("NotoSans-Regular.ttf",n.split(",")[1]),o.addFont("NotoSans-Regular.ttf","NotoSans","normal"),o.setFont("NotoSans");const i=await Qn.localDbGetAllByReportId(e.id);if(i.length===0)return 204;i[0],o.setProperties({title:on.concat(".pdf")});const a=[[{content:"Relatorio de Pacientes Que Levantaram Medicamentos na US",styles:{minCellHeight:25,fontSize:12,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Clinica/Sector: "+e.clinic.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+e.startDate+" a "+e.endDate,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}]];K(o,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:a}),o.setFontSize(8),o.text("Rep\xFAblica de Mo\xE7ambique ",16,28),o.text("Minist\xE9rio da Sa\xFAde ",20,32),o.text("Servi\xE7o Nacional de Sa\xFAde",16,36),o.addImage(rs,"png",28,15,10,10);const s=["NID","Nome Completo","Data de Levantamento","Data de Prox. Levantamento","Regime Terapeutico","Tipo de Dispensa","Unidade Sanit\xE1ria"],d=i,t=this.createArrayOfArrayRow(d);K(o,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:100},1:{cellWidth:50}},didDrawPage:function(g){const f="P\xE1gina "+o.internal.getNumberOfPages();o.setFontSize(8);const r=o.internal.pageSize,p=r.height?r.height:r.getHeight();o.text(f,g.settings.margin.right,p-10)},startY:o.lastAutoTable.finalY,theme:"grid",head:[s],body:t});const m=o.output();Oe.downloadFile(on,".pdf",m,l)},async downloadExcel(e,l){const n=await Qn.localDbGetAllByReportId(e.id);if(n.length===0)return 204;const o=n,i=this.createArrayOfArrayRow(o);console.log(i);const a=new xe.exports.Workbook;a.creator="FGH",a.lastModifiedBy="FGH",a.created=new Date,a.modified=new Date,a.lastPrinted=new Date;const s=a.addWorksheet(jn),d=a.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),t=s.getCell("A8"),m=s.getCell("A9"),g=s.getCell("A11"),f=s.getCell("A12"),r=s.getCell("E12"),p=s.getCell("L11"),v=s.getCell("L12"),b=s.getCell("B11"),D=s.getCell("B12"),u=s.getCell("F12"),c=s.getCell("M11"),h=s.getCell("M12"),y=s.getRow(15),x=s.getColumn("A"),R=s.getColumn("B"),_=s.getColumn("C"),N=s.getColumn("D"),O=s.getColumn("E"),T=s.getColumn("F"),q=s.getColumn("G"),I=s.getColumn("H"),X=s.getColumn("I"),$=s.getColumn("J"),w=s.getColumn("K");t.alignment=m.alignment=y.alignment={vertical:"middle",horizontal:"center",wrapText:!0},g.alignment=f.alignment=r.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},t.border=m.border=g.border=D.border=f.border=b.border=r.border=u.border=p.border=c.border=v.border=h.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},t.value=Mf,m.value=Yf,b.value=n[0].clinic,u.value="",D.value=n[0].district,c.value=e.startDate,h.value=e.endDate,g.value="Unidade Sanit\xE1ria",f.value="Distrito",r.value="Prov\xEDncia",p.value="Data In\xEDcio",v.value="Data Fim",s.mergeCells("A9:M10"),s.mergeCells("B11:K11"),s.mergeCells("B12:D12"),s.mergeCells("F12:K12"),s.mergeCells("A13:K13"),y.height=30,x.width=20,R.width=20,_.width=30,N.width=10,O.width=15,T.width=20,q.width=20,I.width=20,X.width=20,$.width=20,w.width=20,f.font=r.font=p.font=v.font=g.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},s.addImage(d,{tl:{col:0,row:1},ext:{width:144,height:98}}),s.addTable({name:jn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NID",totalsRowLabel:"none",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Data de Levantamento",totalsRowFunction:"none",filterButton:!1},{name:"Data de Prox. Levantamento",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terapeutico",totalsRowFunction:"none",filterButton:!1},{name:"Tipo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"Unidade Sanitaria",totalsRowFunction:"none",filterButton:!1}],rows:i});const G=s.lastRow.number!==void 0?s.lastRow.number:0;for(let L=14;L<=G;L++)s.getRow(L).eachCell({includeEmpty:!0},H=>{H.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},H.alignment={vertical:"middle",horizontal:"center",wrapText:!0},L===14&&(H.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},H.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const U=await a.xlsx.writeBuffer(),z="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Q=".xlsx",Z=new Blob([U],{type:z});if(Ef.value&&!Ff.value)Ue(Z,on+Q),l.value=!1;else{const L="RelatorioDePacientesQueLevantaramMedsNaUS";Oe.downloadFile(L,".xlsx",Z,l)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].nid),o.push(String(e[n].firstNames+" "+e[n].middleNames+" "+e[n].lastNames).replaceAll("null","").replace("  "," ")),o.push(P(new Date(e[n].pickUpDate)).format("DD-MM-YYYY")),o.push(P(new Date(e[n].nexPickUpDate)).format("DD-MM-YYYY")),o.push(e[n].therapeuticalRegimen),o.push(e[n].dispenseType),o.push(e[n].clinic),l.push(o)}return l}};const Nf={class:"param-container"},Tf="PatientsPickedUpMedsAtUS",If="Patients_picked_up_med_us",Bf={__name:"PatientsPickedUpMedsAtUS",props:["selectedService","menuSelected","id","params"],setup(e){const{alertError:l}=Re(),n=e,o=S(0),i=S(0),a=S(0),s=S(""),d=S(null),t=S(!1),m=Ge(S(!1)),g=Ge(S(!1));Me(()=>{n.params&&b(n.params)});const f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(console.log(n.params),s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}else f.value=!0,ee.remove(n.id)},v=u=>{Qn.getDataLocalDb(u),a.value=100,u.progress=100,r(u,f)},b=u=>{a.value=100,u.progress=100},D=(u,c,h)=>{c==="PDF"?ci.downloadPDF(h,m).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1)}):ci.downloadExcel(h,g).then(y=>{y===204&&(l("N\xE3o existem Dados para o per\xEDodo selecionado"),g.value=!1)})};return E("downloadingPdf",m),E("downloadingXls",g),E("serviceAux",d),E("resultFromLocalStorage",t),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDrugStoreSection",ref:s},[t.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(d.value!==null?d.value.code:"")+": Lista de Pacientes que Levantaram Medicamentos na US ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Pacientes que Levantaram Medicamentos na US ",1)]),_:1})),ie("div",Nf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,reportType:If,tabName:Tf,params:e.params,progress:a.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}},{isMobile:di,isOnline:ui}=ce(),ho="PacientesEmDS",Of=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Lf="Lista de Pacientes em Dispensa Semestral",nn=ho.concat("_"+P(new Date).format("DD-MM-YYYY"));let no=0,ao=0,lo=0;var io={async downloadPDF(e,l,n,o){const i=de.currClinic(),a=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),s=o[0];a.setProperties({title:nn.concat(".pdf")});const d=new Image;d.src="data:image/png;base64,"+le;const t=[[{content:"Pacientes em Dispensa Semestral",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" \xE0 "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+s.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+s.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(a,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),a.setFontSize(8),a.text("Rep\xFAblica de Mo\xE7ambique ",16,28),a.text("Minist\xE9rio da Sa\xFAde ",20,32),a.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),a.addImage(d,"png",28,15,10,10);const m=["ORD","NID","Nome","Idade","Data da Prescri\xE7\xE3o","Tipo Paciente","Linha Terap\xEAutica","Regime Terap\xEAutico","Data Levant.","Data Prox. Levant."],g=o,f=[];let r=1,p=0,v=0,b=0;for(const D in g){g[D].patientType==="Inicio"?p=p+1:g[D].patientType==="DS - TRANSPORTE"?b=b+1:v=v+1;const u=[];u.push(r),u.push(g[D].nid),u.push(g[D].firstNames+" "+g[D].lastNames),u.push(g[D].age),u.push(P(new Date(g[D].prescriptionDate)).format("DD-MM-YYYY")),u.push(g[D].patientType),u.push(g[D].therapeuticLine),u.push(g[D].therapeuticRegimen),u.push(P(new Date(g[D].pickupDate)).format("DD-MM-YYYY")),u.push(P(new Date(g[D].nextPickUpDate)).format("DD-MM-YYYY")),f.push(u),r+=1}if(r=0,K(a,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:50},1:{cellWidth:50}},headStyles:{halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[[{content:"Qualifica\xE7\xE3o dos Pacientes",colSpan:2,styles:{halign:"center",fillColor:[75,76,77],fontStyle:"bold"}}]],body:[[{content:"TIPO",styles:{halign:"center",fillColor:[75,76,77],fontStyle:"bold",textColor:[255,255,255]}},{content:"TOTAL",styles:{halign:"center",fillColor:[75,76,77],fontStyle:"bold",textColor:[255,255,255]}}],[{content:"Novos",styles:{halign:"center"}},{content:p,styles:{halign:"center"}}],[{content:"Manuten\xE7\xE3o",styles:{halign:"center"}},{content:v,styles:{halign:"center"}}],[{content:"Manuten\xE7\xE3o Transporte",styles:{halign:"center"}},{content:b,styles:{halign:"center"}}],[{content:"Cumulativo em DS",styles:{halign:"center"}},{content:p+v+b,styles:{halign:"center"}}]],startY:a.lastAutoTable.finalY+5}),K(a,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:15},1:{cellWidth:45},2:{cellWidth:45},3:{cellWidth:20},4:{cellWidth:25},5:{cellWidth:20},6:{cellWidth:25},7:{cellWidth:30}},didDrawPage:function(D){const u="P\xE1gina "+a.internal.getNumberOfPages();a.setFontSize(8);const c=a.internal.pageSize,h=c.height?c.height:c.getHeight();a.text(u,D.settings.margin.right,h-10)},startY:a.lastAutoTable.finalY,theme:"grid",head:[m],body:f}),ui.value&&!di.value)window.open(a.output("bloburl"));else{const D=a.output();this.downloadFile(nn,"pdf",D)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(ho),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getCell("A14"),_=t.getCell("A15"),N=t.getCell("A16"),O=t.getCell("A17"),T=t.getCell("A18"),q=t.getCell("A19"),I=t.getCell("B15"),X=t.getCell("B16"),$=t.getCell("B17"),w=t.getCell("B18"),V=t.getCell("B19"),G=t.getRow(14),U=t.getRow(15),z=t.getColumn("A"),Q=t.getColumn("B"),Z=t.getColumn("C"),L=t.getColumn("D"),k=t.getColumn("E"),H=t.getColumn("F"),B=t.getColumn("G"),W=t.getColumn("H"),oe=t.getColumn("I"),Y=t.getColumn("J");g.alignment=f.alignment=G.alignment=U.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border=R.border=_.border=I.border=N.border=O.border=T.border=q.border=X.border=$.border=w.border=V.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},R.fill=_.fill=I.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},R.font=_.font=I.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0},g.value=Of,f.value=Lf,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=l,x.value=n,r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",R.value="Qualifica\xE7\xE3o dos Pacientes",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A14:B14"),U.height=30,G.height=30,z.width=20,Q.width=20,Z.width=30,L.width=15,k.width=20,H.width=15,B.width=15,W.width=15,oe.width=15,Y.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:ho,ref:"A15",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Tipo",totalsRowLabel:"none",filterButton:!1},{name:"Total",totalsRowLabel:"Totals:",filterButton:!1}],rows:[["Novos",no],["Manuten\xE7\xE3o",ao],["Transporte",lo],["Cumulativo",no+ao+lo]]}),t.addTable({name:ho,ref:"A21",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data da Prescri\xE7\xE3o",totalsRowFunction:"none",filterButton:!1},{name:"Tipo Paciente",totalsRowFunction:"none",filterButton:!1},{name:"Linha Terap\xEAutica",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terap\xEAutico",totalsRowFunction:"none",filterButton:!1},{name:"Data Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data Prox. Levant.",totalsRowFunction:"none",filterButton:!1}],rows:s});const Pe=t.lastRow.number!==void 0?t.lastRow.number:0;for(let Ne=21;Ne<=Pe;Ne++)t.getRow(Ne).eachCell({includeEmpty:!0},ge=>{ge.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},ge.alignment={vertical:"middle",horizontal:"center",wrapText:!0},Ne===21&&(ge.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},ge.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const ne=await d.xlsx.writeBuffer(),re="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",me=".xlsx",Ye=new Blob([ne],{type:re});if(ui.value&&!di.value)Ue(Ye,nn+me);else{let Ne=function(Se,Ee){const ue=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(ue,function(ve){we(ve,Se,Ee)},De)},we=function(Se,Ee,ue){Se.getFile(Ee,{create:!0,exclusive:!1},function(ve){ge(ve,ue)},be)},ge=function(Se,Ee){Se.createWriter(function(ue){ue.onwriteend=function(){console.log("Successful file write..."),Le()},ue.onerror=function(ve){console.log("Failed file write: "+ve)},ue.write(Ee)})},De=function(Se){console.log(Se)},be=function(Se){console.log("errorr: "+Se.toString())},Le=function(){const Se=Ie;console.log("file system 44444: "+Se);const Ee=cordova.file.externalRootDirectory+"Download/"+Se;console.log("file system 2222: "+Ee);const ue=decodeURIComponent(Ee);cordova.plugins.fileOpener2.open(ue,"application/vnd.ms-excel",{error:function(ve){console.log("file system open3333366: "+ve+ue)},success:function(){}})};const Ie="PacientesActivos.xlsx";Ne(Ie,Ye)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){e[o].patientType==="Inicio"?no=no+1:e[o].patientType==="DS - TRANSPORTE"?lo=lo+1:ao=ao+1;const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(e[o].age),i.push(P(new Date(e[o].prescriptionDate)).format("DD-MM-YYYY")),i.push(e[o].patientType),i.push(e[o].therapeuticLine),i.push(e[o].therapeuticRegimen),i.push(P(new Date(e[o].pickupDate)).format("DD-MM-YYYY")),i.push(P(new Date(e[o].nextPickUpDate)).format("DD-MM-YYYY")),l.push(i),n+=1}return n=0,e=[],l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const kf={class:"param-container"},Vf="SemiannualDispensation",zf="PACIENTES_EM_DS",_f={__name:"SemiannualDispensation",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,l.value?(r(u,f),C.apiInitReportProcess("activePatientReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})):(r(u,f),je.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("activePatientReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c)=>{l.value?C.printReport("activePatientReport",u,c).then(h=>{if(!h.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const y=h.data[0];c==="PDF"?(d.value=!0,io.downloadPDF(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"tarv"),d.value=!1):(t.value=!0,io.downloadExcel(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"tarv"),t.value=!1)}}):je.localDbGetAllByReportId(u).then(h=>{const y=h[0];c==="PDF"?(io.downloadPDF("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h),d.value=!1):(io.downloadExcel("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h),t.value=!1)})};return E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDPatientHistorySection",ref:s},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Pacientes em Dispensa Semestral ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes em Dispensa Semestral ",1)]),_:1})),ie("div",kf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,progress:a.value,reportType:zf,tabName:Vf,params:e.params,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var Uf=Fe(_f,[["__scopeId","data-v-c83cce46"]]);const{isMobile:gi,isOnline:fi}=ce(),vo="PacientesEmDT",$f=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Hf="Lista de Pacientes em Dispensa Trimestral",an=vo.concat("_"+P(new Date).format("DD-MM-YYYY"));let so=0,ro=0,co=0;var uo={async downloadPDF(e,l,n,o){const i=de.currClinic(),a=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),s=o[0];a.setProperties({title:an.concat(".pdf")});const d=new Image;d.src="data:image/png;base64,"+le;const t=[[{content:"Pacientes em Dispensa Trimestral",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" \xE0 "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+s.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+s.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(a,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),a.setFontSize(8),a.text("Rep\xFAblica de Mo\xE7ambique ",16,28),a.text("Minist\xE9rio da Sa\xFAde ",20,32),a.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),a.addImage(d,"png",28,15,10,10);const m=["ORD","NID","Nome","Idade","Data da Prescri\xE7\xE3o","Tipo Paciente","Linha Terap\xEAutica","Regime Terap\xEAutico","Data Levant.","Data Prox. Levant."],g=o,f=[];let r=1,p=0,v=0,b=0;for(const D in g){g[D].patientType==="Inicio"?p=p+1:g[D].patientType==="DT - TRANSPORTE"?b=b+1:v=v+1;const u=[];u.push(r),u.push(g[D].nid),u.push(g[D].firstNames+" "+g[D].lastNames),u.push(g[D].age),u.push(P(new Date(g[D].prescriptionDate)).format("DD-MM-YYYY")),u.push(g[D].patientType),u.push(g[D].therapeuticLine),u.push(g[D].therapeuticRegimen),u.push(P(new Date(g[D].pickupDate)).format("DD-MM-YYYY")),u.push(P(new Date(g[D].nextPickUpDate)).format("DD-MM-YYYY")),f.push(u),r+=1}if(r=0,K(a,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:50},1:{cellWidth:50}},headStyles:{halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[[{content:"Qualifica\xE7\xE3o dos Pacientes",colSpan:2,styles:{halign:"center",fillColor:[75,76,77],fontStyle:"bold"}}]],body:[[{content:"TIPO",styles:{halign:"center",fillColor:[75,76,77],fontStyle:"bold",textColor:[255,255,255]}},{content:"TOTAL",styles:{halign:"center",fillColor:[75,76,77],fontStyle:"bold",textColor:[255,255,255]}}],[{content:"Novos",styles:{halign:"center"}},{content:p,styles:{halign:"center"}}],[{content:"Manuten\xE7\xE3o",styles:{halign:"center"}},{content:v,styles:{halign:"center"}}],[{content:"Manuten\xE7\xE3o Transporte",styles:{halign:"center"}},{content:b,styles:{halign:"center"}}],[{content:"Cumulativo em DT",styles:{halign:"center"}},{content:p+v+b,styles:{halign:"center"}}]],startY:a.lastAutoTable.finalY+5}),K(a,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:15},1:{cellWidth:45},2:{cellWidth:45},3:{cellWidth:20},4:{cellWidth:25},5:{cellWidth:20},6:{cellWidth:25},7:{cellWidth:30}},didDrawPage:function(D){const u="P\xE1gina "+a.internal.getNumberOfPages();a.setFontSize(8);const c=a.internal.pageSize,h=c.height?c.height:c.getHeight();a.text(u,D.settings.margin.right,h-10)},startY:a.lastAutoTable.finalY+5,theme:"grid",head:[m],body:f}),fi.value&&!gi.value)window.open(a.output("bloburl"));else{const D=a.output();this.downloadFile(an,"pdf",D)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(vo),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getCell("A14"),_=t.getCell("A15"),N=t.getCell("A16"),O=t.getCell("A17"),T=t.getCell("A18"),q=t.getCell("A19"),I=t.getCell("B15"),X=t.getCell("B16"),$=t.getCell("B17"),w=t.getCell("B18"),V=t.getCell("B19"),G=t.getRow(14),U=t.getRow(15),z=t.getColumn("A"),Q=t.getColumn("B"),Z=t.getColumn("C"),L=t.getColumn("D"),k=t.getColumn("E"),H=t.getColumn("F"),B=t.getColumn("G"),W=t.getColumn("H"),oe=t.getColumn("I"),Y=t.getColumn("J");g.alignment=f.alignment=G.alignment=U.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border=R.border=_.border=I.border=N.border=O.border=T.border=q.border=X.border=$.border=w.border=V.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},R.fill=_.fill=I.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},R.font=_.font=I.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0},g.value=$f,f.value=Hf,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=l,x.value=n,r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",R.value="Qualifica\xE7\xE3o dos Pacientes",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A13:I13"),t.mergeCells("A14:B14"),U.height=30,G.height=30,z.width=20,Q.width=20,Z.width=30,L.width=15,k.width=20,H.width=15,B.width=15,W.width=15,oe.width=15,Y.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:vo,ref:"A15",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Tipo",totalsRowLabel:"none",filterButton:!1},{name:"Total",totalsRowLabel:"Totals:",filterButton:!1}],rows:[["Novos",so],["Manuten\xE7\xE3o",ro],["Transporte",co],["Cumulativo",so+ro+co]]}),t.addTable({name:vo,ref:"A21",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Idade",totalsRowFunction:"none",filterButton:!1},{name:"Data da Prescri\xE7\xE3o",totalsRowFunction:"none",filterButton:!1},{name:"Tipo Paciente",totalsRowFunction:"none",filterButton:!1},{name:"Linha Terap\xEAutica",totalsRowFunction:"none",filterButton:!1},{name:"Regime Terap\xEAutico",totalsRowFunction:"none",filterButton:!1},{name:"Data Levant.",totalsRowFunction:"none",filterButton:!1},{name:"Data Prox. Levant.",totalsRowFunction:"none",filterButton:!1}],rows:s});const Pe=t.lastRow.number!==void 0?t.lastRow.number:0;for(let Ne=21;Ne<=Pe;Ne++)t.getRow(Ne).eachCell({includeEmpty:!0},ge=>{ge.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},ge.alignment={vertical:"middle",horizontal:"center",wrapText:!0},Ne===21&&(ge.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},ge.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const ne=await d.xlsx.writeBuffer(),re="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",me=".xlsx",Ye=new Blob([ne],{type:re});if(fi.value&&!gi.value)Ue(Ye,an+me);else{let Ne=function(Se,Ee){const ue=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(ue,function(ve){we(ve,Se,Ee)},De)},we=function(Se,Ee,ue){Se.getFile(Ee,{create:!0,exclusive:!1},function(ve){ge(ve,ue)},be)},ge=function(Se,Ee){Se.createWriter(function(ue){ue.onwriteend=function(){console.log("Successful file write..."),Le()},ue.onerror=function(ve){console.log("Failed file write: "+ve)},ue.write(Ee)})},De=function(Se){console.log(Se)},be=function(Se){console.log("errorr: "+Se.toString())},Le=function(){const Se=Ie;console.log("file system 44444: "+Se);const Ee=cordova.file.externalRootDirectory+"Download/"+Se;console.log("file system 2222: "+Ee);const ue=decodeURIComponent(Ee);cordova.plugins.fileOpener2.open(ue,"application/vnd.ms-excel",{error:function(ve){console.log("file system open3333366: "+ve+ue)},success:function(){}})};const Ie="PacientesActivos.xlsx";Ne(Ie,Ye)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){e[o].patientType==="Inicio"?so=so+1:e[o].patientType==="DT - TRANSPORTE"?co=co+1:ro=ro+1;const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(e[o].age),i.push(P(new Date(e[o].prescriptionDate)).format("DD-MM-YYYY")),i.push(e[o].patientType),i.push(e[o].therapeuticLine),i.push(e[o].therapeuticRegimen),i.push(P(new Date(e[o].pickupDate)).format("DD-MM-YYYY")),i.push(P(new Date(e[o].nextPickUpDate)).format("DD-MM-YYYY")),l.push(i),n+=1}return n=0,e=[],l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Gf={class:"param-container"},qf="QuarterlyDispensation",Wf="PACIENTES_EM_DT",Qf={__name:"QuarterlyDispensation",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(s.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{a.value=.001,l.value?(r(u,f),C.apiInitReportProcess("activePatientReport",u).then(c=>{setTimeout(()=>{b(u)},3e3)})):(r(u,f),je.getDataLocalDb(u),a.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("activePatientReport",u).then(c=>{c.data.progress>.001?(a.value=c.data.progress,a.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(a.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c)=>{l.value?C.printReport("activePatientReport",u,c).then(h=>{if(!h.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const y=h.data[0];c==="PDF"?(d.value=!0,uo.downloadPDF(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"tarv"),d.value=!1):(t.value=!0,uo.downloadExcel(y.province,P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h.data,"tarv"),t.value=!1)}}):je.localDbGetAllByReportId(u).then(h=>{const y=h[0];c==="PDF"?(uo.downloadPDF("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h),d.value=!1):(uo.downloadExcel("",P(new Date(y.startDate)).format("DD-MM-YYYY"),P(new Date(y.endDate)).format("DD-MM-YYYY"),h),t.value=!1)})};return E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterDPatientHistorySection",ref:s},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Pacientes em Dispensa Trimestral ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes em Dispensa Trimestral ",1)]),_:1})),ie("div",Gf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:o.value,qtyProcessed:i.value,progress:a.value,reportType:Wf,tabName:qf,params:e.params,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","progress","params","clinicalService"])]),_:1})]),_:1})])],512))}};var jf=Fe(Qf,[["__scopeId","data-v-7839dae4"]]),cs={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);const[n]=await Promise.all([st.getAllPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.patientvisitDetails.patientVisit.patient,a=o.patientvisitDetails.episode,s=o.patientvisitDetails.prescription.prescriptionDetails,d=o.patientvisitDetails.episode.patientServiceIdentifier,t=s.length>0?s[0].therapeuticLine:"",m=s.length>0?s[0].therapeuticRegimen:"",g=o.patientvisitDetails.prescription.patientType==="N/A"?o.patientvisitDetails.prescription.patientStatus:o.patientvisitDetails.prescription.patientType,f=s.length>0?s[0].dispenseType:"";if(d.service.id===l.clinicalService){const r=new at;r.reportId=l.id,r.year=l.year,r.startDate=l.startDate,r.endDate=l.endDate,r.nid=d.value,r.patientName=i.firstNames+" "+i.middleNames+" "+i.lastNames,r.patientType=g,r.startReason=a.startStopReason.reason;const p=this.idadeCalculator(i.dateOfBirth);r.ageGroup_0_4=p>=0&&p<4?"Sim":"Nao",r.ageGroup_5_9=p>=5&&p<=9?"Sim":"Nao",r.ageGroup_10_14=p>=10&&p<=14?"Sim":"Nao",r.ageGroup_Greater_than_15=p>=15?"Sim":"Nao",r.pickUpDate=o.pickupDate,r.nexPickUpDate=o.nextPickUpDate,r.regime=m.description,r.dispensationType=f.description,r.therapeuticLine=t.description,r.clinic=o.clinic.clinicName,r.prep=d.service.code==="PREP"?"Sim":"",r.ppe=d.service.code==="PPE"?"Sim":"";const v=[];for(const b of o.packagedDrugs){const D={};D.drugName=b.drug.name,D.quantity=b.quantitySupplied,console.log(D),v.push(D),console.log(r)}console.log(v),r.drugQuantityTemps=v,this.localDbAddOrUpdate(r)}}},localDbAddOrUpdate(e){return et.nSQL().onConnected(()=>{et.nSQL(at.entity).query("upsert",e).exec()})},async localDbGetAllByReportId(e){return et.nSQL(at.entity).query("select").where(["reportId","=",e]).exec().then(l=>l!==void 0?l:null)},async getDataLocalReport(e){return et.nSQL(at.entity).query("select").where(["reportId","=",e]).exec().then(l=>l)},idadeCalculator(e){if(P(e,"YYYY/MM/DDDD").isValid()){const l=P(e,"YYYY/MM/DDDD"),o=P(new Date).diff(l,"years");return console.log(o),o}}};const ds=new Image;ds.src="data:image/png;base64,"+le;const{isOnline:go,isMobile:mi}=ce(),Xf=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Jf="LIVRO DE REGISTO DI\xC1RIO DE PREPs",Xn="PrepDailyListReport",ln=Xn.concat("_"+C.getFormatDDMMYYYY(new Date));var pi={async downloadPDF(e,l,n){const o=de.currClinic();let i=[],a=[],s={};if(go.value){if(i=await C.printReport("arvDailyRegisterReportTemp",e,l),i.status===204||i.data.length===0)return 204;s=i.data[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate);const g=Object.values(C.mapaDeAgrupamento(i.data));a=this.createArrayOfArrayRow(g)}else{if(i=await this.getDataLocalReport(e),i.length===0)return 204;s=i[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),a=this.createArrayOfArrayRow(i)}const d=new Ce({orientation:"l",unit:"mm",format:"a3",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=[[{content:"LIVRO DE REGISTO DI\xC1RIO DE PREPs",styles:{minCellHeight:20,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+o.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?o.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?o.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]],m=[[{content:"ORD",rowSpan:2},{content:"NID",rowSpan:2},{content:"NOME",rowSpan:2},{content:"Tipo de paciente",rowSpan:2},{content:"Faixa Et\xE1ria",colSpan:4},{content:"Tipo PREP",rowSpan:2},{content:"Regime",rowSpan:2},{content:"Produtos e Quantidades",rowSpan:2,styles:{cellWidth:50}},{content:"Tipo de Dispensa",rowSpan:2},{content:"Linha",rowSpan:2},{content:"Data de Levant.",rowSpan:2},{content:"Data Proxi. Levant.",rowSpan:2},{content:"PROFILAXIA",colSpan:3}],[{content:"[0-4]"},{content:"[5-9]:"},{content:"[10-14]"},{content:"[>15]"},{content:"PPE"},{content:"PREP"},{content:"Cr. Exp."}]];if(K(d,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.addImage(ds,"png",28,15,10,10),K(d,{bodyStyles:{overflow:"linebreak",cellWidth:"wrap",valign:"middle",fontSize:6,overflowColumns:"linebreak"},headStyles:{valign:"bottom",halign:"center",fontSize:6,lineWidth:.5,lineColor:[230,230,230],fillColor:[255,255,255],textColor:[96,96,96]},didDrawPage:function(g){const f="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(6);const r=d.internal.pageSize,p=r.height?r.height:r.getHeight();d.text(f,g.settings.margin.right,p-10)},theme:"grid",head:m,body:a}),go.value&&!mi.value)return d.save(ln.concat(".pdf"));{console.log(d);const g=d.output();this.downloadFile(ln,"pdf",g)}},async downloadExcel(e,l,n){const o=de.currClinic();let i=[],a=[],s={};if(go.value){if(i=await C.printReport("arvDailyRegisterReportTemp",e,l),i.status===204||i.data.length===0)return 204;s=i.data[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate);const ge=Object.values(C.mapaDeAgrupamento(i.data));a=this.createArrayOfArrayRow(ge)}else{if(i=await this.getDataLocalReport(e),s=i[0],i.length===0)return 204;n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),a=this.createArrayOfArrayRow(i)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Xn),m=d.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("F11"),D=t.getCell("F12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("G11"),x=t.getCell("G12"),R=t.getCell("E13"),_=t.getCell("P13"),N=t.getRow(14),O=t.getRow(13),T=t.getColumn("A"),q=t.getColumn("B"),I=t.getColumn("C"),X=t.getColumn("D"),$=t.getColumn("E"),w=t.getColumn("F"),V=t.getColumn("G"),G=t.getColumn("H"),U=t.getColumn("I"),z=t.getColumn("J"),Q=t.getColumn("K"),Z=t.getColumn("L"),L=t.getColumn("M"),k=t.getColumn("N"),H=t.getColumn("O"),B=t.getColumn("P"),W=t.getColumn("Q"),oe=t.getColumn("R"),Y=t.getColumn("S");_.alignment=R.alignment=g.alignment=f.alignment=N.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},c.border=p.border=v.border=h.border=D.border=x.border={bottom:{style:"thin"}},_.border=R.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Xf,f.value=Jf,u.value=o.clinicName,h.value=o.province.description,c.value=o.district.description,y.value=n.startDateParam,x.value=n.endDateParam,r.value="Farm\xE1cia",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",R.value="Faixa Et\xE1ria",_.value="Profilaxia",t.mergeCells("A9:G9"),t.mergeCells("B11:E11"),t.mergeCells("B12:C12"),t.mergeCells("E13:G13"),t.mergeCells("P13:R13"),t.getCell("A13").fill=t.getCell("B13").fill=t.getCell("C13").fill=t.getCell("D13").fill=t.getCell("E13").fill=t.getCell("F13").fill=t.getCell("G13").fill=t.getCell("H13").fill=t.getCell("I13").fill=t.getCell("J13").fill=t.getCell("K13").fill=t.getCell("L13").fill=t.getCell("M13").fill=t.getCell("N13").fill=t.getCell("O13").fill=t.getCell("P13").fill=t.getCell("Q13").fill=t.getCell("R13").fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},R.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},_.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},N.height=30,O.height=30,T.width=10,q.width=30,I.width=30,X.width=20,$.width=10,w.width=10,V.width=10,G.width=10,U.width=15,z.width=25,Q.width=50,Z.width=15,L.width=15,k.width=15,H.width=15,B.width=15,W.width=10,oe.width=10,Y.width=10,f.font=p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Xn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",filterButton:!1},{name:"NID",filterButton:!1},{name:"NOME ",filterButton:!1},{name:"TIPO DE PACIENTE",totalsRowFunction:"none",filterButton:!1},{name:"[0 -4]",totalsRowFunction:"none",filterButton:!1},{name:"[5-9]",totalsRowFunction:"none",filterButton:!1},{name:"[10-14]",totalsRowFunction:"none",filterButton:!1},{name:"[>15]",totalsRowFunction:"none",filterButton:!1},{name:"TIPO TARV.",totalsRowFunction:"none",filterButton:!1},{name:"REGIME",totalsRowFunction:"none",filterButton:!1},{name:"PRODUTOS - (QUANTIDADES) ",totalsRowFunction:"none",filterButton:!1},{name:"TIPO DE DISPENSA",totalsRowFunction:"none",filterButton:!1},{name:"LINHA",totalsRowFunction:"none",filterButton:!1},{name:"DATA DE LEVANTAMENTO",totalsRowFunction:"none",filterButton:!1},{name:"DATA PROXIM. LEVANTAMENTO",totalsRowFunction:"none",filterButton:!1},{name:"PPE",totalsRowFunction:"none",filterButton:!1},{name:"PREP",totalsRowFunction:"none",filterButton:!1},{name:"CR. Exp",totalsRowFunction:"none",filterButton:!1}],rows:a});const Pe=t.lastRow.number!==void 0?t.lastRow.number:0;for(let ge=14;ge<=Pe;ge++){const De=t.getRow(ge);De.height=50,De.halign="left",De.wrapText=!0,De.eachCell({includeEmpty:!0},be=>{be.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},be.alignment={vertical:"middle",horizontal:"center",wrapText:!0},ge===14&&(be.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},be.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}let ne=15,re={};n.isOnline?re=rows.data:re=i;for(let ge=0;ge<=re.length;ge++){const De=re[ge];if(De!==void 0){let be="";for(const Ie in De.drugQuantityTemps)be=be+(De.drugQuantityTemps[Ie].drugName+" - ("+De.drugQuantityTemps[Ie].quantity+");                                       ");const Le=t.getCell("K"+ne);Le.value=be,ne++}}const me=await d.xlsx.writeBuffer(),Ye="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Ne=".xlsx",we=new Blob([me],{type:Ye});if(go.value&&!mi.value)_e.exports.saveAs(we,ln+Ne);else{let ge=function(ue,ve){const Ae=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(Ae,function(Te){De(Te,ue,ve)},Le)},De=function(ue,ve,Ae){ue.getFile(ve,{create:!0,exclusive:!1},function(Te){be(Te,Ae)},Ie)},be=function(ue,ve){ue.createWriter(function(Ae){Ae.onwriteend=function(){console.log("Successful file write..."),Se()},Ae.onerror=function(Te){console.log("Failed file write: "+Te)},Ae.write(ve)})},Le=function(ue){console.log(ue)},Ie=function(ue){console.log("errorr: "+ue.toString())},Se=function(){const ue=Ee;console.log("file system 44444: "+ue);const ve=cordova.file.externalRootDirectory+"Download/"+ue;console.log("file system 2222: "+ve);const Ae=decodeURIComponent(ve);cordova.plugins.fileOpener2.open(Ae,"application/vnd.ms-excel",{error:function(Te){console.log("file system open3333366: "+Te+Ae)},success:function(){}})};const Ee="LivroDiarioDePreps.xlsx";console.log("result"+Ee),ge(Ee,we)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n++),i.push(e[o].nid),i.push(String(e[o].patientName).replaceAll("null","").replace("  "," ")),i.push(e[o].startReason),i.push(e[o].ageGroup_0_4),i.push(e[o].ageGroup_5_9),i.push(e[o].ageGroup_10_14),i.push(e[o].ageGroup_Greater_than_15),i.push(e[o].patientType),i.push(e[o].regime),i.push(C.createDrugArrayOfArrayRow(e[o].drugQuantityTemps).join(`; 
`)),i.push(e[o].dispensationType),i.push(e[o].therapeuticLine),console.log(e[o].pickupDate),i.push(C.getFormatDDMMYYYY(e[o].pickupDate)),console.log(C.getFormatDDMMYYYY(e[o].pickupDate)),i.push(C.getFormatDDMMYYYY(e[o].nextPickupDate)),i.push(e[o].ppe),i.push(e[o].prep),i.push(""),l.push(i)}return l},async getDataLocalReport(e){const l=await cs.localDbGetAllByReportId(e);return l===null||l.length===0?"204":l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Kf={class:"param-container"},Zf="LIVRO_DIARIO_PREP",em="PrepDailyRegister",tm={__name:"PrepDailyRegister",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(""),i=S(!1),a=S(!1),s=S(0),d=S(0),t=S(0),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(o.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{t.value=.001,l.value?(r(u,f),C.apiInitReportProcess("arvDailyRegisterReportTemp",u).then(c=>{t.value=c.data.progress,setTimeout(()=>{b(u)},3e3)})):(r(u,f),cs.getDataLocalDb(u),t.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("arvDailyRegisterReportTemp",u).then(c=>{c.data.progress>.001?(t.value=c.data.progress,t.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(t.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?pi.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),i.value=!1}):c==="XLS"&&pi.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),a.value=!1})};return E("downloadingPdf",i),E("downloadingXls",a),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterPrepDailyRegisterSection",ref:o},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Lista de Registro Di\xE1rio de PREP ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Registro Di\xE1rio de PREP ",1)]),_:1})),ie("div",Kf,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:s.value,qtyProcessed:d.value,reportType:Zf,tabName:em,params:e.params,progress:t.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}};var om=Fe(tm,[["__scopeId","data-v-40095e16"]]),us={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e);console.log(l);const[n]=await Promise.all([packService.getAllPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const o of n){const i=o.patientvisitDetails.patientVisit.patient,a=o.patientvisitDetails.episode,s=o.patientvisitDetails.prescription.prescriptionDetails,d=o.patientvisitDetails.episode.patientServiceIdentifier,t=s.length>0?s[0].therapeuticLine:"",m=s.length>0?s[0].therapeuticRegimen:"",g=o.patientvisitDetails.prescription.patientType==="N/A"?o.patientvisitDetails.prescription.patientStatus:o.patientvisitDetails.prescription.patientType,f=s.length>0?s[0].dispenseType:"";if(d.service.id===l.clinicalService){const r=new at;r.reportId=l.id,r.year=l.year,r.startDate=l.startDate,r.endDate=l.endDate,r.nid=d.value,r.patientName=i.firstNames+" "+i.middleNames+" "+i.lastNames,r.patientType=g,r.startReason=a.startStopReason.reason;const p=this.idadeCalculator(i.dateOfBirth);r.ageGroup_0_4=p>=0&&p<4?"Sim":"Nao",r.ageGroup_5_9=p>=5&&p<=9?"Sim":"Nao",r.ageGroup_10_14=p>=10&&p<=14?"Sim":"Nao",r.ageGroup_Greater_than_15=p>=15?"Sim":"Nao",r.pickUpDate=o.pickupDate,r.nexPickUpDate=o.nextPickUpDate,r.regime=m.description,r.dispensationType=f.description,r.therapeuticLine=t.description,r.clinic=o.clinic.clinicName,r.prep=d.service.code==="TPT"?"Sim":"",r.ppe=d.service.code==="PPE"?"Sim":"";const v=[];for(const b of o.packagedDrugs){const D={};D.drugName=b.drug.name,D.quantity=b.quantitySupplied,console.log(D),v.push(D),console.log(r)}console.log(v),r.drugQuantityTemps=v,this.localDbAddOrUpdate(r)}}},localDbAddOrUpdate(e){return et.nSQL().onConnected(()=>{et.nSQL(at.entity).query("upsert",e).exec()})},async localDbGetAllByReportId(e){return et.nSQL(at.entity).query("select").where(["reportId","=",e]).exec().then(l=>l!==void 0?l:null)},async getDataLocalReport(e){return et.nSQL(at.entity).query("select").where(["reportId","=",e]).exec().then(l=>l)},idadeCalculator(e){if(P(e,"YYYY/MM/DDDD").isValid()){const l=P(e,"YYYY/MM/DDDD"),o=P(new Date).diff(l,"years");return console.log(o),o}}};const gs=new Image;gs.src="data:image/png;base64,"+le;const{isOnline:fo,isMobile:hi}=ce(),nm=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,am="LIVRO DE REGISTO DI\xC1RIO DE TPTs",Jn="TptDailyListReport",sn=Jn.concat("_"+C.getFormatDDMMYYYY(new Date));var vi={async downloadPDF(e,l,n){const o=de.currClinic();let i=[],a=[],s={};if(fo.value){if(i=await C.printReport("arvDailyRegisterReportTemp",e,l),i.status===204||i.data.length===0)return 204;s=i.data[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate);const g=Object.values(C.mapaDeAgrupamento(i.data));a=this.createArrayOfArrayRow(g)}else{if(i=await this.getDataLocalReport(e),i.length===0)return 204;s=i[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),a=this.createArrayOfArrayRow(i)}const d=new Ce({orientation:"l",unit:"mm",format:"a3",putOnlyUsedFonts:!0,floatPrecision:"smart"}),t=[[{content:"LIVRO DE REGISTO DI\xC1RIO DE TPTs",styles:{minCellHeight:20,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+o.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+n.startDateParam+" \xE0 "+n.endDateParam,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+(n.district===null?o.district.description:n.district.description),halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+(n.province===null?o.province.description:n.province.description),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+n.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]],m=[[{content:"ORD",rowSpan:2},{content:"NID",rowSpan:2},{content:"NOME",rowSpan:2},{content:"Tipo de paciente",rowSpan:2},{content:"Faixa Et\xE1ria",colSpan:4},{content:"Tipo TPT",rowSpan:2},{content:"Regime",rowSpan:2},{content:"Produtos e Quantidades",rowSpan:2,styles:{cellWidth:50}},{content:"Tipo de Dispensa",rowSpan:2},{content:"Linha",rowSpan:2},{content:"Data de Levant.",rowSpan:2},{content:"Data Proxi. Levant.",rowSpan:2},{content:"PROFILAXIA",colSpan:3}],[{content:"[0-4]"},{content:"[5-9]:"},{content:"[10-14]"},{content:"[>15]"},{content:"PPE"},{content:"PREP"},{content:"Cr. Exp."}]];if(K(d,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.addImage(gs,"png",28,15,10,10),K(d,{bodyStyles:{overflow:"linebreak",cellWidth:"wrap",valign:"middle",fontSize:6,overflowColumns:"linebreak"},headStyles:{valign:"bottom",halign:"center",fontSize:6,lineWidth:.5,lineColor:[230,230,230],fillColor:[255,255,255],textColor:[96,96,96]},didDrawPage:function(g){const f="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(6);const r=d.internal.pageSize,p=r.height?r.height:r.getHeight();d.text(f,g.settings.margin.right,p-10)},theme:"grid",head:m,body:a}),fo.value&&!hi.value)return d.save(sn.concat(".pdf"));{console.log(d);const g=d.output();this.downloadFile(sn,"pdf",g)}},async downloadExcel(e,l,n){const o=de.currClinic();let i=[],a=[],s={};if(fo.value){if(i=await C.printReport("arvDailyRegisterReportTemp",e,l),i.status===204||i.data.length===0)return 204;s=i.data[0],n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate);const ge=Object.values(C.mapaDeAgrupamento(i.data));a=this.createArrayOfArrayRow(ge)}else{if(i=await this.getDataLocalReport(e),s=i[0],i.length===0)return 204;n.startDateParam=C.getFormatDDMMYYYY(s.startDate),n.endDateParam=C.getFormatDDMMYYYY(s.endDate),a=this.createArrayOfArrayRow(i)}const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(Jn),m=d.addImage({base64:"data:image/pngbase64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("F11"),D=t.getCell("F12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("G11"),x=t.getCell("G12"),R=t.getCell("E13"),_=t.getCell("P13"),N=t.getRow(14),O=t.getRow(13),T=t.getColumn("A"),q=t.getColumn("B"),I=t.getColumn("C"),X=t.getColumn("D"),$=t.getColumn("E"),w=t.getColumn("F"),V=t.getColumn("G"),G=t.getColumn("H"),U=t.getColumn("I"),z=t.getColumn("J"),Q=t.getColumn("K"),Z=t.getColumn("L"),L=t.getColumn("M"),k=t.getColumn("N"),H=t.getColumn("O"),B=t.getColumn("P"),W=t.getColumn("Q"),oe=t.getColumn("R"),Y=t.getColumn("S");_.alignment=R.alignment=g.alignment=f.alignment=N.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},c.border=p.border=v.border=h.border=D.border=x.border={bottom:{style:"thin"}},_.border=R.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=nm,f.value=am,u.value=o.clinicName,h.value=o.province.description,c.value=o.district.description,y.value=n.startDateParam,x.value=n.endDateParam,r.value="Farm\xE1cia",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",R.value="Faixa Et\xE1ria",_.value="Profilaxia",t.mergeCells("A9:G9"),t.mergeCells("B11:E11"),t.mergeCells("B12:C12"),t.mergeCells("E13:G13"),t.mergeCells("P13:R13"),t.getCell("A13").fill=t.getCell("B13").fill=t.getCell("C13").fill=t.getCell("D13").fill=t.getCell("E13").fill=t.getCell("F13").fill=t.getCell("G13").fill=t.getCell("H13").fill=t.getCell("I13").fill=t.getCell("J13").fill=t.getCell("K13").fill=t.getCell("L13").fill=t.getCell("M13").fill=t.getCell("N13").fill=t.getCell("O13").fill=t.getCell("P13").fill=t.getCell("Q13").fill=t.getCell("R13").fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},R.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},_.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},_.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:12,italic:!1,bold:!0},N.height=30,O.height=30,T.width=10,q.width=30,I.width=30,X.width=20,$.width=10,w.width=10,V.width=10,G.width=10,U.width=15,z.width=25,Q.width=50,Z.width=15,L.width=15,k.width=15,H.width=15,B.width=15,W.width=10,oe.width=10,Y.width=10,f.font=p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:Jn,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",filterButton:!1},{name:"NID",filterButton:!1},{name:"NOME ",filterButton:!1},{name:"TIPO DE PACIENTE",totalsRowFunction:"none",filterButton:!1},{name:"[0 -4]",totalsRowFunction:"none",filterButton:!1},{name:"[5-9]",totalsRowFunction:"none",filterButton:!1},{name:"[10-14]",totalsRowFunction:"none",filterButton:!1},{name:"[>15]",totalsRowFunction:"none",filterButton:!1},{name:"TIPO TARV.",totalsRowFunction:"none",filterButton:!1},{name:"REGIME",totalsRowFunction:"none",filterButton:!1},{name:"PRODUTOS - (QUANTIDADES) ",totalsRowFunction:"none",filterButton:!1},{name:"TIPO DE DISPENSA",totalsRowFunction:"none",filterButton:!1},{name:"LINHA",totalsRowFunction:"none",filterButton:!1},{name:"DATA DE LEVANTAMENTO",totalsRowFunction:"none",filterButton:!1},{name:"DATA PROXIM. LEVANTAMENTO",totalsRowFunction:"none",filterButton:!1},{name:"PPE",totalsRowFunction:"none",filterButton:!1},{name:"PREP",totalsRowFunction:"none",filterButton:!1},{name:"CR. Exp",totalsRowFunction:"none",filterButton:!1}],rows:a});const Pe=t.lastRow.number!==void 0?t.lastRow.number:0;for(let ge=14;ge<=Pe;ge++){const De=t.getRow(ge);De.height=50,De.halign="left",De.wrapText=!0,De.eachCell({includeEmpty:!0},be=>{be.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},be.alignment={vertical:"middle",horizontal:"center",wrapText:!0},ge===14&&(be.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},be.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})})}let ne=15,re={};n.isOnline?re=rows.data:re=i;for(let ge=0;ge<=re.length;ge++){const De=re[ge];if(De!==void 0){let be="";for(const Ie in De.drugQuantityTemps)be=be+(De.drugQuantityTemps[Ie].drugName+" - ("+De.drugQuantityTemps[Ie].quantity+");                                       ");const Le=t.getCell("K"+ne);Le.value=be,ne++}}const me=await d.xlsx.writeBuffer(),Ye="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Ne=".xlsx",we=new Blob([me],{type:Ye});if(fo.value&&!hi.value)_e.exports.saveAs(we,sn+Ne);else{let ge=function(ue,ve){const Ae=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(Ae,function(Te){De(Te,ue,ve)},Le)},De=function(ue,ve,Ae){ue.getFile(ve,{create:!0,exclusive:!1},function(Te){be(Te,Ae)},Ie)},be=function(ue,ve){ue.createWriter(function(Ae){Ae.onwriteend=function(){console.log("Successful file write..."),Se()},Ae.onerror=function(Te){console.log("Failed file write: "+Te)},Ae.write(ve)})},Le=function(ue){console.log(ue)},Ie=function(ue){console.log("errorr: "+ue.toString())},Se=function(){const ue=Ee;console.log("file system 44444: "+ue);const ve=cordova.file.externalRootDirectory+"Download/"+ue;console.log("file system 2222: "+ve);const Ae=decodeURIComponent(ve);cordova.plugins.fileOpener2.open(Ae,"application/vnd.ms-excel",{error:function(Te){console.log("file system open3333366: "+Te+Ae)},success:function(){}})};const Ee="LivroDiarioDePreps.xlsx";console.log("result"+Ee),ge(Ee,we)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n++),i.push(e[o].nid),i.push(String(e[o].patientName).replaceAll("null","").replace("  "," ")),i.push(e[o].startReason),i.push(e[o].ageGroup_0_4),i.push(e[o].ageGroup_5_9),i.push(e[o].ageGroup_10_14),i.push(e[o].ageGroup_Greater_than_15),i.push(e[o].patientType),i.push(e[o].regime),i.push(C.createDrugArrayOfArrayRow(e[o].drugQuantityTemps).join(`; 
`)),i.push(e[o].dispensationType),i.push(e[o].therapeuticLine),i.push(C.getFormatDDMMYYYY(e[o].pickupDate)),i.push(C.getFormatDDMMYYYY(e[o].nextPickupDate)),i.push(e[o].ppe),i.push(e[o].prep),i.push(""),l.push(i)}return l},async getDataLocalReport(e){const l=await us.localDbGetAllByReportId(e);return l===null||l.length===0?"204":l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const lm={class:"param-container"},im="LIVRO_DIARIO_TPT",sm="TptDailyRegister",rm={__name:"TptDailyRegister",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(""),i=S(!1),a=S(!1),s=S(0),d=S(0),t=S(0),m=S(null),g=S(!1),f=S(!1),r=(u,c)=>{c.value||ee.set(u.id,u)},p=u=>{if(o.value.remove(),u){const c=u.id;f.value=!0,ee.remove(c)}},v=u=>{t.value=.001,l.value?(r(u,f),C.apiInitReportProcess("arvDailyRegisterReportTemp",u).then(c=>{t.value=c.data.progress,setTimeout(()=>{b(u)},3e3)})):(r(u,f),us.getDataLocalDb(u),t.value=100,u.progress=100)},b=u=>{C.getProcessingStatus("arvDailyRegisterReportTemp",u).then(c=>{c.data.progress>.001?(t.value=c.data.progress,t.value<100?(r(u,f),u.progress=c.data.progress,setTimeout(()=>{b(u)},3e3)):(t.value=100,u.progress=100,r(u,f))):setTimeout(()=>{b(u)},3e3)})},D=(u,c,h)=>{c==="PDF"?vi.downloadPDF(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),i.value=!1}):c==="XLS"&&vi.downloadExcel(u,c,h).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),a.value=!1})};return E("downloadingPdf",i),E("downloadingXls",a),E("serviceAux",m),E("resultFromLocalStorage",g),E("getProcessingStatus",b),(u,c)=>(M(),se("div",{ref_key:"filterTptDailyRegisterSection",ref:o},[g.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[0]||(c[0]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(m.value!==null?m.value.code:"")+": Lista de Registro Di\xE1rio de TPT ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:c[1]||(c[1]=h=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Lista de Registro Di\xE1rio de TPT ",1)]),_:1})),ie("div",lm,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:s.value,qtyProcessed:d.value,reportType:im,tabName:sm,params:e.params,progress:t.value,clinicalService:e.selectedService,onGenerateReport:D,onInitReportProcessing:v},null,8,["id","totalRecords","qtyProcessed","params","progress","clinicalService"])]),_:1})]),_:1})])],512))}};var cm=Fe(rm,[["__scopeId","data-v-094e76e8"]]);const{isMobile:Di,isOnline:bi}=ce(),Kn="RelatorioInventarioParcial",dm=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,um="Relatorio de Inventario Parcial",rn=Kn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Si={async generateSubreport(){const e=new jsPDF;return e.text("This is a subreport PDF",10,10),e},async downloadPDF(e,l,n,o){const i=de.currClinic(),a=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),s=o[0];a.setProperties({title:rn.concat(".pdf")});const d=new Image;d.src="data:image/png;base64,"+le;const t=[[{content:"Relatorio de Inventario Parcial",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+P(l).format("DD-MM-YYYY")+" \xE0 "+P(n).format("DD-MM-YYYY"),colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+s.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+P(n).year(),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(a,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),a.setFontSize(8),a.text("Rep\xFAblica de Mo\xE7ambique ",16,28),a.text("Minist\xE9rio da Sa\xFAde ",20,32),a.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),a.addImage(d,"png",28,15,10,10);const m=["Ordem","Lote","Data do ajuste","Saldo Inicial","Frascos Contados","Notas"],g=o;let f=1;for(let r=0;r<g.length;r++){const p=[],v=[[g[r].drugName]];K(a,{bodyStyles:{halign:"left",fontSize:10,fontStyle:"bold"},body:v}),f=1;const b=g[r].adjustments;for(const u in b){const c=[];c.push(f),c.push(b[u].batchNumber),c.push(P(new Date(b[u].captureDate)).format("DD-MM-YYYY")),c.push(String(b[u].operation_type).includes("AJUSTE_POSETIVO")?b[u].balance-b[u].adjustedValue:b[u].balance+b[u].adjustedValue),c.push(b[u].balance),c.push(b[u].notes),c.push(b[u].operation_type),p.push(c),f+=1}K(a,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},didDrawPage:function(u){const c="P\xE1gina "+a.internal.getNumberOfPages();a.setFontSize(8);const h=a.internal.pageSize,y=h.height?h.height:h.getHeight();a.text(c,u.settings.margin.right,y-10)},startY:a.lastAutoTable.finalY,theme:"grid",head:[m],body:p});const D=[[{content:"Saldo Actual",styles:{halign:"left",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:10},{content:g[r].totalBalance,styles:{halign:"center",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:20}],[{content:"Saldo Inicial",styles:{halign:"left",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:10},{content:String(g[r].operation_type).includes("AJUSTE_POSETIVO")?g[r].totalBalance+g[r].totalAdjustedValue:g[r].totalBalance-g[r].totalAdjustedValue,styles:{halign:"center",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:20}],[{content:"Varia\xE7\xE3o para o Med. ",styles:{halign:"left",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},cellWidth:10},{content:g[r].totalAdjustedValue,styles:{halign:"center",valign:"middle",fontStyle:"bold",fontSize:"10",textColor:0},cellWidth:20}]];K(a,{headStyles:{halign:"left"},theme:"grid",head:[["Totais","Valor"]],body:D,startY:a.lastAutoTable.finalY,tableWidth:84})}if(bi.value&&!Di.value)window.open(a.output("bloburl"));else{const r=a.output();this.downloadFile(rn,"pdf",r)}},async downloadExcel(e,l,n,o){de.currClinic();const i=new xe.exports.Workbook;i.creator="CSAUDE",i.lastModifiedBy="CSAUDE",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addWorksheet(Kn),s=i.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),d=a.getCell("A8"),t=a.getCell("A9"),m=a.getCell("A11"),g=a.getCell("A12"),f=a.getCell("C12"),r=a.getCell("E11"),p=a.getCell("E12"),v=a.getCell("B11"),b=a.getCell("B12"),D=a.getCell("D12"),u=a.getCell("F11"),c=a.getCell("F12"),h=a.getRow(15),y=a.getColumn("A"),x=a.getColumn("B"),R=a.getColumn("C"),_=a.getColumn("D"),N=a.getColumn("E"),O=a.getColumn("F");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=dm,t.value=um,v.value=o[0].clinic,D.value=e,b.value=o[0].district,u.value=P(l).format("DD-MM-YYYY"),c.value=P(n).format("DD-MM-YYYY"),m.value="Unidade Sanit\xE1ria",g.value="Distrito",f.value="Prov\xEDncia",r.value="Data In\xEDcio",p.value="Data Fim",a.mergeCells("A9:F10"),a.mergeCells("A15:F15"),h.height=30,y.width=35,x.width=20,R.width=20,_.width=20,N.width=20,O.width=30,g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},a.addImage(s,{tl:{col:0,row:1},ext:{width:144,height:98}});const T=a.getCell("A15");T.value="Medicamento";const q=o;T.font={name:"Arial",family:2,size:11,italic:!1,bold:!0};for(let V=0;V<q.length;V++){const G=a.lastRow.number!==void 0?a.lastRow.number:0,U=G,z=q[V].adjustments,Q=this.createArrayOfArrayRow(z),Z=V===0?"A17":"A"+Number(G+2);if(V===0){const Y=a.getCell("A16");Y.value=q[V].drugName,a.mergeCells("A16:F16")}else{const Y=Number(G+1),he=a.getCell("A"+Number(Y));he.value=q[V].drugName,a.mergeCells("A"+Y+" : F"+Y)}a.addTable({name:Kn,ref:Z,headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Ordem",totalsRowLabel:"none",filterButton:!1},{name:"Lote",totalsRowFunction:"none",filterButton:!1},{name:"Data do ajuste",totalsRowFunction:"none",filterButton:!1},{name:"Saldo Inicial",totalsRowFunction:"none",filterButton:!1},{name:"Frascos Contados",totalsRowFunction:"none",filterButton:!1},{name:"Notas",totalsRowFunction:"none",filterButton:!1}],rows:Q});for(let Y=14;Y<=U+1;Y++)a.getRow(Y).eachCell({includeEmpty:!0},Pe=>{Pe.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});for(let Y=G;Y<=U;Y++){const he=a.getRow(Y+1);a.getRow(Y+2).eachCell({includeEmpty:!0},ne=>{ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"dedfe0"},bgColor:{argb:"dedfe0"}},ne.font={name:"Arial",family:2,size:11,italic:!1,bold:!0}}),he.eachCell({includeEmpty:!0},ne=>{ne.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},ne.alignment={vertical:"middle",horizontal:"center",wrapText:!0},ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"4b4c4d"},bgColor:{argb:"4b4c4d"}},ne.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0}})}const L=a.getCell("A"+Number(G+z.length+3));L.value="Saldo Actual";const k=a.getCell("B"+Number(G+z.length+3));k.value=Number(q[V].totalBalance);const H=a.getCell("A"+Number(G+z.length+4));H.value="Saldo Inicial";const B=a.getCell("B"+Number(G+z.length+4));B.value=String(q[V].operation_type).includes("AJUSTE_POSETIVO")?Number(q[V].totalBalance)+Number(q[V].totalAdjustedValue):Number(q[V].totalBalance)-Number(q[V].totalAdjustedValue);const W=a.getCell("A"+Number(G+z.length+5));W.value="Total de Varia\xE7\xE3o para o Med.  ";const oe=a.getCell("B"+Number(G+z.length+5));oe.value=Number(q[V].totalAdjustedValue),H.font=L.font=W.font=H.font={name:"Arial",family:2,size:11,italic:!1,bold:!0}}const I=await i.xlsx.writeBuffer(),X="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",$=".xlsx",w=new Blob([I],{type:X});if(bi.value&&!Di.value)Ue(w,rn+$);else{let V=function(k,H){const B=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(B,function(W){G(W,k,H)},z)},G=function(k,H,B){k.getFile(H,{create:!0,exclusive:!1},function(W){U(W,B)},Q)},U=function(k,H){k.createWriter(function(B){B.onwriteend=function(){console.log("Successful file write..."),Z()},B.onerror=function(W){console.log("Failed file write: "+W)},B.write(H)})},z=function(k){console.log(k)},Q=function(k){console.log("errorr: "+k.toString())},Z=function(){const k=L;console.log("file system 44444: "+k);const H=cordova.file.externalRootDirectory+"Download/"+k;console.log("file system 2222: "+H);const B=decodeURIComponent(H);cordova.plugins.fileOpener2.open(B,"application/vnd.ms-excel",{error:function(W){console.log("file system open3333366: "+W+B)},success:function(){}})};const L="RelatorioInventarioParcial.xlsx";V(L,w)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].batchNumber),i.push(P(new Date(e[o].captureDate)).format("DD-MM-YYYY")),i.push(String(e[o].operation_type).includes("AJUSTE_POSETIVO")?e[o].balance-e[o].adjustedValue:e[o].balance+e[o].adjustedValue),i.push(e[o].balance),i.push(e[o].notes),l.push(i),n+=1}return n=0,e=[],l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const gm={class:"param-container"},yi="InventoryPartial",fm="INVENTARIO_PARCIAL",mm={__name:"InventoryPartial",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(!1),g=Xi(),f=x=>{if(s.value.remove(),x){const R=x.id;m.value=!0,ee.remove(R)}},r=S(null),p=S(!1),v=(x,R,_)=>{const N=x.map(O=>({value:O.id,label:P(O.endDate).format("DD-MM-YYYY")}));g.dialog({title:"Lista de Inventarios",message:"Seleccione o inventario:",options:{type:"checkbox",model:[],items:N},cancel:!0,persistent:!0}).onOk(O=>{O.forEach(T=>{b(T,R,_)}),d.value=!1}).onCancel(()=>{t.value=!1,d.value=!1}).onDismiss(()=>{t.value=!1,d.value=!1})},b=(x,R,_)=>{C.apiPrintInventoryReport(x,R).then(N=>{if(!N.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const O=N.data[0].adjustments[0];_==="PDF"?(Si.downloadPDF(O.province,O.startDate,O.endDate,N.data),d.value=!1):(d.value,Si.downloadExcel(O.province,O.startDate,O.endDate,N.data),t.value=!1)}})},D=(x,R)=>{R.value||ee.set(x.id,x)},u=async x=>{a.value=.001,l.value?(D(x,m),C.apiInitInventoryReportProcessing(x).then(R=>{h(x)})):D(x,m)},c=(x,R)=>{C.getInventoryList("inventoryReport",x).then(_=>{_.data.length===0?(n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1):v(_.data,x,R)})},h=x=>{C.getProcessingStatus("inventoryReport",x).then(R=>{R.data.progress>.001?(a.value=R.data.progress,a.value<100?(D(x,m),x.progress=R.data.progress,setTimeout(()=>{h(x)},3e3)):(a.value=100,x.progress=100,D(x,m))):setTimeout(()=>{h(x)},3e3)})},y=async(x,R)=>{l.value&&c(x,R)};return Me(()=>{console.log(yi)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",r),E("resultFromLocalStorage",p),E("getProcessingStatus",h),(x,R)=>(M(),se("div",{ref_key:"filterPartialInventorySection",ref:s},[p.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:R[0]||(R[0]=_=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(r.value!==null?r.value.code:"")+": Relat\xF3rio de Invent\xE1rio Parcial ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:R[1]||(R[1]=_=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Relat\xF3rio de Invent\xE1rio Parcial ",1)]),_:1})),ie("div",gm,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:fm,progress:a.value,tabName:yi,params:e.params,onGenerateReport:y,onInitReportProcessing:u},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var pm=Fe(mm,[["__scopeId","data-v-76ad9fd8"]]);const{isMobile:wi,isOnline:Ri}=ce(),Zn="RelatorioInventarioGeral",hm=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,vm="Relatorio de Inventario Geral",cn=Zn.concat("_"+P(new Date).format("DD-MM-YYYY"));var Ci={async generateSubreport(){const e=new jsPDF;return e.text("This is a subreport PDF",10,10),e},async downloadPDF(e,l,n,o){const i=de.currClinic(),a=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"}),s=o[0];a.setProperties({title:cn.concat(".pdf")});const d=new Image;d.src="data:image/png;base64,"+le;const t=[[{content:"Relatorio de Inventario Geral",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+P(l).format("DD-MM-YYYY")+" \xE0 "+P(n).format("DD-MM-YYYY"),colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+s.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+P(n).year(),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(a,{bodyStyles:{halign:"left",valign:"middle",fontSize:8},headStyles:{halign:"left",valign:"middle"},theme:"grid",body:t}),a.setFontSize(8),a.text("Rep\xFAblica de Mo\xE7ambique ",16,28),a.text("Minist\xE9rio da Sa\xFAde ",20,32),a.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),a.addImage(d,"png",28,15,10,10);const m=["Ordem","Lote","Data do ajuste","Saldo Inicial","Frascos Contados","Notas"],g=o;let f=1;for(let r=0;r<g.length;r++){const p=[],v=[[g[r].drugName]];K(a,{bodyStyles:{halign:"left",fontSize:10,fontStyle:"bold"},body:v}),f=1;const b=g[r].adjustments;for(const u in b){const c=[];c.push(f),c.push(b[u].batchNumber),c.push(P(new Date(b[u].captureDate)).format("DD-MM-YYYY")),c.push(String(b[u].operation_type).includes("AJUSTE_POSETIVO")?b[u].balance-b[u].adjustedValue:b[u].balance+b[u].adjustedValue),c.push(b[u].balance),c.push(b[u].notes),c.push(b[u].operation_type),p.push(c),f+=1}K(a,{bodyStyles:{halign:"center",fontSize:8},headStyles:{halign:"center",valign:"middle",fontSize:8},didDrawPage:function(u){const c="P\xE1gina "+a.internal.getNumberOfPages();a.setFontSize(8);const h=a.internal.pageSize,y=h.height?h.height:h.getHeight();a.text(c,u.settings.margin.right,y-10)},startY:a.lastAutoTable.finalY,theme:"grid",head:[m],body:p});const D=[[{content:"Saldo Actual ",styles:{halign:"left",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:10},{content:g[r].totalBalance,styles:{halign:"center",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:20}],[{content:"Saldo Inicial",styles:{halign:"left",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:10},{content:String(g[r].operation_type).includes("AJUSTE_POSETIVO")?g[r].totalBalance+g[r].totalAdjustedValue:g[r].totalBalance-g[r].totalAdjustedValue,styles:{halign:"center",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},ColumnWidth:20}],[{content:"Varia\xE7\xE3o para o Med. ",styles:{halign:"left",valign:"middle",fontStyle:"bold",fontSize:"8",textColor:0},cellWidth:10},{content:g[r].totalAdjustedValue,styles:{halign:"center",valign:"middle",fontStyle:"bold",fontSize:"10",textColor:0},cellWidth:20}]];K(a,{headStyles:{halign:"center"},theme:"grid",head:[["Totais","Valor"]],body:D,startY:a.lastAutoTable.finalY,tableWidth:84})}if(Ri.value&&!wi.value)window.open(a.output("bloburl"));else{const r=a.output();this.downloadFile(cn,"pdf",r)}},async downloadExcel(e,l,n,o){de.currClinic();const i=new xe.exports.Workbook;i.creator="CSAUDE",i.lastModifiedBy="CSAUDE",i.created=new Date,i.modified=new Date,i.lastPrinted=new Date;const a=i.addWorksheet(Zn),s=i.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),d=a.getCell("A8"),t=a.getCell("A9"),m=a.getCell("A11"),g=a.getCell("A12"),f=a.getCell("C12"),r=a.getCell("E11"),p=a.getCell("E12"),v=a.getCell("B11"),b=a.getCell("B12"),D=a.getCell("D12"),u=a.getCell("F11"),c=a.getCell("F12"),h=a.getRow(15),y=a.getColumn("A"),x=a.getColumn("B"),R=a.getColumn("C"),_=a.getColumn("D"),N=a.getColumn("E"),O=a.getColumn("F");d.alignment=t.alignment=h.alignment={vertical:"middle",horizontal:"center",wrapText:!0},m.alignment=g.alignment=f.alignment=r.alignment=p.alignment={vertical:"middle",horizontal:"left",wrapText:!1},d.border=t.border=m.border=b.border=g.border=v.border=f.border=D.border=r.border=u.border=p.border=c.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},d.value=hm,t.value=vm,v.value=o[0].clinic,D.value=e,b.value=o[0].district,u.value=P(l).format("DD-MM-YYYY"),c.value=P(n).format("DD-MM-YYYY"),m.value="Unidade Sanit\xE1ria",g.value="Distrito",f.value="Prov\xEDncia",r.value="Data In\xEDcio",p.value="Data Fim",a.mergeCells("A9:F10"),a.mergeCells("A15:F15"),h.height=30,y.width=35,x.width=20,R.width=20,_.width=20,N.width=20,O.width=30,g.font=f.font=r.font=p.font=m.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},a.addImage(s,{tl:{col:0,row:1},ext:{width:144,height:98}});const T=a.getCell("A15");T.value="Medicamento";const q=o;T.font={name:"Arial",family:2,size:11,italic:!1,bold:!0};for(let V=0;V<q.length;V++){const G=a.lastRow.number!==void 0?a.lastRow.number:0,U=G,z=q[V].adjustments,Q=this.createArrayOfArrayRow(z),Z=V===0?"A17":"A"+Number(G+2);if(V===0){const Y=a.getCell("A16");Y.value=q[V].drugName,a.mergeCells("A16:F16"),Y.alignment={vertical:"middle",horizontal:"left",wrapText:!1}}else{const Y=Number(G+1),he=a.getCell("A"+Number(Y));he.value=q[V].drugName,a.mergeCells("A"+Y+" : F"+Y),he.alignment={vertical:"middle",horizontal:"left",wrapText:!1}}a.addTable({name:Zn,ref:Z,headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"Ordem",totalsRowLabel:"none",filterButton:!1},{name:"Lote",totalsRowFunction:"none",filterButton:!1},{name:"Data do ajuste",totalsRowFunction:"none",filterButton:!1},{name:"Saldo Inicial",totalsRowFunction:"none",filterButton:!1},{name:"Frascos Contados",totalsRowFunction:"none",filterButton:!1},{name:"Notas",totalsRowFunction:"none",filterButton:!1}],rows:Q});for(let Y=14;Y<=U+1;Y++)a.getRow(Y).eachCell({includeEmpty:!0},Pe=>{Pe.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}});for(let Y=G;Y<=U;Y++){const he=a.getRow(Y+1);a.getRow(Y+2).eachCell({includeEmpty:!0},ne=>{ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"dedfe0"},bgColor:{argb:"dedfe0"}},ne.font={name:"Arial",family:2,size:11,italic:!1,bold:!0}}),he.eachCell({includeEmpty:!0},ne=>{ne.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},ne.alignment={vertical:"middle",horizontal:"center",wrapText:!0},ne.fill={type:"pattern",pattern:"solid",fgColor:{argb:"4b4c4d"},bgColor:{argb:"4b4c4d"}},ne.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0}})}const L=a.getCell("A"+Number(G+z.length+3));L.value="Saldo Actual";const k=a.getCell("B"+Number(G+z.length+3));k.value=Number(q[V].totalBalance);const H=a.getCell("A"+Number(G+z.length+4));H.value="Saldo Inicial";const B=a.getCell("B"+Number(G+z.length+4));B.value=String(q[V].operation_type).includes("AJUSTE_POSETIVO")?Number(q[V].totalBalance)+Number(q[V].totalAdjustedValue):Number(q[V].totalBalance)-Number(q[V].totalAdjustedValue);const W=a.getCell("A"+Number(G+z.length+5));W.value="Total de Varia\xE7\xE3o para o Med.  ";const oe=a.getCell("B"+Number(G+z.length+5));oe.value=Number(q[V].totalAdjustedValue),H.font=L.font=W.font=H.font={name:"Arial",family:2,size:11,italic:!1,bold:!0}}const I=await i.xlsx.writeBuffer(),X="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",$=".xlsx",w=new Blob([I],{type:X});if(Ri.value&&!wi.value)Ue(w,cn+$);else{let V=function(k,H){const B=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(B,function(W){G(W,k,H)},z)},G=function(k,H,B){k.getFile(H,{create:!0,exclusive:!1},function(W){U(W,B)},Q)},U=function(k,H){k.createWriter(function(B){B.onwriteend=function(){console.log("Successful file write..."),Z()},B.onerror=function(W){console.log("Failed file write: "+W)},B.write(H)})},z=function(k){console.log(k)},Q=function(k){console.log("errorr: "+k.toString())},Z=function(){const k=L;console.log("file system 44444: "+k);const H=cordova.file.externalRootDirectory+"Download/"+k;console.log("file system 2222: "+H);const B=decodeURIComponent(H);cordova.plugins.fileOpener2.open(B,"application/vnd.ms-excel",{error:function(W){console.log("file system open3333366: "+W+B)},success:function(){}})};const L="RelatorioInventarioGeral.xlsx";V(L,w)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].batchNumber),i.push(P(new Date(e[o].captureDate)).format("DD-MM-YYYY")),i.push(String(e[o].operation_type).includes("AJUSTE_POSETIVO")?e[o].balance-e[o].adjustedValue:e[o].balance+e[o].adjustedValue),i.push(e[o].balance),i.push(e[o].notes),l.push(i),n+=1}return n=0,e=[],l},downloadFile(e,l,n){const o=e+l;console.log("result"+o),i(o,n);function i(g,f){const r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){const g=o;console.log("file system 44444: "+g);const f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);const r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Dm={class:"param-container"},xi="InventoryGeneral",bm="INVENTARIO_GENERAL",Sm={__name:"InventoryGeneral",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(0),i=S(0),a=S(0),s=S(""),d=S(!1),t=S(!1),m=S(!1),g=Xi(),f=x=>{if(s.value.remove(),x){const R=x.id;m.value=!0,ee.remove(R)}},r=S(null),p=S(!1),v=(x,R,_)=>{const N=x.map(O=>({value:O.id,label:P(O.endDate).format("DD-MM-YYYY")}));g.dialog({title:"Lista de Inventarios",message:"Seleccione o inventario:",options:{type:"checkbox",model:[],items:N},cancel:!0,persistent:!0}).onOk(O=>{O.forEach(T=>{b(T,R,_)}),d.value=!1}).onCancel(()=>{t.value=!1,d.value=!1}).onDismiss(()=>{t.value=!1,d.value=!1})},b=(x,R,_)=>{C.apiPrintInventoryReport(x,R).then(N=>{if(!N.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1;else{const O=N.data[0].adjustments[0];_==="PDF"?(Ci.downloadPDF(O.province,O.startDate,O.endDate,N.data),d.value=!1):(d.value,Ci.downloadExcel(O.province,O.startDate,O.endDate,N.data),t.value=!1)}})},D=(x,R)=>{R.value||ee.set(x.id,x)},u=async x=>{a.value=.001,l.value?(D(x,m),C.apiInitInventoryReportProcessing(x).then(R=>{h(x)})):D(x,m)},c=(x,R)=>{C.getInventoryList("inventoryReport",x).then(_=>{_.data.length===0?(n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1,d.value=!1):v(_.data,x,R)})},h=x=>{C.getProcessingStatus("inventoryReport",x).then(R=>{R.data.progress>.001?(a.value=R.data.progress,a.value<100?(D(x,m),x.progress=R.data.progress,setTimeout(()=>{h(x)},3e3)):(a.value=100,x.progress=100,D(x,m))):setTimeout(()=>{h(x)},3e3)})},y=async(x,R)=>{l.value&&c(x,R)};return Me(()=>{console.log(xi)}),E("downloadingPdf",d),E("downloadingXls",t),E("serviceAux",r),E("resultFromLocalStorage",p),E("getProcessingStatus",h),(x,R)=>(M(),se("div",{ref_key:"filterGeneralInventorySection",ref:s},[p.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:R[0]||(R[0]=_=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(r.value!==null?r.value.code:"")+": Relat\xF3rio de Invent\xE1rio Geral ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:R[1]||(R[1]=_=>f(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Relat\xF3rio de Invent\xE1rio Geral ",1)]),_:1})),ie("div",Dm,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,clinicalService:e.selectedService,totalRecords:o.value,qtyProcessed:i.value,reportType:bm,progress:a.value,tabName:xi,params:e.params,onGenerateReport:y,onInitReportProcessing:u},null,8,["id","clinicalService","totalRecords","qtyProcessed","progress","params"])]),_:1})]),_:1})])],512))}};var ym=Fe(Sm,[["__scopeId","data-v-5db9058a"]]);const{isMobile:Pi,isOnline:Ai}=ce(),ea="PacientesEsperadosNumDia",wm=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 SERVI\xC7O NACIONAL DE SA\xDADE`,Rm="Relat\xF3rio de Pacientes Esperados Num Dia",dn=ea.concat("_"+P(new Date).format("DD-MM-YYYY"));var mo={async downloadPDF(e,l,n,o,i){const a=await Xe(Je),s=de.currClinic(),d=new Ce({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});d.addFileToVFS("NotoSans-Regular.ttf",a.split(",")[1]),d.addFont("NotoSans-Regular.ttf","NotoSans","normal"),d.setFont("NotoSans");const t=o[0];d.setProperties({title:dn.concat(".pdf")});const m=new Image;m.src="data:image/png;base64,"+le;const g=[[{content:"Lista de Pacientes Esperados num Dia",styles:{minCellHeight:25,fontSize:16,halign:"center"},colSpan:3,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+s.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Per\xEDodo: "+l+" \xE0 "+n,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+t.district,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+e,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Ano: "+t.year,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];K(d,{bodyStyles:{font:"NotoSans",halign:"left",valign:"middle",fontSize:8},headStyles:{font:"NotoSans",halign:"left",valign:"middle"},theme:"grid",body:g}),d.setFontSize(8),d.text("Rep\xFAblica de Mo\xE7ambique ",16,28),d.text("Minist\xE9rio da Sa\xFAde ",20,32),d.text("Servi\xE7o Nacional de Sa\xFAde ",16,36),d.addImage(m,"png",28,15,10,10);const f=["ORD","NID","Nome","Data do Pr\xF3ximo Levantamento","Regime Terap\xEAutico","Tipo de Dispensa","Sector Clinico"],r=o,p=[];let v=1;for(const b in r){const D=[];D.push(v),D.push(r[b].nid),D.push(r[b].firstNames+" "+r[b].middleNames+" "+r[b].lastNames),D.push(P(new Date(r[b].nextPickUpDate)).format("DD-MM-YYYY")),D.push(r[b].therapeuticRegimen),D.push(r[b].dispenseType),D.push(r[b].clinicSectorName),p.push(D),v+=1}if(v=0,K(d,{bodyStyles:{font:"NotoSans",halign:"center",fontSize:8},headStyles:{font:"NotoSans",halign:"center",valign:"middle",fontSize:8},columnStyles:{0:{cellWidth:20},1:{cellWidth:40},2:{cellWidth:60},3:{cellWidth:30},4:{cellWidth:50},5:{cellWidth:35},6:{cellWidth:35},7:{cellWidth:25}},didDrawPage:function(b){const D="P\xE1gina "+d.internal.getNumberOfPages();d.setFontSize(8);const u=d.internal.pageSize,c=u.height?u.height:u.getHeight();d.text(D,b.settings.margin.right,c-10)},startY:d.lastAutoTable.finalY,theme:"grid",head:[f],body:p}),Ai.value&&!Pi.value)window.open(d.output("bloburl")),i.value=!1;else{const b=d.output();Oe.downloadFile(dn,".pdf",b,i)}},async downloadExcel(e,l,n,o,i){de.currClinic();const a=o,s=this.createArrayOfArrayRow(a),d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(ea),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("A8"),f=t.getCell("A9"),r=t.getCell("A11"),p=t.getCell("A12"),v=t.getCell("D12"),b=t.getCell("I11"),D=t.getCell("I12"),u=t.getCell("B11"),c=t.getCell("B12"),h=t.getCell("E12"),y=t.getCell("J11"),x=t.getCell("J12"),R=t.getRow(15),_=t.getColumn("A"),N=t.getColumn("B"),O=t.getColumn("C"),T=t.getColumn("D"),q=t.getColumn("E"),I=t.getColumn("F"),X=t.getColumn("G"),$=t.getColumn("H"),w=t.getColumn("I"),V=t.getColumn("J");g.alignment=f.alignment=R.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=p.alignment=v.alignment=b.alignment=D.alignment={vertical:"middle",horizontal:"left",wrapText:!1},g.border=f.border=r.border=c.border=p.border=u.border=v.border=h.border=b.border=y.border=D.border=x.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=wm,f.value=Rm,u.value=o[0].clinic,h.value=e,c.value=o[0].district,y.value=l,x.value=n,r.value="Unidade Sanit\xE1ria",p.value="Distrito",v.value="Prov\xEDncia",b.value="Data In\xEDcio",D.value="Data Fim",t.mergeCells("A9:J10"),t.mergeCells("B11:H11"),t.mergeCells("B12:C12"),t.mergeCells("E12:H12"),t.mergeCells("A13:I13"),R.height=30,_.width=20,N.width=20,O.width=30,T.width=15,q.width=20,I.width=15,X.width=15,$.width=15,w.width=15,V.width=20,p.font=v.font=b.font=D.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:144,height:98}}),t.addTable({name:ea,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"ORD",totalsRowLabel:"none",filterButton:!1},{name:"NID",totalsRowLabel:"Totals:",filterButton:!1},{name:"Nome",totalsRowFunction:"none",filterButton:!1},{name:"Data do Pr\xF3ximo Levantamento",totalsRowLabel:"none"},{name:"Regime Terap\xEAutico",totalsRowFunction:"none",filterButton:!1},{name:"Tipo de Dispensa",totalsRowFunction:"none",filterButton:!1},{name:"Nome da Unidade Sanit\xE1ria",totalsRowFunction:"none",filterButton:!1}],rows:s});const U=t.lastRow.number!==void 0?t.lastRow.number:0;for(let k=14;k<=U;k++)t.getRow(k).eachCell({includeEmpty:!0},B=>{B.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},B.alignment={vertical:"middle",horizontal:"center",wrapText:!0},k===14&&(B.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},B.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:11,italic:!1,bold:!0})});const z=await d.xlsx.writeBuffer(),Q="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",Z=".xlsx",L=new Blob([z],{type:Q});if(Ai.value&&!Pi.value)Ue(L,dn+Z),i.value=!1;else{const k="PacientesEsperadosNoDia.xlsx";Oe.downloadFile(k,".xlsx",L,i)}},createArrayOfArrayRow(e){const l=[];let n=1;for(const o in e){const i=[];i.push(n),i.push(e[o].nid),i.push(e[o].firstNames+" "+e[o].middleNames+" "+e[o].lastNames),i.push(P(new Date(e[o].nextPickUpDate)).format("DD-MM-YYYY")),i.push(e[o].therapeuticRegimen),i.push(e[o].dispenseType),i.push(e[o].clinicSectorName),l.push(i),n+=1}return n=0,e=[],l}};const Fi=We[hn.entity];var Ei={async getDataLocalDb(e){const l=Ve.determineStartEndDate(e),[n]=await Promise.all([st.getAllExpectedPacksByStartDateAndEndDateFromDexie(l.startDate,l.endDate)]);for(const i of n){const a=i.patientvisitDetails.patientVisit.patient,s=i.patientvisitDetails.prescription.prescriptionDetails,d=i.patientvisitDetails.episode.patientServiceIdentifier,t=s.length>0?s[0].therapeuticRegimen:"",m=s.length>0?s[0].dispenseType:"";if(d.service.id===l.clinicalService){const g=new hn;g.dispenseType=m.description,g.reportId=l.id,g.year=l.year,g.startDate=l.startDate,g.endDate=l.endDate,g.nid=d.value,g.firstNames=a.firstNames,g.middleNames=a.middleNames,g.lastNames=a.lastNames,g.cellphone=a.cellphone,g.pickUpDate=i.pickupDate,g.nextPickUpDate=i.nextPickUpDate,g.therapeuticRegimen=t.description,g.dispenseMode=i.dispenseMode.description,g.clinicalService=d.service.description,g.clinic=i.clinic.clinicName,g.id=He(),this.localDbAddOrUpdate(g),console.log(g)}}const o=await dt.getLocalDbPatientVisitsExpectedOnDay(l.clinicalService,l.startDate,l.endDate);for(const i of o)if(i.pack!==void 0){const a=new hn,s=i.prescription.prescriptionDetails;let d=i.prescription;d=await mn.getPrescriptionMobileById(d.id);const t=zi.getById(s.length>0?s[0].dispenseType.id:"");let m=i.patientVisit;m===null&&(m=await vt.getAllMobileById(i.patient_visit_id));const g=await Mt.getPatientByIdMobile(m.patient.id),f=await hr.apiFetchById(i.episode.id);let r=g.identifiers.find(p=>p.id===f.patientServiceIdentifier.id);if(r||(r=await pn.localDbGetById(i.episode.patientServiceIdentifier.id)),r){const p=i.pack,v=i.clinic,b=d.prescriptionDetails,D=await ut.localDbGetById(r.service.id),u=await Vi.getInMobileById(b.length>0?b[0].therapeuticRegimen.id:""),c=await vr.localDbGetById(p.dispenseMode.id);a.dispenseType=t.description,a.reportId=l.id,a.year=l.year,a.startDate=l.startDate,a.endDate=l.endDate,a.nid=r.value,a.firstNames=g.firstNames,a.middleNames=g.middleNames,a.lastNames=g.lastNames,a.cellphone=g.cellphone,a.pickUpDate=p.pickupDate,a.nextPickUpDate=p.nextPickUpDate,a.therapeuticRegimen=u.description,a.dispenseMode=c.description,a.clinicalService=D.description,a.clinic=v.clinicName,a.id=He(),this.localDbAddOrUpdate(a),console.log(a)}}},localDbAddOrUpdate(e){return Fi.add(e).catch(l=>{console.log(l)})},async localDbGetAllByReportId(e){return Fi.where("reportId").equalsIgnoreCase(e).toArray().then(l=>l)}};const Cm={class:"param-container"},xm="ExpectedPatients",Pm="EXPECTED_PATIENTS",Am={__name:"expectedOfDay",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=e,i=S(0),a=S(""),s=S(0),d=S(0),t=Ge(S(!1)),m=S(!1),g=S(!1),f=(c,h)=>{h.value||ee.set(c.id,c)},r=c=>{if(a.value.remove(),c){const h=c.id;g.value=!0,ee.remove(h)}else g.value=!0,ee.remove(o.id)},p=S(null),v=S(!1),b=c=>{if(i.value=.001,l.value){f(c,g);const h=Ve.determineStartEndDate(c);C.apiInitExpectedPatientsProcessing(h).then(y=>{D(h)})}else{const h=Ve.determineStartEndDate(c);Ei.getDataLocalDb(h).then(y=>{i.value=100,c.progress=100}),f(c,g)}},D=c=>{l.value&&C.getProcessingStatus("expectedPatientsReport",c).then(h=>{h.data.progress>.001?(i.value=h.data.progress,i.value<100?(f(c,g),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(i.value=100,c.progress=100,f(c,g))):setTimeout(()=>{D(c)},3e3)})},u=async(c,h)=>{if(l.value)C.apiPrintExpectedPatientsReport(c).then(y=>{if(!y.data[0])n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1,t.value=!1;else{const x=y.data[0];h==="PDF"?mo.downloadPDF(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y.data,t):mo.downloadExcel(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y.data,m)}});else{const y=await Ei.localDbGetAllByReportId(c);if(y.length===0)n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1,t.value=!1;else{const x=y[0];h==="PDF"?await mo.downloadPDF(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y,t):await mo.downloadExcel(x.province,P(new Date(x.startDate)).format("DD-MM-YYYY"),P(new Date(x.endDate)).format("DD-MM-YYYY"),y,m)}}};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",p),E("resultFromLocalStorage",v),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterExpectedSection",ref:a},[v.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>r(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(p.value!==null?p.value.code:"")+": Pacientes Esperados Num Dia ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>r(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Pacientes Esperados Num Dia ",1)]),_:1})),ie("div",Cm,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,reportType:Pm,tabName:xm,params:e.params,totalRecords:s.value,progress:i.value,qtyProcessed:d.value,clinicalService:e.selectedService,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","params","totalRecords","progress","qtyProcessed","clinicalService"])]),_:1})]),_:1})])],512))}};var Fm=Fe(Am,[["__scopeId","data-v-148f1c2c"]]);const{isMobile:Mi,isOnline:ht}=ce(),Em=`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,Mm="MAPA MENSAL DE MEDICAMENTOS DA TB",ta="MMIA",un=ta.concat("_"+P(new Date).format("DD-MM-YYYY")),Yi=["Janeiro","Fevereiro","Mar\xE7o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];var Ni={async downloadPDF(e){const l=new Ce({orientation:"p",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});l.setFontSize(10);const n=new Image;n.src="data:image/png;base64,"+le,l.setProperties({title:un.concat(".pdf")});const o=["FNM","MEDICAMENTO","Unidade","Saldo Inicial","Entradas","Sa\xEDdas","Perdas e Ajustes","Invent\xE1rio","Validade"],i=de.currClinic();let a={},s=[],d=[],t=[];if(ht.value){if(a=await C.get("mmiaReport",e),a.status===204||a.data.length===0)return 204;s=a.data,t=s.mmiaStockSubReportItemList,d=s.mmiaRegimenSubReportList,console.log(s)}else{if(s=await $e.getDataLocalReportMmia(e),s===void 0||s.length===0)return 204;t=await $e.getDataLocalReportStock(e),d=await $e.getDataLocalReportRegimen(e)}const m=this.createArrayOfArrayRow(t),g=this.createRegimenArrayOfArrayRow(d),f=this.pacienteTipoTableData("XLS"),r=this.fasesProfilaxiaTableData("XLS",d),p=this.periodicidadeDaDispensaTableData("XLS",d),v=this.createRegimenTotalArrayRow(ht.value?s.mmiaRegimenSubReportList:d,"XLS",d),b=this.createFotterTableRow(),D=Yi[new Date(s.endDate).getMonth()],u=[],c=[],h=[],y=[];c.push(n),c.push({content:`REP\xDABLICA DE MO\xC7AMBIQUE 
MINIST\xC9RIO DA SA\xDADE 
CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS`,styles:{halign:"left",valign:"middle",fontStyle:"bold",textColor:0}}),c.push({content:"MAPA MENSAL DE MEDICAMENTOS DA TB",styles:{halign:"center",valign:"middle",fontStyle:"bold",textColor:0}}),c.push({content:"M\xEAs: "+D,styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}),h.push({content:"Unidade Sanit\xE1ria: "+i.clinicName,colSpan:3,styles:{halign:"left",fontStyle:"bold",textColor:0}}),y.push({colSpan:2,content:"Distrito: "+i.district.description,styles:{halign:"left",fontStyle:"bold",textColor:0}}),y.push({content:"Prov\xEDncia: "+i.province.description,styles:{halign:"left",fontStyle:"bold",textColor:0}}),h.push({rowSpan:2,content:"Ano: "+s.year,styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0}}),u.push(c),u.push(h),u.push(y),K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6,textColor:0},columnStyles:{0:{cellWidth:14}},styles:{maxCellHeight:4},body:u,startY:10}),l.addImage(n,"PNG",16,10,10,10),K(l,{theme:"grid",styles:{maxCellHeight:4},bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:13},1:{halign:"left"},2:{cellWidth:15},3:{cellWidth:18},4:{cellWidth:16},5:{cellWidth:13},6:{cellWidth:18},7:{cellWidth:17},8:{cellWidth:17}},headStyles:{halign:"center",valign:"middle",fontSize:5,fontStyle:"bold",textColor:0,fillColor:[208,216,252]},head:[o],body:m,startY:l.lastAutoTable.finalY});const x=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:35},2:{cellWidth:33}},headStyles:{halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[[{content:"Fases de Tratamento",colSpan:2,styles:{halign:"center",fillColor:[187,216,118]}},{content:"Nr. Dias Dispensados",styles:{halign:"center",fillColor:[187,216,118]}}]],body:g,startY:x+1,margin:{right:90.1}});const R=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:35},2:{cellWidth:33}},headStyles:{halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:v,startY:R+1,margin:{right:90.1}});const _=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:35},2:{cellWidth:33}},headStyles:{halign:"center",valign:"middle",fontSize:6,fillColor:[75,76,77]},styles:{maxCellHeight:4},head:[[{content:"Faixas Etarias",styles:{halign:"center",fillColor:[187,216,118]}},{content:"Tratamento",styles:{halign:"center",fillColor:[187,216,118]}},{content:"Profilaxia",styles:{halign:"center",fillColor:[187,216,118]}}]],body:[[{content:"Adultos"},{content:""},{content:d[0].totaldcline2}],[{content:"Crian\xE7a < 25 Kg"},{content:""},{rowSpan:2,content:d[0].totaldcline1,styles:{valign:"middle",halign:"center"}}],[{content:"Crian\xE7a > 25 Kg"},{content:""}]],startY:_+1,margin:{right:90.1}});const N=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{halign:"left",fillColor:[240,241,242]},1:{cellWidth:30}},head:[[{content:"Quantifica\xE7\xE3o dos doentes",styles:{halign:"center",fillColor:[75,76,77]}}]],headStyles:{halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:[],startY:x+1,margin:{left:121.1}});const O=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:20},2:{cellWidth:20}},headStyles:{halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:f,startY:O+1,margin:{left:121.1}});const T=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:20},2:{cellWidth:20}},headStyles:{halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:r,startY:T+3,margin:{left:121.1}});const q=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{cellWidth:20},2:{cellWidth:20}},headStyles:{halign:"center",valign:"middle",fontSize:6},styles:{maxCellHeight:4},body:p,startY:q+3,margin:{left:121.1}});const I=l.lastAutoTable.finalY;K(l,{theme:"grid",bodyStyles:{halign:"center",fontSize:6},columnStyles:{0:{halign:"left"}},styles:{maxCellHeight:2},body:[["Observa\xE7\xE3oes:"],[` 







`]],startY:I+3,margin:{left:121.1}}),K(l,{theme:"grid",bodyStyles:{halign:"left",fontSize:6},columnStyles:{1:{cellWidth:60},2:{cellWidth:55}},styles:{maxCellHeight:2},body:b,startY:N+10}),l.setFontSize(7),l.text(`Nota: Mapa de Preenchimento Obrigat\xF3rio Mensal pela Farm\xE1cia da Unidade Sanit\xE1ria 
Vers\xE3o no 8 19 Nov 2019 DS TLD90 MDS e ARVs de nova gera\xE7\xE3o`,15,l.lastAutoTable.finalY+5);const X="P\xE1gina "+l.internal.getNumberOfPages();l.setFontSize(8);const $=l.internal.pageSize,w=$.height?$.height:$.getHeight();if(l.text(X,15,w-10),ht.value&&!Mi.value)window.open(l.output("bloburl"));else{console.log(l);var V=l.output();console.log(V),this.downloadFile(un,"pdf",V)}},async downloadExcel(e){const l=de.currClinic();let n={},o=[],i=[],a=[];if(ht.value){if(n=await C.get("mmiaReport",e),n.status===204||n.data.length===0)return 204;o=n.data,a=o.mmiaStockSubReportItemList,i=o.mmiaRegimenSubReportList}else{if(o=await $e.getDataLocalReportMmia(e),o===void 0||o.length===0)return 204;a=await $e.getDataLocalReportStock(e),i=await $e.getDataLocalReportRegimen(e)}const s=this.createArrayOfArrayRow(a);this.createRegimenArrayOfArrayRow(i),this.createMmiaTipoDoentesArrayRow(o),this.createMmiaFaixaEtariaArrayRow(o),this.createMmiaProfilaxiaArrayRow(o),this.createRegimenTotalArrayRow(ht.value?o.mmiaRegimenSubReportList:i,"XLS",i),this.createLinesSumaryArrayRow(ht.value?o.mmiaRegimenSubReportList:i,"XLS"),this.createLinesSumaryTotalArrayRow(ht.value?o.mmiaRegimenSubReportList:i,"XLS"),this.createMmiaDispenseTypeDSArrayRow(o),this.createMmiaDispenseTypeDTArrayRow(o),this.createMmiaDispenseTypeDMArrayRow(o),this.createMmiaAjustePercentageArrayRow(o),this.createFotterTableRow();const d=new xe.exports.Workbook;d.creator="FGH",d.lastModifiedBy="FGH",d.created=new Date,d.modified=new Date,d.lastPrinted=new Date;const t=d.addWorksheet(ta),m=d.addImage({base64:"data:image/png;base64,"+le,extension:"png"}),g=t.getCell("B1"),f=t.getCell("C1"),r=t.getCell("A8"),p=t.getCell("A9"),v=t.getCell("C9"),b=t.getCell("I1"),D=t.getCell("I8"),u=t.getRow(11),c=t.getColumn("A"),h=t.getColumn("B"),y=t.getColumn("C"),x=t.getColumn("D"),R=t.getColumn("E"),_=t.getColumn("F"),N=t.getColumn("G"),O=t.getColumn("H"),T=t.getColumn("I");b.alignment=f.alignment=u.alignment=D.alignment={vertical:"middle",horizontal:"center",wrapText:!0},r.alignment=g.alignment=p.alignment=v.alignment={vertical:"middle",horizontal:"left",wrapText:!1},D.border=b.border=g.border=f.border=r.border=p.border=v.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},g.value=Em,f.value=Mm,b.value="M\xEAs: "+Yi[new Date(o.endDate).getMonth()],D.value="Ano: "+o.year,r.value="Unidade Sanit\xE1ria: "+l.clinicName,p.value="Distrito: "+l.district.description,v.value="Prov\xEDncia: "+l.province.description,t.mergeCells("A1:A7"),t.mergeCells("B1:B7"),t.mergeCells("C1:H7"),t.mergeCells("I1:I7"),t.mergeCells("A8:H8"),t.mergeCells("A9:B9"),t.mergeCells("C9:H9"),t.mergeCells("I8:I9"),u.height=30,c.width=18,h.width=70,y.width=35,x.width=30,R.width=10,_.width=10,N.width=10,O.width=12,T.width=13,f.font=p.font=v.font=r.font={name:"Arial",family:2,size:11,italic:!1,bold:!0},t.addImage(m,{tl:{col:0,row:1},ext:{width:119,height:98}}),t.addTable({name:ta,ref:"A11",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"FNM",totalsRowLabel:"Totals:",filterButton:!1},{name:"Medicamento",totalsRowFunction:"none",filterButton:!1},{name:"Unidade",totalsRowFunction:"none",filterButton:!1},{name:"Saldo Inicial",totalsRowFunction:"none",filterButton:!1},{name:"Entradas",totalsRowFunction:"none",filterButton:!1},{name:"Sa\xEDdas",totalsRowFunction:"none",filterButton:!1},{name:"Perdas e Ajustes",totalsRowFunction:"none",filterButton:!1},{name:"Invent\xE1rio",totalsRowFunction:"none",filterButton:!1},{name:"Validade",totalsRowFunction:"none",filterButton:!1}],rows:s});const q=Number(t.lastRow.number)+2,I=t.getCell("A"+Number(q));t.mergeCells("A"+Number(q)+":B"+Number(q)),I.value="Fases de Tratamento";const X=t.getCell("C"+Number(q));X.value="Nr. Dias Dispensados";const $=t.getCell("E"+Number(q));t.mergeCells("E"+Number(q)+":I"+Number(q)),$.value="Quantifica\xE7\xE3o dos doentes";const w=Number(t.lastRow.number),V=t.getCell("A"+Number(w+1));t.mergeCells("A"+Number(w+1)+":A"+(Number(w)+7)),V.value="Adulto";const G=t.getCell("B"+Number(w+1));G.value="Sens\xEDvel Intensiva";const U=t.getCell("C"+Number(w+1));U.value="";const z=t.getCell("B"+Number(w+2));z.value="Sens\xEDvel Manuten\xE7\xE3o";const Q=t.getCell("C"+Number(w+2));Q.value="";const Z=t.getCell("B"+Number(w+3));Z.value="MR Intensiva";const L=t.getCell("C"+Number(w+3));L.value="";const k=t.getCell("B"+Number(w+4));k.value="MR Manuten\xE7\xE3o";const H=t.getCell("C"+Number(w+4));H.value="";const B=t.getCell("B"+Number(w+5));B.value="XR Indu\xE7\xE3o";const W=t.getCell("C"+Number(w+5));W.value="";const oe=t.getCell("B"+Number(w+6));oe.value="XR Manuten\xE7\xE3o";const Y=t.getCell("C"+Number(w+6));Y.value="";const he=t.getCell("B"+Number(w+7));he.value="XR Intensiva";const Pe=t.getCell("C"+Number(w+7));Pe.value="";const ne=t.getCell("A"+Number(w+8));t.mergeCells("A"+Number(w+8)+":A"+(Number(w)+14)),ne.value="Pediatrico";const re=t.getCell("B"+Number(w+8));re.value="Sens\xEDvel Intensiva";const me=t.getCell("C"+Number(w+8));me.value="";const Ye=t.getCell("B"+Number(w+9));Ye.value="Sens\xEDvel Manuten\xE7\xE3o";const Ne=t.getCell("C"+Number(w+9));Ne.value="";const we=t.getCell("B"+Number(w+10));we.value="MR Intensiva";const ge=t.getCell("C"+Number(w+10));ge.value="";const De=t.getCell("B"+Number(w+11));De.value="MR Manuten\xE7\xE3o";const be=t.getCell("C"+Number(w+11));be.value="";const Le=t.getCell("B"+Number(w+12));Le.value="XR Indu\xE7\xE3o";const Ie=t.getCell("C"+Number(w+12));Ie.value="";const Se=t.getCell("B"+Number(w+13));Se.value="XR Manuten\xE7\xE3o";const Ee=t.getCell("C"+Number(w+13));Ee.value="";const ue=t.getCell("B"+Number(w+14));ue.value="XR Intensiva";const ve=t.getCell("C"+Number(w+14));ve.value="";const Ae=t.getCell("E"+Number(w+1));t.mergeCells("E"+Number(w+1)+":F"+(Number(w)+7)),Ae.value="Pacientes Novos no Sector da TB";const Te=t.getCell("G"+Number(w+1));t.mergeCells("G"+Number(w+1)+":H"+(Number(w)+1)),Te.value="Paciente/Tipo";const Ft=t.getCell("I"+Number(w+1));Ft.value="Total";const Co=t.getCell("G"+Number(w+2));t.mergeCells("G"+Number(w+2)+":H"+(Number(w)+2)),Co.value="Novo Adulto Sensivel";const xo=t.getCell("I"+Number(w+2));xo.value="";const Tt=t.getCell("G"+Number(w+3));t.mergeCells("G"+Number(w+3)+":H"+(Number(w)+3)),Tt.value="Novo Adulto MR";const ft=t.getCell("I"+Number(w+3));ft.value="";const oa=t.getCell("G"+Number(w+4));t.mergeCells("G"+Number(w+4)+":H"+(Number(w)+4)),oa.value="Novo Adulto XR";const wt=t.getCell("I"+Number(w+4));wt.value="";const fs=t.getCell("G"+Number(w+5));t.mergeCells("G"+Number(w+5)+":H"+(Number(w)+5)),fs.value="Nova Crian\xE7a Sensivel";const ms=t.getCell("I"+Number(w+5));ms.value="";const ps=t.getCell("G"+Number(w+6));t.mergeCells("G"+Number(w+6)+":H"+(Number(w)+6)),ps.value="Nova Crian\xE7a MR";const hs=t.getCell("I"+Number(w+6));hs.value="";const vs=t.getCell("G"+Number(w+7));t.mergeCells("G"+Number(w+7)+":H"+(Number(w)+7)),vs.value="Nova Crian\xE7a MR";const Ds=t.getCell("I"+Number(w+7));Ds.value="",t.mergeCells("E"+Number(w+8)+":F"+(Number(w)+8));const na=t.getCell("G"+Number(w+8));t.mergeCells("G"+Number(w+8)+":H"+(Number(w)+8)),na.value="Total";const aa=t.getCell("I"+Number(w+8));aa.value="";const Po=t.getCell("E"+Number(w+10));t.mergeCells("E"+Number(w+10)+":F"+(Number(w)+13)),Po.value="Seguimento Profilaxias (PUs e Farm\xE1cias P\xFAblicas)";const la=t.getCell("G"+Number(w+10));t.mergeCells("G"+Number(w+10)+":H"+(Number(w)+10)),la.value="Fases Profilaxia";const Ao=t.getCell("I"+Number(w+10));Ao.value="Total";const bs=t.getCell("G"+Number(w+11));t.mergeCells("G"+Number(w+11)+":H"+(Number(w)+11)),bs.value="In\xEDcio";const Ss=t.getCell("I"+Number(w+11));Ss.value=i[0].totaldcline3;const ys=t.getCell("G"+Number(w+12));t.mergeCells("G"+Number(w+12)+":H"+(Number(w)+12)),ys.value="Cont\xEDnua/Manuten\xE7\xE3o ";const ws=t.getCell("I"+Number(w+12));ws.value=i[0].totalline3;const Rs=t.getCell("G"+Number(w+13));t.mergeCells("G"+Number(w+13)+":H"+(Number(w)+13)),Rs.value="Final/\xDAltima Dispensa";const Cs=t.getCell("I"+Number(w+13));Cs.value=i[0].totaldcline4,t.mergeCells("E"+Number(w+14)+":F"+(Number(w)+14));const ia=t.getCell("G"+Number(w+14));t.mergeCells("G"+Number(w+14)+":H"+(Number(w)+14)),ia.value="Total";const xs=t.getCell("I"+Number(w+14));xs.value=i[0].totaldcline3+i[0].totalline3+i[0].totaldcline4;const Fo=t.getCell("E"+Number(w+16));t.mergeCells("E"+Number(w+16)+":F"+(Number(w)+18)),Fo.value="Tipo de Dispensa dos Profilacticos";const sa=t.getCell("G"+Number(w+16));t.mergeCells("G"+Number(w+16)+":H"+(Number(w)+16)),sa.value="Periodicidade da Dispensa";const Eo=t.getCell("I"+Number(w+16));Eo.value="Total";const Ps=t.getCell("G"+Number(w+17));t.mergeCells("G"+Number(w+17)+":H"+(Number(w)+17)),Ps.value="Mensal";const As=t.getCell("I"+Number(w+17));As.value=i[0].totalline2;const Fs=t.getCell("G"+Number(w+18));t.mergeCells("G"+Number(w+18)+":H"+(Number(w)+18)),Fs.value="Trimestral";const Es=t.getCell("I"+Number(w+18));Es.value=i[0].totalline1,t.mergeCells("E"+Number(w+19)+":F"+(Number(w)+19));const ra=t.getCell("G"+Number(w+19));t.mergeCells("G"+Number(w+19)+":H"+(Number(w)+19)),ra.value="Total";const Ms=t.getCell("I"+Number(w+19));Ms.value=i[0].totalline2+i[0].totalline1;const Ys=t.getCell("E"+Number(w+21));t.mergeCells("E"+Number(w+21)+":I"+(Number(w)+21)),Ys.value="Observa\xE7\xE3oes:",t.mergeCells("E"+Number(w+22)+":I"+(Number(w)+31));const Mo=t.getCell("A"+Number(w+16));t.mergeCells("A"+Number(w+16)+":A"+(Number(w)+23)),Mo.value="PUs er Farm\xE1cia Ambulat\xF3rio";const It=t.getCell("B"+Number(w+16));It.value="Produto";const Bt=t.getCell("C"+Number(w+16));Bt.value="Nr Comprimidos";const Ns=t.getCell("B"+Number(w+17));Ns.value="Isoniazida 100 mg";const Ts=t.getCell("C"+Number(w+17));Ts.value=Number(i[0].line1);const Is=t.getCell("B"+Number(w+18));Is.value="Isoniazida 300 mg";const Bs=t.getCell("C"+Number(w+18));Bs.value=Number(i[0].line2);const Os=t.getCell("B"+Number(w+19));Os.value="Levofloxacina 100 mg Disp";const Ls=t.getCell("C"+Number(w+19));Ls.value=Number(i[0].line3);const ks=t.getCell("B"+Number(w+20));ks.value="Levofloxacina 250 mg Rev";const Vs=t.getCell("C"+Number(w+20));Vs.value=Number(i[0].line4);const zs=t.getCell("B"+Number(w+21));zs.value="3HP (Rifapentina+Isoniazida)";const _s=t.getCell("C"+Number(w+21));_s.value=Number(i[0].totalline4);const Us=t.getCell("B"+Number(w+22));Us.value="Piridoxina 25mg";const $s=t.getCell("C"+Number(w+22));$s.value=Number(i[0].totalPatients);const Hs=t.getCell("B"+Number(w+23));Hs.value="Piridoxina 50mg";const Gs=t.getCell("C"+Number(w+23));Gs.value=Number(i[0].cumunitaryClinic);const Yo=t.getCell("A"+Number(w+25));Yo.value="Faixas Etarias";const Ot=t.getCell("B"+Number(w+25));Ot.value="Tratamento";const Lt=t.getCell("C"+Number(w+25));Lt.value="Profilaxia";const ca=t.getCell("A"+Number(w+26));ca.value="Adultos";const qs=t.getCell("B"+Number(w+26));qs.value="";const da=t.getCell("C"+Number(w+26));da.value=i[0].totaldcline2;const ua=t.getCell("A"+Number(w+27));ua.value="Crian\xE7a < 25 Kg";const Ws=t.getCell("B"+Number(w+27));Ws.value="";const ga=t.getCell("C"+Number(w+27));t.mergeCells("C"+Number(w+27)+":C"+(Number(w)+28)),ga.value=i[0].totaldcline1;const fa=t.getCell("A"+Number(w+28));fa.value="Crian\xE7a > 25 Kg";const Qs=t.getCell("B"+Number(w+28));Qs.value="";const js=t.getCell("A"+Number(w+38));t.mergeCells("A"+Number(w+38)+":B"+(Number(w)+38)),js.value="Elaborado por";const Xs=t.getCell("C"+Number(w+38));t.mergeCells("C"+Number(w+38)+":D"+(Number(w)+38)),Xs.value="Visto";const Js=t.getCell("E"+Number(w+38));t.mergeCells("E"+Number(w+38)+":I"+(Number(w)+38)),Js.value="Data de elabora\xE7\xE3o:";const ma=t.getCell("A"+Number(w+39));t.mergeCells("A"+Number(w+39)+":I"+(Number(w)+39)),ma.value="Nota: Mapa de Preenchimento Obrigat\xF3rio Mensal pela Farm\xE1cia da Unidade Sanit\xE1ria Vers\xE3o no 8 19 Nov 2019 DS TLD90 MDS e ARVs de nova gera\xE7\xE3o",I.fill=X.fill=It.fill=Bt.fill=Yo.fill=Ot.fill=Lt.fill=Ae.fill=Po.fill=Fo.fill={type:"pattern",pattern:"solid",fgColor:{argb:"bad975"},bgColor:{argb:"bad975"}},$.fill={type:"pattern",pattern:"solid",fgColor:{argb:"060606"},bgColor:{argb:"060606"}},Te.fill=Ft.fill=la.fill=Ao.fill=sa.fill=Eo.fill={type:"pattern",pattern:"solid",fgColor:{argb:"c49e54"},bgColor:{argb:"c49e54"}},V.fill={type:"pattern",pattern:"solid",fgColor:{argb:"c4d6f0"},bgColor:{argb:"c4d6f0"}},ne.fill=Mo.fill={type:"pattern",pattern:"solid",fgColor:{argb:"b0c9f5"},bgColor:{argb:"b0c9f5"}},I.font=X.font=It.font=Bt.font=Yo.font=Ot.font=Lt.font=$.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:10,italic:!1,bold:!0},I.alignment=V.alignment=ne.alignment=Mo.alignment=ca.alignment=ua.alignment=fa.alignment=ga.alignment=da.alignment=Ae.alignment=Po.alignment=Fo.alignment=aa.alignment=$.alignment=Ft.alignment=Ao.alignment=Eo.alignment=It.alignment=Ot.alignment=X.alignment=Bt.alignment=Lt.alignment={vertical:"middle",horizontal:"center",wrapText:!0},ma.alignment=na.alignment=ia.alignment=ra.alignment={horizontal:"right",wrapText:!0};const Ks=await d.xlsx.writeBuffer(),Zs="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",er=".xlsx",pa=new Blob([Ks],{type:Zs});if(ht.value&&!Mi.value)_e.exports.saveAs(pa,un+er);else{let tr=function(tt,pt){const rt=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(rt,function(Dt){or(Dt,tt,pt)},ar)},or=function(tt,pt,rt){tt.getFile(pt,{create:!0,exclusive:!1},function(Dt){nr(Dt,rt)},lr)},nr=function(tt,pt){tt.createWriter(function(rt){rt.onwriteend=function(){console.log("Successful file write..."),ir()},rt.onerror=function(Dt){console.log("Failed file write: "+Dt)},rt.write(pt)})},ar=function(tt){console.log(tt)},lr=function(tt){console.log("errorr: "+tt.toString())},ir=function(){const tt=ha;console.log("file system 44444: "+tt);const pt=cordova.file.externalRootDirectory+"Download/"+tt;console.log("file system 2222: "+pt);const rt=decodeURIComponent(pt);cordova.plugins.fileOpener2.open(rt,"application/vnd.ms-excel",{error:function(Dt){console.log("file system open3333366: "+Dt+rt)},success:function(){}})};const ha="Mmia.xlsx";tr(ha,pa)}},createArrayOfArrayRow(e){const l=[];for(const n in e){const o=[];o.push(e[n].fnmCode),o.push(e[n].drugName),o.push(e[n].unit+" comp"),o.push(e[n].inventory-e[n].initialEntrance+e[n].outcomes-e[n].lossesAdjustments),o.push(e[n].initialEntrance),o.push(e[n].outcomes),o.push(e[n].lossesAdjustments),o.push(e[n].inventory),o.push(P(e[n].expireDate).format("DD-MM-YYYY")),l.push(o)}return l},createRegimenArrayOfArrayRow(e){const l=[],n=[],o=[],i=[],a=[],s=[],d=[],t=[],m=[],g=[],f=[],r=[],p=[],v=[],b=[];return n.push({rowSpan:7,content:"Adulto:",styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0,fillColor:[196,213,239]}}),n.push({content:"Sens\xEDvel Intensiva",styles:{halign:"left"}},{content:""}),o.push({content:"Sens\xEDvel Manuten\xE7\xE3o",styles:{halign:"left"}},{content:""}),i.push({content:"MR Intensiva",styles:{halign:"left"}},{content:""}),a.push({content:"MR Manuten\xE7\xE3o",styles:{halign:"left"}},{content:""}),s.push({content:"XR Indu\xE7\xE3o",styles:{halign:"left"}},{content:""}),d.push({content:"XR Manuten\xE7\xE3o",styles:{halign:"left"}},{content:""}),t.push({content:"XR Intensiva",styles:{halign:"left"}},{content:""}),m.push({rowSpan:7,content:"Pediatrico:",styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0,fillColor:[175,202,245]}}),m.push({content:"Sens\xEDvel Intensiva",styles:{halign:"left"}},{content:""}),g.push({content:"Sens\xEDvel Manuten\xE7\xE3o",styles:{halign:"left"}},{content:""}),f.push({content:"MR Intensiva",styles:{halign:"left"}},{content:""}),r.push({content:"MR Manuten\xE7\xE3o",styles:{halign:"left"}},{content:""}),p.push({content:"XR Indu\xE7\xE3o",styles:{halign:"left"}},{content:""}),v.push({content:"XR Manuten\xE7\xE3o",styles:{halign:"left"}},{content:""}),b.push({content:"XR Intensiva",styles:{halign:"left"}},{content:""}),l.push(n),l.push(o),l.push(i),l.push(a),l.push(s),l.push(d),l.push(t),l.push(m),l.push(g),l.push(f),l.push(r),l.push(p),l.push(v),l.push(b),console.log(l),l},createMmiaTipoDoentesArrayRow(e){const l=[],n=[],o=[],i=[],a=[],s=[];return n.push("Novos"),n.push(e.totalPacientesInicio),o.push("Manuten\xE7\xE3o"),o.push(e.totalPacientesManter),i.push("Altera\xE7\xE3o"),i.push(e.totalPacientesAlterar),a.push("Tr\xE2nsito"),a.push(e.totalPacientesTransito),s.push("Transfer\xEAncias"),s.push(e.totalPacientesTransferidoDe),l.push(n),l.push(o),l.push(i),l.push(a),l.push(s),l},createMmiaFaixaEtariaArrayRow(e){const l=[],n=[],o=[],i=[],a=[];return n.push("Adultos"),n.push(e.totalPacientesAdulto),o.push("Pedi\xE1tricos 0 aos 4"),o.push(e.totalPacientes04),i.push("Pedi\xE1tricos 5 aos 9"),i.push(e.totalPacientes59),a.push("Pedi\xE1tricos 10 aos 14"),a.push(e.totalPacientes1014),l.push(n),l.push(o),l.push(i),l.push(a),l},createMmiaProfilaxiaArrayRow(e){const l=[],n=[],o=[],i=[],a=[];return n.push("PPE"),n.push(e.totalPacientesPPE),o.push("PrEP"),o.push(e.totalPacientesPREP),i.push("Crian\xE7as Expostas"),i.push(e.totalpacientesCE),a.push("Total de pacientes em TARV na US"),a.push("Ver Resumo Mensal"),l.push(n),l.push(o),l.push(i),l.push(a),l},periodicidadeDaDispensaTableData(e,l){const n=[],o=[],i=[],a=[],s=[];return o.push({rowSpan:3,content:"Tipo de Dispensa dos Profilacticos",styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:[255,255,255],fillColor:[187,216,118]}}),o.push({content:"Periodicidade da Dispensa",styles:{halign:"center",fillColor:[197,159,85],textColor:[187,216,118],fontStyle:"bold"}},{content:"Total",styles:{halign:"center",fontStyle:"bold",textColor:[187,216,118],fillColor:[197,159,85]}}),i.push({content:"Mensal",styles:{halign:"left"}},{content:l[0].totalline2,styles:{halign:"center"}}),a.push({content:"Trimestral",styles:{halign:"left"}},{content:l[0].totalline1,styles:{halign:"center"}}),s.push({content:"",styles:{halign:"left"}},{content:"Total",styles:{halign:"right"}},{content:l[0].totalline2+l[0].totalline1,styles:{halign:"center"}}),n.push(o),n.push(i),n.push(a),n.push(s),n},fasesProfilaxiaTableData(e,l){const n=[],o=[],i=[],a=[],s=[],d=[];return o.push({rowSpan:4,content:"Seguimento Profilaxias (PUs e Farm\xE1cias P\xFAblicas)",styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:[255,255,255],fillColor:[187,216,118]}}),o.push({content:"Fases Profilaxia",styles:{halign:"center",fillColor:[197,159,85],textColor:[187,216,118],fontStyle:"bold"}},{content:"Total",styles:{halign:"center",fontStyle:"bold",textColor:[187,216,118],fillColor:[197,159,85]}}),i.push({content:"In\xEDcio",styles:{halign:"left"}},{content:l[0].totaldcline3,styles:{halign:"center"}}),a.push({content:"Cont\xEDnua/Manuten\xE7\xE3o",styles:{halign:"left"}},{content:l[0].totalline3,styles:{halign:"center"}}),s.push({content:"Final/\xDAltima Dispensa",styles:{halign:"left"}},{content:l[0].totaldcline4,styles:{halign:"center"}}),d.push({content:"",styles:{halign:"left"}},{content:"Total",styles:{halign:"right"}},{content:l[0].totaldcline3+l[0].totalline3+l[0].totaldcline4,styles:{halign:"center"}}),n.push(o),n.push(i),n.push(a),n.push(s),n.push(d),n},pacienteTipoTableData(e){const l=[],n=[],o=[],i=[],a=[],s=[],d=[],t=[],m=[];return n.push({rowSpan:7,content:"Pacientes Novos no Sector da TB",styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:[255,255,255],fillColor:[187,216,118]}}),n.push({content:"Paciente/Tipo ",styles:{halign:"center",fillColor:[197,159,85],textColor:[187,216,118],fontStyle:"bold"}},{content:"Total",styles:{halign:"center",fontStyle:"bold",textColor:[187,216,118],fillColor:[197,159,85]}}),o.push({content:"Novo Adulto Sensivel",styles:{halign:"left"}},{content:"",styles:{halign:"left"}}),i.push({content:"Novo Adulto MR",styles:{halign:"left"}},{content:"",styles:{halign:"left"}}),a.push({content:"Novo Adulto XR",styles:{halign:"left"}},{content:"",styles:{halign:"left"}}),s.push({content:"Nova Crian\xE7a Sensivel",styles:{halign:"left"}},{content:"",styles:{halign:"left"}}),d.push({content:"Nova Crian\xE7a MR",styles:{halign:"left"}},{content:"",styles:{halign:"left"}}),t.push({content:"Nova Crian\xE7a XR",styles:{halign:"left"}},{content:"",styles:{halign:"left"}}),m.push({content:"",styles:{halign:"left"}},{content:"Total",styles:{halign:"right"}},{content:"",styles:{halign:"left"}}),l.push(n),l.push(o),l.push(i),l.push(a),l.push(s),l.push(d),l.push(t),l.push(m),l},createRegimenTotalArrayRow(e,l,n){const o=[];let i=0,a=0;for(const v in e)e[v].code!=="TDF+3TC PrEP"&&(i+=e[v].totalPatients,a+=e[v].cumunitaryClinic);const s=[],d=[],t=[],m=[],g=[],f=[],r=[],p=[];return s.push({rowSpan:8,content:"PUs er Farm\xE1cia Ambulat\xF3rio",styles:{valign:"middle",halign:"center",fontStyle:"bold",textColor:0,fillColor:[175,202,245]}}),s.push({content:"Produto",styles:{halign:"center",fillColor:[187,216,118],fontStyle:"bold",textColor:[255,255,255]}},{content:"Nr Comprimidos",styles:{halign:"center",fontStyle:"bold",fillColor:[187,216,118],textColor:[255,255,255]}}),d.push({content:"Isoniazida 100 mg",styles:{halign:"left"}},{content:Number(n[0].line1),styles:{halign:"center"}}),t.push({content:"Isoniazida 300 mg",styles:{halign:"left"}},{content:Number(n[0].line2),styles:{halign:"center"}}),m.push({content:"Levofloxacina 100 mg Disp",styles:{halign:"left"}},{content:Number(n[0].line3),styles:{halign:"center"}}),g.push({content:"Levofloxacina 250 mg Rev",styles:{halign:"left"}},{content:Number(n[0].line4),styles:{halign:"center"}}),f.push({content:"3HP (Rifapentina+Isoniazida)",styles:{halign:"left"}},{content:Number(n[0].totalline4),styles:{halign:"center"}}),r.push({content:"Piridoxina 25mg",styles:{halign:"left"}},{content:Number(n[0].totalPatients),styles:{halign:"center"}}),p.push({content:"Piridoxina 50mg",styles:{halign:"left"}},{content:Number(n[0].cumunitaryClinic),styles:{halign:"center"}}),o.push(s),o.push(d),o.push(t),o.push(m),o.push(g),o.push(f),o.push(r),o.push(p),o},createLinesSumaryArrayRow(e,l){const n=[];let o=0,i=0,a=0,s=0,d=0,t=0;for(const r in e)e[r].code!=="TDF+3TC PrEP"&&(o+=e[r].totalline1,s+=e[r].totaldcline1,i+=e[r].totalline2,d+=e[r].totaldcline2,a+=e[r].totalline3,t+=e[r].totaldcline3);const m=[],g=[],f=[];return l=="PDF"?m.push({content:"1as Linhas",styles:{halign:"right"}}):m.push("1as Linhas"),m.push(o),m.push(s),l=="PDF"?g.push({content:"2as Linhas",styles:{halign:"right"}}):g.push("2as Linhas"),g.push(i),g.push(d),l=="PDF"?f.push({content:"3as Linhas",styles:{halign:"right"}}):f.push("3as Linhas"),f.push(a),f.push(t),n.push(m),n.push(g),n.push(f),n},createLinesSumaryTotalArrayRow(e,l){const n=[];let o=0,i=0;for(const s in e)e[s].code!=="TDF+3TC PrEP"&&(o+=e[s].totalline1+e[s].totalline2+e[s].totalline3,i+=e[s].totaldcline1+e[s].totaldcline2+e[s].totaldcline3);const a=[];return l=="PDF"?a.push({content:"Total",styles:{halign:"right",fillColor:[204,204,204]}}):a.push("Total"),a.push(o),a.push(i),n.push(a),n},createMmiaDispenseTypeDSArrayRow(e){const l=[],n=[],o=[],i=[],a=[],s=[],d=[],t=[];return n.push("M\xEAs-5"),n.push(e.dsM5),o.push("M\xEAs-4"),o.push(e.dsM4),i.push("M\xEAs-3"),i.push(e.dsM3),a.push("M\xEAs-2"),a.push(e.dsM2),s.push("M\xEAs-1"),s.push(e.dsM1),d.push("No M\xEAs"),d.push(e.dsM0),t.push("Total"),t.push(e.dsM5+e.dsM4+e.dsM3+e.dsM2+e.dsM1+e.dsM0),l.push(n),l.push(o),l.push(i),l.push(a),l.push(s),l.push(d),l.push(t),l},createMmiaDispenseTypeDTArrayRow(e){const l=[],n=[],o=[],i=[],a=[];return n.push(e.dtM2),o.push(e.dtM1),i.push(e.dtM0),a.push(e.dtM2+e.dtM1+e.dtM0),l.push(n),l.push(o),l.push(i),l.push(a),l},createMmiaDispenseTypeDMArrayRow(e){const l=[],n=[],o=[];return n.push(e.dM),n.push(e.dM+e.dsM0+e.dtM0),o.push(e.dM),o.push(e.dM+e.dtM2+e.dtM1+e.dtM0+e.dsM5+e.dsM4+e.dsM3+e.dsM2+e.dsM1+e.dsM0),l.push(n),l.push(o),l},createMmiaAjustePercentageArrayRow(e){const l=[],n=[];return n.push("Ajuste"),n.push(Math.round((e.dM+e.dtM2+e.dtM1+e.dtM0+e.dsM5+e.dsM4+e.dsM3+e.dsM2+e.dsM1+e.dsM0)/(e.dM+e.dsM0+e.dtM0)*100)+"%"),l.push(n),l},createFotterTableRow(){const e=[],l=[];return l.push("Elaborado por"),l.push("Visto:"),l.push("Data de elabora\xE7\xE3o: "+P(new Date).format("DD-MM-YYYY")),e.push(l),e},getFormatDDMMYYYY(e){return P(e).format("DD-MM-YYYY")},downloadFile(e,l,n){var o=e+l;console.log("result"+o),i(o,n);function i(g,f){var r=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(r,function(p){a(p,g,f)},d)}function a(g,f,r){g.getFile(f,{create:!0,exclusive:!1},function(p){s(p,r)},t)}function s(g,f){g.createWriter(function(r){r.onwriteend=function(){console.log("Successful file write..."),m()},r.onerror=function(p){console.log("Failed file write: "+p)},r.write(f)})}function d(g){console.log(g)}function t(g){console.log("errorr: "+g.toString())}function m(){var g=o;console.log("file system 44444: "+g);var f=cordova.file.externalRootDirectory+"Download/"+g;console.log("file system 2222: "+f);var r=decodeURIComponent(f);cordova.plugins.fileOpener2.open(r,"application/pdf",{error:function(p){console.log("file system open3333366: "+p+r)},success:function(){}})}}};const Ym={class:"param-container"},Nm="MmiaTb",Tm="MAPA_MENSAL_DE_MEDICAMENTO_DA_TB",Im={__name:"MmiaTb",props:["selectedService","menuSelected","id","params"],setup(e){const{isOnline:l}=ce(),{alertError:n}=Re(),o=S(null),i=S(!1),a=S(0),s=S(0),d=S(""),t=S(!1),m=S(!1),g={id:2,description:"Mensal",code:"MONTH"},f=S(!1);S({type:"",visible:!1,msg:""});const r=S(0),p=c=>{if(d.value.remove(),c){const h=c.id;f.value=!0,ee.remove(h)}},v=(c,h)=>{h.value||ee.set(c.id,c)},b=async c=>{if(c.periodType!=="MONTH")n("O per\xEDodo seleccionado n\xE3o \xE9 aplicavel a este relat\xF3rio, por favor seleccionar o per\xEDodo [Mensal]");else if(r.value=.001,l.value)v(c,f),C.apiInitMmiaProcessing(c).then(h=>{D(c)});else{v(c,f);const h=await $e.getMmiaStockReport(c),y=await $e.getMmiaRegimenSubReport(h);await $e.getMmiaReport(h,y),r.value=100,c.progress=100}},D=c=>{C.getProcessingStatus("mmiaReport",c).then(h=>{h.data.progress>.001?(r.value=h.data.progress,r.value<100?(v(c,f),c.progress=h.data.progress,setTimeout(()=>{D(c)},3e3)):(r.value=100,c.progress=100,v(c,f))):(r.value=100,c.progress=100,v(c,f))})},u=(c,h)=>{h==="PDF"?Ni.downloadPDF(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),t.value=!1}):Ni.downloadExcel(c).then(y=>{y===204&&n("N\xE3o existem Dados para o per\xEDodo selecionado"),m.value=!1})};return E("downloadingPdf",t),E("downloadingXls",m),E("serviceAux",o),E("resultFromLocalStorage",i),E("getProcessingStatus",D),(c,h)=>(M(),se("div",{ref_key:"filterMmiaSection",ref:d},[i.value?(M(),J(ae,{key:0,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[0]||(h[0]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(o.value!==null?o.value.code:"")+": Mapa Mensal de Medicamentos da TB (MMTB) ",1)]),_:1})):(M(),J(ae,{key:1,addVisible:!1,mainContainer:!0,closeVisible:!0,onCloseSection:h[1]||(h[1]=y=>p(e.params)),bgColor:"bg-orange-5"},{default:A(()=>[j("Servi\xE7o "+te(e.selectedService!==null?e.selectedService.code:"")+": Mapa Mensal de Medicamentos da TB (MMTB) ",1)]),_:1})),ie("div",Ym,[F(pe,null,{default:A(()=>[F(fe,{class:"col"},{default:A(()=>[F(ye,{id:e.id,totalRecords:a.value,qtyProcessed:s.value,reportType:Tm,progress:r.value,tabName:Nm,params:e.params,typeService:e.selectedService,clinicalService:e.selectedService,applicablePeriods:g,onGenerateReport:u,onInitReportProcessing:b},null,8,["id","totalRecords","qtyProcessed","progress","params","typeService","clinicalService"])]),_:1})]),_:1})])],512))}};var Bm=Fe(Im,[["__scopeId","data-v-9a69b09e"]]);const Om={class:"row"},Lm={key:0,class:"col-3 q-ml-sm q-mr-sm",style:{"max-width":"500px"}},km=ie("div",{class:"col text-center text-weight-bold"},"Listagens",-1),Vm={class:"col q-mr-sm"},zm=ie("div",{class:"col text-center text-weight-bold"},"Resultados",-1),_m={class:"row"},Um={key:0,class:"col-3 q-ml-sm q-mr-sm panel",style:{"max-width":"500px"}},$m={class:"col q-mr-sm panel q-pa-sm"},Hm=ie("div",{class:"row"},[ie("div",{class:"col-3 q-pa-md q-pl-lg q-ml-lg q-mr-lg panel"}),ie("div",{class:"col q-mr-lg panel"})],-1),wp={__name:"Reports",setup(e){const{closeLoading:l,showloading:n}=Sr(),o={ActivesInDrugStore:wc,GuestList:Pc,PatientsWithouDispense:Nc,ImportedPatientList:Oc,TransferedFrom:zc,TransferedTo:Hc,Mmia:Jc,LinhasTerapeuticasUsadas:nd,SegundasLinhas:cd,PatientsAbandonment:vd,PatientsAbandonmentReturned:Cd,Balancete:Td,ReferredBackPatients:Wd,ReferredPatients:_d,ReferredPatientDispenseHistory:eu,AbsentPatients:Uu,AbsentPatientsDT:eg,AbsentPatientsDS:ig,AbsentPatientsApss:Qu,AbsentReferredPatients:iu,ReceivedStock:gu,UsedStock:Su,ArvDailyRegister:Bu,PatientHistory:fg,PatientHistoryPREP:Dg,PatientHistoryTPT:Rg,NotSynchronizedPack:Fg,SemiannualDispensation:Uf,QuarterlyDispensation:jf,PrepDailyRegister:om,TptDailyRegister:cm,QuantityRemain:Au,partialInventory:pm,generalInventory:ym,expectedOfDay:Fm,MmiaTb:Bm,PossiblePatientDuplicates:Tg,TBScreening:Hg,RAMScreening:Xg,PacksByDrugBottles:of,PatientWithPregnancyScreening:uf,NotSynchronizedPackToServer:bf,PatientsMonitoredForAdherence:Af,PatientsPickedUpMedsAtUS:Bf,RegisteredInIdmed:kg},{isMobile:i}=ce(),a=S("Relat\xF3rios"),s=S("list");S(null),S("");const d=S(),t={backgroundColor:"#ffffff",color:"#555"},m={backgroundColor:"#eee",color:"black"},g={right:"2px",borderRadius:"5px",backgroundColor:"#0ba58b",width:"5px",opacity:.75},f=S(null),r=S("TARV"),p=S([]);Me(()=>{const D=ee.getAllKeys();D.length>0&&n();for(let u=0;u<D.length;u++){if(D[u].substring(0,6)==="report"){const c=ee.getItem(D[u]);d.value=ut.getClinicalServicePersonalizedById(c.clinicalService),v(c.tabName,d,c)}u===D.length-1&&l()}});const v=(D,u,c)=>{const h="report"+Dr(),y={id:c===void 0?h:c.id,name:D,clinicalService:u,params:c};p.value.push(y)};Ke(()=>br.query().orderBy("code","desc").get());const b=Ke(()=>de.currClinic());return E("currClinic",b),E("title",a),E("servicoActual",f),E("codeServicoActual",r),(D,u)=>(M(),se("div",null,[F(Rr),F(rr,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=c=>s.value=c),dense:"",class:"text-grey q-pt-md q-pl-md","active-color":"primary","indicator-color":"white",align:"left"},{default:A(()=>[F(va,{name:"list",label:"Listas",class:gn(s.value==="list"?"tab-menu":"")},null,8,["class"]),F(va,{name:"graph",label:"An\xE1lise Gr\xE1fica",class:gn(s.value==="graph"?"tab-menu":"")},null,8,["class"])]),_:1},8,["modelValue"]),F(Ti,{style:{"margin-top":"-1px"}}),ke(i)?(M(),J(Tr,{key:0,onChangeTab:v})):nt("",!0),F(sr,{modelValue:s.value,"onUpdate:modelValue":u[1]||(u[1]=c=>s.value=c),animated:""},{default:A(()=>[F(Da,{name:"list"},{default:A(()=>[ie("div",Om,[ke(i)?nt("",!0):(M(),se("div",Lm,[F(ya,{dark:"",class:"bg-primary text-white"},{default:A(()=>[km]),_:1})])),ie("div",Vm,[F(ya,{dark:"",class:"bg-primary text-white"},{default:A(()=>[zm]),_:1})])]),ie("div",_m,[ke(i)?nt("",!0):(M(),se("div",Um,[ke(i)?nt("",!0):(M(),J(jr,{key:0,onChangeTab:v}))])),ie("div",$m,[F(wr,{"thumb-style":g,"content-style":t,"content-active-style":m,style:{height:"700px"},class:"q-pr-md"},{default:A(()=>[(M(!0),se(lt,null,it(p.value,c=>(M(),J(yr(o[c.name]),{key:c.id,selectedService:c.clinicalService,id:c.id,params:c.params,class:"q-mb-sm"},null,8,["selectedService","id","params"]))),128))]),_:1})])])]),_:1}),F(Da,{name:"graph"},{default:A(()=>[Hm]),_:1})]),_:1},8,["modelValue"])]))}};export{wp as default};
