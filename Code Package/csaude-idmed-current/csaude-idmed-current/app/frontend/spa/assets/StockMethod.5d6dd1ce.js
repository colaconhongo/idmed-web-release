import{Y as J,bJ as V,dc as _,bL as U,bM as v,dd as Z,cV as F,a$ as L,de as R,b_ as M,cf as f,C as j,b8 as k,da as I,d4 as E,be as ee}from"./index.28c7e456.js";const{closeLoading:N,showloading:ne}=L(),{isMobile:oe,isOnline:A}=J(),l=V(_),h=U[_.entity];var O={post(t){return A.value?this.postWeb(t):this.putMobile(t)},get(t){return A.value?this.getWeb(t):this.getMobile()},patch(t,i){return A.value?this.patchWeb(t,i):this.putMobile(i)},async delete(t){return A.value?this.deleteWeb(t):this.deleteMobile(t)},async apiSave(t){return v().post("/referedStockMoviment",t)},async apiRemove(t){return v().delete(`/referedStockMoviment/${t}`)},async apiUpdate(t){return v().patch("/referedStockMoviment",t)},newInstanceEntity(){return l.getModel().$newInstance()},postWeb(t){return v().post("referedStockMoviment",t).then(i=>{l.save(i.data)})},getWeb(t){if(t>=0)return v().get("referedStockMoviment?offset="+t).then(i=>{l.save(i.data),t=t+100,i.data.length>0?this.getWeb(t):N()})},getAllByClinic(t,i){A.value?this.getAllByClinicWeb(t,i):this.getAllByClinicMobile(t)},getAllByClinicWeb(t,i){if(i>=0)return v().get("referedStockMoviment/clinic/"+t+"?offset="+i+"&max=100").then(m=>{l.save(m.data),i=i+100,m.data.length>0?this.get(i):N()})},patchWeb(t,i){return v().patch("referedStockMoviment/"+t,i).then(m=>{l.save(m.data)})},deleteWeb(t){return v().delete("referedStockMoviment/"+t).then(()=>{l.destroy(t)})},async apiGetAll(t,i){return v().get("/referedStockMoviment?offset="+t+"&max="+i)},addMobile(t){return h.put(JSON.parse(JSON.stringify(t))).then(()=>{l.save(JSON.parse(JSON.stringify(t)))})},async putMobile(t){const i=JSON.parse(JSON.stringify(t));return h.put(i).then(()=>{i.adjustments.length>0&&i.adjustments.map(m=>{m.adjusted_stock_id=m.adjustedStock.id,m.operation_id=m.operation.id,m.clinic_id=m.clinic.id,Z.addMobile(m)}),l.save(i)})},getMobile(){return h.toArray().then(t=>{l.save(t)}).catch(t=>{console.log(t)})},async getReferedStockMovimentsMobile(){return await h.toArray()},getAllByClinicMobile(t){return h.where("clinic_id").equalsIgnoreCase(t).toArray().then(i=>(l.save(i),i))},async localDbGetAll(){return h.toArray().then(t=>(l.save(t),t))},getBystockMobile(t){return h.where("stock_id").equalsIgnoreCase(t.id).toArray().then(i=>(l.save(i),i))},async deleteMobile(t){const i=await F.nSQL("referedStockMoviments").query("delete").where(["id","=",t]).exec();return l.destroy(t),i}};const{closeLoading:T,showloading:se}=L(),{isMobile:ae,isOnline:S}=J(),y=V(R),D=U[R.entity];var w={post(t){return S.value?this.postWeb(t):this.putMobile(t)},get(t){return S.value?this.getWeb(t):this.getMobile()},patch(t){return S.value?this.apiUpdateWeb(t):this.putMobile(t)},async delete(t){return S.value?this.deleteMobile(t):this.deleteWeb(t)},postWeb(t){return v().post("destroyedStock",t).then(i=>{y.save(i.data)})},getWeb(t){if(t>=0)return v().get("destroyedStock?offset="+t).then(i=>{y.save(i.data),t=t+100,i.data.length>0?this.getWeb(t):T()})},getAllByClinic(t,i){S.value?this.getAllByClinicWeb(t,i):this.getAllByClinicMobile(t)},getAllByClinicWeb(t,i){if(i>=0)return v().get("destroyedStock/clinic/"+t+"?offset="+i+"&max=100").then(m=>{y.save(m.data),i=i+100,m.data.length>0?this.get(i):T()})},deleteWeb(t){return v().delete("destroyedStock/"+t).then(()=>{y.destroy(t)})},async apiUpdateWeb(t){return await v().patch("/destroyedStock",t)},addMobile(t){return D.put(JSON.parse(JSON.stringify(t))).then(()=>{y.save(JSON.parse(JSON.stringify(t)))})},async putMobile(t){return D.put(JSON.parse(JSON.stringify(t))).then(()=>{y.save(JSON.parse(JSON.stringify(t)))})},getMobile(){return D.toArray().then(t=>{y.save(t)}).catch(t=>{console.log(t)})},getDestroyedStocksMobile(){return D.toArray()},async getReferedStockMovimentsMobile(){return await D.toArray()},getAllByClinicMobile(t){return D.where("clinic_id").equalsIgnoreCase(t).toArray().then(i=>(y.save(i),i))},getBystockMobile(t){return D.where("stock_id").equalsIgnoreCase(t.id).toArray().then(i=>(y.save(i),i))},async localDbGetAll(){return D.toArray().then(t=>(y.save(t),t))}};const b=ee();function ie(){function t(u){return u.packagedDrugStocks!==void 0&&u.packagedDrugStocks.length>0||u.adjustments.length>0}function i(u){return M.formatDate(u.expireDate)}function m(u){return M.formatDate(u,"DD-MM-YYYY")}function Y(){return"stock"}async function B(u){let c=0;const r=await f.getStocksByDrugIdMobile(u.id);for(const d of r)c+=Number(d.stockMoviment);return c}async function $(u){const c=await j.getPatientVisitMobile();let r=0;for(const d of c)for(const n of d.patientVisitDetails)if(n.pack!==void 0)for(const e of n.pack.packagedDrugs)e.drug.id===u.id&&(r+=Number(e.quantitySupplied));return r}async function W(u){const c=await w.getReferedStockMovimentsMobile(),r=[];for(const n of c){const e={};for(const a of n.adjustments)a.adjustedStock.drug_id===u.id&&(e.id=k(),e.eventDate=a.captureDate,e.year=new Date(a.captureDate).getFullYear(),e.month=b.returnEstatisticMonth(new Date(a.captureDate)),e.moviment="Perda",e.orderNumber="",e.incomes=0,e.outcomes=0,e.posetiveAdjustment=0,e.negativeAdjustment=0,e.loses=Number(a.adjustedValue),e.balance=0,e.code=a.operation.code,e.stockId="",e.notes="",r.push(e))}const d=[];return r.reduce((n,e)=>{const a=`${e.year}-${e.month}`;return n[a]||(n[a]={id:e.id,year:e.year,month:e.month,code:e.code,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:e.moviment,orderNumber:"",incomes:0,outcomes:0,loses:0,balance:e.balance,stockId:e.stockId,notes:e.notes},d.push(n[a])),n[a].loses+=e.loses,n},{}),d}async function P(u){const c=[],r=await O.getReferedStockMovimentsMobile();for(const n of r){const e={};for(const a of n.adjustments)a.adjustedStock.drug_id===u.id&&(a.operation.code==="AJUSTE_POSETIVO"||a.operation.code==="AJUSTE_NEGATIVO")&&(e.id=k(),e.code=a.operation.code,e.eventDate=n.date,e.year=new Date(n.date).getFullYear(),e.month=b.returnEstatisticMonth(new Date(n.date)),e.moviment=a.operation.code==="AJUSTE_POSETIVO"?"Ajuste Posetivo":"Ajuste Negativo",e.orderNumber="",e.incomes=0,e.outcomes=0,e.posetiveAdjustment=a.operation.code==="AJUSTE_POSETIVO"?a.adjustedValue:0,e.negativeAdjustment=a.operation.code==="AJUSTE_NEGATIVO"?a.adjustedValue:0,e.loses=0,e.balance=0,e.code=a.operation.code,e.stockId="",e.notes="",c.push(e))}const d=[];return c.reduce((n,e)=>{const a=`${e.year}-${e.month}-${e.code}`;return n[a]||(n[a]={id:e.id,year:e.year,month:e.month,code:e.code,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:e.moviment,orderNumber:"",incomes:0,outcomes:0,loses:e.loses,balance:e.balance,stockId:e.stockId,notes:e.notes},d.push(n[a])),e.code==="AJUSTE_POSETIVO"?n[a].posetiveAdjustment+=e.posetiveAdjustment:e.code==="AJUSTE_NEGATIVO"&&(n[a].negativeAdjustment+=e.negativeAdjustment),n},{}),d}async function C(u){const c=[],r=await I.getAllFinalizedInventoryStockAdjustmentMobile();for(const n of r)if(n.adjustedStock.drug_id===u.id&&(n.operation.code==="AJUSTE_POSETIVO"||n.operation.code==="AJUSTE_NEGATIVO")){const e={};e.id=k(),e.eventDate=n.captureDate,e.year=new Date(n.captureDate).getFullYear(),e.month=b.returnEstatisticMonth(new Date(n.captureDate)),e.moviment="Invent\xE1rio",e.orderNumber="",e.incomes=0,e.outcomes=0,e.posetiveAdjustment=n.operation.code==="AJUSTE_POSETIVO"?n.adjustedValue:0,e.negativeAdjustment=n.operation.code==="AJUSTE_NEGATIVO"?n.adjustedValue:0,e.loses=0,e.balance=0,e.code=n.operation.code,e.stockId="",e.notes="",c.push(e)}const d=[];return c.reduce((n,e)=>{const a=`${e.year}-${e.month}`;return n[a]||(n[a]={id:e.id,year:e.year,month:e.month,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:"Invent\xE1rio",orderNumber:"",incomes:0,outcomes:0,loses:e.loses,balance:e.balance,code:e.code,stockId:e.stockId,notes:e.notes},d.push(n[a])),n[a].posetiveAdjustment+=e.posetiveAdjustment,n[a].negativeAdjustment+=e.negativeAdjustment,n},{}),d}async function x(u){const c=[],r=await f.getStocksByDrugIdMobile(u.id),d=r.map(o=>o.entrance_id||o.entranceId),e=(await E.getStockEntrancesByIds(d)).map(o=>({incomes:r.filter(p=>p.entrance_id===o.id).reduce((p,g)=>p+g.unitsReceived,0),dateReceived:o.dateReceived,orderNumber:o.orderNumber}));for(const o of e){new Date(o.startDate);const s={};s.id=k(),s.eventDate=o.dateReceived,s.year=new Date(o.dateReceived).getFullYear(),s.month=b.returnEstatisticMonth(new Date(o.dateReceived)),s.moviment="Entrada de Stock",s.orderNumber=o.orderNumber,s.incomes=Number(o.incomes),s.outcomes=0,s.posetiveAdjustment=0,s.negativeAdjustment=0,s.loses=0,s.balance=0,s.code="ENTRADA",s.stockId="",s.notes="",c.push(s)}const a=[];return c.reduce((o,s)=>{const p=`${s.year}-${s.month}`;return o[p]||(o[p]={id:s.id,year:s.year,month:s.month,posetiveAdjustment:0,negativeAdjustment:0,eventDate:s.creationDate,moviment:"Entrada de Stock",orderNumber:"",incomes:0,outcomes:0,loses:s.loses,balance:s.balance,code:s.code,stockId:s.stockId,notes:s.notes},a.push(o[p])),o[p].incomes+=s.incomes,o},{}),a}async function G(u){const c=[],r=await j.getPatientVisitMobile();for(const n of r)for(const e of n.patientVisitDetails)if(e.pack!==void 0){for(const a of e.pack.packagedDrugs)if(a.drug.id===u.id){const o={};o.id=k(),o.eventDate=e.pack.pickupDate,o.year=new Date(e.pack.pickupDate).getFullYear(),o.month=b.returnEstatisticMonth(new Date(e.pack.pickupDate)),o.moviment="Sa\xEDdas",o.orderNumber="",o.incomes=0,o.outcomes=Number(a.quantitySupplied),o.posetiveAdjustment=0,o.negativeAdjustment=0,o.loses=0,o.balance=0,o.code="SAIDA",o.notes="",c.push(o)}}const d=[];return c.reduce((n,e)=>{const a=`${e.year}-${e.month}`;return n[a]||(n[a]={id:e.id,year:e.year,month:e.month,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.creationDate,moviment:"Saidas",orderNumber:"",incomes:0,outcomes:0,loses:e.loses,balance:e.balance,code:e.code,stockId:e.stockId,notes:e.notes},d.push(n[a])),n[a].outcomes+=e.outcomes,n},{}),d}async function q(u){const c=[],r=await w.getDestroyedStocksMobile();for(const n of r){const e={};for(const a of n.adjustments)a.adjustedStock.id===u&&(e.id=k(),e.eventDate=n.date,e.moviment="Perda",e.orderNumber="",e.incomes=0,e.outcomes=0,e.posetiveAdjustment=0,e.negativeAdjustment=0,e.loses=a.adjustedValue,e.balance=0,e.code=a.operation.code,e.stockId="",e.notes="",c.push(e))}const d=[];return c.reduce((n,e)=>{const o=`${b.getDDMMYYYFromJSDate(e.eventDate)}`;return n[o]||(n[o]={id:e.id,year:e.year,month:e.month,code:e.code,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:e.moviment,orderNumber:"",incomes:0,outcomes:0,loses:0,balance:e.balance,stockId:e.stockId,notes:e.notes},d.push(n[o])),n[o].loses+=e.loses,n},{}),d}async function Q(u){const c=[],r=await O.getReferedStockMovimentsMobile();for(const n of r){const e={};for(const a of n.adjustments)a.adjustedStock.id===u&&(a.operation.code==="AJUSTE_POSETIVO"||a.operation.code==="AJUSTE_NEGATIVO")&&(e.id=k(),e.eventDate=n.date,e.moviment=a.operation.code==="AJUSTE_POSETIVO"?"Ajuste Posetivo":"Ajuste Negativo",e.orderNumber="",e.incomes=0,e.outcomes=0,e.posetiveAdjustment=a.operation.code==="AJUSTE_POSETIVO"?a.adjustedValue:0,e.negativeAdjustment=a.operation.code==="AJUSTE_NEGATIVO"?a.adjustedValue:0,e.notes="",e.loses=0,e.code=a.operation.code,c.push(e))}const d=[];return c.reduce((n,e)=>{const o=`${b.getDDMMYYYFromJSDate(e.eventDate)}`;return n[o]||(n[o]={id:e.id,year:e.year,month:e.month,code:e.code,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:e.moviment,orderNumber:"",incomes:0,outcomes:0,loses:e.loses,balance:e.balance,stockId:e.stockId,notes:e.notes},d.push(n[o])),e.code==="AJUSTE_POSETIVO"?n[o].posetiveAdjustment+=e.posetiveAdjustment:e.code==="AJUSTE_NEGATIVO"&&(n[o].negativeAdjustment+=e.negativeAdjustment),n},{}),d}async function z(u){const c=[],r=await I.getAllFinalizedInventoryStockAdjustmentMobile();for(const n of r){const e={};n.adjustedStock.id===u&&(e.id=k(),e.eventDate=n.captureDate,e.moviment="Invent\xE1rio",e.orderNumber="",e.incomes=0,e.outcomes=0,e.posetiveAdjustment=n.operation.code==="AJUSTE_POSETIVO"?n.adjustedValue:0,e.negativeAdjustment=n.operation.code==="AJUSTE_NEGATIVO"?n.adjustedValue:0,e.loses=0,e.balance=0,e.code=n.operation.code,e.stockId="",e.notes="",c.push(e))}const d=[];return c.reduce((n,e)=>{const o=`${b.getDDMMYYYFromJSDate(e.eventDate)}`;return n[o]||(n[o]={id:e.id,year:e.year,month:e.month,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:"Invent\xE1rio",orderNumber:"",incomes:0,outcomes:0,loses:e.loses,balance:e.balance,code:e.code,stockId:e.stockId,notes:e.notes},d.push(n[o])),n[o].posetiveAdjustment+=e.posetiveAdjustment,n[o].negativeAdjustment+=e.negativeAdjustment,n},{}),d}async function H(u){const c=[],r=await f.getBystockMobile(u),d=r.map(o=>o.entrance_id||o.entranceId),e=(await E.getStockEntrancesByIds(d)).map(o=>{var p;return{incomes:r.filter(g=>g.entrance_id===o.id).reduce((g,X)=>g+X.unitsReceived,0),dateReceived:o.dateReceived,orderNumber:o.orderNumber,stockId:(p=r.find(g=>g.entrance_id===o.id))==null?void 0:p.id}});for(const o of e)if(o.orderNumber!==void 0){const s={};s.id=k(),s.eventDate=o.dateReceived,s.year=new Date(o.dateReceived).getFullYear(),s.month=new Date(o.dateReceived).getMonth(),s.moviment="Entrada de Stock",s.orderNumber=o.orderNumber,s.incomes=Number(o.incomes),s.outcomes=0,s.posetiveAdjustment=0,s.negativeAdjustment=0,s.loses=0,s.balance=0,s.code="ENTRADA",s.stockId=o.stockId,s.notes="",c.push(s)}const a=[];return c.reduce((o,s)=>{const g=`${b.getDDMMYYYFromJSDate(s.eventDate)}`;return o[g]||(o[g]={id:s.id,year:s.year,month:s.month,posetiveAdjustment:0,negativeAdjustment:0,eventDate:s.eventDate,moviment:"Entrada de Stock",orderNumber:"",incomes:0,outcomes:0,loses:s.loses,balance:s.balance,code:s.code,stockId:s.stockId,notes:s.notes},a.push(o[g])),o[g].incomes+=s.incomes,o},{}),a}async function K(u){const c=[],r=await j.getPatientVisitMobile();for(const n of r)for(const e of n.patientVisitDetails)if(e.pack!==void 0){for(const a of e.pack.packagedDrugs)for(const o of a.packagedDrugStocks)if(o.stock.id===u){const s={};s.stockId=o.stock.id,s.id=k(),s.eventDate=e.pack.pickupDate,s.moviment="Sa\xEDdas",s.orderNumber="",s.incomes=0,s.outcomes=a.quantitySupplied,s.posetiveAdjustment=0,s.negativeAdjustment=0,s.loses=0,s.balance=0,s.code="SAIDA",s.notes="",c.push(s)}}const d=[];return c.reduce((n,e)=>{const o=`${b.getDDMMYYYFromJSDate(e.eventDate)}`;return n[o]||(n[o]={id:e.id,year:e.year,month:e.month,posetiveAdjustment:0,negativeAdjustment:0,eventDate:e.eventDate,moviment:"Saidas",orderNumber:"",incomes:0,outcomes:0,loses:e.loses,balance:e.balance,code:e.code,stockId:e.stockId,notes:e.notes},d.push(n[o])),n[o].outcomes+=e.outcomes,n},{}),d}return{isInUse:t,getFormatedExpireDate:i,formatDate:m,getClassName:Y,localDbGetStockBalanceByDrug:B,localDbGetQuantitySuppliedByDrug:$,getDestructionsDrugFile:W,getAdjustmentsDrugFile:P,getInventoryAdjustmentsDrugFile:C,getEntrancesDrugFile:x,getPacksDrugFile:G,getDestructionsDrugFileBatch:q,getAdjustmentsDrugFileBatch:Q,getInventoryAdjustmentsDrugFileBatch:z,getEntrancesDrugFileBatch:H,getPacksDrugFileBatch:K}}export{w as D,O as R,ie as u};
