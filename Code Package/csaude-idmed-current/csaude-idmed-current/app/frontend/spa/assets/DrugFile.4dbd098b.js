import{Q as zt}from"./QSpace.b53e3d44.js";import{bE as Ut,i as J,r as R,o as dt,K as k,L as ue,M as i,a7 as B,V as pe,a6 as qe,f as l,a8 as He,a4 as T,O as U,bI as Ht,cc as kt,bb as Qt,P as xe,U as Et,Y as Je,bJ as Gt,dj as $t,bM as fe,cV as et,be as Mt,a$ as Jt,b4 as Rt,c as te,a1 as W,a_ as j,a5 as S,c8 as Wt,bO as Z,$ as De,de as Xt,b8 as gt,dk as Kt,dl as pt,dc as Zt,dm as eo,cf as rt,b_ as vt,b6 as to,w as oo,bs as no,cd as ao,F as lo,c9 as ro}from"./index.28c7e456.js";import{c as Vt,b as Qe,Q as Se,a as ht}from"./QMenu.9a83401e.js";import{Q as jt}from"./QList.d4521672.js";import{a as Ge,c as q,b as z,Q as Nt}from"./QTable.f91943bc.js";import{Q as Ot}from"./QInnerLoading.e80e6b25.js";import{Q as io}from"./QScrollArea.288f8a37.js";import{_ as so}from"./TitleBar.f7be41e1.js";import{Q as co,a as uo}from"./QPopupProxy.bc9f6d75.js";import{C as it}from"./ClosePopup.20eb2e56.js";import{Q as mo,_ as bt}from"./ListHeader.c33af243.js";import{u as fo,R as go,D as po}from"./StockMethod.5d6dd1ce.js";import{E as vo,M as tt,a as ot}from"./imageBytes.1a4fecd7.js";import{e as ho,F as bo}from"./exceljs.min.c840c290.js";import{R as st}from"./ReportService.c2f34a2e.js";import{R as yo}from"./ReceivedStockMobileService..72a4bb91.js";import"./position-engine.b3fa6cbd.js";import"./QSelect.caa108f8.js";import"./QLinearProgress.c6927d78.js";import"./TouchPan.90ce57a2.js";import"./use-render-cache.3aae9b27.js";import"./StockAlertService.3ee5a37f.js";let wo=0,Re;function yt(e,a){Re===void 0&&(Re=document.createElement("div"),Re.style.cssText="position: absolute; left: 0; top: 0",document.body.appendChild(Re));const n=e.getBoundingClientRect(),d=Re.getBoundingClientRect(),{marginLeft:c,marginRight:t,marginTop:u,marginBottom:o}=window.getComputedStyle(e),f=parseInt(c,10)+parseInt(t,10),b=parseInt(u,10)+parseInt(o,10);return{left:n.left-d.left,top:n.top-d.top,width:n.right-n.left,height:n.bottom-n.top,widthM:n.right-n.left+(a===!0?0:f),heightM:n.bottom-n.top+(a===!0?0:b),marginH:a===!0?f:0,marginV:a===!0?b:0}}function ze(e){return{width:e.scrollWidth,height:e.scrollHeight}}const wt=["Top","Right","Bottom","Left"],St=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],So=/-block|-inline|block-|inline-/,xo=/(-block|-inline|block-|inline-).*:/;function xt(e,a){const n=window.getComputedStyle(e),d={};for(let c=0;c<a.length;c++){const t=a[c];if(n[t]==="")if(t==="cssText"){const u=n.length;let o="";for(let f=0;f<u;f++)So.test(n[f])!==!0&&(o+=n[f]+": "+n[n[f]]+"; ");d[t]=o}else if(["borderWidth","borderStyle","borderColor"].indexOf(t)!==-1){const u=t.replace("border","");let o="";for(let f=0;f<wt.length;f++){const b="border"+wt[f]+u;o+=n[b]+" "}d[t]=o}else if(t==="borderRadius"){let u="",o="";for(let f=0;f<St.length;f++){const b=n[St[f]].split(" ");u+=b[0]+" ",o+=(b[1]===void 0?b[0]:b[1])+" "}d[t]=u+"/ "+o}else d[t]=n[t];else t==="cssText"?d[t]=n[t].split(";").filter(u=>xo.test(u)!==!0).join(";"):d[t]=n[t]}return d}const Do=["absolute","fixed","relative","sticky"];function Dt(e){let a=e,n=0;for(;a!==null&&a!==document;){const{position:d,zIndex:c}=window.getComputedStyle(a),t=Number(c);t>n&&(a===e||Do.includes(d)===!0)&&(n=t),a=a.parentNode}return n}function Co(e){return{from:e.from,to:e.to!==void 0?e.to:e.from}}function Fo(e){return typeof e=="number"?e={duration:e}:typeof e=="function"&&(e={onEnd:e}),{...e,waitFor:e.waitFor===void 0?0:e.waitFor,duration:isNaN(e.duration)===!0?300:parseInt(e.duration,10),easing:typeof e.easing=="string"&&e.easing.length!==0?e.easing:"ease-in-out",delay:isNaN(e.delay)===!0?0:parseInt(e.delay,10),fill:typeof e.fill=="string"&&e.fill.length!==0?e.fill:"none",resize:e.resize===!0,useCSS:e.useCSS===!0||e.usecss===!0,hideFromClone:e.hideFromClone===!0||e.hidefromclone===!0,keepToClone:e.keepToClone===!0||e.keeptoclone===!0,tween:e.tween===!0,tweenFromOpacity:isNaN(e.tweenFromOpacity)===!0?.6:parseFloat(e.tweenFromOpacity),tweenToOpacity:isNaN(e.tweenToOpacity)===!0?.5:parseFloat(e.tweenToOpacity)}}function Ct(e){const a=typeof e;return a==="function"?e():a==="string"?document.querySelector(e):e}function Ft(e){return e&&e.ownerDocument===document&&e.parentNode!==null}function Ao(e){let a=()=>!1,n=!1,d=!0;const c=Co(e),t=Fo(e),u=Ct(c.from);if(Ft(u)!==!0)return a;typeof u.qMorphCancel=="function"&&u.qMorphCancel();let o,f,b,v;const x=u.parentNode,y=u.nextElementSibling,g=yt(u,t.resize),{width:$,height:L}=ze(x),{borderWidth:D,borderStyle:P,borderColor:H,borderRadius:Q,backgroundColor:N,transform:M,position:V,cssText:A}=xt(u,["borderWidth","borderStyle","borderColor","borderRadius","backgroundColor","transform","position","cssText"]),p=u.classList.toString(),_=u.style.cssText,s=u.cloneNode(!0),h=t.tween===!0?u.cloneNode(!0):void 0;h!==void 0&&(h.className=h.classList.toString().split(" ").filter(r=>/^bg-/.test(r)===!1).join(" ")),t.hideFromClone===!0&&s.classList.add("q-morph--internal"),s.setAttribute("aria-hidden","true"),s.style.transition="none",s.style.animation="none",s.style.pointerEvents="none",x.insertBefore(s,y),u.qMorphCancel=()=>{n=!0,s.remove(),h!==void 0&&h.remove(),t.hideFromClone===!0&&s.classList.remove("q-morph--internal"),u.qMorphCancel=void 0};const Ce=()=>{const r=Ct(c.to);if(n===!0||Ft(r)!==!0){typeof u.qMorphCancel=="function"&&u.qMorphCancel();return}u!==r&&typeof r.qMorphCancel=="function"&&r.qMorphCancel(),t.keepToClone!==!0&&r.classList.add("q-morph--internal"),s.classList.add("q-morph--internal");const{width:ve,height:X}=ze(x),{width:Fe,height:Ae}=ze(r.parentNode);t.hideFromClone!==!0&&s.classList.remove("q-morph--internal"),r.qMorphCancel=()=>{n=!0,s.remove(),h!==void 0&&h.remove(),t.hideFromClone===!0&&s.classList.remove("q-morph--internal"),t.keepToClone!==!0&&r.classList.remove("q-morph--internal"),u.qMorphCancel=void 0,r.qMorphCancel=void 0};const re=()=>{if(n===!0){typeof r.qMorphCancel=="function"&&r.qMorphCancel();return}t.hideFromClone!==!0&&(s.classList.add("q-morph--internal"),s.innerHTML="",s.style.left=0,s.style.right="unset",s.style.top=0,s.style.bottom="unset",s.style.transform="none"),t.keepToClone!==!0&&r.classList.remove("q-morph--internal");const O=r.parentNode,{width:K,height:Y}=ze(O),C=r.cloneNode(t.keepToClone);C.setAttribute("aria-hidden","true"),t.keepToClone!==!0&&(C.style.left=0,C.style.right="unset",C.style.top=0,C.style.bottom="unset",C.style.transform="none",C.style.pointerEvents="none"),C.classList.add("q-morph--internal");const Te=r===u&&x===O?s:r.nextElementSibling;O.insertBefore(C,Te);const{borderWidth:he,borderStyle:F,borderColor:w,borderRadius:m,backgroundColor:E,transform:ct,position:ut,cssText:It}=xt(r,["borderWidth","borderStyle","borderColor","borderRadius","backgroundColor","transform","position","cssText"]),mt=r.classList.toString(),Bt=r.style.cssText;r.style.cssText=It,r.style.transform="none",r.style.animation="none",r.style.transition="none",r.className=mt.split(" ").filter(I=>/^bg-/.test(I)===!1).join(" ");const G=yt(r,t.resize),ie=g.left-G.left,se=g.top-G.top,je=g.width/(G.width>0?G.width:10),Ne=g.height/(G.height>0?G.height:100),ne=$-ve,ae=L-X,_e=K-Fe,ke=Y-Ae,de=Math.max(g.widthM,ne),ce=Math.max(g.heightM,ae),be=Math.max(G.widthM,_e),ye=Math.max(G.heightM,ke),Oe=u===r&&["absolute","fixed"].includes(ut)===!1&&["absolute","fixed"].includes(V)===!1;let Ie=ut==="fixed",Be=O;for(;Ie!==!0&&Be!==document;)Ie=window.getComputedStyle(Be).position==="fixed",Be=Be.parentNode;if(t.hideFromClone!==!0&&(s.style.display="block",s.style.flex="0 0 auto",s.style.opacity=0,s.style.minWidth="unset",s.style.maxWidth="unset",s.style.minHeight="unset",s.style.maxHeight="unset",s.classList.remove("q-morph--internal")),t.keepToClone!==!0&&(C.style.display="block",C.style.flex="0 0 auto",C.style.opacity=0,C.style.minWidth="unset",C.style.maxWidth="unset",C.style.minHeight="unset",C.style.maxHeight="unset"),C.classList.remove("q-morph--internal"),typeof t.classes=="string"&&(r.className+=" "+t.classes),typeof t.style=="string")r.style.cssText+=" "+t.style;else if(Ut(t.style)===!0)for(const I in t.style)r.style[I]=t.style[I];const Le=Dt(s),Pe=Dt(r),Ye=Ie===!0?document.documentElement:{scrollLeft:0,scrollTop:0};r.style.position=Ie===!0?"fixed":"absolute",r.style.left=`${G.left-Ye.scrollLeft}px`,r.style.right="unset",r.style.top=`${G.top-Ye.scrollTop}px`,r.style.margin=0,t.resize===!0&&(r.style.minWidth="unset",r.style.maxWidth="unset",r.style.minHeight="unset",r.style.maxHeight="unset",r.style.overflow="hidden",r.style.overflowX="hidden",r.style.overflowY="hidden"),document.body.appendChild(r),h!==void 0&&(h.style.cssText=A,h.style.transform="none",h.style.animation="none",h.style.transition="none",h.style.position=r.style.position,h.style.left=`${g.left-Ye.scrollLeft}px`,h.style.right="unset",h.style.top=`${g.top-Ye.scrollTop}px`,h.style.margin=0,h.style.pointerEvents="none",t.resize===!0&&(h.style.minWidth="unset",h.style.maxWidth="unset",h.style.minHeight="unset",h.style.maxHeight="unset",h.style.overflow="hidden",h.style.overflowX="hidden",h.style.overflowY="hidden"),document.body.appendChild(h));const ft=I=>{u===r&&d!==!0?(r.style.cssText=_,r.className=p):(r.style.cssText=Bt,r.className=mt),C.parentNode===O&&O.insertBefore(r,C),s.remove(),C.remove(),h!==void 0&&h.remove(),a=()=>!1,u.qMorphCancel=void 0,r.qMorphCancel=void 0,typeof t.onEnd=="function"&&t.onEnd(d===!0?"to":"from",I===!0)};if(t.useCSS!==!0&&typeof r.animate=="function"){const I=t.resize===!0?{transform:`translate(${ie}px, ${se}px)`,width:`${de}px`,height:`${ce}px`}:{transform:`translate(${ie}px, ${se}px) scale(${je}, ${Ne})`},Ee=t.resize===!0?{width:`${be}px`,height:`${ye}px`}:{},We=t.resize===!0?{width:`${de}px`,height:`${ce}px`}:{},Xe=t.resize===!0?{transform:`translate(${-1*ie}px, ${-1*se}px)`,width:`${be}px`,height:`${ye}px`}:{transform:`translate(${-1*ie}px, ${-1*se}px) scale(${1/je}, ${1/Ne})`},Ke=h!==void 0?{opacity:t.tweenToOpacity}:{backgroundColor:N},Ze=h!==void 0?{opacity:1}:{backgroundColor:E};v=r.animate([{margin:0,borderWidth:D,borderStyle:P,borderColor:H,borderRadius:Q,zIndex:Le,transformOrigin:"0 0",...I,...Ke},{margin:0,borderWidth:he,borderStyle:F,borderColor:w,borderRadius:m,zIndex:Pe,transformOrigin:"0 0",transform:ct,...Ee,...Ze}],{duration:t.duration,easing:t.easing,fill:t.fill,delay:t.delay}),f=h===void 0?void 0:h.animate([{opacity:t.tweenFromOpacity,margin:0,borderWidth:D,borderStyle:P,borderColor:H,borderRadius:Q,zIndex:Le,transformOrigin:"0 0",transform:M,...We},{opacity:0,margin:0,borderWidth:he,borderStyle:F,borderColor:w,borderRadius:m,zIndex:Pe,transformOrigin:"0 0",...Xe}],{duration:t.duration,easing:t.easing,fill:t.fill,delay:t.delay}),o=t.hideFromClone===!0||Oe===!0?void 0:s.animate([{margin:`${ae<0?ae/2:0}px ${ne<0?ne/2:0}px`,width:`${de+g.marginH}px`,height:`${ce+g.marginV}px`},{margin:0,width:0,height:0}],{duration:t.duration,easing:t.easing,fill:t.fill,delay:t.delay}),b=t.keepToClone===!0?void 0:C.animate([Oe===!0?{margin:`${ae<0?ae/2:0}px ${ne<0?ne/2:0}px`,width:`${de+g.marginH}px`,height:`${ce+g.marginV}px`}:{margin:0,width:0,height:0},{margin:`${ke<0?ke/2:0}px ${_e<0?_e/2:0}px`,width:`${be+G.marginH}px`,height:`${ye+G.marginV}px`}],{duration:t.duration,easing:t.easing,fill:t.fill,delay:t.delay});const le=$e=>{o!==void 0&&o.cancel(),f!==void 0&&f.cancel(),b!==void 0&&b.cancel(),v.cancel(),v.removeEventListener("finish",le),v.removeEventListener("cancel",le),ft($e),o=void 0,f=void 0,b=void 0,v=void 0};u.qMorphCancel=()=>{u.qMorphCancel=void 0,n=!0,le()},r.qMorphCancel=()=>{r.qMorphCancel=void 0,n=!0,le()},v.addEventListener("finish",le),v.addEventListener("cancel",le),a=$e=>n===!0||v===void 0?!1:$e===!0?(le(!0),!0):(d=d!==!0,o!==void 0&&o.reverse(),f!==void 0&&f.reverse(),b!==void 0&&b.reverse(),v.reverse(),!0)}else{const I=`q-morph-anim-${++wo}`,Ee=document.createElement("style"),We=t.resize===!0?`
            transform: translate(${ie}px, ${se}px);
            width: ${de}px;
            height: ${ce}px;
          `:`transform: translate(${ie}px, ${se}px) scale(${je}, ${Ne});`,Xe=t.resize===!0?`
            width: ${be}px;
            height: ${ye}px;
          `:"",Ke=t.resize===!0?`
            width: ${de}px;
            height: ${ce}px;
          `:"",Ze=t.resize===!0?`
            transform: translate(${-1*ie}px, ${-1*se}px);
            width: ${be}px;
            height: ${ye}px;
          `:`transform: translate(${-1*ie}px, ${-1*se}px) scale(${1/je}, ${1/Ne});`,le=h!==void 0?`opacity: ${t.tweenToOpacity};`:`background-color: ${N};`,$e=h!==void 0?"opacity: 1;":`background-color: ${E};`,Lt=h===void 0?"":`
            @keyframes ${I}-from-tween {
              0% {
                opacity: ${t.tweenFromOpacity};
                margin: 0;
                border-width: ${D};
                border-style: ${P};
                border-color: ${H};
                border-radius: ${Q};
                z-index: ${Le};
                transform-origin: 0 0;
                transform: ${M};
                ${Ke}
              }

              100% {
                opacity: 0;
                margin: 0;
                border-width: ${he};
                border-style: ${F};
                border-color: ${w};
                border-radius: ${m};
                z-index: ${Pe};
                transform-origin: 0 0;
                ${Ze}
              }
            }
          `,Pt=t.hideFromClone===!0||Oe===!0?"":`
            @keyframes ${I}-from {
              0% {
                margin: ${ae<0?ae/2:0}px ${ne<0?ne/2:0}px;
                width: ${de+g.marginH}px;
                height: ${ce+g.marginV}px;
              }

              100% {
                margin: 0;
                width: 0;
                height: 0;
              }
            }
          `,Yt=Oe===!0?`
            margin: ${ae<0?ae/2:0}px ${ne<0?ne/2:0}px;
            width: ${de+g.marginH}px;
            height: ${ce+g.marginV}px;
          `:`
            margin: 0;
            width: 0;
            height: 0;
          `,qt=t.keepToClone===!0?"":`
            @keyframes ${I}-to {
              0% {
                ${Yt}
              }

              100% {
                margin: ${ke<0?ke/2:0}px ${_e<0?_e/2:0}px;
                width: ${be+G.marginH}px;
                height: ${ye+G.marginV}px;
              }
            }
          `;Ee.innerHTML=`
          @keyframes ${I} {
            0% {
              margin: 0;
              border-width: ${D};
              border-style: ${P};
              border-color: ${H};
              border-radius: ${Q};
              background-color: ${N};
              z-index: ${Le};
              transform-origin: 0 0;
              ${We}
              ${le}
            }

            100% {
              margin: 0;
              border-width: ${he};
              border-style: ${F};
              border-color: ${w};
              border-radius: ${m};
              background-color: ${E};
              z-index: ${Pe};
              transform-origin: 0 0;
              transform: ${ct};
              ${Xe}
              ${$e}
            }
          }

          ${Pt}

          ${Lt}

          ${qt}
        `,document.head.appendChild(Ee);let ee="normal";s.style.animation=`${t.duration}ms ${t.easing} ${t.delay}ms ${ee} ${t.fill} ${I}-from`,h!==void 0&&(h.style.animation=`${t.duration}ms ${t.easing} ${t.delay}ms ${ee} ${t.fill} ${I}-from-tween`),C.style.animation=`${t.duration}ms ${t.easing} ${t.delay}ms ${ee} ${t.fill} ${I}-to`,r.style.animation=`${t.duration}ms ${t.easing} ${t.delay}ms ${ee} ${t.fill} ${I}`;const me=Me=>{Me===Object(Me)&&Me.animationName!==I||(r.removeEventListener("animationend",me),r.removeEventListener("animationcancel",me),ft(),Ee.remove())};u.qMorphCancel=()=>{u.qMorphCancel=void 0,n=!0,me()},r.qMorphCancel=()=>{r.qMorphCancel=void 0,n=!0,me()},r.addEventListener("animationend",me),r.addEventListener("animationcancel",me),a=Me=>n===!0||!r||!s||!C?!1:Me===!0?(me(),!0):(d=d!==!0,ee=ee==="normal"?"reverse":"normal",s.style.animationDirection=ee,h.style.animationDirection=ee,C.style.animationDirection=ee,r.style.animationDirection=ee,!0)}};t.waitFor>0||t.waitFor==="transitionend"||t.waitFor===Object(t.waitFor)&&typeof t.waitFor.then=="function"?(t.waitFor>0?new Promise(K=>setTimeout(K,t.waitFor)):t.waitFor==="transitionend"?new Promise(K=>{const Y=()=>{C!==null&&(clearTimeout(C),C=null),r&&(r.removeEventListener("transitionend",Y),r.removeEventListener("transitioncancel",Y)),K()};let C=setTimeout(Y,400);r.addEventListener("transitionend",Y),r.addEventListener("transitioncancel",Y)}):t.waitFor).then(re).catch(()=>{typeof r.qMorphCancel=="function"&&r.qMorphCancel()}):re()};return typeof e.onToggle=="function"&&e.onToggle(),requestAnimationFrame(Ce),r=>a(r)}const To={class:"text-bold text-subtitle1 vertical-middle q-pl-md"},_o={__name:"StockFileListHeader",setup(e){const a=J("addVisible"),n=J("bgColor"),d=J("mainContainer"),c=J("doneVisible"),t=J("addNewAdjustment"),u=J("expandLess"),o=J("saveAjustment"),f=J("showAddButton"),b=J("cancelAdjustment"),v=J("showCancel"),x=J("loadingSave"),y=R(""),g=R(!1),$=()=>{d?y.value="list-header":y.value=""},L=()=>{g.value=!g.value,u(g.value)};return dt(()=>{$()}),(D,P)=>(k(),ue(mo,{dense:"","inline-actions":"",class:kt([[B(n),y.value],"text-white q-pa-none"])},{action:i(()=>[B(c)?(k(),ue(pe,{key:0,loading:B(x),flat:"",dense:"",round:"",color:"green-8",icon:"done",onClick:B(o)},null,8,["loading","onClick"])):qe("",!0),B(f)?(k(),ue(pe,{key:1,dense:"",flat:"",round:"",color:"green-8",icon:g.value?"expand_less":"expand_more",class:"float-right",onClick:L},null,8,["icon"])):qe("",!0),B(a)?(k(),ue(pe,{key:2,dense:"",flat:"",round:"",color:"green-8",icon:"add",class:"float-right"},{default:i(()=>[l(Vt,{anchor:"center middle",self:"center middle"},{default:i(()=>[l(jt,{style:{"min-width":"150px"}},{default:i(()=>[He((k(),ue(Qe,{clickable:""},{default:i(()=>[l(Se,{onClick:P[0]||(P[0]=H=>B(t)("POSETIVE"))},{default:i(()=>[T("Ajuste Positivo")]),_:1})]),_:1})),[[it]]),He((k(),ue(Qe,{clickable:""},{default:i(()=>[l(Se,{onClick:P[1]||(P[1]=H=>B(t)("NEGATIVE"))},{default:i(()=>[T("Ajuste Negativo")]),_:1})]),_:1})),[[it]])]),_:1})]),_:1})]),_:1})):qe("",!0),B(v)?(k(),ue(pe,{key:3,dense:"",flat:"",round:"",color:"red-8",icon:"clear",class:"float-right",onClick:B(b)},null,8,["onClick"])):qe("",!0)]),default:i(()=>[U("span",To,[Ht(D.$slots,"default")])]),_:3},8,["class"]))}},ge={__name:"TextField",setup(e){const a=J("valueInput"),n=J("refInput");return(d,c)=>(k(),ue(Et,{outlined:"",ref:B(n),value:B(a),type:"text",onInput:c[1]||(c[1]=t=>d.$emit("update:value",t.target.value)),"lazy-rules":""},Qt({_:2},[B(a)!==null&&B(a)!==void 0&&B(a)!==""?{name:"append",fn:i(()=>[l(xe,{name:"close",onClick:c[0]||(c[0]=t=>a.value=""),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["value"]))}},oe=fo();Je();const ko=Mt(),{closeLoading:Eo,showloading:$n}=Jt(),{alertSucess:At,alertError:Mn,alertWarning:Rn}=Rt(),we=Gt($t);var Ve={async post(e){const a=await fe().post("drug",e);we.save(a.data),At("O Registo foi efectuado com sucesso")},get(e){if(e>=0)return fe().get("drug?offset="+e+"&max=100").then(a=>{we.save(a.data),e=e+100,a.data.length>0?this.get(e):Eo()})},async patch(e,a){const n=await fe().patch("drug?id=eq."+e,a);we.save(JSON.parse(n.config.data)),At("O Registo foi alterado com sucesso")},async delete(e){await fe().delete("drug/"+e),we.destroy(e)},async apiGetDrugFileMobile(e){return await fe().get(`/drugStockFile/drugfilemobile/${e}`)},async apiGetDrugSummary(e,a){return await fe().get(`/drugStockFile/sumary/${e}/${a}`)},async apiGetDrugBatchSummary(e,a){return await fe().get(`/drugStockFile/batchsumary/${e}/${a}`)},localDbAddOrUpdate(e){return et.nSQL().onConnected(()=>{et.nSQL("drugFiles").query("upsert",e).exec(),we.save(e)})},localDbGetAll(){return et.nSQL("drugFiles").query("select").exec().then(e=>(we.save(e),e))},calculateBalance(e){let a=0;for(let n=0;n<e.length;n++){if(n>0){const d=Number(e[n].incomes)-Number(e[n].outcomes)+Number(e[n].posetiveAdjustment)-Number(e[n].negativeAdjustment)-Number(e[n].loses);a=Number(e[n-1].balance)+Number(d),e[n].balance=a}else{const d=Number(e[n].incomes)-Number(e[n].outcomes)+Number(e[n].posetiveAdjustment)-Number(e[n].negativeAdjustment)-Number(e[n].loses);a=Number(d)+Number(a),e[n].balance=a}e[n].month!==void 0&&(e[n].month=ko.getMonthName(e[n].month))}return e},async getDrugFileSummary(e){const a=[];return(await oe.getEntrancesDrugFile(e)).forEach(o=>{a.push(o)}),(await oe.getPacksDrugFile(e)).forEach(o=>{a.push(o)}),(await oe.getAdjustmentsDrugFile(e)).forEach(o=>{a.push(o)}),(await oe.getDestructionsDrugFile(e)).forEach(o=>{a.push(o)}),(await oe.getInventoryAdjustmentsDrugFile(e)).forEach(o=>{a.push(o)}),this.calculateBalance(a).reverse()},async getDrugFileSummaryBatch(e){const a=[];return(await oe.getEntrancesDrugFileBatch(e)).forEach(o=>{a.push(o)}),(await oe.getPacksDrugFileBatch(e)).forEach(o=>{a.push(o)}),(await oe.getAdjustmentsDrugFileBatch(e)).forEach(o=>{a.push(o)}),(await oe.getDestructionsDrugFileBatch(e)).forEach(o=>{a.push(o)}),(await oe.getInventoryAdjustmentsDrugFileBatch(e)).forEach(o=>{a.push(o)}),this.calculateBalance(a).reverse()}};const $o={class:"box-border q-pb-md"},Mo={class:"text-blue-grey-8"},Ro={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},Vo=U("span",null," Sem informa\xE7\xE3o por visualizar ",-1),jo={key:0},No={class:"row items-center justify-end"},Oo={key:1},Io={key:0},Bo={key:1},Lo={key:0},Po={key:1},Yo={key:0},qo={key:1},zo={key:0},Uo={key:1},Ho={key:0},Qo={key:1},Go={key:0},Jo={key:1},Wo={key:0},Xo={key:1},Ko={__name:"LoteInfoContainer",props:["stockInfo","batchS"],setup(e){const{isMobile:a,isOnline:n}=Je(),{alertSucess:d,alertError:c}=Rt(),t=R(!0),u=R(!1),o=J("batchChanged"),f=[{name:"eventDate",required:!0,label:"Data Movimento",field:"eventDate",align:"center",sortable:!0},{name:"moviment",align:"center",label:"Origem/Destino",sortable:!0},{name:"incomes",align:"center",label:"Entrada",sortable:!0},{name:"outcomes",align:"center",label:"Sa\xEDdas",sortable:!0},{name:"posetiveAdjustment",align:"center",label:"Ajuste Positivo (+)",sortable:!0},{name:"negativeAdjustment",align:"center",label:"Ajuste Negativo (-)",sortable:!0},{name:"loses",align:"center",label:"Perdas",sortable:!0},{name:"balance",align:"center",label:"Saldo",sortable:!0}],b=e,v=Mt(),x=R(""),y=R([]),g=R(""),$=R("display"),L=R(!0),D=R({}),P=R({}),H=R({}),Q=R(0),N=R(!1),M=F=>{L.value=!F},V=F=>F<=Z(new Date).format("YYYY/MM/DD"),A=()=>{u.value=!0,N.value=!1;const F=De.currClinic();F.sectors=[];let w=null,m=null,E=null;if(Te.value?(E=new Xt({id:gt(),date:v.getDateFromHyphenDDMMYYYYWithTime(D.value.eventDate),clinic:F}),w=new Kt({adjustedValue:Number(D.value.loses),operation:pt.getStockOperatinTypeByCode("AJUSTE_NEGATIVO")}),E.adjustments.push(w)):(Y.value||C.value)&&(m=new Zt({id:gt(),origin:D.value.moviment,date:v.getDateFromHyphenDDMMYYYYWithTime(D.value.eventDate),quantity:Y.value?Number(D.value.posetiveAdjustment):Number(D.value.negativeAdjustment),orderNumber:"Ordem_ajuste",clinic:F}),w=new eo({adjustedValue:Y.value?Number(D.value.posetiveAdjustment):Number(D.value.negativeAdjustment),operation:pt.getStockOperatinTypeByCode(Y.value?"AJUSTE_POSETIVO":"AJUSTE_NEGATIVO")}),m.adjustments.push(w)),w.adjustedStock=rt.getStockById(X.value.id),D.value.eventDate.trim()===""){c("Por favor indicar a  data de movimento correcta."),u.value=!1;return}else v.getDateFormatYYYYMMDDFromDDMMYYYY(D.value.eventDate)<v.getYYYYMMDDFromJSDate(w.adjustedStock.entrance.dateReceived)?(c("A data do movimento n\xE3o pode ser menor que a data de entrada do lote."),u.value=!1):v.getDateFromHyphenDDMMYYYYWithTime(D.value.eventDate)>new Date?(c("A data do movimento n\xE3o pode ser maior que a data corrente."),u.value=!1):D.value.moviment.trim()===""?(c("Por favor indicar a Origem/Destino."),u.value=!1):Number(w.adjustedValue)<=0||isNaN(w.adjustedValue)?(c("Por favor indicar uma quantidade v\xE1lida."),u.value=!1):(Te.value||C.value)&&w.adjustedStock.stockMoviment-w.adjustedValue<0?(c("A quantidade que pretende retitar \xE9 maior que a quantidade em stock no momento, imposs\xEDvel prosseguir!"),u.value=!1):(Q.value=y.value[1].balance,w.clinic=F,w.captureDate=v.getDateFromHyphenDDMMYYYYWithTime(D.value.eventDate),w.adjustedStock.clinic=F,Y.value?w.adjustedStock.stockMoviment=Number(Q.value)+Number(w.adjustedValue):w.adjustedStock.stockMoviment=Number(Q.value)-Number(w.adjustedValue),w.balance=w.adjustedStock.stockMoviment,D.value.balance=w.balance,console.log("RFERENCE:",m),p(m,E))},p=(F,w)=>{Y.value||C.value?go.post(F).then(m=>{D.value.id=F.adjustments[0].id,_(F.adjustments[0].adjustedStock)}):(w.notes=" - ",po.post(w).then(m=>{D.value.id=w.adjustments[0].id,_(w.adjustments[0].adjustedStock)}))},_=F=>{o.value=!0,rt.patch(F.id,F).then(w=>{$.value="display",g.value="",ve(),d("Opera\xE7\xE3o efectuada com sucesso."),u.value=!1})},s=()=>{const F=y.value.map(w=>w.id).indexOf(D.value.id);y.value.splice(F,1),g.value="",$.value="display"},h=()=>{y.value.shift(),$.value="display",N.value=!1},Ce=F=>{if(y.value.some(m=>m.id===null))c("Ja existe uma operacao de ajuste em curso.");else{N.value=!0,K.value=!1,g.value=F;const m={id:null,eventDate:" ",moviment:" ",orderNumber:F==="POSETIVE"?" ":"",incomes:"-",outcomes:"-",posetiveAdjustment:F==="POSETIVE"?" ":"",negativeAdjustment:F==="NEGATIVE"?" ":"",loses:F==="LOSS"?" ":"-",balance:" "};D.value=m,y.value.unshift(m),$.value="create"}},r=()=>{const F=new Date(X.value.expireDate);if(F<new Date)return x.value="Expired","Expirou aos "+v.formatDate(X.value.expireDate);if(F===new Date)return x.value="Expiring","Expira Hoje!";if(vt.addToDate(new Date,{months:2})>=F){x.value="Expiring";const w=vt.getDateDiff(F,new Date,"days");return"Faltam "+w+" dias para expirar"}else return x.value="valid",v.formatDate(X.value.expireDate)},ve=()=>{const F=De.currClinic();n.value?Ve.apiGetDrugBatchSummary(F.id,X.value.id).then(w=>{const m=w.data;y.value=m,t.value=!1}):Ve.getDrugFileSummaryBatch(X.value.id).then(w=>{y.value=w,t.value=!1})},X=te(()=>b.stockInfo),Fe=te(()=>r()),Ae=te(()=>x.value!=="valid"?"text-red-8":"text-green-8"),re=te(()=>$.value==="edit"||$.value==="create"),O=te(()=>$.value==="display"),K=te(()=>x.value!=="Expired"||$.value!=="edit"),Y=te(()=>g.value==="POSETIVE"),C=te(()=>g.value==="NEGATIVE"),Te=te(()=>g.value==="LOSS"),he=te(()=>re.value?"bg-orange-5":"bg-grey-6");return dt(()=>{ve()}),W("expandLess",M),W("addNewAdjustment",Ce),W("cancel",s),W("bgColor",P),W("addVisible",K),W("doneVisible",re),W("mainContainer",H),W("saveAjustment",A),W("showCancel",N),W("cancelAdjustment",h),W("loadingSave",u),(F,w)=>(k(),j("div",$o,[l(_o,{addVisible:K.value,doneVisible:re.value,mainContainer:!1,expandLess:"expandLess",addNewAdjustment:"addNewAdjustment",cancelAdjustment:"cancelAdjustment",saveAjustment:"saveAjustment",showCancel:N.value,bgColor:he.value,loadingSave:u.value},{default:i(()=>[U("span",Mo,[T("Nr. do Lote: "+S(X.value.batchNumber)+" - [Saldo Actual: "+S(X.value.stockMoviment)+"] - [Validade: ",1),U("span",{class:kt(Ae.value)},S(Fe.value),3),T("]")])]),_:1},8,["addVisible","doneVisible","showCancel","bgColor","loadingSave"]),He(l(Nt,{class:"col",dense:"",flat:"",separator:"cell",rows:y.value,columns:f,"row-key":"id",loading:t.value},{"no-data":i(({icon:m,filter:E})=>[U("div",Ro,[Vo,l(xe,{size:"2em",name:E?"filter_b_and_w":m},null,8,["name"])])]),header:i(m=>[l(Ge,{class:"text-left bg-grey-3",style:{"text-align":"center"},props:m},{default:i(()=>[l(q,{style:{width:"140px"}},{default:i(()=>[T(S(f[0].label),1)]),_:1}),l(q,{style:{width:"200px"}},{default:i(()=>[T(S(f[1].label),1)]),_:1}),l(q,{style:{width:"180px"}},{default:i(()=>[T(S(f[2].label),1)]),_:1}),l(q,{style:{width:"120px"}},{default:i(()=>[T(S(f[3].label),1)]),_:1}),l(q,{style:{width:"120px"}},{default:i(()=>[T(S(f[4].label),1)]),_:1}),l(q,{style:{width:"120px"}},{default:i(()=>[T(S(f[5].label),1)]),_:1}),l(q,{style:{width:"120px"}},{default:i(()=>[T(S(f[6].label),1)]),_:1}),l(q,{style:{width:"120px"}},{default:i(()=>[T(S(f[7].label),1)]),_:1})]),_:2},1032,["props"])]),body:i(m=>[l(Ge,{props:m},{default:i(()=>[l(z,{key:"eventDate",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",jo,[l(Et,{dense:"",outlined:"",class:"col",modelValue:m.row.eventDate,"onUpdate:modelValue":E=>m.row.eventDate=E,ref:"expireDate",label:"Data Movimento"},{append:i(()=>[l(xe,{name:"event",class:"cursor-pointer"},{default:i(()=>[l(co,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:i(()=>[l(uo,{modelValue:m.row.eventDate,"onUpdate:modelValue":E=>m.row.eventDate=E,mask:"DD-MM-YYYY",options:V},{default:i(()=>[U("div",No,[He(l(pe,{label:"Close",color:"primary",flat:""},null,512),[[it]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])])):(k(),j("span",Oo,S(B(v).isValidDate(m.row.eventDate)?B(v).getDDMMYYYFromJSDate(m.row.eventDate):B(v).getDateFormatDDMMYYYYFromYYYYMMDD(m.row.eventDate)),1))]),_:2},1032,["props"]),l(z,{key:"moviment",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",Io,[l(ge,{modelValue:m.row.moviment,"onUpdate:modelValue":E=>m.row.moviment=E,label:"Tipo de Movimento",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue"])])):(k(),j("span",Bo,S(m.row.moviment),1))]),_:2},1032,["props"]),l(z,{key:"incomes",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",Lo,[l(ge,{modelValue:m.row.incomes,"onUpdate:modelValue":E=>m.row.incomes=E,disable:"",label:"Entradas",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue"])])):(k(),j("span",Po,S(m.row.incomes),1))]),_:2},1032,["props"]),l(z,{key:"outcomes",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",Yo,[l(ge,{modelValue:m.row.outcomes,"onUpdate:modelValue":E=>m.row.outcomes=E,disable:"",label:"Sa\xEDdas",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue"])])):(k(),j("span",qo,S(m.row.outcomes),1))]),_:2},1032,["props"]),l(z,{key:"posetiveAdjustment",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",zo,[l(ge,{modelValue:m.row.posetiveAdjustment,"onUpdate:modelValue":E=>m.row.posetiveAdjustment=E,disable:!Y.value,label:"Ajuste Positivo",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue","disable"])])):(k(),j("span",Uo,S(m.row.posetiveAdjustment),1))]),_:2},1032,["props"]),l(z,{key:"negativeAdjustment",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",Ho,[l(ge,{modelValue:m.row.negativeAdjustment,"onUpdate:modelValue":E=>m.row.negativeAdjustment=E,disable:!C.value,label:"Ajuste Negativo",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue","disable"])])):(k(),j("span",Qo,S(m.row.negativeAdjustment),1))]),_:2},1032,["props"]),l(z,{key:"loses",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",Go,[l(ge,{modelValue:m.row.loses,"onUpdate:modelValue":E=>m.row.loses=E,disable:!Te.value,label:"Perdas",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue","disable"])])):(k(),j("span",Jo,S(m.row.loses),1))]),_:2},1032,["props"]),l(z,{key:"balance",props:m},{default:i(()=>[m.row.id===null&&!O.value?(k(),j("span",Wo,[l(ge,{modelValue:m.row.balance,"onUpdate:modelValue":E=>m.row.balance=E,disable:"",label:"Saldo",dense:"",class:"col"},null,8,["modelValue","onUpdate:modelValue"])])):(k(),j("span",Xo,S(m.row.balance),1))]),_:2},1032,["props"])]),_:2},1032,["props"])]),loading:i(()=>[l(Ot,{showing:"",color:"primary"})]),_:1},8,["rows","loading"]),[[Wt,L.value]])]))}},{isMobile:Tt,isOnline:nt}=Je(),Zo=`REP\xDABLICA DE MO\xC7AMBIQUE 
 MINIST\xC9RIO DA SA\xDADE 
 CENTRAL DE MEDICAMENTOS E ARTIGOS M\xC9DICOS `,en="Ficha do Medicamento",Ue="FichaDoMedicamento",at=Ue.concat("_"+st.getFormatDDMMYYYY(new Date)),lt=De.currClinic();var _t={async downloadPDF(e,a,n,d){const c=new vo({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});c.setProperties({title:at.concat(".pdf")});const t=new Image;t.src="data:image/png;base64,"+tt;const u=new Image;u.src="data:image/png;base64,"+tt,c.internal.pageSize.getWidth();const o=[[{content:"Ficha do Medicamento",styles:{minCellHeight:20,fontSize:16,halign:"center"},colSpan:4,halign:"center",valign:"middle",fontStyle:"bold"}],[{content:"Unidade Sanit\xE1ria: "+lt.clinicName,colSpan:2,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"FNM: "+n.value.fnmCode,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Medicamento: "+n.value.name,colSpan:1,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"}],[{content:"Distrito: "+lt.district.description,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Prov\xEDncia: "+lt.province.description,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Unidade: "+n.value.packSize,halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"},{content:"Data do relat\xF3rio: "+Z(new Date).format("DD-MM-YYYY"),halign:"center",valign:"left",fontStyle:"bold",fontSize:"14"}]];ot(c,{bodyStyles:{halign:"left",valign:"middle",fontSize:6},headStyles:{halign:"left",valign:"middle",fontSize:6},theme:"grid",body:o}),c.setFontSize(10),c.addImage(u,"png",16,16,16,16),c.text("Rep\xFAblica de Mo\xE7ambique ",47,22),c.text("Minist\xE9rio da Sa\xFAde ",52,26),c.text("Central de Medicamentos e Artigos M\xE9dicos ",34,30);const f=[[{content:"RESUMO DE STOCK",colSpan:8}],[{content:"PERIODO DE MOVIMENTO"},{content:"MOVIMENTO"},{content:"ENTRADAS"},{content:"SA\xCDDAS"},{content:"AJUSTE POSITIVO (+)"},{content:"AJUSTE NEGATIVO (-)"},{content:"PERDAS"},{content:"SALDOS"}]],b=this.createArrayOfArrayRowForResumo(a.value);ot(c,{bodyStyles:{overflow:"linebreak",cellWidth:"wrap",valign:"middle",fontSize:6,overflowColumns:"linebreak"},headStyles:{valign:"bottom",halign:"center",fontSize:6,lineWidth:.5,lineColor:[230,230,230],fillColor:[255,255,255],textColor:[96,96,96]},didDrawPage:function(x){const y="P\xE1gina "+c.internal.getNumberOfPages();c.setFontSize(6);const g=c.internal.pageSize,$=g.height?g.height:g.getHeight();c.text(y,x.settings.margin.right,$-10)},theme:"grid",head:f,body:b});const v=this.filtrarEOrdenarObjetos(d);this.imprimirAoTerminar(v,c,e,"")},async downloadExcel(e,a,n,d){const c=De.currClinic();let t=this.createArrayOfArrayRowForResumo(a.value);if(!nt.value){const C=await this.getDataLocalReport(id);if(C===void 0||C.length===0)return 204;t=this.createArrayOfArrayRow(C),params.startDateParam=st.getFormatDDMMYYYY(t[0].startDate),params.endDateParam=st.getFormatDDMMYYYY(t[0].endDate)}const u=new ho.exports.Workbook;u.creator="CSAUDE",u.lastModifiedBy="CSAUDE",u.created=new Date,u.modified=new Date,u.lastPrinted=new Date;const o=u.addWorksheet(Ue),f=u.addImage({base64:"data:image/png;base64,"+tt,extension:"png"}),b=o.getCell("A8"),v=o.getCell("A9"),x=o.getCell("A11"),y=o.getCell("B11"),g=o.getCell("A12"),$=o.getCell("B12"),L=o.getCell("C12"),D=o.getCell("D12"),P=o.getCell("G11"),H=o.getCell("G12"),Q=o.getCell("H11"),N=o.getCell("H12"),M=o.getCell("A13"),V=o.getCell("I11"),A=o.getCell("I12"),p=o.getCell("J11"),_=o.getCell("J12"),s=o.getRow(14),h=o.getColumn("A"),Ce=o.getColumn("B"),r=o.getColumn("C"),ve=o.getColumn("D"),X=o.getColumn("E"),Fe=o.getColumn("F"),Ae=o.getColumn("G"),re=o.getColumn("H"),O=o.getColumn("I"),K=o.getColumn("J");o.getCell("A13").fill=o.getCell("B13").fill=o.getCell("C13").fill=o.getCell("D13").fill=o.getCell("E13").fill=o.getCell("F13").fill=o.getCell("G13").fill=o.getCell("H13").fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},M.alignment=b.alignment=v.alignment=s.alignment={vertical:"middle",horizontal:"center",wrapText:!0},x.alignment=g.alignment=L.alignment=V.alignment=A.alignment={vertical:"middle",horizontal:"left",wrapText:!1},b.border=v.border=x.border=$.border=g.border=y.border=L.border=D.border=V.border=p.border=A.border=_.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},b.value=Zo,v.value=en,y.value=c.clinicName!==null?c.clinicName:"",D.value=c.province!==null?c.province.description:"",$.value=c.district!==null?c.district.description:"",N.value=n.value.packSize,Q.value=n.value.fnmCode,P.value="FNM",M.value="RESUMO",H.value="Unidade",p.value=n.value.name,_.value=Z(new Date).format("DD-MM-YYYY"),x.value="Farm\xE1cia",g.value="Distrito",L.value="Prov\xEDncia",V.value="Medicamento",A.value="Data do relat\xF3rio",o.mergeCells("A1:A7"),o.mergeCells("A9:J10"),o.mergeCells("B11:F11"),o.mergeCells("D12:F12"),o.mergeCells("A13:H13"),h.width=20,Ce.width=20,r.width=40,ve.width=15,X.width=25,Fe.width=25,Ae.width=20,re.width=20,O.width=20,K.width=20,M.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:10},o.addImage(f,{tl:{col:0,row:1},ext:{width:144,height:98}}),o.addTable({name:Ue,ref:"A14",headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"DATA DO MOVIMENTO",filterButton:!1},{name:"MOVIMENTO",totalsRowFunction:"none",filterButton:!1},{name:"ENTRADAS",totalsRowFunction:"none",filterButton:!1},{name:"SA\xCDDAS",totalsRowFunction:"none",filterButton:!1},{name:"AJUSTE POSITIVO (+) ",totalsRowFunction:"none",filterButton:!1},{name:"AJUSTE NEGATIVO (-) ",totalsRowFunction:"none",filterButton:!1},{name:"PERDAS",totalsRowFunction:"none",filterButton:!1},{name:"SALDOS",totalsRowFunction:"none",filterButton:!1}],rows:t});const Y=this.filtrarEOrdenarObjetos(d);this.imprimirAoTerminar(Y,o,e,u)},createArrayOfArrayRowForResumo(e){let a=0;const n=[];for(const d in e){a++;const c=[];if(c.push(e[d].month+", "+parseInt(e[d].year)),c.push(e[d].moviment),c.push(e[d].incomes),c.push(e[d].outcomes),c.push(e[d].posetiveAdjustment),c.push(e[d].negativeAdjustment),c.push(e[d].loses),c.push(e[d].balance),n.push(c),a===3)break}return n},createArrayOfArrayRowForLote(e){const a=[];for(const n in e){const d=[];d.push(e[n].numLote),d.push(Z(e[n].eventDate).format("DD-MM-YYYY")),d.push(e[n].moviment),d.push(e[n].incomes),d.push(e[n].outcomes),d.push(e[n].posetiveAdjustment),d.push(e[n].negativeAdjustment),d.push(e[n].loses),d.push(e[n].balance),d.push(e[n].validade),a.push(d)}return a},async imprimirAoTerminar(e,a,n,d){const c=[],t=[];for(const o in e){const f=[];f.push(e[o]);const b=Ve.apiGetDrugBatchSummary(f[0].clinic_id,f[0].id).then(v=>{const x=v.data;for(let g=0;g<x.length;g++)x[g].numLote=e[o].batchNumber,x[g].validade=Z(e[o].expireDate).format("DD-MM-YYYY");const y=this.ordenaPorMovimentoDesc(x);for(let g=0;g<y.length;g++)t.push(y[g])});c.push(b)}await Promise.all(c);const u=this.createArrayOfArrayRowForLote(this.ordenaPorMovimentoDesc1(t));if(n==="PDF")if(ot(a,{bodyStyles:{overflow:"linebreak",cellWidth:"wrap",valign:"middle",fontSize:6,overflowColumns:"linebreak"},headStyles:{valign:"bottom",halign:"center",fontSize:6,lineWidth:.5,lineColor:[230,230,230],fillColor:[255,255,255],textColor:[96,96,96]},theme:"grid",head:[[{content:"LOTES",colSpan:10}],[{content:"NR. DO LOTE"},{content:"DATA DE MOVIMENTO"},{content:"MOVIMENTO"},{content:"ENTRADA"},{content:"SA\xCDDA"},{content:"AJUSTE POSITIVO (+)"},{content:"AJUSTE NEGATIVO (-)"},{content:"PERDAS"},{content:"SALDO"},{content:"VALIDADE"}]],body:u}),nt.value&&!Tt.value)window.open(a.output("bloburl"));else{const f=a.output();this.downloadFile(at,"pdf",f)}else{a.mergeCells("A"+(Number(a.lastRow.number)+1)+":J"+(Number(a.lastRow.number)+1));const o=a.getCell("A"+Number(a.lastRow.number));o.value="LOTES",o.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},o.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:10,italic:!1};const b=a.lastRow.number!==void 0?a.lastRow.number:0;for(let $=14;$<=b;$++){const L=a.getRow($);L.height=30,L.eachCell({includeEmpty:!0},D=>{D.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},D.alignment={vertical:"middle",horizontal:"center",wrapText:!0},$===13&&(D.fill={type:"pattern",pattern:"solid",fgColor:{argb:"1fa37b"},bgColor:{argb:"1fa37b"}},D.font={name:"Arial",color:{argb:"FFFFFFFF"},family:2,size:10,italic:!1})})}a.addTable({name:Ue,ref:"A"+(Number(a.lastRow.number)+1),headerRow:!0,totalsRow:!1,style:{showRowStripes:!1},columns:[{name:"NR. DO LOTE",filterButton:!1},{name:"DATA DO MOVIMENTO",filterButton:!1},{name:"MOVIMENTO",totalsRowFunction:"none",filterButton:!1},{name:"ENTRADAS",totalsRowFunction:"none",filterButton:!1},{name:"SA\xCDDAS",totalsRowFunction:"none",filterButton:!1},{name:"AJUSTE POSITIVO (+) ",totalsRowFunction:"none",filterButton:!1},{name:"AJUSTE NEGATIVO (-) ",totalsRowFunction:"none",filterButton:!1},{name:"PERDAS",totalsRowFunction:"none",filterButton:!1},{name:"SALDOS",totalsRowFunction:"none",filterButton:!1},{name:"VALIDADE",totalsRowFunction:"none",filterButton:!1}],rows:u});const v=await d.xlsx.writeBuffer(),x="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",y=".xlsx",g=new Blob([v],{type:x});if(nt.value&&!Tt.value)bo.exports.saveAs(g,at+y);else{let $=function(M,V){const A=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(A,function(p){L(p,M,V)},P)},L=function(M,V,A){M.getFile(V,{create:!0,exclusive:!1},function(p){D(p,A)},H)},D=function(M,V){M.createWriter(function(A){A.onwriteend=function(){console.log("Successful file write..."),Q()},A.onerror=function(p){console.log("Failed file write: "+p)},A.write(V)})},P=function(M){console.log(M)},H=function(M){console.log("errorr: "+M.toString())},Q=function(){const M=N;console.log("file system 44444: "+M);const V=cordova.file.externalRootDirectory+"Download/"+M;console.log("file system 2222: "+V);const A=decodeURIComponent(V);cordova.plugins.fileOpener2.open(A,"application/vnd.ms-excel",{error:function(p){console.log("file system open3333366: "+p+A)},success:function(){}})};const N="StockRecebido.xlsx";console.log("result"+N),$(N,g)}}},filtrarEOrdenarObjetos(e){const a=Z();return e.filter(c=>Z(c.expireDate).isAfter(a)).sort((c,t)=>Z(c.expireDate).diff(Z(t.expireDate)))},ordenaPorMovimentoDesc(e){return e.sort((n,d)=>Z(d.eventDate).diff(Z(n.eventDate)))},ordenaPorMovimentoDesc1(e){return e.sort(function(a,n){const d=new Date(a.eventDate);return new Date(n.eventDate)-d}),e},downloadFile(e,a,n){const d=e+a;c(d,n);function c(v,x){const y=cordova.file.externalRootDirectory+"Download";window.resolveLocalFileSystemURL(y,function(g){t(g,v,x)},o)}function t(v,x,y){v.getFile(x,{create:!0,exclusive:!1},function(g){u(g,y)},f)}function u(v,x){v.createWriter(function(y){y.onwriteend=function(){console.log("Successful file write..."),b()},y.onerror=function(g){console.log("Failed file write: "+g)},y.write(x)})}function o(v){console.log(v)}function f(v){console.log("errorr: "+v.toString())}function b(){const v=d;console.log("file system 44444: "+v);const x=cordova.file.externalRootDirectory+"Download/"+v;console.log("file system 2222: "+x);const y=decodeURIComponent(x);cordova.plugins.fileOpener2.open(y,"application/pdf",{error:function(g){console.log("file system open3333366: "+g+y)},success:function(){}})}},async getDataLocalReport(e){let a=[];const n=await yo.localDbGetAllByReportId(e);return a=this.createArrayOfArrayRow(n),a}};const tn={class:"q-pa-lg"},on={class:"box-border q-pb-md"},nn={class:"row q-pa-md"},an={class:"q-ml-md relative-position"},ln=U("hr",null,null,-1),rn={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},sn=U("span",null," Sem resultados para visualizar ",-1),Vn={__name:"DrugFile",setup(e){const{isOnline:a,isMobile:n}=Je(),d=R(!0),c=R(!1),t=R(!1),u=R(null),o=R(null),f=R(null),b=[{name:"year",required:!0,label:"Ano",field:"year",align:"center",sortable:!0},{name:"month",required:!0,label:"Mes",field:"month",align:"center",sortable:!0},{name:"moviment",align:"center",label:"Movimento",sortable:!0},{name:"incomes",align:"center",label:"Entradas",sortable:!0},{name:"outcomes",align:"center",label:"Sa\xEDdas",sortable:!0},{name:"posetiveAdjustment",align:"center",label:"Ajuste Positivo (+)",sortable:!0},{name:"negativeAdjustment",align:"center",label:"Ajuste Negativo (-)",sortable:!0},{name:"loses",align:"center",label:"Perdas",sortable:!0},{name:"balance",align:"center",label:"Saldo",sortable:!0}],v=to(),x=R("Ficha do Medicamento"),y=R([]);R([]);const g={backgroundColor:"#ffffff",color:"#555"},$=p=>{if(p!==t.value){const _=()=>u.value,s=()=>o.value?o.value.$el:void 0;Ao({from:t.value===!0?s:_,to:t.value===!0?_:s,onToggle:()=>{t.value=p},duration:500})}},L={backgroundColor:"#eee",color:"black"},D={right:"2px",borderRadius:"5px",backgroundColor:"#0ba58b",width:"5px",opacity:.75},P=()=>{v.go(-1)},H=()=>{_t.downloadPDF("PDF",y,f,V(f.value))},Q=()=>{_t.downloadExcel("XLS",y,f,V(f.value))},N=async()=>{const p=De.currClinic();a.value?Ve.apiGetDrugSummary(p.id,localStorage.getItem("selectedDrug")).then(_=>{const s=_.data;y.value=s,d.value=!1}):(y.value=await Ve.getDrugFileSummary(f.value),d.value=!1)},M=p=>{p.constructor.name==="StockReferenceAdjustment"&&p.operation.code==="AJUSTE_POSETIVO"?(A.drugFileSummary[0].posetiveAdjustment+=p.adjustedValue,A.drugFileSummary[0].balance+=p.adjustedValue):(p.constructor.name==="StockReferenceAdjustment"&&p.operation.code==="AJUSTE_NEGATIVO"||p.constructor.name==="StockDestructionAdjustment")&&(A.drugFileSummary[0].posetiveAdjustment-=p.adjustedValue,A.drugFileSummary[0].balance-=p.adjustedValue);for(let _=0;_<A.drugFileSummaryBatch.length;_++)A.drugFileSummaryBatch[_].stockId===p.adjustedStock.id&&(p.constructor.name==="StockReferenceAdjustment"&&p.operation.code==="AJUSTE_POSETIVO"?(A.drugFileSummaryBatch[_].posetiveAdjustment=A.drugFileSummaryBatch[_].posetiveAdjustment+p.adjustedValue,A.drugFileSummaryBatch[_].balance=A.drugFileSummaryBatch[_].balance+p.adjustedValue):(p.constructor.name==="StockReferenceAdjustment"&&p.operation.code==="AJUSTE_NEGATIVO"||p.constructor.name==="StockDestructionAdjustment")&&(A.drugFileSummaryBatch[_].posetiveAdjustment-=p.adjustedValue,A.drugFileSummaryBatch[_].balance-=p.adjustedValue))};oo(p=>{f.value!==void 0&&f.value!==null&&N()}),no(()=>{const p=localStorage.getItem("selectedDrug");f.value=ao.getDrugById(p)}),dt(()=>{N()});const V=p=>{const _=De.currClinic();return rt.getStockByDrug(p.id,_.id)},A=()=>$t.query().where("drugId",f.value.id).first();return W("title",x),W("batchChanged",c),(p,_)=>(k(),j("div",null,[l(so),l(io,{"thumb-style":D,"content-style":g,"content-active-style":L,style:{height:"780px"},class:"q-pr-md"},{default:i(()=>[U("div",tn,[l(bt,{addVisible:!1,doneVisible:!1,mainContainer:!0,bgColor:"bg-primary"},{default:i(()=>[T(S(f.value.name)+" ("+S(f.value.packSize)+" "+S(f.value.form.description)+") ",1)]),_:1}),U("div",on,[U("div",nn,[l(zt),l(pe,{unelevated:"",color:"blue",label:"Voltar",onClick:P}),U("div",an,[l(pe,{class:"q-fab",unelevated:"",color:"green-4",label:"Imprimir",icon:"print",onClick:_[0]||(_[0]=s=>$(!0))}),l(Vt,{ref:"menu",offset:[5,5],class:"bg-grey-2"},{default:i(()=>[l(jt,null,{default:i(()=>[l(Qe,{clickable:"",onClick:_[1]||(_[1]=s=>H())},{default:i(()=>[l(Se,{avatar:""},{default:i(()=>[l(xe,{name:"picture_as_pdf",class:"text-red-10"})]),_:1}),l(Se,null,{default:i(()=>[l(ht,{class:"text-red-10"},{default:i(()=>[T("PDF")]),_:1})]),_:1})]),_:1}),ln,l(Qe,{clickable:"",onClick:_[2]||(_[2]=s=>Q())},{default:i(()=>[l(Se,{avatar:""},{default:i(()=>[l(xe,{name:"insert_drive_file",class:"text-green-10"})]),_:1}),l(Se,null,{default:i(()=>[l(ht,{class:"text-green-10"},{default:i(()=>[T("XLS")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),U("div",{ref_key:"refFab",ref:u,class:"absolute-center bg-accent"},null,512)])]),l(Nt,{class:"col",dense:"",flat:"",separator:"cell",rows:y.value,columns:b,"row-key":"id",loading:d.value},{"no-data":i(({icon:s,filter:h})=>[U("div",rn,[sn,l(xe,{size:"2em",name:h?"filter_b_and_w":s},null,8,["name"])])]),header:i(s=>[l(Ge,{class:"text-left bg-grey-3",style:{"text-align":"center"},props:s},{default:i(()=>[l(q,{style:{width:"70px"}},{default:i(()=>[T(S(b[0].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[1].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[2].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[3].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[4].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[5].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[6].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[7].label),1)]),_:1}),l(q,{style:{width:"190px"}},{default:i(()=>[T(S(b[8].label),1)]),_:1})]),_:2},1032,["props"])]),body:i(s=>[l(Ge,{props:s},{default:i(()=>[l(z,{key:"year",props:s},{default:i(()=>[T(S(String(s.row.year).replace(".0","")),1)]),_:2},1032,["props"]),l(z,{key:"month",props:s},{default:i(()=>[T(S(s.row.month),1)]),_:2},1032,["props"]),l(z,{key:"moviment",props:s},{default:i(()=>[T(S(s.row.moviment),1)]),_:2},1032,["props"]),l(z,{key:"incomes",props:s},{default:i(()=>[T(S(s.row.incomes),1)]),_:2},1032,["props"]),l(z,{key:"outcomes",props:s},{default:i(()=>[T(S(s.row.outcomes),1)]),_:2},1032,["props"]),l(z,{key:"posetiveAdjustment",props:s},{default:i(()=>[T(S(s.row.posetiveAdjustment),1)]),_:2},1032,["props"]),l(z,{key:"negativeAdjustment",props:s},{default:i(()=>[T(S(s.row.negativeAdjustment),1)]),_:2},1032,["props"]),l(z,{key:"loses",props:s},{default:i(()=>[T(S(s.row.loses),1)]),_:2},1032,["props"]),l(z,{key:"balance",props:s},{default:i(()=>[T(S(s.row.balance),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),loading:i(()=>[l(Ot,{showing:"",color:"primary"})]),_:1},8,["rows","loading"])]),U("div",null,[l(bt,{addVisible:!1,doneVisible:!1,mainContainer:!1,bgColor:"bg-primary"},{default:i(()=>[T("Informa\xE7\xE3o por Lote ")]),_:1}),U("div",null,[(k(!0),j(lo,null,ro(V(f.value),s=>(k(),j("span",{key:s.id},[l(Ko,{stockInfo:s,onUpdateDrugFileAdjustment:M},null,8,["stockInfo"])]))),128))])])])]),_:1})]))}};export{Vn as default};
