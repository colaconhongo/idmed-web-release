import{Q as lt}from"./QScrollArea.288f8a37.js";import{Q as qa}from"./QDrawer.64b2d870.js";import{Q as Bt,a as Lt,b as Ca}from"./QTabPanels.fab18ecb.js";import{Q as Aa}from"./QTabs.9968ab83.js";import{Q as $a}from"./QToolbar.a9ffd08a.js";import{i as U,K as o,a_ as I,O as a,f as e,a7 as t,V as J,a5 as _,a4 as B,bI as Wt,r as n,o as Pe,bg as zt,A as Ye,bO as ve,H as Ae,c as $,M as l,S as ct,N as he,P as ne,R as ue,U as se,bZ as Gt,a6 as D,bP as Ne,W as ye,a$ as ot,b_ as vt,I as bt,J as st,z as Ht,b4 as Qe,Z as Le,Y as ze,bh as Ia,a1 as F,a9 as ke,be as et,b9 as ua,b8 as fe,b$ as Xe,c0 as Ea,$ as He,a0 as wt,bf as ca,c1 as qt,B as me,L as O,a8 as xe,c2 as Se,c3 as Ct,c4 as rt,c5 as Qt,c6 as Jt,c7 as Kt,C as Ee,b as yt,c8 as dt,F as St,c9 as Dt,ca as At,cb as Ta,cc as va,cd as Ma,ce as Fa,cf as Na,cg as Oa,D as Ua,ch as Zt,ci as Xt,cj as ea,ck as ta,cl as aa}from"./index.28c7e456.js";import{_ as Ya}from"./TitleBar.f7be41e1.js";import{u as Me}from"./patientMethods.cc912af0.js";import{_ as Ba}from"./PatientRegister.9f39be71.js";import{Q as Be,a as Fe,b as te,c as at}from"./QTable.f91943bc.js";import{Q as $t}from"./QTooltip.f3ef7ac8.js";import{Q as pe}from"./QSelect.caa108f8.js";import{Q as je,a as Ge}from"./QPopupProxy.bc9f6d75.js";import{C as Ue}from"./ClosePopup.20eb2e56.js";import{u as it,a as ma,b as jt,_ as La,c as za}from"./AddEditPrescriptionUnit.262246ef.js";import{p as Wa}from"./patientTransReferenceService.af812779.js";import{Q as It,_ as xt}from"./ListHeader.c33af243.js";import{Q as Te}from"./QMenu.9a83401e.js";import{Q as fa}from"./QSpace.b53e3d44.js";import{Q as mt}from"./QExpansionItem.095ed3fd.js";import{_ as Ha}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ja}from"./QList.d4521672.js";import{u as Ga}from"./drugMethods.baae673f.js";import{E as Qa,M as Ja,a as la}from"./imageBytes.1a4fecd7.js";import{f as Ka,D as Za,a as Xa}from"./NotoSans-Regular.92f6a76e.js";import{Q as el,a as ht,b as tl}from"./QStepperNavigation.7576f0eb.js";import"./TouchPan.90ce57a2.js";import"./position-engine.b3fa6cbd.js";import"./use-render-cache.3aae9b27.js";import"./QLinearProgress.c6927d78.js";import"./QSlideTransition.7e213459.js";const al={class:"row q-mb-sm"},ll={class:"col"},sl={class:"row q-ml-lg"},il={class:"col-3 q-mt-sm"},ol={class:"col q-pt-md"},nl={class:"row q-mb-sm text-weight-bold text-h6 text-orange-7"},rl={class:"row text-subtitle2 text-grey-9"},dl={class:"text-subtitle2 text-primary"},ul={class:"col-5 text-center"},cl={class:"q-mt-md q-pt-md text-subtitle1 text-grey-14"},vl=a("div",{class:"col"},null,-1),ml={__name:"PanelTitleBar",setup(j){const{preferedIdentifierValue:q,fullName:A}=Me(),M=U("patient"),x=U("showPatientDetails"),k=U("title");return(d,V)=>(o(),I("div",al,[a("div",ll,[a("div",sl,[a("div",il,[e(J,{outline:"",round:"",color:"primary",size:"xl",icon:t(M).gender=="Feminino"?"female":"male",onClick:t(x)},null,8,["icon","onClick"])]),a("div",ol,[a("div",nl,_(t(A)(t(M))),1),a("div",rl,[B(" NID: "),a("span",dl,_(t(q)(t(M))),1)])])])]),a("div",ul,[a("div",cl,[Wt(d.$slots,"default",{},()=>[B(_(t(k)),1)])])]),vl]))}};const fl={style:{width:"1200px","max-width":"140vw"}},pl=a("div",{class:"col text-bold text-grey-10 q-ml-sm text-center"}," Unir Pacientes Duplicados ",-1),gl={class:"row"},_l={class:"col-6"},hl={class:"q-mt-lg"},yl={class:"row items-center q-mb-md"},bl=a("span",{class:"q-pl-sm text-subtitle2"},"Dados Pessoais - Paciente Preferido",-1),wl={class:"q-mt-md"},Sl={class:"row"},Dl={class:"q-mt-md"},xl={class:"row"},Vl={class:"q-mt-md"},Pl={class:"row"},kl={key:0,class:"q-mt-md"},Rl={class:"col-6"},ql={class:"q-mt-lg"},Cl={class:"row items-center q-mb-md"},Al=a("span",{class:"q-pl-sm text-subtitle2"},"Dados Pessoais - Paciente Duplicado",-1),$l={class:"q-mt-md"},Il={class:"row"},El={class:"q-mt-md"},Tl={class:"row"},Ml={class:"q-mt-md"},Fl={class:"row"},Nl={key:0,class:"q-mt-md"},Ol=a("h5",{style:{"margin-left":"20px"}},[B(" Ap\xF3s esta opera\xE7\xE3o ser gravada ou executada com sussesso, o paciente preferido ser\xE1 o novo paciente a ser utilizado. Toda a informa\xE7\xE3o dos dois pacentes em causa ser\xE1 alocada ao paciente preferido. "),a("p",null," NOTA: O Paciente Duplicado ser\xE1 REMOVIDO e a sua informa\xE7\xE3o jamais sera visualizada. "),a("p",{style:{color:"red"}},[a("strong",null," AVISO: N\xC3O PODERA VOLTAR A INFORMAC\xC3O ANTERIOR DEPOIS DE UNIR OS PACIENTES. ")])],-1),Ul={__name:"MergeDuplicatePatients",setup(j){const q=[{name:"pickUpDate",align:"left",field:"nextPickUpDate",label:"Data do Levantamento",sortable:!1},{name:"nextPickUpDate",align:"left",field:"nextPickUpDate",label:"Data do Pr\xF3ximo Levantamento",sortable:!1},{name:"therapeuticRegimen",align:"left",field:"therapeuticRegimen",label:"Regime Terapeutico",sortable:!1}],{alertSucess:A,alertError:M,alertInfo:x}=Qe(),{closeLoading:k,showloading:d}=ot(),V=n({}),R=n(null),T=n([]),P=U("closeDuplicates"),w=U("patient"),i=n({}),r=n([]),c=n(""),s=n(""),u=U("closeMergePatient"),g=E=>vt.formatDate(E,"DD-MM-YYYY"),v=n(!1),y=n(!0);Pe(async()=>{d();const E=zt.getClinicalServiceByCode("TARV");console.log(w.value.id),V.value=Ye.getPreferredIdentifierByPatientId(w.value.id),c.value=ve().diff(ve(w.value.dateOfBirth,"YYYY-MM-DD"),"years"),T.value=Ae.getAllWithAllRecursiveFromPatientAndClinicService(w.value.id,E.id),T.value=W(T.value,"visitDate"),k()});const m=async()=>{if(d(),y.value=!0,R.value&&R.value.length>0){const E=zt.getClinicalServiceByCode("TARV"),b=await Ye.apiFetchByNidValue(R.value);b?(i.value=b.patient,await Ae.apiGetAllPatientVisitDetailsByPatientId(i.value.id),await bt.apiGetByPatientId(i.value.id),await st.apiGetByPatientId(i.value.id),r.value=Ae.getAllWithAllRecursiveFromPatientAndClinicService(i.value.id,E.id),r.value=W(r.value,"visitDate"),console.log(r.value),s.value=ve().diff(ve(w.value.dateOfBirth,"YYYY-MM-DD"),"years"),y.value=!1):M("N\xE3o foi encontrado nenhum paciente com NID"),k()}else{M("Preencha o NID do paciente duplicado a Pesquisar"),k();return}},Z=$(()=>w.value?g(w.value.dateOfBirth):""),f=$(()=>i.value?g(i.value.dateOfBirth):""),N=()=>{v.value=!0,Ht.mergePatients(w.value.id,i.value.id).then(E=>{v.value=!1,A("Operacao efectuada com sucesso"),u()})},W=(E,b)=>E.slice().sort(function(p,h){return p.patientVisit[b]>h.patientVisit[b]?-1:p.patientVisit[b]<h.patientVisit[b]?1:0});return(E,b)=>(o(),I("div",fl,[e(ye,null,{default:l(()=>[a("form",{onSubmit:ct(N,["prevent"])},[e(he,{class:"bg-green-2"},{default:l(()=>[pl]),_:1}),a("div",gl,[a("div",_l,[e(he,null,{default:l(()=>[a("div",hl,[a("div",yl,[e(ne,{name:"person_outline",size:"sm"}),bl]),e(ue,{color:"grey-13",size:"1px"})]),a("div",wl,[a("div",Sl,[e(se,{label:"Nid *",dense:"",outlined:"",disable:"",class:"col",ref:"firstNamesRef",modelValue:V.value.value,"onUpdate:modelValue":b[0]||(b[0]=p=>V.value.value=p)},null,8,["modelValue"])])]),a("div",Dl,[a("div",xl,[e(se,{label:"Nome *",dense:"",outlined:"",disable:"",class:"col",ref:"firstNamesRef",modelValue:t(w).firstNames,"onUpdate:modelValue":b[1]||(b[1]=p=>t(w).firstNames=p)},null,8,["modelValue"]),e(se,{modelValue:t(w).middleNames,"onUpdate:modelValue":b[2]||(b[2]=p=>t(w).middleNames=p),ref:"middleNamesRef",dense:"",outlined:"",class:"col q-ml-md",label:"Sobre Nome ",disable:""},null,8,["modelValue"]),e(se,{ref:"lastNamesRef",modelValue:t(w).lastNames,"onUpdate:modelValue":b[3]||(b[3]=p=>t(w).lastNames=p),class:"col q-ml-md",label:"Apelido *",dense:"",outlined:"",disable:""},null,8,["modelValue"])])]),a("div",Vl,[a("div",Pl,[e(se,{modelValue:Z.value,"onUpdate:modelValue":b[4]||(b[4]=p=>Z.value=p),class:"col",label:"Data de Nascimento",dense:"",outlined:"",disable:""},null,8,["modelValue"]),e(se,{label:"Idade",dense:"",outlined:"",disable:"",class:"col q-ml-md",modelValue:c.value,"onUpdate:modelValue":b[5]||(b[5]=p=>c.value=p)},null,8,["modelValue"]),e(se,{label:"Genero",dense:"",outlined:"",disable:"",class:"col q-ml-md",modelValue:t(w).gender,"onUpdate:modelValue":b[6]||(b[6]=p=>t(w).gender=p)},null,8,["modelValue"])])]),T.value!==null&&T.value.length>0?(o(),I("div",kl,[e(Be,{title:"Dispensas",rows:T.value,columns:q,"row-key":"name",class:"my-sticky-header-table"},{body:l(p=>[e(Fe,{"no-hover":"",props:p},{default:l(()=>[e(te,{key:"pickUpDate",props:p},{default:l(()=>[B(_(g(p.row.pack.pickupDate)),1)]),_:2},1032,["props"]),e(te,{key:"nextPickUpDate",props:p},{default:l(()=>[B(_(g(p.row.pack.nextPickUpDate)),1)]),_:2},1032,["props"]),e(te,{key:"therapeuticRegimen",props:p},{default:l(()=>[B(_(t(Gt).getById(p.row.prescription.prescriptionDetails[0].therapeutic_regimen_id).regimenScheme),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])):D("",!0)]),_:1})]),a("div",Rl,[e(he,null,{default:l(()=>[a("div",ql,[a("div",Cl,[e(ne,{name:"person_outline",size:"sm"}),Al]),e(ue,{color:"grey-13",size:"1px"})]),a("div",$l,[a("div",Il,[e(se,{label:"Nid do paciente duplicado a pesquisar*",dense:"",outlined:"",class:"col",modelValue:R.value,"onUpdate:modelValue":b[7]||(b[7]=p=>R.value=p)},null,8,["modelValue"]),e(J,{onClick:b[8]||(b[8]=p=>m()),class:"q-ml-sm",square:"",color:"primary",icon:"search"},{default:l(()=>[e($t,{class:"bg-green-5"},{default:l(()=>[B("Pesquisar")]),_:1})]),_:1})])]),a("div",El,[a("div",Tl,[e(se,{label:"Nome *",dense:"",outlined:"",disable:"",class:"col",ref:"firstNamesRef",modelValue:i.value.firstNames,"onUpdate:modelValue":b[9]||(b[9]=p=>i.value.firstNames=p)},null,8,["modelValue"]),e(se,{modelValue:i.value.middleNames,"onUpdate:modelValue":b[10]||(b[10]=p=>i.value.middleNames=p),ref:"middleNamesRef",dense:"",outlined:"",class:"col q-ml-md",label:"Sobre Nome ",disable:""},null,8,["modelValue"]),e(se,{ref:"lastNamesRef",modelValue:i.value.lastNames,"onUpdate:modelValue":b[11]||(b[11]=p=>i.value.lastNames=p),class:"col q-ml-md",label:"Apelido *",dense:"",outlined:"",disable:""},null,8,["modelValue"])])]),a("div",Ml,[a("div",Fl,[e(se,{ref:"lastNamesRef",modelValue:f.value,"onUpdate:modelValue":b[12]||(b[12]=p=>f.value=p),class:"col",label:"Data de Nascimento",dense:"",outlined:"",disable:""},null,8,["modelValue"]),e(se,{label:"Idade",dense:"",outlined:"",disable:"",class:"col q-ml-md",modelValue:s.value,"onUpdate:modelValue":b[13]||(b[13]=p=>s.value=p)},null,8,["modelValue"]),e(se,{label:"Genero",dense:"",outlined:"",disable:"",class:"col q-ml-md",modelValue:t(w).gender,"onUpdate:modelValue":b[14]||(b[14]=p=>t(w).gender=p)},null,8,["modelValue"])])]),r.value!==null&&r.value.length>0?(o(),I("div",Nl,[e(Be,{title:"Dispensas",rows:r.value,columns:q,"row-key":"name",class:"my-sticky-header-table"},{body:l(p=>[e(Fe,{"no-hover":"",props:p},{default:l(()=>[e(te,{key:"pickUpDate",props:p},{default:l(()=>[B(_(g(p.row.pack.pickupDate)),1)]),_:2},1032,["props"]),e(te,{key:"nextPickUpDate",props:p},{default:l(()=>[B(_(g(p.row.pack.nextPickUpDate)),1)]),_:2},1032,["props"]),e(te,{key:"therapeuticRegimen",props:p},{default:l(()=>[B(_(p.row.prescription.prescriptionDetails[0].therapeutic_regimen_id!==null&&p.row.prescription.prescriptionDetails[0].therapeutic_regimen_id!==void 0&&p.row.prescription.prescriptionDetails[0].therapeutic_regimen_id!==""?t(Gt).getById(p.row.prescription.prescriptionDetails[0].therapeutic_regimen_id).regimenScheme:"Sem Info."),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])):D("",!0)]),_:1})]),Ol]),e(Ne,{align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Cancelar",color:"red",onClick:t(P)},null,8,["onClick"]),e(J,{type:"submit",loading:v.value,label:"Submeter",color:"primary",desabled:y.value},null,8,["loading","desabled"])]),_:1})],32)]),_:1})]))}};const Yl={class:"text-center q-mb-md"},Bl={class:""},Ll={class:"row items-center q-mb-sm"},zl=a("span",{class:"q-pl-sm text-subtitle2"},"Dados Pessoais",-1),Wl={class:"row q-mb-sm"},Hl=a("div",{class:"col-5 text-grey-9"},"Nome",-1),jl={class:"col text-grey-10"},Gl={class:"row q-mb-sm"},Ql=a("div",{class:"col-5 text-grey-9"},"Idade",-1),Jl={class:"col text-grey-10"},Kl={class:"row q-mb-sm"},Zl=a("div",{class:"col-5 text-grey-9"},"G\xEAnero",-1),Xl={class:"col text-grey-10"},es={class:"q-mt-md"},ts={class:"row items-center q-mb-sm"},as=a("span",{class:"q-pl-sm text-subtitle2"},"Endere\xE7o",-1),ls={class:"row q-mb-sm"},ss=a("div",{class:"col-5 text-grey-9"},"Prov\xEDncia",-1),is={class:"col text-grey-10"},os={class:"row q-mb-sm"},ns=a("div",{class:"col-5 text-grey-9"},"Distrito",-1),rs={class:"col text-grey-10"},ds={class:"row q-mb-sm"},us=a("div",{class:"col-5 text-grey-9"},"Posto Administrativo",-1),cs={class:"col text-grey-10"},vs={class:"row q-mb-sm"},ms=a("div",{class:"col-5 text-grey-9"},"Bairro",-1),fs={class:"col text-grey-10"},ps={class:"row q-mb-sm"},gs=a("div",{class:"col-5 text-grey-9"},"Local Refer\xEAncia",-1),_s={class:"col text-grey-10"},hs={class:"row q-mb-sm"},ys=a("div",{class:"col-5 text-grey-9"},"Morada",-1),bs={class:"col text-grey-10"},ws={class:"q-mt-md"},Ss={class:"row items-center q-mb-sm"},Ds=a("span",{class:"q-pl-sm text-subtitle2"},"Contacto",-1),xs={class:"row q-mb-sm"},Vs=a("div",{class:"col-5 text-grey-9"},"Principal",-1),Ps={class:"col text-grey-10"},ks={class:"row q-mb-sm"},Rs=a("div",{class:"col-5 text-grey-9"},"Alternativo",-1),qs={class:"col text-grey-10"},Cs={key:0,class:"row q-my-md"},As={key:1,class:"row"},$s=a("span",null,null,-1),sa={__name:"PatientInfo",setup(j){const{postoAdministrativoName:q,bairroName:A,fullName:M,hasNoObitOrTransferedForEpisode:x}=Me(),{idadeCalculator:k,getDDMMYYYFromJSDate:d}=et(),{isProvincialInstalation:V}=Le();ze();const R=n(!1),T=n(!1),P=n(!1),w=n(!1),i=U("patient");Pe(()=>{r()});const r=()=>{i.value===null&&(i.value=Ht.getPatientByID(localStorage.getItem("patientuuid")))},c=()=>{R.value=!0,P.value=!1},s=()=>{R.value=!1,P.value=!1},u=()=>{T.value=!1},g=()=>{T.value=!0},v=()=>{T.value=!1,P.value=!1},y=$(()=>Ia.getAllActive()),m=$(()=>i.value!==null?!!x(i.value):!1);return F("newPatient",P),F("closePatient",s),F("closeDuplicates",u),F("patient",i),F("openMrsPatient",w),F("showPatientRegister",R),F("closeMergePatient",v),F("dataSources",y),(Z,f)=>(o(),I("div",null,[a("div",Yl,[e(ne,{class:"profile",name:t(i).gender=="Feminino"?"female":"male",size:"120px",color:"primary"},null,8,["name"])]),a("div",Bl,[a("div",Ll,[e(ne,{name:"person_outline",size:"sm"}),zl]),e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",Wl,[Hl,a("div",jl,_(t(M)(t(i))),1)]),a("div",Gl,[Ql,a("div",Jl,_(t(k)(t(d)(t(i).dateOfBirth)))+" Anos ",1)]),a("div",Kl,[Zl,a("div",Xl,_(t(i).gender),1)]),a("div",es,[a("div",ts,[e(ne,{name:"house",size:"sm"}),as]),e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",ls,[ss,a("div",is,_(t(i).province!==null&&t(i).province!==void 0?t(i).province.description:""),1)]),a("div",os,[ns,a("div",rs,_(t(i).district!==null&&t(i).district!==void 0?t(i).district.description:""),1)]),a("div",ds,[us,a("div",cs,_(t(q)(t(i))),1)]),a("div",vs,[ms,a("div",fs,_(t(A)(t(i))),1)]),a("div",ps,[gs,a("div",_s,_(t(i).addressReference),1)]),a("div",hs,[ys,a("div",bs,_(t(i).address),1)]),a("div",ws,[a("div",Ss,[e(ne,{name:"call",size:"sm"}),Ds]),e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",xs,[Vs,a("div",Ps,_(t(i).cellphone),1)]),a("div",ks,[Rs,a("div",qs,_(t(i).alternativeCellphone),1)]),t(V)()?D("",!0):(o(),I("div",Cs,[e(J,{unelevated:"",color:"orange-5",label:"Editar",class:"col",disable:!m.value,onClick:c},null,8,["disable"])])),t(V)()?D("",!0):(o(),I("div",As,[e(J,{unelevated:"",color:"primary",label:"Unir Duplicados",class:"col",onClick:g})])),e(ke,{persistent:"",modelValue:R.value,"onUpdate:modelValue":f[0]||(f[0]=N=>R.value=N)},{default:l(()=>[e(Ba)]),_:1},8,["modelValue"]),e(ke,{persistent:"",modelValue:T.value,"onUpdate:modelValue":f[1]||(f[1]=N=>T.value=N)},{default:l(()=>[e(Ul)]),_:1},8,["modelValue"]),$s]))}};function Is(){function j(q,A){return A===""?!1:String(q).toLowerCase().includes(String(A).toLowerCase())}return{stringContains:j}}const Es={class:"row items-center text-subtitle1 q-pa-md"},Ts={class:"text-bold text-grey-10 q-ml-sm"},Ms={class:"text-grey-10 q-ml-sm"},Fs=a("span",{class:"text-bold text-h6"},"|",-1),Ns={key:0,class:"text-grey-10 q-ml-sm"},Os={class:"text-bold text-h6"},Us={key:1,class:"text-grey-10 q-ml-sm"},Ys=a("span",{class:"text-bold text-h6"},"|",-1),Bs={class:"text-center text-h6 q-mt-sm"},Ls={key:0},zs={key:1},Ws={key:2},Hs={key:3},js={class:"q-mx-lg"},Gs={class:"q-mt-lg"},Qs=a("div",{class:"row items-center q-mb-sm"},[a("span",{class:"text-subtitle2"},"Dados do servi\xE7o de Sa\xFAde")],-1),Js={class:"row q-mt-md"},Ks={class:"row items-center justify-end"},Zs={key:0},Xs={class:"q-mt-md"},ei=a("div",{class:"row items-center q-mb-sm"},[a("span",{class:"text-subtitle2"},"Dados do Identificador")],-1),ti={class:"row q-mb-md"},ai={key:0,class:"col",tabindex:"0"},li={key:0,class:"row"},si={key:0,class:"col q-ml-md",tabindex:"0"},ii={key:1},oi={class:"q-mt-md"},ni=a("div",{class:"row items-center q-mb-sm"},[a("span",{class:"text-subtitle2"},"Dados de Fim do servi\xE7o de Sa\xFAde")],-1),ri={class:"row"},di={class:"row items-center justify-end"},ui={key:0,class:"row"},ci={key:1,class:"row"},vi={class:"row"},mi={key:2},fi={class:"q-mt-md"},pi=a("div",{class:"row items-center q-mb-sm"},[a("span",{class:"text-subtitle2"},"Dados de Reabertura do servi\xE7o de Sa\xFAde")],-1),gi={class:"row"},_i={class:"row items-center justify-end"},pa={__name:"AddClinicService",setup(j){const{hasPreferedId:q}=Me(),{hasVisits:A}=it(),{isValidDate:M,getDDMMYYYFromJSDate:x,getDateFromHyphenDDMMYYYY:k,getDateFromHyphenYYYYMMDD:d,getYYYYMMDDFromJSDate:V}=et(),{stringContains:R}=Is(),{isReferenceOrTransferenceEpisode:T,lastVisit:P}=it(),{alertSucess:w,alertError:i,alertInfo:r,alertWarningAction:c}=Qe(),{fullName:s,age:u}=Me(),{lastVisitPrescription:g}=ma(),{isMobile:v,isOnline:y}=ze(),m=n(!1),Z=n(""),f=n(new ua({id:fe()})),N=n(new Xe({id:fe()})),W=n(["Activo","Inactivo"]),E=n(["Activo"]),b=n(""),p=n(""),h=n(!1),Q=n(""),ae=n(null),le=n(null),G=n(null),ce=n(null),De=n(null),ge=n(null),Ve=n(null),$e=n(null),X=n(null),K=n(null),re=n(null),be=n(null),_e=n(null),oe=n(null),Y=n(null),H=n(null),Re=n(null),ft=n(null),qe=n(null),de=U("patient"),Et=U("curIdentifier"),We=U("curIdentifier"),Oe=U("isCreateStep"),tt=U("isEditStep"),Ce=U("isCloseStep"),we=U("isReOpenStep"),pt=U("close");Pe(()=>{Tt(),gt()});const Je=ie=>ie<=ve().format("YYYY/MM/DD"),Tt=()=>{Oe.value?We.value=f.value:We.value!==null&&(f.value=We.value,Z.value=x(We.value.startDate))},gt=()=>{f.value.service!==null&&(f.value.value===null||f.value.value===void 0||String(f.value.value).trim().length===0)&&(Q.value=f.value.service.identifierType.pattern)},Mt=ie=>de.value.identifiers.some(C=>C.service.id===ie.id),Vt=()=>Da.value.filter(z=>!Mt(z)),Ft=ie=>{const z=g(f.value);return z!==null&&bt.getLastPrescriptionFromPatientVisitDetails(z.prescription.id).remainigDurationInWeeks()>0},Ke=()=>{if(m.value=!0,f.value.patient=de.value,Ce.value)if(K.value.validate(),H.value.validate(),!K.value.hasError&&!H.value.hasError){const ie=me.getLastStartEpisodeByIdentifier(f.value.id);M(String(k(b.value)))?k(b.value)>d(ve().format("YYYY-MM-DD"))?(i("A data de fim indicada \xE9 maior que a data da corrente."),m.value=!1):ie!==null&&k(b.value)<d(ie.episodeDate)?(i("A data de fim indicada \xE9 menor que a data de inicio ao tratamento."),m.value=!1):k(b.value)<k(Z.value)?(i("A data de fim indicada \xE9 menor que a data de inicio ao servi\xE7o."),m.value=!1):ie!==null&&A(ie)&&k(b.value)<d(P(ie).pack.pickupDate)?(i("A data de fim indicada \xE9 menor que a data da ultima visita efectuada pelo paciente."),m.value=!1):L.value&&!Ft()?(i("O paciente deve ter registo de pelo menos uma prescri\xE7\xE3o e dispensa para poder ser referido."),m.value=!1):(L.value||S.value)&&N.value.referralClinic===null?(i("Por favor indicar o destino do paciente."),m.value=!1):Ze():(i("A data de fim \xE9 inv\xE1lida."),m.value=!1)}else m.value=!1;else if(we.value)if(ft.value.validate(),qe.value.validate(),!ft.value.hasError&&!qe.value.hasError){const ie=me.getLastStopEpisodeByIdentifier(f.value.id);M(String(k(p.value)))?k(p.value)>d(ve().format("YYYY-MM-DD"))?(i("A data de abertura indicada \xE9 maior que a data da corrente."),m.value=!1):k(p.value)<d(ie.episodeDate)?(i("A data de abertura indicada \xE9 menor que a data do ultimo fecho efectuado."),m.value=!1):Ze():(i("A data de abertura \xE9 inv\xE1lida."),m.value=!1)}else m.value=!1;else if(Oe.value||tt.value)if(ge.value.validate(),De.value.validate(),Ve.value.validate(),h.value?(f.value.prefered=!1,f.value.value=""):$e.value.validate(),!De.value.hasError&&!ge.value.hasError&&!Ve.value.hasError)if(!M(String(k(Z.value))))i("A data de admiss\xE3o \xE9 inv\xE1lida."),m.value=!1;else if(f.value===""&&!h.value||R(f.value.value,"#"))i("Por favor indicar um identificador dentro do padr\xE3o."),m.value=!1;else if(k(Z.value)<d(de.value.dateOfBirth))i("A data de admiss\xE3o indicada \xE9 menor que a data de nascimento do paciente/utente."),m.value=!1;else if(!h.value&&(f.value===""||R(f.value,"#")))i("Por favor indicar um identificador dentro do padr\xE3o."),m.value=!1;else if(tt.value){const ie=me.lastEpisodeByIdentifier(f.value.id);ie!==null&&k(Z.value)>d(ie.episodeDate)?(i("A data de admiss\xE3o indicada \xE9 maior que a data do primeiro epis\xF3dio registado."),m.value=!1):Sa.value&&f.value.service.id!==Et.service.id?(i("N\xE3o pode alterar o servi\xE7o de sa\xFAde pois ja existem registos de visitas associados."),m.value=!1):de.value.identifiers.length>1&&q(de.value)&&f.value.prefered?(c("O identificador neste momento em associa\xE7\xE3o passar\xE1 a ser considerado como preferido, deseja continuar neste modo?").then(z=>{z?Ze():r("Opera\xE7\xE3o cancelada")}),m.value=!1):Ze()}else de.value.identifiers.length>1&&q(de.value)&&f.value.prefered?(c("O identificador neste momento em associa\xE7\xE3o passar\xE1 a ser considerado como preferido, deseja continuar neste modo?").then(ie=>{ie?Ze():r("Opera\xE7\xE3o cancelada")}),m.value=!1):Ze();else m.value=!1},Nt=()=>me.getLastStartEpisodeWithPrescription(f.value.id),Ze=async()=>{f.value.episodes=[],N.value.origin=Ie.value.id,Ce.value&&(N.value.episodeType=Ct.getEpisodeTypeByCode("FIM"),N.value.episodeType_id=N.value.episodeType.id,N.value.episodeDate=V(k(b.value)),f.value.state="Inactivo",f.value.endDate=V(k(b.value))),we.value&&(N.value.episodeType=Ct.getEpisodeTypeByCode("INICIO"),N.value.episodeType_id=N.value.episodeType.id,N.value.episodeDate=V(k(p)),f.value.reopenDate=V(k(p)),f.value.endDate="",f.value.state="Activo"),(Ce.value||we.value)&&(N.value.id=fe(),N.value.creationDate=ve(),N.value.clinic=Ie.value,N.value.clinic_id=Ie.value.id,ce.value!==null?N.value.clinicSector=rt.getClinicSectorsById(ce.value.id):_t.value!==null&&(N.value.clinicSector=_t.value.clinicSector,N.value.clinicSector_id=_t.value.clinicSector.id),N.value.clinicSector.clinic={},N.value.clinicSector.clinic.id=Ie.value.id,f.value.episodes.push(N.value)),Oe.value&&(f.value.id=fe(),f.value.clinic={},f.value.clinic.id=Ie.value.id,f.value.startDate=V(k(Z.value)),f.value.identifierType=f.value.service.identifierType,f.value.origin=Ie.value.id),tt.value&&(f.value.startDate=V(k(Z.value)));let ie=f.value.service.id;f.value.patient={},f.value.patient.id=de.value.id,f.value.service={},f.value.service.id=ie,f.value.origin=Ie.value.id,h.value&&(f.value.value=Ye.getLatestIdentifierSlimByPatientId(de.value.id).value),v.value&&!y.value&&(f.value.syncStatus===""||f.value.syncStatus==="R"?f.value.syncStatus="R":f.value.syncStatus==="S"&&(f.value.syncStatus="U"),f.value.patient_id=de.value.id,f.value.service_id=f.value.service.id,f.value.identifier_type_id=f.value.identifierType.id),await Ye.apiSave(f.value,Oe.value).then(z=>{m.value=!1,S.value&&Pt();let C="";Ce.value?C="Servi\xE7o de sa\xFAde fechado com sucesso.":Oe.value?C="Servi\xE7o de sa\xFAde adicionado com sucesso.":tt.value?C="Servi\xE7o de sa\xFAde actualizado com sucesso.":we.value&&(C="Servi\xE7o de sa\xFAde reaberto com sucesso."),w(C),pt()}).catch(z=>{m.value=!1;const C=[];if(console.error(z),z.request.response!=null){const Yt=JSON.parse(z.request.response);Yt.total==null?C.push(Yt.message):Yt._embedded.errors.forEach(Ra=>{C.push(Ra.message)})}console.error(C),i("Aconteceu um erro inesperado, por favor contacte o HIS")})},Pt=()=>{if(S.value||L.value){const ie=new Qt({syncStatus:"P",operationDate:N.value.episodeDate,creationDate:ve(),operationType:Jt.getOperationType(S.value?"TRANSFERENCIA":"REFERENCIA_FP"),origin:Ie.value,destination:N.value.referralClinic.uuid,identifier:Object.assign({},f.value),patient:Object.assign({},de.value)});ie.identifier.episodes=[],ie.patient.identifiers=[],setTimeout(kt(ie),2)}else if(Rt.value){const ie=new Qt({syncStatus:"P",operationDate:N.value.episodeDate,creationDate:ve(),operationType:Jt.getOperationType("REFERENCIA_DC"),origin:Ie.value,destination:ce.value.uuid,identifier:Object.assign({},f.value),patient:Object.assign({},de.value)});ie.identifier.episodes=[],ie.patient.identifiers=[],setTimeout(kt(ie),2)}},kt=ie=>{Wa.post(ie)},Ot=$(()=>Ea.getAllClinicSectorTypes()),nt=$(()=>G.value===null?[]:G.value.clinicSectorList),Ie=$(()=>He.currClinic()),Ut=$(()=>L.value?(ae.value=de.value.clinic.province,wt.getAllProvincesById(de.value.clinic.province_id)):wt.getAllProvinces()),ee=$(()=>ae.value!==null&&ae.value!==void 0?ca.getAllDistrictByProvinceId(ae.value.id):null),L=$(()=>N.value===null||N.value===void 0||N.value.startStopReason===null||N.value.startStopReason===void 0?!1:N.value.startStopReason.code==="REFERIDO_PARA"),S=$(()=>N.value===null||N.value===void 0||N.value.startStopReason===null||N.value.startStopReason===void 0?!1:N.value.startStopReason.code==="TRANSFERIDO_PARA"),Rt=$(()=>N.value===null||N.value===void 0||N.value.startStopReason===null||N.value.startStopReason===void 0?!1:N.value.startStopReason.code==="REFERIDO_DC"),wa=$(()=>le.value!==null?L.value?He.getAllPrivateFromDistrict(le.value.id):He.getAllUSFromDistrict(le.value.id):[]),Sa=$(()=>Nt()!==null),Da=$(()=>zt.getAllClinicalServices()),xa=$(()=>Vt()),Va=$(()=>{const ie=qt.getAllStopReasons();let z=[];return z=ie.filter(C=>C.code!=="REFERIDO_DC"&&C.code!=="REFERIDO_PARA"&&C.code!=="ABANDONO"&&C.code!=="VOLTOU_A_SER_REFERIDO_PARA"&&C.code!=="REFERIDO_SECTOR_CLINICO"),z}),Pa=$(()=>{const ie=qt.getAllStartReasons();let z=[];return _t.value!==null&&T(_t.value)?(z=ie.filter(C=>C.code==="VOLTOU_REFERENCIA"||C.code==="REINICIO_TRATAMETO"||C.code==="TRANSFERIDO_DE"),z):(z=ie.filter(C=>C.code!=="VOLTOU_REFERENCIA"),z)}),_t=$(()=>We.value!==null&&We.value!==void 0?me.lastEpisodeByIdentifier(We.value.id):null),ka=$(()=>S.value?"US de Transfer\xEAncia":L.value?"Farm\xE1cia de Refer\xEAncia":"Sem Titulo");return(ie,z)=>(o(),O(ye,{style:{width:"900px","max-width":"90vw"}},{default:l(()=>[a("form",{onSubmit:ct(Ke,["prevent"])},[e(he,{class:"q-pa-none bg-green-2"},{default:l(()=>[a("div",Es,[e(ne,{name:t(de).gender=="Feminino"?"female":"male",size:"md",color:"primary"},null,8,["name"]),a("div",Ts,_(t(s)(t(de))),1),a("div",Ms,[Fs,B(" "+_(t(de).gender),1)]),t(u)(t(de))<=14?(o(),I("div",Ns,[a("span",Os,[B(" | "),e(ne,{name:"child_care"})]),B(" "+_(t(u)(t(de)))+" Ano(s) de Idade ",1)])):(o(),I("div",Us,[Ys,B(" "+_(t(u)(t(de)))+" Anos de Idade ",1)]))]),e(ue)]),_:1}),a("div",Bs,[t(tt)?(o(),I("span",Ls,"Actualizar")):D("",!0),t(Oe)?(o(),I("span",zs,"Adicionar")):D("",!0),t(Ce)?(o(),I("span",Ws,"Fechar")):D("",!0),t(we)?(o(),I("span",Hs,"Reabrir")):D("",!0),B(" Servi\xE7o de Sa\xFAde ")]),a("div",js,[a("div",Gs,[Qs,e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",Js,[e(pe,{class:"col",dense:"",outlined:"",ref_key:"clinicalServiceRef",ref:De,rules:[C=>!!C||"Por favor indicar o servi\xE7o de sa\xFAde"],disable:t(Ce)||t(we),modelValue:f.value.service,"onUpdate:modelValue":[z[0]||(z[0]=C=>f.value.service=C),gt],options:xa.value,"option-value":"id","option-label":"code",label:"Servi\xE7o de Sa\xFAde *"},null,8,["rules","disable","modelValue","options"]),e(se,{dense:"",outlined:"",class:"col q-ml-md",modelValue:Z.value,"onUpdate:modelValue":z[2]||(z[2]=C=>Z.value=C),disable:t(Ce)||t(we),ref_key:"startDateRef",ref:ge,rules:[C=>C&&C.length>0||"Por favor indicar a data de admiss\xE3o"],label:"Data de Admiss\xE3o *"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:Z.value,"onUpdate:modelValue":z[1]||(z[1]=C=>Z.value=C),options:Je,mask:"DD-MM-YYYY"},{default:l(()=>[a("div",Ks,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","disable","rules"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"stateRef",ref:Ve,rules:[C=>!!C||"Por favor indicar o estado"],disable:t(Ce)||t(we),modelValue:f.value.state,"onUpdate:modelValue":z[3]||(z[3]=C=>f.value.state=C),options:t(Oe)?E.value:W.value,label:"Estado *"},null,8,["rules","disable","modelValue","options"])]),!t(Ce)&&!t(we)?(o(),I("span",Zs,[a("div",Xs,[ei,e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",ti,[t(Oe)&&t(de).identifiers.length>0&&f.value.service!==null&&f.value.service.code!=="TARV"?(o(),I("div",ai,[B(" Assumir Identificador Anterior? "),e(Se,{"keep-color":"",color:"primary",modelValue:h.value,"onUpdate:modelValue":z[4]||(z[4]=C=>h.value=C),val:!0,label:"Sim"},null,8,["modelValue"]),e(Se,{"keep-color":"",color:"primary",modelValue:h.value,"onUpdate:modelValue":z[5]||(z[5]=C=>h.value=C),val:!1,label:"Nao"},null,8,["modelValue"])])):D("",!0)]),h.value?D("",!0):(o(),I("div",li,[e(se,{outlined:"",dense:"",ref_key:"identifierRef",ref:$e,class:"col","lazy-rules":"",label:"Nr. do Identificador *",disable:f.value.service===null,mask:Q.value,"fill-mask":"#",rules:[C=>!!C||"Por favor indicar o identificador"],modelValue:f.value.value,"onUpdate:modelValue":z[6]||(z[6]=C=>f.value.value=C)},null,8,["disable","mask","rules","modelValue"]),f.value?(o(),I("div",si,[B(" Preferido? "),e(Se,{"keep-color":"",color:"primary",modelValue:f.value.prefered,"onUpdate:modelValue":z[7]||(z[7]=C=>f.value.prefered=C),val:!0,label:"Sim"},null,8,["modelValue"]),e(Se,{"keep-color":"",color:"primary",modelValue:f.value.prefered,"onUpdate:modelValue":z[8]||(z[8]=C=>f.value.prefered=C),val:!1,label:"Nao"},null,8,["modelValue"])])):D("",!0)]))])):D("",!0),t(Ce)?(o(),I("span",ii,[a("div",oi,[ni,e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",ri,[e(se,{dense:"",outlined:"",class:"col",modelValue:b.value,"onUpdate:modelValue":z[10]||(z[10]=C=>b.value=C),ref_key:"endDateRef",ref:X,label:"Data de Fim *"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:b.value,"onUpdate:modelValue":z[9]||(z[9]=C=>b.value=C),options:Je,mask:"DD-MM-YYYY"},{default:l(()=>[a("div",di,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"stopReasonRef",ref:K,rules:[C=>!!C||"Por favor indicar a nota de fim"],modelValue:N.value.startStopReason,"onUpdate:modelValue":z[11]||(z[11]=C=>N.value.startStopReason=C),options:Va.value,"option-value":"id","option-label":"reason",label:"Notas de Fim [Refer\xEAncia, Transferido para, ...] *"},null,8,["rules","modelValue","options"])]),L.value||S.value?(o(),I("div",ui,[e(pe,{class:"col",dense:"",outlined:"",modelValue:ae.value,"onUpdate:modelValue":z[12]||(z[12]=C=>ae.value=C),"use-input":"",ref_key:"provinceRef",ref:re,"input-debounce":"0",options:Ut.value,"option-value":"id","option-label":"description",label:"Prov\xEDncia"},null,8,["modelValue","options"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",modelValue:le.value,"onUpdate:modelValue":z[13]||(z[13]=C=>le.value=C),"use-input":"",ref_key:"districtRef",ref:be,"input-debounce":"0",options:ee.value,"option-value":"id","option-label":"description",label:"Distrito"},null,8,["modelValue","options"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"referralClinicRef",ref:_e,rules:[C=>!!C||"Por favor indicar o destino do paciente."],modelValue:N.value.referralClinic,"onUpdate:modelValue":z[14]||(z[14]=C=>N.value.referralClinic=C),options:wa.value,"option-value":"id","option-label":"clinicName",label:ka.value},null,8,["rules","modelValue","options","label"])])):D("",!0),Rt.value?(o(),I("div",ci,[e(pe,{class:"col",dense:"",outlined:"",modelValue:G.value,"onUpdate:modelValue":z[15]||(z[15]=C=>G.value=C),"use-input":"",ref_key:"clinicSectorTypeRef",ref:oe,"input-debounce":"0",options:Ot.value,"option-value":"id","option-label":"description",label:"Tipo de Sector de Dispensa"},null,8,["modelValue","options"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"referealClinicSectorRef",ref:Y,rules:[C=>!!C||"Por favor indicar o sector de dispensa."],modelValue:ce.value,"onUpdate:modelValue":z[16]||(z[16]=C=>ce.value=C),options:nt.value,"option-value":"id","option-label":"description",label:"Sector de Dispensa"},null,8,["rules","modelValue","options"])])):D("",!0),a("div",vi,[e(se,{modelValue:N.value.notes,"onUpdate:modelValue":z[17]||(z[17]=C=>N.value.notes=C),label:"Outras notas de fim *",ref_key:"closingNotesRef",ref:H,rules:[C=>!!C||"Por favor indicar outras notas do fim"],dense:"",class:"col"},null,8,["modelValue","rules"])])])):D("",!0),t(we)?(o(),I("span",mi,[a("div",fi,[pi,e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",gi,[e(se,{dense:"",outlined:"",class:"col",modelValue:p.value,"onUpdate:modelValue":z[19]||(z[19]=C=>p.value=C),ref_key:"reOpenDateRef",ref:Re,label:"Data de Reabertura *"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:p.value,"onUpdate:modelValue":z[18]||(z[18]=C=>p.value=C),options:Je,mask:"DD-MM-YYYY"},{default:l(()=>[a("div",_i,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"reOpenReasonRef",ref:ft,rules:[C=>!!C||"Por favor indicar a nota de reabertura"],modelValue:N.value.startStopReason,"onUpdate:modelValue":z[20]||(z[20]=C=>N.value.startStopReason=C),options:Pa.value,"option-value":"id","option-label":"reason",label:"Notas de Reabertura *"},null,8,["rules","modelValue","options"]),e(se,{modelValue:N.value.notes,"onUpdate:modelValue":z[21]||(z[21]=C=>N.value.notes=C),label:"Outras notas *",ref_key:"reOpenNotesRef",ref:qe,rules:[C=>!!C||"Por favor indicar outras notas do fim"],dense:"",class:"col q-ml-md"},null,8,["modelValue","rules"])])])):D("",!0)]),e(Ne,{align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Cancelar",color:"red",onClick:t(pt)},null,8,["onClick"]),e(J,{type:"submit",loading:m.value,onClick:z[22]||(z[22]=C=>m.value=!0),label:"Submeter",color:"primary"},null,8,["loading"])]),_:1})],32)]),_:1}))}},hi={class:"row"},yi={class:"text-subtitle1 text-orange-10"},ut={__name:"ListEmpty",setup(j){const q=U("titleEmptyList");return(A,M)=>(o(),I("div",hi,[e(It,{"inline-actions":"",class:"text-white bg-orange-1 col"},{default:l(()=>[a("span",yi,[Wt(A.$slots,"default",{},()=>[B(_(t(q)),1)])])]),_:3})]))}},bi={class:"row items-center text-subtitle1 q-pa-md"},wi={class:"text-bold text-grey-10 q-ml-sm"},Si={class:"text-grey-10 q-ml-sm"},Di=a("span",{class:"text-bold text-h6"},"|",-1),xi={key:0,class:"text-grey-10 q-ml-sm"},Vi={class:"text-bold text-h6"},Pi={key:1,class:"text-grey-10 q-ml-sm"},ki=a("span",{class:"text-bold text-h6"},"|",-1),Ri={class:"text-center text-h6 q-mt-sm"},qi={key:0},Ci={key:1},Ai={key:2},$i={class:"q-mx-lg"},Ii={class:"q-mt-lg"},Ei=a("div",{class:"row items-center q-mb-sm"},[a("span",{class:"text-subtitle2"},"Dados de in\xEDcio do Hist\xF3rico Cl\xEDnico")],-1),Ti={class:"row q-mt-md"},Mi={class:"row items-center justify-end"},Fi={class:"row q-mt-md"},Ni={class:"row items-center justify-end"},Oi=a("div",{class:"col q-ml-md"},null,-1),Ui={key:0},Yi={class:"q-mt-md"},Bi=a("div",{class:"row items-center q-mb-sm"},[a("span",{class:"text-subtitle2"},"Dados de Fim do Hist\xF3rico Cl\xEDnico")],-1),Li={class:"row"},zi={class:"row items-center justify-end"},Wi={key:0,class:"row"},Hi={key:1,class:"row"},ji={key:2,class:"row"},Gi={class:"row"},ga={__name:"AddEditEpisode",setup(j){const{getDDMMYYYFromJSDate:q,isValidDate:A,getDateFromHyphenDDMMYYYY:M,getYYYYMMDDFromJSDate:x,extractHyphenDateFromDMYConvertYMD:k,getDateFromHyphenDDMMYYYYWithTime:d}=et(),{alertSucess:V,alertError:R}=Qe(),{fullName:T,age:P}=Me(),{isReferenceOrTransferenceEpisode:w,hasVisits:i}=it(),{remainigDurationInWeeks:r}=jt(),{closeLoading:c,showloading:s}=ot(),{isOnline:u}=ze(),g=n(!1),v=n(new Xe({id:fe()})),y=n(new Xe({id:fe()})),m=n(""),Z=n(""),f=n(null),N=n(null),W=n(null),E=n(null),b=n(null),p=n(null),h=n(null),Q=n(null),ae=n(null),le=n(null),G=n(null),ce=n(null),De=n(null),ge=n(null),Ve=n(null),$e=n(null),X=n(null),K=U("curIdentifier"),re=U("curEpisode"),be=U("lastPack"),_e=U("patient"),oe=U("isEditStep"),Y=U("isNewEpisode"),H=U("isClosingEpisode"),Re=U("closeEpisodeCreation");Pe(()=>{kt()});const ft=$(()=>Je.value?"US de Transfer\xEAncia":we.value?"Farm\xE1cia de Refer\xEAncia":"Sem Titulo"),qe=$(()=>He.currClinic()),de=$(()=>y.value.patientVisitDetails.length<=0),Et=$(()=>we.value?wt.getAllProvincesById(K.value.clinic.province_id):wt.getAllProvinces()),We=$(()=>Kt.getFacilityTypeClinicSectorForDC()),Oe=$(()=>W.value===null?[]:rt.getClinicSectorsByFacilityTypeId(qe.value.id,W.value.id)),tt=$(()=>{const ee=Kt.getFacilityTypeParagemUnica();return rt.getClinicSectorsByFacilityTypeId(qe.value.id,ee.id)}),Ce=$(()=>f.value!==null&&f.value!==void 0?we.value||Je.value?ca.getAllDistrictByProvinceId(f.value.id):[]:[]),we=$(()=>v.value===null||v.value===void 0||v.value.startStopReason===null||v.value.startStopReason===void 0?!1:v.value.startStopReason.code==="REFERIDO_PARA"),pt=$(()=>v.value===null||v.value===void 0||v.value.startStopReason===null||v.value.startStopReason===void 0?!1:v.value.startStopReason.code==="REFERIDO_DC"),Je=$(()=>v.value===null||v.value===void 0||v.value.startStopReason===null||v.value.startStopReason===void 0?!1:v.value.startStopReason.code==="TRANSFERIDO_PARA"),Tt=$(()=>v.value===null||v.value===void 0||v.value.startStopReason===null||v.value.startStopReason===void 0?!1:v.value.startStopReason.code==="REFERIDO_SECTOR_CLINICO"),gt=$(()=>q(K.value.startDate)),Mt=$(()=>{const ee=rt.getActiveUSClinicSectorByClinic(K.value.clinic_id);if(_e.value.gender==="Masculino"){let L=[];return L=ee.filter(S=>S.code!=="CPN"),L}return ee}),Vt=$(()=>{const ee=localStorage.getItem("clinicUsers");return rt.getClinicSectorByCode(ee)?rt.getClinicSectorByCode(ee):He.getByCode(ee)}),Ft=$(()=>N.value!==null?we.value?He.getAllPrivateFromDistrict(N.value.id):He.getAllUSFromDistrict(N.value.id):[]),Ke=$(()=>me.lastEpisodeByIdentifier(K.value.id)),Nt=$(()=>{let ee=qt.getAllStartReasons(),L=[];return ee==null&&(ee=[]),Ke.value!==null&&w(Ke.value)?(L=ee.filter(S=>S.code==="VOLTOU_REFERENCIA"),L):(L=ee.filter(S=>S.code!=="VOLTOU_REFERENCIA"),L)}),Ze=$(()=>{let ee=qt.getAllStopReasons(),L=[];return ee==null&&(ee=[]),u.value?Ke.value!==null&&w(Ke.value)?(L=ee.filter(S=>S.code!=="REFERIDO_DC"&&S.code!=="TRANSFERIDO_PARA"&&S.code!=="REFERIDO_PARA"&&S.code!=="FIM_PPE"&&S.code!=="TERMINO_DO_TRATAMENTO"&&S.code!=="OBITO"&&S.code!=="TSPC"),L):(L=ee.filter(S=>S.code!=="TRANSFERIDO_PARA"&&S.code!=="FIM_PPE"&&S.code!=="TERMINO_DO_TRATAMENTO"&&S.code!=="OBITO"&&S.code!=="TSPC"),L):(L=ee.filter(S=>S.code!=="REFERIDO_DC"&&S.code!=="TRANSFERIDO_PARA"&&S.code!=="REFERIDO_PARA"&&S.code!=="FIM_PPE"&&S.code!=="TERMINO_DO_TRATAMENTO"&&S.code!=="OBITO"&&S.code!=="TSPC"&&S.code!=="REFERIDO_SECTOR_CLINICO"&&S.code!=="VOLTOU_A_SER_REFERIDO_PARA"),L)}),Pt=ee=>ee<=ve().format("YYYY/MM/DD"),kt=async()=>{f.value=wt.getAllProvincesById(K.value.clinic.province_id),Y.value?(y.value=new Xe,y.value.id=fe(),y.value.syncStatus="R",m.value=q(ve()),u.value||(y.value.clinicSector=Vt.value)):(v.value=new Xe,v.value.id=fe(),v.value.syncStatus="R",y.value.syncStatus="U",re!=null&&(y.value=me.lastEpisodeByIdentifier(K.value.id),m.value=q(y.value.episodeDate)))},Ot=()=>{if(g.value=!0,h.value.validate(),Q.value.validate(),ae.value.validate(),!h.value.hasError&&!ae.value.hasError&&!Q.value.hasError){if(Y.value&&Ke.value!==null&&x(k(m.value))<x(Ke.value.episodeDate)){R("A data indicada n\xE3o pode ser menor que a data do \xFAltimo hist\xF3rico cl\xEDnico."),g.value=!1;return}A(String(M(m.value)))?x(k(m.value))>ve().format("YYYY-MM-DD")?(R("A data de inicio indicada \xE9 maior que a data da corrente."),g.value=!1):x(k(m.value))<x(K.value.startDate)?(R("A data de inicio indicada \xE9 menor que a data de admiss\xE3o ao servi\xE7o cl\xEDnico."),g.value=!1):!Y.value&&!H.value?i(y.value)&&x(k(m.value))<x(k(be.value.pickupDate))?(R("A data de inicio indicada \xE9 menor que a data da ultima visita efectuada pelo paciente."),g.value=!1):nt():!Y.value&&H.value?(le.value.validate(),G.value.validate(),X.value.validate(),!le.value.hasError&&!G.value.hasError&&!X.value.hasError?A(String(M(Z.value)))?x(k(m.value))>x(k(Z.value))?(R("A data de Fim indicada \xE9 menor que a data de in\xEDcio."),g.value=!1):i(y.value)&&x(k(Z.value))<x(k(be.value.pickupDate))?(R("A data de Fim indicada \xE9 menor que a data da ultima visita efectuada pelo paciente."),g.value=!1):(we.value||pt.value)&&!Ie(y.value)?(R("O paciente deve ter registo de uma prescri\xE7\xE3o v\xE1lida e dispensa para poder ser referido."),g.value=!1):we.value||Je.value?(ge.value.validate(),ge.value.hasError?(R("Por favor indicar o destino do paciente."),g.value=!1):nt()):nt():(R("A data de Fim \xE9 inv\xE1lida."),g.value=!1):g.value=!1):nt():(R("A data de inicio \xE9 inv\xE1lida."),g.value=!1)}else g.value=!1},nt=async()=>{if(Y.value)y.value.episodeType=Ct.getEpisodeTypeByCode("INICIO"),y.value.notes="Novo hist\xF3rico cl\xEDnico",y.value.clinic={},y.value.clinic.id=qe.value.id,y.value.patientServiceIdentifier=K.value,y.value.episodeDate=d(m.value),y.value.creationDate=new Date,y.value.patientVisitDetails=[],y.value.patientServiceIdentifier={},y.value.patientServiceIdentifier.id=K.value.id,y.value.patientServiceIdentifier_id=K.value.id,y.value.origin=qe.value.id;else{y.value.creationDate=new Date,y.value.clinicSector_id=y.value.clinicSector.id;const ee=y.value.clinicSector.id;y.value.clinicSector={},y.value.clinicSector.id=ee,y.value.clinicSector_id=ee,y.value.clinic={},y.value.clinic.id=qe.value.id,y.value.episodeDate=H.value?y.value.episodeDate:d(m.value),y.value.patientVisitDetails=[],v.value.patientServiceIdentifier={},v.value.patientServiceIdentifier.id=K.value.id,v.value.patientServiceIdentifier_id=K.value.id,y.value.patientVisitDetails=[],y.value.patientServiceIdentifier={},y.value.patientServiceIdentifier.id=K.value.id,y.value.patientServiceIdentifier_id=K.value.id,H.value&&(y.value.isLast=!1,v.value.clinicSector=E.value!==null?E.value:y.value.clinicSector,v.value.clinicSector_id=v.value.clinicSector.id,v.value.isLast=!0,v.value.episodeType=Ct.getEpisodeTypeByCode("FIM"),v.value.clinic={},v.value.clinic.id=qe.value.id,v.value.episodeDate=d(Z.value),v.value.creationDate=new Date,v.value.patientServiceIdentifier={},v.value.patientServiceIdentifier.id=K.value.id,v.value.patientVisitDetails=[],y.value.origin=qe.value.id,v.value.origin=qe.value.id)}me.apiSave(y.value,Y.value).then(()=>{H.value&&(s(),me.apiSave(v.value,!0).then(()=>{v.value.startStopReason.code==="TRANSFERIDO_PARA"||v.value.startStopReason.code==="OBITO"||v.value.startStopReason.code==="REFERIDO_SECTOR_CLINICO"||v.value.startStopReason.code==="REFERIDO_PARA"||v.value.startStopReason.code==="REFERIDO_DC"?K.value.patient.identifiers.forEach(ee=>{Ye.apiFetchById(ee.id),c()}):c()}).catch(ee=>{console.log(ee),c(),R("Aconteceu um erro ao durante a operacao de registo do Hist\xF3rico Cl\xEDnico de Fecho")})),V(Y.value?"Hist\xF3rico Cl\xEDnico adicionado com sucesso.":"Hist\xF3rico Cl\xEDnico actualizado com sucesso."),Re()}).catch(ee=>{console.log(ee),R("Aconteceu um erro ao gravar o epis\xF3dio"),g.value=!1})},Ie=ee=>{const L=Ae.getLastPatientVisitDetailFromPatientVisitAndEpisode(Ut(ee).id,ee.id);return L!=null?r(L.prescription)>0:!1},Ut=ee=>{const L=[];if(ee!=null){const S=Ae.getAllPatientVisitDetailsFromEpisode(ee.id);return S!=null&&S.forEach(Rt=>{L.push(Rt.patient_visit_id)}),Ee.getLastFromPatientVisitList(L)}else return null};return(ee,L)=>(o(),O(ye,{style:{width:"900px","max-width":"90vw"}},{default:l(()=>[a("form",{onSubmit:ct(Ot,["prevent"])},[e(he,{class:"q-pa-none bg-green-2"},{default:l(()=>[a("div",bi,[e(ne,{name:t(_e).gender=="Feminino"?"female":"male",size:"md",color:"primary"},null,8,["name"]),a("div",wi,_(t(T)(t(_e))),1),a("div",Si,[Di,B(" "+_(t(_e).gender),1)]),t(P)(t(_e))<=14?(o(),I("div",xi,[a("span",Vi,[B(" | "),e(ne,{name:"child_care"})]),B(" "+_(t(P)(t(_e)))+" Ano(s) de Idade ",1)])):(o(),I("div",Pi,[ki,B(" "+_(t(P)(t(_e)))+" Anos de Idade ",1)]))]),e(ue)]),_:1}),a("div",Ri,[!t(Y)&&!t(H)?(o(),I("span",qi,"Actualizar")):!t(Y)&&t(H)?(o(),I("span",Ci,"Fechar")):(o(),I("span",Ai,"Adicionar")),B(" Hist\xF3rico Cl\xEDnico ")]),a("div",$i,[a("div",Ii,[Ei,e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",Ti,[e(pe,{class:"col",disable:"",dense:"",outlined:"",modelValue:t(K).service,"onUpdate:modelValue":L[0]||(L[0]=S=>t(K).service=S),ref_key:"serviceRef",ref:b,"option-value":"id","option-label":"description",label:"Servi\xE7o de Sa\xFAde",rules:[S=>S&&S.length>0||"Por favor indicar a data de admiss\xE3o"]},null,8,["modelValue","rules"]),e(se,{dense:"",outlined:"",disable:"",class:"col q-ml-md",modelValue:gt.value,"onUpdate:modelValue":L[2]||(L[2]=S=>gt.value=S),ref_key:"identifierstartDateRef",ref:p,rules:[S=>S&&S.length>0||"Por favor indicar a data de admiss\xE3o"],label:"Data de Admiss\xE3o"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:t(K).startDate,"onUpdate:modelValue":L[1]||(L[1]=S=>t(K).startDate=S),mask:"DD-MM-YYYY"},{default:l(()=>[a("div",Mi,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","rules"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",modelValue:y.value.startStopReason,"onUpdate:modelValue":L[3]||(L[3]=S=>y.value.startStopReason=S),disable:!de.value||t(H),options:Nt.value,ref_key:"startReasonRef",ref:h,rules:[S=>!!S||"Por favor indicar a nota de in\xEDcio"],"option-value":"id","option-label":"reason",label:"Notas de in\xEDcio *"},null,8,["modelValue","disable","options","rules"])]),a("div",Fi,[t(u)?(o(),O(pe,{key:0,class:"col",dense:"",outlined:"",disable:!de.value||t(H),ref_key:"clinicSerctorRef",ref:Q,rules:[S=>!!S||"Por favor indicar o sector onde vai ocorrer o atendimento"],modelValue:y.value.clinicSector,"onUpdate:modelValue":L[4]||(L[4]=S=>y.value.clinicSector=S),options:Mt.value,"option-value":"id","option-label":"clinicName",label:"Sector Clinico *"},null,8,["disable","rules","modelValue","options"])):D("",!0),t(u)?D("",!0):(o(),O(pe,{key:1,class:"col",dense:"",outlined:"",disable:"",ref_key:"clinicSerctorRef",ref:Q,rules:[S=>!!S||"Por favor indicar o sector onde vai ocorrer o atendimento"],modelValue:y.value.clinicSector,"onUpdate:modelValue":L[5]||(L[5]=S=>y.value.clinicSector=S),options:Vt.value,"option-value":"id","option-label":"clinicName",label:"Sector Clinico *"},null,8,["rules","modelValue","options"])),e(se,{dense:"",outlined:"",disable:!de.value||t(H),class:"col q-ml-md",modelValue:m.value,"onUpdate:modelValue":L[7]||(L[7]=S=>m.value=S),ref_key:"startDateRef",ref:ae,rules:[S=>S&&S.length>0||"Por favor indicar a data de in\xEDcio"],label:"Data de In\xEDcio *"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:m.value,"onUpdate:modelValue":L[6]||(L[6]=S=>m.value=S),options:Pt,mask:"DD-MM-YYYY"},{default:l(()=>[a("div",Ni,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["disable","modelValue","rules"]),Oi]),t(H)&&t(i)(y.value)?(o(),I("span",Ui,[a("div",Yi,[Bi,e(ue,{color:"grey-13",size:"1px",class:"q-mb-sm"})]),a("div",Li,[e(se,{dense:"",outlined:"",class:"col",modelValue:Z.value,"onUpdate:modelValue":L[9]||(L[9]=S=>Z.value=S),ref_key:"stopDateRef",ref:le,label:"Data de Fim*"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:Z.value,"onUpdate:modelValue":L[8]||(L[8]=S=>Z.value=S),options:Pt,mask:"DD-MM-YYYY"},{default:l(()=>[a("div",zi,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"stopReasonRef",ref:G,rules:[S=>!!S||"Por favor indicar a nota de fim"],modelValue:v.value.startStopReason,"onUpdate:modelValue":L[10]||(L[10]=S=>v.value.startStopReason=S),options:Ze.value,"option-value":"id","option-label":"reason",label:"Notas de Fim do Hist\xF3rico Cl\xEDnico *"},null,8,["rules","modelValue","options"])]),we.value||Je.value?(o(),I("div",Wi,[e(pe,{class:"col",dense:"",outlined:"",modelValue:f.value,"onUpdate:modelValue":L[11]||(L[11]=S=>f.value=S),"use-input":"",ref_key:"provinceRef",ref:ce,"input-debounce":"0",options:Et.value,"option-value":"id","option-label":"description",label:"Prov\xEDncia"},null,8,["modelValue","options"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",modelValue:N.value,"onUpdate:modelValue":L[12]||(L[12]=S=>N.value=S),"use-input":"",ref_key:"districtRef",ref:De,"input-debounce":"0",options:Ce.value,"option-value":"id","option-label":"description",label:"Distrito"},null,8,["modelValue","options"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",ref_key:"referralClinicRef",ref:ge,rules:[S=>!!S||"Por favor indicar o destino do paciente."],modelValue:E.value,"onUpdate:modelValue":L[13]||(L[13]=S=>E.value=S),options:Ft.value,"option-value":"id","option-label":"clinicName",label:ft.value},null,8,["rules","modelValue","options","label"])])):D("",!0),pt.value?(o(),I("div",Hi,[e(pe,{class:"col",dense:"",outlined:"",modelValue:W.value,"onUpdate:modelValue":[L[14]||(L[14]=S=>W.value=S),L[15]||(L[15]=S=>E.value=null)],"use-input":"",ref_key:"clinicSectorTypeRef",ref:Ve,"input-debounce":"0",options:We.value,"option-value":"id","option-label":"description",label:"Tipo de Sector de Dispensa"},null,8,["modelValue","options"]),e(pe,{class:"col q-ml-md",dense:"",outlined:"",disable:y.value.id!==null&&t(oe),ref_key:"referealClinicSectorRef",ref:$e,rules:[S=>!!S||"Por favor indicar o sector de dispensa."],modelValue:E.value,"onUpdate:modelValue":L[16]||(L[16]=S=>E.value=S),options:Oe.value,"option-value":"id","option-label":"clinicName",label:"Sector de Dispensa"},null,8,["disable","rules","modelValue","options"])])):D("",!0),Tt.value?(o(),I("div",ji,[e(pe,{class:"col",dense:"",outlined:"",disable:y.value.id!==null&&t(oe),ref_key:"referealClinicSectorRef",ref:$e,rules:[S=>!!S||"Por favor indicar o sector de dispensa."],modelValue:E.value,"onUpdate:modelValue":L[17]||(L[17]=S=>E.value=S),options:tt.value,"option-value":"id","option-label":"clinicName",label:"Sector de Dispensa"},null,8,["disable","rules","modelValue","options"])])):D("",!0),a("div",Gi,[e(se,{modelValue:v.value.notes,"onUpdate:modelValue":L[18]||(L[18]=S=>v.value.notes=S),label:"Outras notas do Hist\xF3rico Cl\xEDnico",disable:y.value.id!==null&&t(oe),ref_key:"endNotesRef",ref:X,rules:[S=>!!S||"Por favor indicar a nota de fim"],dense:"",class:"col"},null,8,["modelValue","disable","rules"])])])):D("",!0)]),e(Ne,{align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Cancelar",color:"red",onClick:t(Re)},null,8,["onClick"]),e(J,{type:"submit",loading:g.value,label:"Submeter",color:"primary"},null,8,["loading"])]),_:1})],32)]),_:1}))}};const Qi={class:"col"},Ji={class:"row"},Ki={key:0,class:"col text-grey-9 text-weight-medium"},Zi={key:1,class:"col text-grey-8"},Xi={key:2,class:"col text-grey-9 text-weight-medium"},eo={key:3,class:"col text-grey-8"},to={class:"col text-grey-9 text-weight-medium"},ao={class:"col text-grey-8"},lo={class:"row"},so={class:"col-3 text-grey-9 text-weight-medium"},io={class:"col text-grey-8"},oo={key:0,class:"col items-center"},no={__name:"Episode",props:["episodeId","isLast"],setup(j){const{isReferenceEpisode:q,isTranferenceEpisode:A,isBackReferenceEpisode:M,hasVisits:x,isCloseEpisode:k,isStartEpisode:d,checkIsReferedToRemove:V}=it(),{alertSucess:R,alertError:T,alertInfo:P,alertWarningAction:w}=Qe(),{closeLoading:i,showloading:r}=ot(),{isPharmacyDDDOrAPEOrDCP:c,isProvincialInstalation:s}=Le(),u=j,g=U("showAddEditEpisode"),v=U("isNewEpisode"),y=U("isClosingEpisode"),m=$(()=>me.getEpisodeById(u.episodeId)),Z=$(()=>st.getLastPackFromEpisode(u.episodeId)),f=$(()=>m.value.patientServiceIdentifier),N=$(()=>E()),W=le=>vt.formatDate(le,"DD-MM-YYYY"),E=()=>q(m.value)||A(m.value)||M(m.value)?!1:!x(m.value),b=()=>{const le=m.value;x(le)?T("N\xE3o pode fazer altera\xE7\xF5es sobre este epis\xF3dio pois o mesmo ja possui registos de visitas do paciente/utente associados."):(g.value=!0,v.value=!1)},p=()=>{y.value=!0,g.value=!0,v.value=!1},h=()=>{y.value=!1;const le=m.value;x(le)?P("error","N\xE3o pode remover este epis\xF3dio pois o mesmo ja possui registos de visitas do paciente/utente associados."):w("Deseja remover o Hist\xF3rico Cl\xEDnico?").then(G=>{console.log(G),G?Q():P("Opera\xE7\xE3o cancelada")})},Q=()=>{r(),me.delete(m.value.id).then(()=>{const le=me.getlast3EpisodesByIdentifier(f.value.id);le.length>0&&V(le)&&me.deletePinia(le[0].id),i(),R("Sucesso","Opera\xE7\xE3o efectuada com sucesso.")}).catch(le=>{console.error(le),T("Erro ao remover o episodio"),i()})},ae=$(()=>m.value!==null?me.lastEpisodeByIdentifier(f.value.id).id===m.value.id:!0);return F("curEpisode",m),F("lastPack",Z),F("curEpisodeIdentifier",f),(le,G)=>(o(),I("div",null,[e(mt,{dense:"","header-class":t(d)(m.value)?"bg-grey-6 text-white text-bold vertical-middle q-pl-md":"bg-red text-white text-bold vertical-middle q-pl-md blink","expand-icon-class":"text-white"},{header:l(()=>[e(Te,{avatar:""},{default:l(()=>[e(ne,{color:"white",name:"medical_information"})]),_:1}),t(d)(m.value)?(o(),O(Te,{key:1},{default:l(()=>[B(" Data de "+_(t(d)(m.value)?"In\xEDcio:":"Fim:")+" "+_(W(m.value.episodeDate))+" ["+_(m.value.startStopReason!==null?m.value.startStopReason.reason:"")+"] ",1)]),_:1})):(o(),O(Te,{key:0},{default:l(()=>[a("span",null," Data de "+_(t(d)(m.value)?"In\xEDcio:":"Fim:")+" "+_(W(m.value.episodeDate))+" ["+_(m.value.startStopReason!==null?m.value.startStopReason.reason:"")+"] ",1)]),_:1}))]),default:l(()=>[e(ye,{flat:"",bordered:"",class:"noRadius"},{default:l(()=>[e(he,{class:"row q-pa-sm"},{default:l(()=>[a("div",Qi,[a("div",Ji,[!t(q)(m.value)&&!t(A)(m.value)?(o(),I("div",Ki," Sector Cl\xEDnico: ")):D("",!0),!t(q)(m.value)&&!t(A)(m.value)?(o(),I("div",Zi,_(m.value.clinicSector!==null?m.value.clinicSector.clinicName:""),1)):D("",!0),t(q)(m.value)||t(A)(m.value)?(o(),I("div",Xi," Farm\xE1cia Refer\xEAncia: ")):D("",!0),t(q)(m.value)||t(A)(m.value)?(o(),I("div",eo,_(m.value.clinicSector!==null?m.value.clinicSector.clinicName:""),1)):D("",!0),a("div",to,_(t(d)(m.value)?"Data de In\xEDcio:":"Data de Fim:"),1),a("div",ao,_(W(m.value.episodeDate)),1)]),a("div",lo,[a("div",so," Notas de "+_(t(d)(m.value)?"In\xEDcio: ":"Fim: "),1),a("div",io,_(m.value.startStopReason!==null?m.value.startStopReason.reason:""),1)])])]),_:1}),e(ue),e(Ne,null,{default:l(()=>[u.isLast&&ae.value&&!t(k)(m.value)?(o(),I("div",oo,[N.value&&!t(c)()&&!t(s)()?(o(),O(J,{key:0,onClick:h,dense:"",unelevated:"",color:"red",label:"Remover",class:"float-right q-ml-md"})):D("",!0),!N.value&&!t(c)()&&!t(s)()?(o(),O(J,{key:1,onClick:p,dense:"",unelevated:"",color:"red",label:"Fechar",class:"float-right q-ml-md"})):D("",!0),N.value&&!t(c)()&&!t(s)()?(o(),O(J,{key:2,onClick:b,dense:"",unelevated:"",color:"orange-5",label:"Editar",class:"float-right"})):D("",!0)])):D("",!0)]),_:1})]),_:1})]),_:1},8,["header-class"]),e(ue),e(ke,{persistent:"",modelValue:t(g),"onUpdate:modelValue":G[0]||(G[0]=ce=>yt(g)?g.value=ce:null)},{default:l(()=>[e(ga)]),_:1},8,["modelValue"])]))}};var ro=Ha(no,[["__scopeId","data-v-731910de"]]);const uo={class:"col-5 bg-white q-pa-md"},co={class:"row"},vo=a("div",{class:"col-4 text-grey-9 text-weight-medium"}," Servi\xE7o de Sa\xFAde: ",-1),mo={class:"col text-grey-8"},fo={class:"row"},po=a("div",{class:"col-4 text-grey-9 text-weight-medium"}," Data de Admiss\xE3o: ",-1),go={class:"col text-grey-8"},_o={key:0,class:"row"},ho=a("div",{class:"col-4 text-grey-9 text-weight-medium"}," Nr Identificador: ",-1),yo={class:"col text-grey-8"},bo={class:"row"},wo=a("div",{class:"col-4 text-grey-9 text-weight-medium"},"Data Fim:",-1),So={class:"col text-grey-8"},Do={class:"row"},xo=a("div",{class:"col-4 text-grey-9 text-weight-medium"}," Notas de Fim: ",-1),Vo={class:"col text-grey-8"},Po={class:"row"},ko=a("div",{class:"col-4 text-grey-9 text-weight-medium"},"Estado:",-1),Ro={class:"col text-grey-8"},qo={class:"row q-my-md"},Co={class:"col q-py-md"},Ao={__name:"InfoContainer",props:["identifierId"],setup(j){const q=j,{hasVisits:A,isCloseEpisode:M,isDCReferenceEpisode:x}=it(),{isProvincialInstalation:k,isPharmacyDDDOrAPEOrDCP:d,isProvincialInstalationPharmacysMode:V,isProvincialInstalationMobileClinic:R}=Le(),{canBeEdited:T}=ma(),{alertSucess:P,alertError:w,alertInfo:i,alertWarningAction:r}=Qe(),{website:c,isDeskTop:s,isMobile:u}=ze(),{formatDate:g}=et(),v=n(!1),y=n(!1),m=n(!1),Z=n(new Xe),f=n(!1),N=n(!0),W=n(!1),E=U("isEditStep"),b=U("isCreateStep"),p=U("isCloseStep"),h=U("isReOpenStep"),Q=$(()=>Ye.identifierCurr(q.identifierId,"")),ae=$(()=>me.lastEpisodeByIdentifier(Q.value.id)),le=$(()=>st.getLastPackFromEpisode(ae.value.id)),G=()=>{Z.value=new Xe,f.value=!0,y.value=!0,m.value=!1},ce=()=>{f.value=!1,y.value=!1},De=()=>{f.value=!1,y.value=!1,m.value=!1},ge=()=>{T(Q.value)?(b.value=!1,E.value=!0,p.value=!1,h.value=!1,W.value=!0):w("N\xE3o pode fazer altera\xE7\xF5es sobre este servi\xE7o de sa\xFAde pois o mesmo ja possui registos de visitas do paciente/utente associados.")},Ve=()=>{b.value=!1,E.value=!1,p.value=!0,h.value=!1,W.value=!0},$e=()=>{b.value=!1,E.value=!1,p.value=!1,h.value=!0,W.value=!0},X=()=>{b.value=!1,E.value=!1,p.value=!1,h.value=!1,W.value=!1},K=$(()=>!be.value),re=$(()=>Q.value!=null?me.lastEpisodeByIdentifier(Q.value.id):new Xe),be=$(()=>re.value===null||re.value===void 0?!1:re.value!==null&&M(re.value)&&!x(re.value)&&Q.value.endDate!==null),_e=$(()=>re.value!==null&&re.value!==void 0?M(re.value)&&(Q.value.endDate===null||Q.value.reopenDate!==null):!0),oe=$(()=>me.getlast3EpisodesByIdentifier(Q.value.id));return F("showAddEditEpisode",f),F("curIdentifier",Q),F("curEpisode",ae),F("lastPack",le),F("isNewEpisode",y),F("closeEpisodeCreation",ce),F("editEpisodeCreation",De),F("close",X),F("isClosingEpisode",m),(Y,H)=>(o(),I("div",null,[e(mt,{dense:"","header-class":K.value?"bg-grey-6 text-white text-bold vertical-middle q-pl-md":"bg-red-7 text-white text-bold vertical-middle q-pl-md","expand-icon-class":"text-white","default-opened":Q.value.service!==null&&Q.value.service!==void 0?Q.value.service.code==="TARV"||!t(c):!0},{header:l(()=>[e(Te,{avatar:""},{default:l(()=>[e(ne,{color:"white",name:"medical_information"})]),_:1}),e(Te,null,{default:l(()=>[B(_(Q.value.service===null||Q.value.service===void 0?"Sem Info":Q.value.service.code),1)]),_:1})]),default:l(()=>[xe(e(ye,{class:"noRadius q-mt-xs"},{default:l(()=>[e(he,{class:"row q-pa-none"},{default:l(()=>[a("div",uo,[a("div",co,[vo,a("div",mo,_(Q.value.service===null||Q.value.service===void 0?"Sem Info":Q.value.service.description),1)]),a("div",fo,[po,a("div",go,_(t(g)(Q.value.startDate)),1)]),Q.value.value!==null?(o(),I("div",_o,[ho,a("div",yo,_(Q.value.value),1)])):D("",!0),xe(a("div",bo,[wo,a("div",So,_(t(g)(Q.value.endDate)),1)],512),[[dt,be.value]]),xe(a("div",Do,[xo,a("div",Vo,_(re.value!==null&&t(M)(Q.value)?re.value.startStopReason.reason:""),1)],512),[[dt,be.value]]),a("div",Po,[ko,a("div",Ro,_(v.value?"Inactivo":"Activo no Servi\xE7o"),1)]),e(ue),a("div",qo,[e(fa),!be.value&&!t(d)()&&!t(k)()?(o(),O(J,{key:0,unelevated:"",color:"orange-5",label:"Editar",onClick:ge,class:"float-right"})):D("",!0),!be.value&&!t(d)()&&!t(R)()&&!t(k)()?(o(),O(J,{key:1,unelevated:"",color:"red",label:"Fechar",onClick:Ve,class:"float-right q-ml-sm"})):D("",!0),be.value?(o(),O(J,{key:2,unelevated:"",color:"blue",label:"Reabrir",onClick:$e,class:"float-right q-ml-sm"})):D("",!0)])]),a("div",Co,[e(xt,{addVisible:_e.value&&(!t(k)()||t(V)()||t(R)()),bgColor:"bg-primary",addButtonActions:G},{default:l(()=>[B("Hist\xF3rico Cl\xEDnico")]),_:1},8,["addVisible"]),Q.value.episodes.length<=0?(o(),O(ut,{key:0},{default:l(()=>[B("Nenhum Hist\xF3rico Cl\xEDnico Iniciado")]),_:1})):D("",!0),a("span",null,[(o(!0),I(St,null,Dt(oe.value,Re=>(o(),O(ro,{key:Re.id,episodeId:Re.id,isLast:Re.isLast},null,8,["episodeId","isLast"]))),128))])])]),_:1})]),_:1},512),[[dt,N.value]])]),_:1},8,["header-class","default-opened"]),e(ue),e(ke,{persistent:"",modelValue:W.value,"onUpdate:modelValue":H[0]||(H[0]=Re=>W.value=Re)},{default:l(()=>[e(pa)]),_:1},8,["modelValue"]),e(ke,{persistent:"",modelValue:f.value,"onUpdate:modelValue":H[1]||(H[1]=Re=>f.value=Re)},{default:l(()=>[e(ga)]),_:1},8,["modelValue"])]))}},ia={__name:"ClinicServicesInfo",setup(j){const{preferedIdentifier:q}=Me(),{isProvincialInstalation:A,isProvincialInstalationPharmacysMode:M,isProvincialInstalationMobileClinic:x,isPharmacyDDDOrAPEOrDCP:k,isLocalInstalation:d}=Le();n(!1);const V=n(new ua);n(!1);const R=n(!0),T=n(!0),P=n(!0),w=n("bg-primary"),i=n("Servi\xE7os de Sa\xFAde da Farm\xE1cia"),r=n("Nenhum Servi\xE7o de Sa\xFAde Adicionado"),c=n(!1),s=n(!1),u=n(!1),g=n(!1),v=n(!1),y=U("patient"),m=$(()=>q(y.value)!==null?Ye.identifierCurr(q(y.value).id,q(y.value).service_id):[]);Pe(()=>{});const Z=()=>{V.value=null,u.value=!0,s.value=!1,g.value=!1,v.value=!1,c.value=!0},f=()=>{u.value=!1,s.value=!1,g.value=!1,v.value=!1,c.value=!1};return F("showAddEditClinicalService",c),F("isEditStep",s),F("isCreateStep",u),F("isCloseStep",g),F("isReOpenStep",v),F("addVisible",T),F("mainContainer",P),F("bgColor",w),F("titleEmptyList",r),F("title",i),F("curIdentifier",m),F("close",f),(N,W)=>(o(),I("div",null,[e(xt,{addVisible:t(A)()&&t(x)()&&!t(M)()||t(d)(),mainContainer:!0,bgColor:"bg-primary",addButtonActions:Z},{default:l(()=>[B(" Servi\xE7os de Sa\xFAde da Farm\xE1cia ")]),_:1},8,["addVisible"]),t(y).identifiers.length<=0?(o(),O(ut,{key:0})):D("",!0),xe(a("div",null,[a("span",null,[(o(!0),I(St,null,Dt(t(y).identifiers,E=>(o(),O(Ao,{key:E.id,identifierId:E.id},null,8,["identifierId"]))),128))])],512),[[dt,R.value]]),e(ke,{persistent:"",modelValue:c.value,"onUpdate:modelValue":W[0]||(W[0]=E=>c.value=E)},{default:l(()=>[e(pa)]),_:1},8,["modelValue"])]))}};const $o={class:"row items-center text-subtitle1 q-pa-md"},Io={class:"text-bold text-grey-10 q-ml-sm"},Eo={class:"text-grey-10 q-ml-sm"},To=a("span",{class:"text-bold text-h6"},"|",-1),Mo={key:0,class:"text-grey-10 q-ml-sm"},Fo={class:"text-bold text-h6"},No={key:1,class:"text-grey-10 q-ml-sm"},Oo=a("span",{class:"text-bold text-h6"},"|",-1),Uo={class:"absolute-top-right q-pa-md"},Yo={class:"row q-mt-xs"},Bo={class:"q-pa-md"},Lo={class:"q-gutter-sm"},zo={class:"row q-mt-xl q-pt-md"},Wo={class:"text-right absolute-bottom q-mb-lg q-mr-md q-mt-xl no-pointer-events"},Ho={__name:"AddEditPrescription",setup(j){const{idadeCalculator:q,getDDMMYYYFromJSDate:A,getYYYYMMDDFromJSDate:M}=et(),{fullName:x}=Me(),{alertSucess:k,alertError:d}=Qe(),V=n("US_"),R=n(),T=n([]),P=n(!1),w=n(new At({id:fe()})),{isReferenceOrTransferenceEpisode:i}=it(),{isOnlyPharmacyDDDO:r,isOnlyComunitaryDispense:c}=Le(),s=U("patient"),u=U("closePrescriptionOption");Pe(()=>{f()});const g=$(()=>V.value!==null?Ta.getAllFromDispenseModeType(V.value):[]),v=$(()=>Ye.getAllIdentifierWithInicialEpisodeByPatient(s.value.id)),y=$(()=>Ye.getAllIdentifierWithREferralEpisodeByPatient(s.value.id)),m=$(()=>He.currClinic()),Z=$(()=>w.value.patientVisitDetails.length===0?"Dispensar":"Dispensar ["+w.value.patientVisitDetails.length+"]"),f=()=>{w.value.visitDate=M(ve()),w.value.clinic=s.value.clinic,w.value.clinic_id=s.value.clinic_id,w.value.patient=s.value,w.value.patient_id=s.value.id,w.value.patientVisitDetails=[],r()&&(V.value="DD_"),c()&&(V.value="DC_")},N=()=>{w.value.clinic={},w.value.clinic.id=s.value.clinic_id,w.value.patient={},w.value.patient.id=s.value.id,w.value.origin=m.value.id,P.value=!0,R.value===null||R.value===void 0||R.value===""?(d("Por favor indicar o modo da dispensa."),P.value=!1):(w.value.patientVisitDetails.forEach(W=>{w.value.visitDate=W.pack.pickupDate,W.origin=m.value.id,W.clinic={},W.clinic.id=s.value.clinic_id,W.episode={},W.episode.id=W.episode_id,W.pack.clinic={},W.pack.clinic.id=s.value.clinic_id,W.pack.dispenseMode={},W.pack.dispenseMode.id=R.value.id,W.pack.syncStatus="R",r()||c()?W.pack.providerUuid=null:W.pack.providerUuid=sessionStorage.getItem("Btoa"),W.pack.origin=m.value.id,W.pack.packagedDrugs.forEach(p=>{p.drug={},p.drug.id=p.drug_id,p.origin=m.value.id}),W.prescription.clinic={},W.prescription.clinic.id=s.value.clinic_id,W.prescription.origin!==s.value.clinic_id&&(W.prescription.origin=m.value.id),W.prescription.prescribedDrugs.forEach(p=>{let h=p.drug.id;p.drug={},p.drug.id=h,p.origin!==s.value.clinic_id&&(p.origin=m.value.id)});const E=me.getEpisodeById(W.episode_id),b=me.lastEpisodeByIdentifier(E.patientServiceIdentifier_id);i(b)&&(W.pack.isreferral=!0)}),Ee.post(w.value).then(W=>{P.value=!1,k("Dispensa efectuada com sucesso"),u()}).catch(W=>{P.value=!1,d("Aconteceu um erro inesperado nesta opera\xE7\xE3o."),console.log(W)}))};return F("curPatientVisit",w),F("currClinic",m),(W,E)=>(o(),O(ye,{style:{width:"1350px","max-width":"110vw"}},{default:l(()=>[e(he,{style:{"max-height":"50vh"},class:"q-pa-none bg-green-2"},{default:l(()=>[a("div",$o,[e(ne,{name:t(s).gender=="Feminino"?"female":"male",size:"md",color:"primary"},null,8,["name"]),a("div",Io,_(t(x)(t(s))),1),a("div",Eo,[To,B(" "+_(t(s).gender),1)]),t(q)(t(A)(t(s).dateOfBirth))<=14?(o(),I("div",Mo,[a("span",Fo,[B(" | "),e(ne,{name:"child_care"})]),B(" "+_(t(q)(t(A)(t(s).dateOfBirth)))+" Ano(s) de Idade ",1)])):(o(),I("div",No,[Oo,B(" "+_(t(q)(t(A)(t(s).dateOfBirth)))+" Anos de Idade ",1)])),a("div",Uo,[xe(e(J,{flat:"",round:"",dense:"",icon:"close",onClick:t(u)},null,8,["onClick"]),[[Ue]])])]),e(ue)]),_:1}),e(lt,{style:{height:"800px"},class:"q-pr-md"},{default:l(()=>[e(he,null,{default:l(()=>[e(ja,{bordered:""},{default:l(()=>[(o(!0),I(St,null,Dt(v.value.length>0?v.value:y.value,b=>(o(),O(mt,{key:b.id,group:"somegroup",dense:"",label:"Prescri\xE7\xE3o "+b.service.code+" - "+b.identifierType.code+": "+b.value,"default-opened":b.service.code==="TARV","header-class":T.value[b.service.code]?"bg-amber-9 text-white text-bold text-subtitle1 vertical-middle q-pl-md":"bg-primary text-white text-bold text-subtitle1 vertical-middle q-pl-md","expand-icon-class":"text-white",modelValue:T.value[b.service.code],"onUpdate:modelValue":p=>T.value[b.service.code]=p},{default:l(()=>[e(ye,null,{default:l(()=>[e(he,null,{default:l(()=>[e(xt,{bgColor:"bg-grey-6"},{default:l(()=>[B("Informa\xE7\xE3o da Prescri\xE7\xE3o ")]),_:1}),e(La,{identifier:b},null,8,["identifier"])]),_:2},1024)]),_:2},1024),e(ue)]),_:2},1032,["label","default-opened","header-class","modelValue","onUpdate:modelValue"]))),128))]),_:1}),a("div",Yo,[e(It,{dense:"","inline-actions":"",class:"col text-white q-pa-none bg-orange-4"},{action:l(()=>[e(pe,{style:{width:"320px"},class:"col q-ma-sm","bg-color":"white",dense:"",outlined:"",ref:"dispenseModeRef",modelValue:R.value,"onUpdate:modelValue":E[6]||(E[6]=b=>R.value=b),options:g.value,"option-value":"id","option-label":"description",label:"Modo de dispensa"},null,8,["modelValue","options"])]),default:l(()=>[a("div",Bo,[a("div",Lo,[e(Se,{modelValue:V.value,"onUpdate:modelValue":[E[0]||(E[0]=b=>V.value=b),E[1]||(E[1]=b=>R.value=[])],"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"US_",label:"Farm\xE1cia P\xFAblica"},null,8,["modelValue"]),e(Se,{modelValue:V.value,"onUpdate:modelValue":[E[2]||(E[2]=b=>V.value=b),E[3]||(E[3]=b=>R.value=[])],"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"DD_",label:"Dipensa Descentralizada"},null,8,["modelValue"]),e(Se,{modelValue:V.value,"onUpdate:modelValue":[E[4]||(E[4]=b=>V.value=b),E[5]||(E[5]=b=>R.value=[])],"checked-icon":"task_alt","unchecked-icon":"panorama_fish_eye",val:"DC_",label:"Dispensa Comunit\xE1ria"},null,8,["modelValue"])])])]),_:1})])]),_:1}),e(Ne,null,{default:l(()=>[a("div",zo,[a("span",Wo,[e(J,{label:"Cancelar",color:"red",class:"all-pointer-events",onClick:t(u)},null,8,["onClick"]),e(J,{label:Z.value,loader:"",disable:w.value.patientVisitDetails.length===0,loading:P.value,onClick:E[7]||(E[7]=b=>N()),color:"primary",class:"q-ml-md all-pointer-events"},null,8,["label","disable","loading"])])])]),_:1})]),_:1})]),_:1}))}},jo={class:"col-12"},Go={key:0},Qo={key:1},Jo={key:0},Ko={key:1},Zo={class:"col"},Xo={__name:"PackInfo",setup(j){const{getDrugFirstLevelById:q}=Ga(),A=[{name:"drug",required:!0,field:"name",label:"Medicamento",align:"left",sortable:!0},{name:"qty",align:"left",field:"quantitySupplied",label:"Quantidade",sortable:!0},{name:"nextPickUpDate",align:"left",field:"nextPickUpDate",label:"Pr\xF3ximo Levantamento",sortable:!1},{name:"quantityRemain",align:"center",field:"quantityRemain",label:"Sobra",sortable:!1},,{name:"opts",align:"left",label:"Op\xE7\xF5es",sortable:!1}];n(!0),n("Prescri\xE7\xE3o"),n("Nenhuma Prescri\xE7\xE3o Adicionada");const M=n("bg-grey-6"),x=U("lastPackOnPrescription");U("curIdentifier");const k=U("removePack"),d=P=>vt.formatDate(P,"DD-MM-YYYY"),V=P=>{let w=0;return x.value.packagedDrugs.find(i=>{P.id===i.drug.id&&(w=Number(i.quantityRemain))}),w},R=P=>Math.floor(V(P)/P.packSize),T=P=>V(P)%P.packSize;return F("bgColor",M),(P,w)=>(o(),I("div",null,[t(x)!==null?(o(),O(mt,{key:0,dense:"","header-class":"bg-grey-6 text-white text-bold vertical-middle q-pl-md","expand-icon-class":"text-white","default-opened":""},{header:l(()=>[e(Te,{avatar:""},{default:l(()=>[e(ne,{color:"white",name:"add_task"})]),_:1}),e(Te,null,{default:l(()=>[B(" Data de Levantamento: "+_(d(t(x).pickupDate)),1)]),_:1})]),default:l(()=>[t(x)!==null?(o(),O(ye,{key:0,flat:"",bordered:"",class:"noRadius"},{default:l(()=>[e(he,{class:"row q-pa-sm"},{default:l(()=>[a("div",jo,[e(Be,{class:"col",dense:"",flat:"",unelevated:"",rows:t(x).packagedDrugs,columns:A,"row-key":"id","hide-bottom":""},{body:l(i=>[e(Fe,{"no-hover":"",props:i},{default:l(()=>[e(te,{key:"drug",props:i},{default:l(()=>[B(_(i.row.drug!==null?i.row.drug.name.includes(String(t(q)(i.row.drug.id).form.description).substring(0,4))?i.row.drug.name:i.row.drug.name+" - ("+i.row.drug.packSize+" "+String(t(q)(i.row.drug.id).form.description).substring(0,4)+")":""),1)]),_:2},1032,["props"]),e(te,{key:"qty",props:i},{default:l(()=>[B(_(i.row.quantitySupplied)+" ",1),t(q)(i.row.drug.id).clinicalService.code==="TARV"?(o(),I("em",Go," Frasco(s)")):(o(),I("em",Qo,_(t(q)(i.row.drug.id).form.description)+"(s)",1))]),_:2},1032,["props"]),e(te,{"auto-width":"",key:"nextPickUpDate",props:i},{default:l(()=>[B(_(i.row.toContinue?d(t(x).nextPickUpDate):"N\xE3o continua"),1)]),_:2},1032,["props"]),e(te,{key:"quantityRemain",props:i},{default:l(()=>[t(q)(i.row.drug.id).clinicalService.code==="TARV"?(o(),I("em",Jo,_(R(i.row.drug))+" Frasco(s) e "+_(T(i.row.drug)+" "+t(q)(i.row.drug.id).form.unit),1)):(o(),I("em",Ko,_(R(i.row.drug))+" "+_(t(q)(i.row.drug.id).form.description)+"(s)",1))]),_:2},1032,["props"]),e(te,{rowspan:t(x).packagedDrugs,"auto-width":"",key:"opts",props:i},{default:l(()=>[a("div",Zo,[e(J,{flat:"",onClick:ct(t(k),["stop"]),round:"",color:"red",icon:"delete"},{default:l(()=>[e($t,{class:"bg-red"},{default:l(()=>[B("Remover")]),_:1})]),_:1},8,["onClick"])])]),_:2},1032,["rowspan","props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])]),_:1})]),_:1})):D("",!0)]),_:1})):D("",!0),e(ue)]))}},{idadeCalculator:Ad,idadeReportCalculator:en}=et(),{isMobile:oa,isOnline:na}=ze();var tn={async downloadPDF(j,q,A){const M=await Ka(Xa),x=q.service.code==="TARV"?"Ficha Individual de Levantamento de ARVs ( FILA)":q.service.code==="TPT"?"Ficha Individual de Levantamento de TPT (FILT)":q.service.code==="PREP"?"Ficha Individual de Levantamento de PREP (FILP)":"Ficha Individual de Levantamento de Medicamento",d=(q.service.code==="TARV"?"FILA_".concat(q.value):q.service.code==="TPT"?"FILT_".concat(q.value):q.service.code==="PREP"?"FILP_".concat(q.value):"Ficha_Medicamento".concat(q.value)).concat("_"+ve(new Date).format("DD-MM-YYYY")),V=new Qa({orientation:"l",unit:"mm",format:"a4",putOnlyUsedFonts:!0,floatPrecision:"smart"});V.addFileToVFS("NotoSans-Regular.ttf",M.split(",")[1]),V.addFont("NotoSans-Regular.ttf","NotoSans","normal"),V.setFont("NotoSans"),V.setProperties({title:d.concat(".pdf")}),A.value=!0;const R=new Image;R.src="data:image/png;base64,"+Ja;const T=V.internal.pageSize.getWidth(),P=["Data de Levantamento de ARVs","Medicamentos ARVs","Quantidade Dispensada","Dosagem","Data Prox. Levant."];let w=[];na.value&&!oa.value?await st.apiGetAllByPatientId(j.id,q.service.code).then(u=>{w=u.data}):await Ee.apiGetAllPacksByPatientId(j.id,q.service.code).then(u=>{w=u});const i=[];let r=new Date(1990,1,1);const c="days";for(const u in w)if(!vt.isSameDate(w[u].pickupDate,r,c)){r=w[u].pickupDate;const g=[];g.push(ve(w[u].pickupDate).format("DD-MM-YYYY")),g.push(an(w[u].packagedDrugs).join(`
`)),g.push(ln(w[u].packagedDrugs).join(`
`)),g.push(sn(w[u].packagedDrugs).join(`
`)),g.push(ve(w[u].nextPickUpDate).format("DD-MM-YYYY")),i.push(g)}const s=[[{content:"NID:    "+q.value,rowSpan:4,halign:"center",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:"Nome:",halign:"left",valign:"middle",fontStyle:"bold",fontSize:"14"},{content:j.firstNames},{content:"Apelido:"},{content:j.lastNames}],[{content:"Idade:"},{content:Math.abs(en(j.dateOfBirth))},{content:"Sexo:"},{content:j.gender}],[{content:"Contacto:"},{content:j.cellphone!==null&&j.cellphone!==void 0?j.cellphone:""},{content:"Endere\xE7o:"},{content:j.address!==null&&j.address!==void 0?j.address:""}]];if(la(V,{margin:{top:60},bodyStyles:{font:"NotoSans",halign:"center",valign:"middle"},headStyles:{font:"NotoSans",halign:"center",valign:"middle"},theme:"grid",body:s}),la(V,{margin:{top:60},bodyStyles:{font:"NotoSans",halign:"center",valign:"middle"},headStyles:{font:"NotoSans",halign:"center",valign:"middle"},didDrawPage:function(u){V.setFontSize(10),V.setTextColor(40),V.addImage(R,"PNG",u.settings.margin.left+15,5,25,25),V.text("REP\xDABLICA DE MO\xC7AMBIQUE",u.settings.margin.left+2,35),V.text("MINIST\xC9RIO DA SA\xDADE",u.settings.margin.left+7,40),V.text("SERVI\xC7O NACIONAL DE SA\xDADE",u.settings.margin.left,45),V.setFontSize(16),V.text(x,T/2,40,{align:"center"})},theme:"grid",head:[P],body:i}),na.value&&!oa.value)window.open(V.output("bloburl")),A.value=!1;else{const u=V.output();Za.downloadFile(d,".pdf",u,A)}}};function an(j){const q=[];for(const A in j){const M=[];M.push(j[A].drug.name),q.push(M)}return q}function ln(j){const q=[];for(const A in j){console.log("RoWWW",j[A]);let M="Frasco(s)";j[A].drug.clinical_service_id!=="80A7852B-57DF-4E40-90EC-ABDE8403E01F"&&(M=j[A].drug.form.description+"(s)");const x=[];x.push(j[A].quantitySupplied+" "+M),q.push(x)}return q}function sn(j){const q=[];for(const A in j){const M=[];M.push("Tomar ".concat(j[A].amtPerTime!==0?j[A].amtPerTime:j[A].drug.defaultTimes)+" "+j[A].drug.form.description+" ".concat(j[A].timesPerDay!==0?j[A].timesPerDay:j[A].drug.defaultTreatment)+" Vez(es) por ".concat(j[A].drug.defaultPeriodTreatment)),q.push(M)}return q}const on={style:{width:"900px","max-width":"140vw"}},nn={class:"col text-bold text-grey-10 q-ml-sm text-center q-pt-sm"},rn={class:"col bg-white q-pa-md"},dn={class:"row"},un=a("div",{class:"col text-grey-9 text-weight-medium text-bold"}," Data da Prescri\xE7\xE3o: ",-1),cn={class:"col text-grey-8"},vn=a("div",{class:"col text-grey-9 text-weight-medium text-bold"}," Regime Terap\xEAutico: ",-1),mn={key:0,class:"col text-grey-8"},fn={key:0,class:"row"},pn={key:0,class:"col text-grey-9 text-weight-medium"},gn={key:1,class:"col text-grey-8"},_n=a("div",{class:"col text-grey-10"},"Cl\xEDnico:",-1),hn={key:2,class:"col text-grey-8"},yn={key:1,class:"row"},bn=a("div",{class:"col text-grey-9 text-weight-medium"}," Tipo de Dispensa: ",-1),wn={key:0,class:"col text-grey-8"},Sn=a("div",{class:"col text-grey-9 text-weight-medium"},"Validade:",-1),Dn={class:"row"},xn=a("div",{class:"col text-grey-9 text-weight-medium"},"Dura\xE7\xE3o:",-1),Vn={class:"col text-grey-8"},Pn=a("div",{class:"col text-grey-9 text-weight-medium"}," Tipo de Paciente: ",-1),kn={class:"col text-grey-8"},Rn={class:"row"},qn=a("div",{class:"col-3 text-grey-9 text-weight-medium"}," Altera Linha Terap\xEAutica: ",-1),Cn={class:"col text-grey-8"},An={key:0,class:"col-3 text-grey-9 text-weight-medium"},$n={key:1,class:"col text-grey-8"},In={class:"row"},En=a("div",{class:"col-3 text-grey-9 text-weight-medium"}," Prescri\xE7\xE3o especial: ",-1),Tn={class:"col text-grey-8"},Mn={key:0,class:"col-3 text-grey-9 text-weight-medium"},Fn={key:1,class:"col text-grey-8"},Nn={class:"col text-grey-8 q-pt-lg"},On=a("span",{class:"text-bold text-subtitle1 vertical-middle q-pl-md"},"Medicamentos Prescritos",-1),Un={__name:"PrescriptionDetailsView",setup(j){const{remainigDuration:q,remainigDurationInWeeks:A}=jt(),{getQtyPrescribed:M}=za(),x=[{name:"drug",align:"left",field:i=>i.drug.name,label:"Medicamento",sortable:!0},{name:"dosage",align:"left",field:i=>"Tomar "+i.amtPerTime+" "+i.drug.form.description+" "+i.timesPerDay+" vez(es) por "+i.form,label:"Toma",sortable:!1},{name:"packs",align:"center",style:"width: 20px",field:i=>M(i,d.value.duration.weeks)>0?M(i,d.value.duration.weeks):1,label:"Quantidade em (Frascos)",sortable:!1}];U("patient");const k=U("curIdentifier"),d=U("prescription"),V=U("showPrescriptionDetails"),R=i=>vt.formatDate(i,"DD-MM-YYYY"),T=()=>{V.value=!1},P=i=>Ma.getCleanDrugById(i),w=$(()=>d.value!==null&&q(d.value)>0?"text-primary":"text-red");return(i,r)=>(o(),I("div",on,[e(ye,{class:"noRadius"},{default:l(()=>[e(he,{class:"bg-green-2"},{default:l(()=>[a("div",nn,_(t(k).service===null||t(k).service===void 0?"Sem Info":t(k).service.code),1)]),_:1}),e(he,{class:"row q-mt-lg"},{default:l(()=>[a("div",rn,[a("div",dn,[un,a("div",cn,_(t(d).prescriptionDate===null||t(d).prescriptionDate===void 0?"Sem Info":R(t(d).prescriptionDate)),1),vn,t(d).prescriptionDetails!==null?(o(),I("div",mn,_(t(d).prescriptionDetails.length>0?t(d).prescriptionDetails[0].therapeuticRegimen===null||t(d).prescriptionDetails[0].therapeuticRegimen===void 0?"Sem Info":t(d).prescriptionDetails[0].therapeuticRegimen.description:""),1)):D("",!0)]),t(d).prescriptionDetails!==null?(o(),I("div",fn,[t(d).prescriptionDetails[0].therapeuticLine!==null?(o(),I("div",pn," Linha Terap\xEAutica: ")):D("",!0),t(d).prescriptionDetails[0].therapeuticLine!==null?(o(),I("div",gn,_(t(d).prescriptionDetails[0].therapeuticLine===null||t(d).prescriptionDetails[0].therapeuticLine===void 0?"Sem Info":t(d).prescriptionDetails[0].therapeuticLine.description),1)):D("",!0),_n,t(d).doctor!==null?(o(),I("div",hn,_(t(d).doctor===null||t(d).doctor===void 0?"Sem Info":t(d).doctor.fullName),1)):D("",!0)])):D("",!0),t(d)!==null?(o(),I("div",yn,[bn,t(d).prescriptionDetails[0].dispenseType!==null?(o(),I("div",wn,_(t(d).prescriptionDetails[0].dispenseType===null||t(d).prescriptionDetails[0].dispenseType===void 0?"Sem Info":t(d).prescriptionDetails[0].dispenseType.description),1)):D("",!0),Sn,a("div",{class:va(["col",w.value])},_(t(d)===null||t(d)===void 0?"Sem Info":t(q)(t(d)))+" mes(es) ",3)])):D("",!0),a("div",Dn,[xn,a("div",Vn,_(t(d)===null||t(d)===void 0||t(d).duration===null?"Sem Info":t(d).duration.description),1),Pn,a("div",kn,_(t(d)===null||t(d)===void 0||t(d).patientStatus===null?"Sem Info":t(d).patientStatus),1)]),a("div",Rn,[qn,a("div",Cn,_(t(d).patientType==="N/A"?"N\xE3o":"Sim"),1),t(d).patientType!=="N/A"?(o(),I("div",An," Motivo de Altera\xE7\xE3o: ")):D("",!0),t(d).patientType!=="N/A"?(o(),I("div",$n,_(t(d).prescriptionDetails[0].reasonForUpdateDesc===null?t(d).prescriptionDetails[0].reasonForUpdate:t(d).prescriptionDetails[0].reasonForUpdateDesc),1)):D("",!0)]),a("div",In,[En,a("div",Tn,_(t(d).prescriptionDetails[0].spetialPrescriptionMotive!==null?"Sim":"N\xE3o"),1),t(d).prescriptionDetails[0].spetialPrescriptionMotive!==null?(o(),I("div",Mn," Motivo da prescri\xE7\xE3o especial: ")):D("",!0),t(d).prescriptionDetails[0].spetialPrescriptionMotive!==null?(o(),I("div",Fn,_(t(d).prescriptionDetails[0].spetialPrescriptionMotive),1)):D("",!0)]),a("div",Nn,[e(It,{dense:"","inline-actions":"",class:"bg-grey-6 text-white q-pa-none"},{default:l(()=>[On]),_:1}),e(Be,{flat:"",bordered:"",dense:"","hide-bottom":"",rows:t(d).prescribedDrugs,columns:x,"row-key":"id"},{body:l(c=>[e(Fe,{"no-hover":"",props:c},{default:l(()=>[e(te,{key:"drug",props:c},{default:l(()=>[B(_(P(c.row.drug.id)!==null&&P(c.row.drug.id)!==void 0?P(c.row.drug.id).name:""),1)]),_:2},1032,["props"]),e(te,{key:"dosage",props:c},{default:l(()=>[B(_("Tomar "+c.row.amtPerTime+" "+P(c.row.drug.id).form!==null&&P(c.row.drug.id).form!==void 0?P(c.row.drug.id).form.description:" "+c.row.timesPerDay+" vez(es) por "+c.row.form),1)]),_:2},1032,["props"]),e(te,{"auto-width":"",key:"packs",props:c},{default:l(()=>[B(_(t(M)(c.row,t(d).duration.weeks)>0?t(M)(c.row,t(d).duration.weeks):1),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows"])])])]),_:1}),e(ue),e(Ne,{align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Fechar",color:"red",onClick:T})]),_:1})]),_:1})]))}};const Yn={class:"col-5 bg-white q-pa-md"},Bn={class:"row"},Ln=a("div",{class:"col text-grey-9 text-weight-medium"}," Data da Prescri\xE7\xE3o: ",-1),zn={class:"col text-grey-8"},Wn=a("div",{class:"col text-grey-9 text-weight-medium"}," Regime Terap\xEAutico: ",-1),Hn={key:0,class:"col text-grey-8"},jn={key:0,class:"row"},Gn={key:0,class:"col text-grey-9 text-weight-medium"},Qn={key:1,class:"col text-grey-8"},Jn=a("div",{class:"col text-grey-10"},"Cl\xEDnico:",-1),Kn={key:2,class:"col text-grey-8"},Zn={key:1,class:"row"},Xn=a("div",{class:"col text-grey-9 text-weight-medium"}," Tipo Dispensa: ",-1),er={key:0,class:"col text-grey-8"},tr=a("div",{class:"col text-grey-9 text-weight-medium"},"Validade:",-1),ar={class:"row"},lr=a("div",{class:"col text-grey-9 text-weight-medium"},"Dura\xE7\xE3o:",-1),sr={class:"col text-grey-8"},ir=a("div",{class:"col text-grey-9 text-weight-medium"}," Tipo Paciente: ",-1),or={class:"col text-grey-8"},nr={class:"row q-my-md"},rr={class:"col q-py-md"},dr={class:"text-bold text-subtitle1 vertical-middle q-pl-md"},ur={class:"q-gutter-x-md"},cr={key:2},vr={__name:"PrescriptionInfoContainer",props:["identifierId"],setup(j){const{website:q,isMobile:A,isOnline:M}=ze(),{closeLoading:x,showloading:k}=ot(),{isProvincialInstalation:d}=Le(),{isCloseEpisode:V,isDCReferenceEpisode:R}=it(),{alertSucess:T,alertError:P,alertInfo:w,alertWarningAction:i}=Qe(),{remainigDuration:r}=jt(),c=n(!0),s=Fa(n(!1)),u=n(!1),g=j,v=U("editPrescriptionOption"),y=U("patient");Pe(()=>{k(),m(),A.value&&!M.value&&Na.get(0)});const m=()=>{Oa.getPatientGroupByPatientId(y.value.id),x()},Z=()=>{let X=!0;(Q.value.tbScreenings.length>0||Q.value.pregnancyScreenings.length>0||Q.value.adherenceScreenings.length>0||Q.value.ramScreenings.length>0||Q.value.vitalSignsScreenings.length>0)&&(X=!1);const K=Ae.getAllPatientVisitByPrescriptioId(ae.value.prescription.id);i("Deseja remover a Dispensa?").then(re=>{if(re)if(X&&K.length<=1){let be=ae.value.pack.id,_e=ae.value.prescription.id,oe=Ae.getAllPatientVisitByPrescriptioId(_e);Ee.delete(Q.value.id).then(Y=>{st.removeFromStorage(be),oe.length<=1&&bt.removeFromStorage(_e),x(),console.log(Y),T("Dispensa removida com sucesso")}).catch(Y=>{x(),console.log(Y),P("Aconteceu um erro ao remover a Dispensa")})}else{let be=ae.value.pack.id;Ae.delete(ae.value.id).then(_e=>{st.removeFromStorage(be),x(),console.log(_e),T("Dispensa removida com sucesso")}).catch(_e=>{x(),console.log(_e),P("Aconteceu um erro ao remover a Dispensa")})}else x(),w("Opera\xE7\xE3o cancelada")})},f=()=>{p.value!==null?P("Esta prescri\xE7\xE3o ja possui registo de dispensas associados, remova primeiro as dispensas."):i("Deseja remover a Prescri\xE7\xE3o?").then(X=>{X?bt.delete(h.value.id).then(K=>{x(),console.log(K),T("Prescri\xE7\xE3o removida com sucesso")}).catch(K=>{x(),console.log(K),P("Aconteceu um erro ao gravar a Prescri\xE7\xE3o")}):(x(),w("Opera\xE7\xE3o cancelada"))})},N=X=>vt.formatDate(X,"DD-MM-YYYY"),W=async X=>{tn.downloadPDF(y.value,X,s)},E=$(()=>Ye.identifierCurr(g.identifierId,"")),b=$(()=>h.value!==null&&r(h.value)>0?"text-primary":"text-red"),p=$(()=>h.value!==null?st.getLastPackFromPatientVisitAndPrescription(h.value.id):null),h=$(()=>ae.value!==null?bt.getLastPrescriptionFromPatientVisitDetails(ae.value.prescription.id):null),Q=$(()=>{const X=[];if(le.value!==null&&le.value!==void 0){const K=Ae.getAllPatientVisitDetailsFromEpisode(le.value.id);return K!=null&&K.forEach(re=>{X.push(re.patient_visit_id)}),Ee.getLastFromPatientVisitList(X)}else if(G.value!==null&&G.value!==void 0){const K=Ae.getAllPatientVisitDetailsFromEpisode(G.value.id);return K!=null&&K.forEach(re=>{X.push(re.patient_visit_id)}),Ee.getLastFromPatientVisitList(X)}else return null}),ae=$(()=>Q.value!==null&&Q.value!==void 0?le.value!==null&&le.value!==void 0?Ae.getLastPatientVisitDetailFromPatientVisitAndEpisode(Q.value.id,le.value.id):Ae.getLastPatientVisitDetailFromPatientVisitAndEpisode(Q.value.id,G.value.id):null),le=$(()=>E.value!==null?me.getLastStartEpisodeWithPrescription(E.value.id):null),G=$(()=>E.value!==null?me.getLastRefferedEpisodeWithPrescription(E.value.id):null),ce=$(()=>E.value!==null?me.lastEpisodeByIdentifier(E.value.id):[]),De=$(()=>ce.value!==null&&V(ce.value)&&!R(ce.value)),ge=$(()=>De.value),Ve=$(()=>Ua.getGroupByPatientAndService(y.value.id,E.value.service.id)),$e=()=>{u.value=!0};return F("lastPackOnPrescription",p),F("isClosed",ge),F("removePack",Z),F("curIdentifier",E),F("prescription",h),F("showPrescriptionDetails",u),F("validadeColor",b),(X,K)=>(o(),I("div",null,[e(mt,{dense:"","header-class":"bg-grey-6 text-white text-bold vertical-middle q-pl-md","expand-icon-class":"text-white","default-opened":E.value.service.code==="TARV"||!t(q)},{header:l(()=>[e(Te,{avatar:""},{default:l(()=>[e(ne,{color:"white",name:"medication"})]),_:1}),e(Te,null,{default:l(()=>[B(_(E.value.service===null||E.value.service===void 0?"Sem Info":E.value.service.code+": "+E.value.value)+" "+_(Ve.value!==null&&Ve.value!==void 0?" - [Paciente esta associado ao Grupo: "+Ve.value.groupType.description+" - "+Ve.value.name+"]":""),1)]),_:1})]),default:l(()=>[xe(a("div",null,[h.value===null||h.value===void 0?(o(),O(ut,{key:0},{default:l(()=>[B("Nenhuma Prescri\xE7\xE3o Adicionada para o servi\xE7o "+_(E.value.service===null||E.value.service===void 0?"Sem Info":E.value.service.code),1)]),_:1})):(o(),O(ye,{key:1,class:"noRadius"},{default:l(()=>[e(he,{class:"row q-pa-none"},{default:l(()=>[a("div",Yn,[a("div",Bn,[Ln,a("div",zn,_(h.value.prescriptionDate===null||h.value.prescriptionDate===void 0?"Sem Info":N(h.value.prescriptionDate)),1),Wn,h.value.prescriptionDetails!==null?(o(),I("div",Hn,_(h.value.prescriptionDetails.length>0?h.value.prescriptionDetails[0].therapeuticRegimen===null||h.value.prescriptionDetails[0].therapeuticRegimen===void 0?"Sem Info":h.value.prescriptionDetails[0].therapeuticRegimen.description:""),1)):D("",!0)]),h.value.prescriptionDetails!==null&&h.value.prescriptionDetails!==void 0&&h.value.prescriptionDetails.length!==0?(o(),I("div",jn,[h.value.prescriptionDetails[0].therapeuticLine!==null&&h.value.prescriptionDetails[0].therapeuticLine!==void 0?(o(),I("div",Gn," Linha Terap\xEAutica: ")):D("",!0),h.value.prescriptionDetails[0].therapeuticLine!==null&&h.value.prescriptionDetails[0].therapeuticLine!==void 0?(o(),I("div",Qn,_(h.value.prescriptionDetails[0].therapeuticLine===null||h.value.prescriptionDetails[0].therapeuticLine===void 0?"Sem Info":h.value.prescriptionDetails[0].therapeuticLine.description),1)):D("",!0),Jn,h.value.doctor!==null?(o(),I("div",Kn,_(h.value.doctor===null||h.value.doctor===void 0?"Sem Info":h.value.doctor.fullName),1)):D("",!0)])):D("",!0),h.value!==null&&h.value.prescriptionDetails!==void 0&&h.value.prescriptionDetails.length!==0?(o(),I("div",Zn,[Xn,h.value.prescriptionDetails[0].dispenseType!==null?(o(),I("div",er,_(h.value.prescriptionDetails[0].dispenseType===null||h.value.prescriptionDetails[0].dispenseType===void 0?"Sem Info":h.value.prescriptionDetails[0].dispenseType.description),1)):D("",!0),tr,a("div",{class:va(["col",b.value])},_(h.value===null||h.value===void 0?"Sem Info":t(r)(h.value))+" mes(es) ",3)])):D("",!0),a("div",ar,[lr,a("div",sr,_(h.value===null||h.value===void 0||h.value.duration===null?"Sem Info":h.value.duration.description),1),ir,a("div",or,_(h.value===null||h.value===void 0||h.value.patientStatus===null?"Sem Info":h.value.patientStatus),1)]),e(ue),a("div",nr,[e(fa),e(J,{unelevated:"",color:"blue",label:"Ver Detalhes",onClick:$e,class:"float-right q-ml-sm"}),ge.value?D("",!0):(o(),O(J,{key:0,unelevated:"",color:"red",label:"Remover",onClick:K[0]||(K[0]=re=>f()),class:"float-right q-ml-sm"}))])]),a("div",rr,[h.value!==null?(o(),O(It,{key:0,dense:"","inline-actions":"",class:"bg-primary text-white q-pa-none"},{action:l(()=>[a("div",ur,[e(J,{dense:"",flat:"",loading:s,color:"white",icon:"print",label:E.value.service.code==="TARV"?"FILA":E.value.service.code==="TPT"?"FILT":E.value.service.code==="PREP"?"FILP":"Ficha",onClick:K[1]||(K[1]=re=>W(E.value))},null,8,["loading","label"]),!ge.value&&t(r)(h.value)>0&&!t(d)()?(o(),O(J,{key:0,dense:"",flat:"",round:"",color:"white",icon:"add",class:"float-right",onClick:t(v)},null,8,["onClick"])):D("",!0)])]),default:l(()=>[a("span",dr,[Wt(X.$slots,"default",{},()=>[B(" Dispensa")])])]),_:3})):D("",!0),p.value===null?(o(),O(ut,{key:1},{default:l(()=>[B("Nenhum registo de Levantamentos")]),_:1})):(o(),I("span",cr,[e(Xo)]))])]),_:3})]),_:3}))],512),[[dt,c.value]])]),_:3},8,["default-opened"]),e(ue),e(ke,{persistent:"",modelValue:u.value,"onUpdate:modelValue":K[2]||(K[2]=re=>u.value=re)},{default:l(()=>[e(Un)]),_:1},8,["modelValue"])]))}},mr={key:1},ra={__name:"PrescriptionInfo",setup(j){const{hasEpisodes:q,hasOneAndClosedIdentifier:A,hasNoObitOrTransferedForEpisode:M}=Me(),{isProvincialInstalation:x,isProvincialInstalationPharmacysMode:k,isProvincialInstalationMobileClinic:d}=Le(),{closeLoading:V,showloading:R}=ot(),T=n(!1),P=n(!1),w=n("Prescri\xE7\xE3o"),i=n("Nenhuma Prescri\xE7\xE3o Adicionada"),r=n("bg-primary"),c=U("patient");Pe(()=>{R(),y()});const s=$(()=>u.value&&!g.value),u=$(()=>q(c.value)),g=$(()=>A(c.value)),v=$(()=>{if(q(c.value))return!!M(c.value)}),y=async()=>{V()},m=()=>{P.value=!0,T.value=!0},Z=()=>{P.value=!1,T.value=!0},f=()=>{T.value=!1};return F("title",w),F("bgColor",r),F("addVisible",s),F("titleEmptyList",i),F("isNewPrescription",P),F("showAddPrescription",T),F("editPrescriptionOption",Z),F("closePrescriptionOption",f),(N,W)=>(o(),I("div",null,[e(xt,{addButtonActions:m,mainContainer:!0,bgColor:"bg-primary","add-visible":v.value&&(!t(x)()||t(k)()||t(d)()),expandVisible:!1,title:w.value},null,8,["add-visible","title"]),a("div",null,[u.value?(o(),I("div",mr,[(o(!0),I(St,null,Dt(t(c).identifiers,E=>(o(),O(vr,{key:E.id,identifierId:E.id},null,8,["identifierId"]))),128))])):(o(),O(ut,{key:0})),e(ke,{persistent:"",modelValue:T.value,"onUpdate:modelValue":W[0]||(W[0]=E=>T.value=E)},{default:l(()=>[e(Ho)]),_:1},8,["modelValue"])])]))}};const fr={class:"q-pa-md"},pr={class:"row items-center justify-end"},_a={__name:"TbQuestionsTable",setup(j){const q=[{name:"question",required:!0,label:"Perguntas de Rastreio de Tuberculose",align:"left",field:s=>s.question,format:s=>`${s}`},{name:"sim",label:"Sim",field:s=>s.answer,align:"right"},{name:"nao",label:"N\xE3o",field:s=>s.answer,align:"left"}],A=[{name:"question",required:!0,label:"Sinais e Sintomas sugestivos a TB",align:"left",field:s=>s.question,format:s=>`${s}`},{name:"sim",label:"Sim",field:s=>s.answer,align:"right"},{name:"nao",label:"N\xE3o",field:s=>s.answer,align:"left"}],M=n([{question:"Est\xE1 Actualmente em tratamento Profil\xE1tico com Isoniazida(TPI)?",answer:!1,code:"01"},{question:"Est\xE1 em tratamento de tuberculose(TB)?",answer:!1,code:"02"},{question:"",answer:!0,code:"03",date:""}]),x=n([{question:"Est\xE1 com tosse a duas semanas?",answer:!1,code:"04"},{question:"Teve febres nas ultimas duas semanas ?",answer:!1,code:"05"},{question:"Perdeu peso >1.5 kg no ultimo m\xEAs?",answer:!1,code:"06"},{question:"Tem suado muito a noite?",answer:!1,code:"07"},{question:"Teve cansaco ou fadiga nas ultimas duas semanas ?",answer:!1,code:"08"},{question:"Tem um parente em casa que est\xE1 a fazer tratamento de TB ?",answer:!1,code:"09"}]),k=n("horizontal"),d=U("onlyView"),V=U("tBScreening"),R=U("showPatientVisit"),T=U("closeButtonActions");Pe(()=>{c()});const P=$(()=>V!=null?V.value:R.value.tbScreenings[0]),w=$(()=>V!=null?V.value.treatmentTB==="true"||V.value.treatmentTB===!0:P.value.treatmentTB===!0||P.value.treatmentTB==="true"),i=s=>s<=ve().format("YYYY/MM/DD"),r=s=>{switch(s.code){case"01":V.value.treatmentTPI=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"02":V.value.treatmentTB=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"03":V.value.treatmentTB==="true"||V.value.treatmentTB===!0?V.value.startTreatmentDate=ve(s.date).format("YYYY-MM-DD"):V.value.startTreatmentDate="";break;case"04":V.value.cough=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"05":V.value.fever=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"06":V.value.losingWeight=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"07":V.value.sweating=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"08":V.value.fatigueOrTirednessLastTwoWeeks=s.answer==="true"?!0:s.answer==="false"?!1:"";break;case"09":V.value.parentTBTreatment=s.answer==="true"?!0:s.answer==="false"?!1:"";break;default:console.log("Sorry, we are out of .")}},c=()=>{P.value!==null&&P.value!==void 0?(M.value.forEach(s=>{s.code==="01"&&(s.answer=String(P.value.treatmentTPI)),s.code==="02"&&(s.answer=String(P.value.treatmentTB)),(P.value.treatmentTB===!0||P.value.treatmentTB==="true")&&s.code==="03"&&(s.date=P.value.startTreatmentDate)}),x.value.forEach(s=>{s.code==="04"&&(s.answer=String(P.value.cough)),s.code==="05"&&(s.answer=String(P.value.fever)),s.code==="06"&&(s.answer=String(P.value.losingWeight)),s.code==="07"&&(s.answer=String(P.value.sweating)),s.code==="08"&&(s.answer=String(P.value.fatigueOrTirednessLastTwoWeeks)),s.code==="09"&&(s.answer=String(P.value.parentTBTreatment))})):(M.value.forEach(s=>{s.code==="01"&&(s.answer=!1),s.code==="02"&&(s.answer=!1),s.code==="03"&&(s.date="")}),x.value.forEach(s=>{s.code==="04"&&(s.answer=!1),s.code==="05"&&(s.answer=!1),s.code==="06"&&(s.answer=!1),s.code==="07"&&(s.answer=!1),s.code==="08"&&(s.answer=!1),s.code==="09"&&(s.answer=!1)}))};return(s,u)=>(o(),I("div",fr,[e(Be,{title:"Rastreio de Tuberculose",rows:M.value,columns:q,"row-key":"question",separator:k.value,"rows-per-page-options":[0],"virtual-scroll":"","hide-bottom":"","table-header-class":"text-white",class:"my-sticky-header-table","title-class":"text-bold text-white"},{body:l(g=>[e(Fe,{props:g},{default:l(()=>[g.row.code!=="03"?(o(),O(te,{key:"question"},{default:l(()=>[B(_(g.row.question),1)]),_:2},1024)):D("",!0),g.row.code==="03"&&w.value===!0?(o(),O(te,{key:"date"},{default:l(()=>[e(se,{dense:"",outlined:"",class:"col",modelValue:g.row.date,"onUpdate:modelValue":[v=>g.row.date=v,v=>r(g.row)],rules:["date"],disable:t(d),label:"Data de Inicio de Tratamento de Tuberculose"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:g.row.date,"onUpdate:modelValue":[v=>g.row.date=v,v=>r(g.row)],options:i,mask:"YYYY-MM-DD"},{default:l(()=>[a("div",pr,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),g.row.code!=="03"?(o(),O(te,{key:"answer",align:"right"},{default:l(()=>[e(Se,{modelValue:g.row.answer,"onUpdate:modelValue":[v=>g.row.answer=v,v=>r(g.row)],val:"true",disable:t(d)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),g.row.code!=="03"?(o(),O(te,{key:"answer",align:"left"},{default:l(()=>[e(Se,{modelValue:g.row.answer,"onUpdate:modelValue":[v=>g.row.answer=v,v=>r(g.row)],val:"false",disable:t(d)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","separator"]),e(Be,{rows:x.value,columns:A,"row-key":"question",separator:k.value,"rows-per-page-options":[0],"virtual-scroll":"","hide-bottom":"","table-header-class":"text-white",class:"my-sticky-header-table","title-class":"text-white"},{body:l(g=>[e(Fe,{props:g},{default:l(()=>[e(te,{key:"question"},{default:l(()=>[B(_(g.row.question),1)]),_:2},1024),e(te,{key:"answer",align:"right"},{default:l(()=>[e(Se,{modelValue:g.row.answer,"onUpdate:modelValue":[v=>g.row.answer=v,v=>r(g.row)],val:"true",disable:t(d)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024),e(te,{key:"answer",align:"left"},{default:l(()=>[e(Se,{modelValue:g.row.answer,"onUpdate:modelValue":[v=>g.row.answer=v,v=>r(g.row)],val:"false",disable:t(d)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","separator"]),e(ye,null,{default:l(()=>[t(d)?(o(),O(Ne,{key:0,align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Sair",color:"red",onClick:u[0]||(u[0]=g=>t(T)()),align:"right"})]),_:1})):D("",!0)]),_:1})]))}};const gr={class:"q-pa-md",style:{width:"900px","max-width":"90vw"}},_r={class:"row items-center justify-end"},ha={__name:"PregnancyQuestionsTable",setup(j){const q=[{name:"question",required:!0,label:"Perguntas de Rastreio de Gravidez",align:"left",field:r=>r.question,format:r=>`${r}`},{name:"sim",label:"Sim",field:r=>r.completed,align:"right"},{name:"nao",label:"N\xE3o",field:r=>r.completed,align:"left"}],A=n([{question:"Est\xE1 gravida?",completed:!1,code:"01"},{question:"Teve menstrua\xE7\xE3o nos ultimos meses?",completed:!1,code:"02"},{question:"",completed:!0,code:"03",date:""}]),M=n(""),x=n("horizontal"),k=U("pregnancyScreening"),d=U("onlyView"),V=U("closeButtonActions"),R=U("showPatientVisit");Pe(()=>{i()});const T=$(()=>k!=null?k.value:R.value.pregnancyScreenings[0]),P=r=>r<=ve().format("YYYY/MM/DD"),w=r=>{switch(r.code){case"01":k.value.pregnant=r.completed,r.completed==="true"||r.completed===!0?M.value=!1:M.value=!0;break;case"02":k.value.menstruationLastTwoMonths=r.completed;break;case"03":k.value.pregnant==="false"||k.value.pregnant===!1?k.value.lastMenstruation=new Date(r.date):k.value.lastMenstruation="";break;default:console.log("Sorry, we are out of .")}},i=()=>{T.value&&(M.value=!T.value.pregnant,A.value.forEach(r=>{r.code==="01"&&(r.completed=String(T.value.pregnant)),r.code==="02"&&(r.completed=String(T.value.menstruationLastTwoMonths)),r.code==="03"&&(r.date=T.value.lastMenstruation)}))};return(r,c)=>(o(),I("div",gr,[e(Be,{title:"Rasterio de Gravidez",rows:A.value,columns:q,"row-key":"question",separator:x.value,"rows-per-page-options":[0],"virtual-scroll":"","hide-bottom":"","table-header-class":"text-white",class:"my-sticky-header-table","title-class":"text-bold text-white"},{body:l(s=>[e(Fe,{props:s},{default:l(()=>[e(te,{key:"question"},{default:l(()=>[B(_(s.row.question),1)]),_:2},1024),s.row.code!=="03"?(o(),O(te,{key:"completed",align:"right"},{default:l(()=>[e(Se,{modelValue:s.row.completed,"onUpdate:modelValue":[u=>s.row.completed=u,u=>w(s.row)],val:"true",disable:t(d)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),s.row.code!=="03"?(o(),O(te,{key:"completed",align:"left"},{default:l(()=>[e(Se,{modelValue:s.row.completed,"onUpdate:modelValue":[u=>s.row.completed=u,u=>w(s.row)],val:"false",disable:t(d)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),s.row.code==="03"&&M.value===!0?(o(),O(te,{key:"date"},{default:l(()=>[e(se,{dense:"",outlined:"",class:"col",modelValue:s.row.date,"onUpdate:modelValue":[u=>s.row.date=u,u=>w(s.row)],mask:"date",rules:["date"],label:"Data da Ultima Menstrua\xE7\xE3o",disable:t(d)},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:s.row.date,"onUpdate:modelValue":[u=>s.row.date=u,u=>w(s.row)],options:P},{default:l(()=>[a("div",_r,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","separator"]),e(ye,null,{default:l(()=>[t(d)?(o(),O(Ne,{key:0,align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Sair",color:"red",onClick:c[0]||(c[0]=s=>t(V)()),align:"right"})]),_:1})):D("",!0)]),_:1})]))}};const hr={class:"q-pa-md",style:{width:"900px","max-width":"90vw"}},ya={__name:"MonitoringReinforcementAdherinTable",setup(j){const q=[{name:"question",required:!0,label:"Perguntas de Monitoria e Refor\xE7o a Ades\xE3o",align:"left",field:r=>r.question,format:r=>`${r}`},{name:"sim",label:"Sim",field:r=>r.completed,align:"right"},{name:"nao",label:"N\xE3o",field:r=>r.completed,align:"left"}],A=n([{question:"O paciente veio na data marcada ?",completed:!1,code:"01"},{question:"Se n\xE3o, quantos dias de atraso completou o paciente ?",completed:!1,code:"02",days:""},{question:"Nos ultimos 2 meses teria se esquecido de tomar os seus medicamentos algum dia na sua hora habitual ?",completed:!1,code:"03",date:""},{question:"Quantos dias passou da hora sem tomar os medicamentos ?",completed:!1,code:"04",days:""},{question:"",completed:!1,code:"05",date:"",text:""}]),M=n("horizontal"),x=U("adherenceScreening"),k=U("onlyView"),d=U("closeButtonActions"),V=U("showPatientVisit");Pe(()=>{i()});const R=$(()=>x!=null?x.value:V.value.adherenceScreenings[0]),T=$(()=>x!=null?x.value.patientForgotMedicine==="true"||x.value.patientForgotMedicine===!0:R.value.patientForgotMedicine==="true"||R.value.patientForgotMedicine===!0),P=$(()=>x!=null?!(x.value.hasPatientCameCorrectDate==="true"||x.value.hasPatientCameCorrectDate===!0):!(R.value.hasPatientCameCorrectDate==="true"||R.value.hasPatientCameCorrectDate===!0)),w=r=>{switch(r.code){case"01":x.value.hasPatientCameCorrectDate=r.completed,(P.value===!1||P.value==="false")&&(x.value.daysWithoutMedicine=0);break;case"02":x.value.hasPatientCameCorrectDate==="false"||x.value.hasPatientCameCorrectDate===!1?x.value.daysWithoutMedicine=r.days:x.value.daysWithoutMedicine=0;break;case"03":x.value.patientForgotMedicine=r.completed,(T.value===!1||T.value==="false")&&(x.value.lateDays=0);break;case"04":x.value.patientForgotMedicine==="true"||x.value.patientForgotMedicine===!0?x.value.lateDays=r.days:x.value.lateDays=0;break;case"05":x.value.lateMotives=r.text;break;default:console.log("Sorry, we are out of .")}},i=()=>{R.value&&(A.value.forEach(r=>{r.code==="01"&&(r.completed=String(R.value.hasPatientCameCorrectDate)),r.code==="02"&&(r.days=R.value.daysWithoutMedicine),r.code==="03"&&(r.completed=String(R.value.patientForgotMedicine)),r.code==="04"&&(r.days=R.value.lateDays),r.code==="05"&&(r.text=R.value.lateMotives)}),R.value.hasPatientCameCorrectDate||(P.value=!0),R.value.patientForgotMedicine&&(T.value=!0))};return(r,c)=>(o(),I("div",hr,[e(Be,{title:"Monitoria e Refor\xE7o de Ades\xE3o",rows:A.value,columns:q,"row-key":"question",separator:M.value,"rows-per-page-options":[0],"virtual-scroll":"","hide-bottom":"","table-header-class":"text-white",class:"my-sticky-header-table","title-class":"text-bold text-white"},{body:l(s=>[e(Fe,{props:s},{default:l(()=>[s.row.code==="01"||s.row.code=="03"?(o(),O(te,{key:"question"},{default:l(()=>[B(_(s.row.question),1)]),_:2},1024)):D("",!0),s.row.code==="02"&&P.value||s.row.code==="04"&&T.value?(o(),O(te,{key:"question",align:"left"},{default:l(()=>[B(_(s.row.question),1)]),_:2},1024)):D("",!0),s.row.code!=="02"&&s.row.code!=="04"&&s.row.code!=="05"?(o(),O(te,{key:"completed",align:"right"},{default:l(()=>[e(Se,{modelValue:s.row.completed,"onUpdate:modelValue":[u=>s.row.completed=u,u=>w(s.row)],val:"true",disable:t(k)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),s.row.code!=="02"&&s.row.code!=="04"&&s.row.code!=="05"?(o(),O(te,{key:"completed",align:"left"},{default:l(()=>[e(Se,{modelValue:s.row.completed,"onUpdate:modelValue":[u=>s.row.completed=u,u=>w(s.row)],val:"false",disable:t(k)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),s.row.code==="02"&&P.value||s.row.code==="04"&&T.value?(o(),O(te,{key:"days",align:"left"},{default:l(()=>[s.row.code==="02"&&P.value?(o(),O(se,{key:0,disable:t(k),modelValue:s.row.days,"onUpdate:modelValue":[u=>s.row.days=u,u=>w(s.row)],modelModifiers:{number:!0},type:"number"},null,8,["disable","modelValue","onUpdate:modelValue"])):D("",!0),s.row.code==="04"&&T.value?(o(),O(se,{key:1,disable:t(k),modelValue:s.row.days,"onUpdate:modelValue":[u=>s.row.days=u,u=>w(s.row)],modelModifiers:{number:!0},type:"number"},null,8,["disable","modelValue","onUpdate:modelValue"])):D("",!0)]),_:2},1024)):D("",!0),s.row.code==="05"&&T.value?(o(),O(te,{key:"question"},{default:l(()=>[t(k)?D("",!0):(o(),O(se,{key:0,filled:"",modelValue:s.row.text,"onUpdate:modelValue":[u=>s.row.text=u,u=>w(s.row)],label:"Motivos"},null,8,["modelValue","onUpdate:modelValue"])),t(k)?(o(),O(se,{key:1,disable:t(k),filled:"",modelValue:s.row.text,"onUpdate:modelValue":[u=>s.row.text=u,u=>w(s.row)],label:"Motivos"},null,8,["disable","modelValue","onUpdate:modelValue"])):D("",!0)]),_:2},1024)):D("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","separator"]),e(ye,null,{default:l(()=>[t(k)?(o(),O(Ne,{key:0,align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Sair",color:"red",onClick:c[0]||(c[0]=s=>t(d)()),align:"right"})]),_:1})):D("",!0)]),_:1})]))}};const yr={class:"q-pa-md",style:{width:"900px","max-width":"90vw"}},ba={__name:"AdverseReactionQuestiosTable",setup(j){const q=[{name:"question",required:!0,label:"Perguntas de Rastreio de Reac\xE7\xF5es Adversas aos Medicamentos",align:"left",field:i=>i.question,format:i=>`${i}`},{name:"sim",label:"Sim",field:i=>i.completed,align:"right"},{name:"nao",label:"N\xE3o",field:i=>i.completed,align:"left"}],A=n([{question:"Tem alguma rea\xE7\xE3o adversa que acha que e causada pelos medicamentos ?",completed:!1,code:"01"},{question:"",completed:!1,code:"02",text:""}]),M=n("horizontal"),x=U("onlyView"),k=U("rAMScreening"),d=U("closeButtonActions"),V=U("showPatientVisit");Pe(()=>{w()});const R=$(()=>k!=null?k.value:V.value.ramScreenings[0]),T=$(()=>k!=null?k.value.adverseReactionMedicine==="true":R.value.adverseReactionMedicine===!0),P=i=>{switch(i.code){case"01":k.value.adverseReactionMedicine=i.completed,T.value||(k.value.adverseReaction="");break;case"02":k.value.adverseReaction=i.text;break;default:console.log("Sorry, we are out of .")}},w=()=>{R.value&&A.value.forEach(i=>{i.code==="01"&&(i.completed=String(R.value.adverseReactionMedicine),R.value.adverseReactionMedicine===!0?T.value=!0:T.value=!1),i.code==="02"&&(i.text=R.value.adverseReaction)})};return(i,r)=>(o(),I("div",yr,[e(Be,{title:"Rea\xE7\xF5es Adversas aos Medicamentos",rows:A.value,columns:q,"row-key":"question",separator:M.value,"rows-per-page-options":[0],"virtual-scroll":"","hide-bottom":"",class:"my-sticky-header-table","table-header-class":"text-white","title-class":"text-bold text-white"},{body:l(c=>[e(Fe,{props:c},{default:l(()=>[c.row.code!=="02"?(o(),O(te,{key:"question"},{default:l(()=>[B(_(c.row.question),1)]),_:2},1024)):D("",!0),c.row.code==="02"?(o(),O(te,{key:"question"},{default:l(()=>[T.value?(o(),O(se,{key:0,filled:"",modelValue:c.row.text,"onUpdate:modelValue":[s=>c.row.text=s,s=>P(c.row)],label:" Descreva brevemente a rea\xE7\xE3o?",disable:t(x)},null,8,["modelValue","onUpdate:modelValue","disable"])):D("",!0)]),_:2},1024)):D("",!0),c.row.code==="01"?(o(),O(te,{key:"completed",align:"right"},{default:l(()=>[e(Se,{modelValue:c.row.completed,"onUpdate:modelValue":[s=>c.row.completed=s,s=>P(c.row)],val:"true",align:"right",disable:t(x)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0),c.row.code==="01"?(o(),O(te,{key:"completed",align:"left"},{default:l(()=>[e(Se,{modelValue:c.row.completed,"onUpdate:modelValue":[s=>c.row.completed=s,s=>P(c.row)],val:"false",align:"left",disable:t(x)},null,8,["modelValue","onUpdate:modelValue","disable"])]),_:2},1024)):D("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","separator"]),e(ye,null,{default:l(()=>[t(x)?(o(),O(Ne,{key:0,align:"right",class:"q-mb-md q-mr-sm"},{default:l(()=>[e(J,{label:"Sair",color:"red",onClick:r[0]||(r[0]=c=>t(d)()),align:"right"})]),_:1})):D("",!0)]),_:1})]))}},br={class:"row items-center text-subtitle1 q-pa-md"},wr={class:"text-bold text-grey-10 q-ml-sm"},Sr={class:"text-grey-10 q-ml-sm"},Dr=a("span",{class:"text-bold text-h6"},"|",-1),xr={key:0,class:"text-grey-10 q-ml-sm"},Vr={class:"text-bold text-h6"},Pr={key:1,class:"text-grey-10 q-ml-sm"},kr=a("span",{class:"text-bold text-h6"},"|",-1),Rr=a("div",{class:"text-center text-h6 q-mt-sm"},"Aten\xE7\xE3o Farmac\xEAutica",-1),qr={class:"text-left text-h7 bold q-ml-sm q-pa-md q-my-lg"},Cr={class:"row items-center justify-end"},Ar={class:"q-mx-lg"},$r={class:"row q-mt-md"},Ir={class:"row q-mt-md"},Er={class:"row q-mt-md"},Tr={__name:"AddEditPharmaceuticalAtention",setup(j){const{alertSucess:q,alertError:A}=Qe(),{age:M,fullName:x,hasIdentifiers:k,getOldestIdentifier:d,isMale:V}=Me(),{getDDMMYYYFromJSDate:R,getJSDateFromDDMMYYY:T}=et();Le();const{isMobile:P,isOnline:w}=ze(),i=n(new At({id:fe()})),r=n(new Zt({id:fe()})),c=n(new Xt({id:fe()})),s=n(new ea({id:fe()})),u=n(new ta({id:fe()})),g=n(new aa({id:fe()})),v=n(n(1)),y=n(""),m=n(),Z=n(""),f=n(""),N=n(""),W=n(""),E=n(!1),b=n(!1),p=n({backgroundColor:"#ffffff",color:"#555"}),h=n({backgroundColor:"#eee",color:"black"}),Q=n({right:"2px",borderRadius:"5px",backgroundColor:"#0ba58b",width:"5px",opacity:.75}),ae=U("showPatientVisit"),le=U("editMode"),G=U("patient"),ce=U("closeButtonActions"),De=U("onlyView");Pe(()=>{i.value.origin=ge.value.id,r.value.origin=ge.value.id,c.value.origin=ge.value.id,s.value.origin=ge.value.id,u.value.origin=ge.value.id,g.value.origin=ge.value.id,le.value?(i.value=ae.value,y.value=R(ae.value.visitDate),ae.value.vitalSignsScreenings.length>0?r.value=ae.value.vitalSignsScreenings[0]:r.value=new Zt({id:fe()}),ae.value.tbScreenings.length>0?c.value=ae.value.tbScreenings[0]:c.value=new Xt({id:fe()}),s.value=V(G.value)?[]:ae.value.pregnancyScreenings.length>0?ae.value.pregnancyScreenings[0]:new ea({id:fe()}),u.value=ae.value.adherenceScreenings.length>0?ae.value.adherenceScreenings[0]:new ta({id:fe()}),g.value=ae.value.ramScreenings.length>0?ae.value.ramScreenings[0]:new aa({id:fe()}),r.value.visit=null,c.value.visit=null,s.value.visit=null,g.value.visit=null,u.value.visit=null):y.value=R(ve())});const ge=$(()=>He.currClinic()),Ve=$(()=>{let oe="";const Y=r.value.imc;return Y==null||String(Y).length===0?oe="":Y<=Number(16.9)?oe="Muito abaixo do peso":Y>=Number(17)&&Y<=Number(18.4)?oe="Abaixo do peso":Y>=Number(18.5)&&Y<=Number(24.9)?oe="Peso normal":Y>=Number(25)&&Y<=Number(29.9)?oe="Acima do peso":Y>=Number(30)&&Y<=Number(34.9)?oe="Obesidade Grau I":Y>=Number(35)&&Y<=Number(39.9)?oe="Obesidade Grau II":Y>=Number(40)&&(oe="Obesidade M\xF3rbida"),oe}),$e=oe=>oe<=ve().format("YYYY/MM/DD"),X=()=>{E.value=!1},K=async()=>{E.value=!0,v.value===1?(Z.value.validate(),f.value.validate(),N.value.validate(),W.value.validate(),y.value===""?(A("Por Favor Preencha data de consulta"),X()):T(y.value).setHours(0,0,0,0)<new Date(G.value.dateOfBirth).setHours(0,0,0,0)?(A("A data de consulta indicada \xE9 maior que a data de nascimento do paciente/utente"),X()):k(G.value)&&new Date(d(G.value).startDate).setHours(0,0,0,0)>T(y.value).setHours(0,0,0,0)?(A("A data da consulta indicada \xE9 menor que a data da admiss\xE3o ao servi\xE7o se sa\xFAde [ "+d(G.value).service.code+" ]"),X()):b.value&&!le.value?(A("J\xE1 Existe uma Aten\xE7\xE3o farmc\xEAutica nessa data .Por Favor use a funcionalidade editar"),X()):r.value.height<=0?(A("Por favor indique uma altura maior que zero "),X()):r.value.weight<=0?(A("Por favor indique um peso maior que zero "),X()):r.value.systole<=0||r.value.distort<=0?(A("Por favor indique um sistole ou diastole maior que zero "),X()):(!Z.value.hasError&&!f.value.hasError&&!N.value.hasError&&!W.value.hasError&&m.value.next(),X()),X()):v.value===2?c.value.treatmentTB==="true"&&c.value.startTreatmentDate===""?A("Deve Preencher a Data de inicio de Tratamento uma vez que esta em Tratamento TB."):c.value.startTreatmentDate&&new Date(c.value.startTreatmentDate)>new Date?A("A Data de inicio de Tratamento indicada \xE9 maior que a data da corrente."):G.value.gender==="Masculino"?(m.value.goTo(4),X()):(m.value.next(),X()):v.value===3?s.value.pregnant==="false"&&s.value.lastMenstruation===""?A("Deve Preencher a Data da Ultima Menstrua\xE7\xE3o."):s.value.lastMenstruation&&new Date(s.value.lastMenstruation)>new Date?A("A Data da Ultima Menstrua\xE7\xE3o indicada \xE9 maior que a data da corrente."):(m.value.next(),X()):v.value===4?u.value.hasPatientCameCorrectDate==="false"&&u.value.daysWithoutMedicine===""||u.value.hasPatientCameCorrectDate==="false"&&u.value.daysWithoutMedicine<=0?(A("Por Favor Indique quantos dias de atraso completou o paciente"),X()):u.value.patientForgotMedicine==="true"&&u.value.lateDays===""||u.value.patientForgotMedicine==="true"&&u.value.lateDays<=0?(A("Por Favor Indique quantos dias passou da hora sem tomar os Medicamentos"),X()):(m.value.next(),X()):v.value===5&&(g.value.adverseReactionMedicine==="true"&&g.value.adverseReaction===""?(A("Por Favor Indique as rea\xE7\xF5es adversas"),X()):((c.value.id===null||c.value.id===void 0)&&(c.value.id=fe()),r.value.distort!==null&&r.value.distort!==void 0&&r.value.distort!==""&&(i.value.vitalSignsScreenings.length===0?i.value.vitalSignsScreenings.push(r.value):i.value.vitalSignsScreenings[0]=r.value),c.value.cough!==null&&c.value.cough!==void 0&&c.value.cough!==""&&(i.value.tbScreenings.length===0?i.value.tbScreenings.push(c.value):i.value.tbScreenings[0]=c.value),s.value.pregnant!==null&&s.value.pregnant!==void 0&&s.value.pregnant!==""&&(i.value.pregnancyScreenings.length===0?i.value.pregnancyScreenings.push(s.value):i.value.pregnancyScreenings[0]=s.value),u.value.hasPatientCameCorrectDate!==null&&u.value.hasPatientCameCorrectDate!==void 0&&u.value.hasPatientCameCorrectDate!==""&&(i.value.adherenceScreenings.length===0?i.value.adherenceScreenings.push(u.value):i.value.adherenceScreenings[0]=u.value),g.value.adverseReactionMedicine!==null&&g.value.adverseReactionMedicine!==void 0&&g.value.adverseReactionMedicine!==""&&(i.value.ramScreenings.length===0?i.value.ramScreenings.push(g.value):i.value.ramScreenings[0]=g.value),i.value.clinic=G.value.clinic,i.value.clinic_id=G.value.clinic.id,i.value.patient=G.value,i.value.visitDate=T(y.value),i.value.vitalSignsScreenings.length>1&&i.value.vitalSignsScreenings.pop(),i.value.tbScreenings.length>1&&i.value.tbScreenings.pop(),i.value.pregnancyScreenings.length>1&&i.value.pregnancyScreenings.pop(),i.value.adherenceScreenings.length>1&&i.value.adherenceScreenings.pop(),i.value.ramScreenings.length>1&&i.value.ramScreenings.pop(),i.value.clinic={},i.value.clinic.id=G.value.clinic_id,i.value.patient={},i.value.patient.id=G.value.id,i.value.patient_id=G.value.id,i.value.patientId=G.value.id,P.value&&!w.value&&(i.value.syncStatus===""||i.value.syncStatus==="R"?i.value.syncStatus="R":i.value.syncStatus==="S"&&(i.value.syncStatus="U")),re(!le.value)))},re=oe=>{oe?Ee.post(i.value).then(()=>{q("Aten\xE7\xE3o Farmaceutica efectuada com sucesso"),X(),ce()}).catch(Y=>{console.log("Erro",Y),A("Aconteceu um erro ao gravar a Aten\xE7\xE3o Farmaceutica"),X()}):Ee.patch(i.value.id,i.value).then(()=>{q("Aten\xE7\xE3o Farmaceutica actualizada com sucesso"),X(),ce()}).catch(()=>{A("Aconteceu um erro ao actualizar a Aten\xE7\xE3o Farmaceutica"),X()})},be=()=>{r.value.height!==0&&r.value.weight!==0&&(r.value.imc=(r.value.weight/(r.value.height*r.value.height)).toFixed(1))},_e=()=>{const oe=Ee.getAllWithVitalSignByPatientId(G.value.id);for(const Y of oe)if(new Date(Y.visitDate).getTime()===T(y).getTime()&&Y.vitalSignsScreenings.length>0){b.value=!0;break}else new Date(Y.visitDate).getTime()===T(y).getTime()&&Y.vitalSignsScreenings.length===0&&(i.value=Y),b.value=!1};return F("vitalSignsScreening",r),F("tBScreening",c),F("pregnancyScreening",s),F("adherenceScreening",u),F("rAMScreening",g),(oe,Y)=>(o(),O(ye,{style:{"max-width":"100vw"}},{default:l(()=>[a("form",{onSubmit:Y[14]||(Y[14]=ct((...H)=>oe.submitMobilizer&&oe.submitMobilizer(...H),["prevent"]))},[e(he,{class:"q-pa-none bg-green-2"},{default:l(()=>[a("div",br,[e(ne,{name:t(G).gender=="Feminino"?"female":"male",size:"md",color:"primary"},null,8,["name"]),a("div",wr,_(t(x)(t(G))),1),a("div",Sr,[Dr,B(" "+_(t(G).gender),1)]),t(M)(t(G))<=14?(o(),I("div",xr,[a("span",Vr,[B(" | "),e(ne,{name:"child_care"})]),B(" "+_(t(M)(t(G)))+" Ano(s) de Idade ",1)])):(o(),I("div",Pr,[kr,B(" "+_(t(M)(t(G)))+" Anos de Idade ",1)]))]),e(ue)]),_:1}),Rr,e(lt,{"thumb-style":Q.value,"content-style":p.value,"content-active-style":h.value,style:{height:"600px",width:"1200px"},class:"q-pr-md"},{default:l(()=>[a("div",qr,[e(se,{dense:"",outlined:"",style:{width:"350px"},modelValue:y.value,"onUpdate:modelValue":Y[2]||(Y[2]=H=>y.value=H),ref:"dataRef",disable:t(le),label:"Data da Consulta"},{append:l(()=>[e(ne,{name:"event",class:"cursor-pointer"},{default:l(()=>[e(je,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[e(Ge,{modelValue:y.value,"onUpdate:modelValue":[Y[0]||(Y[0]=H=>y.value=H),Y[1]||(Y[1]=H=>_e())],options:$e,mask:"DD-MM-YYYY"},{default:l(()=>[a("div",Cr,[xe(e(J,{label:"Close",color:"primary",flat:""},null,512),[[Ue]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue","disable"])]),a("div",Ar,[e(el,{modelValue:v.value,"onUpdate:modelValue":Y[11]||(Y[11]=H=>v.value=H),ref_key:"stepper",ref:m,"header-class":"text-bold bg-grey-3",color:"primary","active-color":"orange-7",animated:""},{default:l(()=>[e(ht,{name:1,title:"Dados Vitais",icon:"show_chart",done:v.value>1},{default:l(()=>[a("div",$r,[e(se,{outlined:"",class:"col",dense:"",modelValue:r.value.height,"onUpdate:modelValue":[Y[3]||(Y[3]=H=>r.value.height=H),Y[4]||(Y[4]=H=>be())],label:"Altura *",mask:"#.##",disable:t(De),suffix:"[Metros]",ref_key:"heightRef",ref:Z,rules:[H=>!!H||"Por favor indicar a altura",H=>Number(H)>0&&Number(H)<Number(4)||"A altura indicado n\xE3o \xE9 v\xE1dlido"]},null,8,["modelValue","disable","rules"]),e(se,{outlined:"",class:"col q-ml-md",dense:"",modelValue:r.value.weight,"onUpdate:modelValue":[Y[5]||(Y[5]=H=>r.value.weight=H),Y[6]||(Y[6]=H=>be())],type:"number",label:"Peso *",rules:[H=>!!H||"Por favor indicar o peso",H=>Number(H)>0&&Number(H)<Number(500)||"O peso indicado n\xE3o \xE9 v\xE1dlido"],suffix:"[Kg]",disable:t(De),ref_key:"weightRef",ref:f},null,8,["modelValue","rules","disable"])]),a("div",Ir,[e(se,{outlined:"",class:"col",dense:"",type:"number",modelValue:r.value.imc,"onUpdate:modelValue":Y[7]||(Y[7]=H=>r.value.imc=H),label:"IMC *",filled:"",disable:"",ref:"imcRef"},null,8,["modelValue"]),e(se,{outlined:"",dense:"",modelValue:Ve.value,"onUpdate:modelValue":Y[8]||(Y[8]=H=>Ve.value=H),class:"col q-ml-md",filled:"",label:"IMC-Descri\xE7\xE3o",disable:""},null,8,["modelValue"])]),a("div",Er,[e(se,{outlined:"",class:"col",dense:"",modelValue:r.value.systole,"onUpdate:modelValue":Y[9]||(Y[9]=H=>r.value.systole=H),mask:"###",label:"Sistole *",disable:t(De),suffix:"[mmHg]",ref_key:"systoleRef",ref:N,rules:[H=>!!H||"Por favor indicar a systole",H=>Number(H)>0||"O valor da s\xEDstole indicado n\xE3o \xE9 v\xE1dlido"]},null,8,["modelValue","disable","rules"]),e(se,{outlined:"",class:"col q-ml-md",dense:"",modelValue:r.value.distort,"onUpdate:modelValue":Y[10]||(Y[10]=H=>r.value.distort=H),mask:"###",label:"Diastole *",suffix:"[mmHg]",disable:t(De),ref_key:"distortRef",ref:W,rules:[H=>!!H||"Por favor indicar a di\xE1stole",H=>Number(H)>0||"O valor da di\xE1stole indicado n\xE3o \xE9 v\xE1dlido"]},null,8,["modelValue","disable","rules"])])]),_:1},8,["done"]),e(ht,{name:2,title:"Rastreio de Tuberculose",icon:"show_chart",done:v.value>2},{default:l(()=>[e(_a)]),_:1},8,["done"]),t(G).gender==="Feminino"?(o(),O(ht,{key:0,name:3,title:"Rastreio de Gravidez",icon:"show_chart",done:v.value>3},{default:l(()=>[e(ha)]),_:1},8,["done"])):D("",!0),e(ht,{name:4,title:"Monitoria e Refor\xE7o \xE0 Ades\xE3o",icon:"show_chart",done:v.value>4},{default:l(()=>[e(ya)]),_:1},8,["done"]),e(ht,{name:5,title:"Rea\xE7\xF5es Adversas",icon:"show_chart"},{default:l(()=>[e(ba,{isNewRender:!0})]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["thumb-style","content-style","content-active-style"]),e(Ne,{align:"right",class:"q-my-md"},{default:l(()=>[e(tl,null,{default:l(()=>[e(J,{label:"Cancelar",color:"red",onClick:Y[12]||(Y[12]=H=>t(ce)())}),v.value>1?(o(),O(J,{key:0,color:"primary",onClick:Y[13]||(Y[13]=H=>oe.$refs.stepper.previous()),label:"Voltar",class:"q-ml-sm"})):D("",!0),e(J,{onClick:K,color:"primary",loading:E.value,label:v.value===5?"Submeter":"Proximo",class:"q-ml-sm"},null,8,["loading","label"])]),_:1})]),_:1})],32)]),_:1}))}};const Mr={class:"col-12"},Fr=a("span",{class:"text-weight-medium"},"Peso:",-1),Nr=a("span",{class:"text-weight-bolder"}," | ",-1),Or=a("span",{class:"text-weight-medium"},"Altura:",-1),Ur=a("span",{class:"text-weight-bolder"}," | ",-1),Yr=a("span",{class:"text-weight-medium"},"IMC:",-1),Br=a("span",{class:"text-weight-bolder"}," | ",-1),Lr=a("span",{class:"text-weight-medium"},"Sistole:",-1),zr=a("span",{class:"text-weight-bolder"}," | ",-1),Wr=a("span",{class:"text-weight-medium"},"Diastole:",-1),Hr={class:"col"},jr={__name:"PharmaceuticalAtentionContainer",setup(j){const{isMale:q}=Me(),{formatDate:A}=et(),{closeLoading:M,showloading:x}=ot();ze();const{alertSucess:k,alertError:d,alertInfo:V,alertWarningAction:R}=Qe(),{isProvincialInstalation:T,isProvincialInstalationPharmacysMode:P,isProvincialInstalationMobileClinic:w}=Le(),i=[{name:"vitalSignsScreenings",required:!0,field:"row.vitalSignsScreenings",label:"Dados Vitais",align:"left",sortable:!1},{name:"tbScreenings",align:"left",field:"row.tbScreenings",label:"Rastreio TB",sortable:!1},{name:"pregnancyScreenings",align:"left",field:"row.pregnancyScreenings",label:"Rastreio Gravidez",sortable:!1},{name:"adherenceScreenings",align:"left",field:"row.adherenceScreenings",label:"Monitoria e Refor\xE7o a Ades\xE3o",sortable:!1},{name:"ramScreenings",align:"left",field:"row.ramScreenings",label:"Rea\xE7\xF5es Adversas",sortable:!1},{name:"opts",align:"left",label:"Op\xE7\xF5es",sortable:!1}],r=U("patient"),c=U("patientVisits"),s=U("viewTb"),u=U("viewPregnancy"),g=U("viewAdherence"),v=U("viewRam"),y=U("showTB"),m=U("showPregnancy"),Z=U("showAdherence"),f=U("showAdverse"),N=U("editButtonActions"),W=E=>{x(),R("Deseja Apagar a aten\xE7\xE3o farmaceutica?").then(b=>{b?Ee.delete(E.id).then(p=>{M(),console.log(p),k("Aten\xE7\xE3o farmaceutica removida com sucesso")}).catch(p=>{M(),console.log(p),d("Aconteceu um erro ao remover a Aten\xE7\xE3o Farmaceutica")}):(M(),V("Opera\xE7\xE3o cancelada"))})};return(E,b)=>(o(!0),I(St,null,Dt(t(c),p=>(o(),I("div",{key:p.id},[e(mt,{dense:"","header-class":"bg-grey-6 text-white text-bold vertical-middle q-pl-md","expand-icon-class":"text-white","default-opened":t(c)[0]===p},{header:l(()=>[e(Te,{avatar:""},{default:l(()=>[e(ne,{color:"white",name:"medical_services"})]),_:1}),e(Te,null,{default:l(()=>[B(" Data do Registo: "+_(t(A)(p.visitDate)),1)]),_:2},1024)]),default:l(()=>[e(ye,{class:"noRadius"},{default:l(()=>[e(he,{class:"row q-pa-none"},{default:l(()=>[a("div",Mr,[e(Be,{class:"col",dense:"",unelevated:"",separator:"vertical",rows:p.vitalSignsScreenings,columns:i,"row-key":"id","hide-bottom":""},{header:l(h=>[e(Fe,{class:"text-left bg-grey-2",props:h},{default:l(()=>[e(at,null,{default:l(()=>[B(_(i[0].label),1)]),_:1}),e(at,null,{default:l(()=>[B(_(i[1].label),1)]),_:1}),t(q)(t(r))?D("",!0):(o(),O(at,{key:0},{default:l(()=>[B(_(i[2].label),1)]),_:1})),e(at,null,{default:l(()=>[B(_(i[3].label),1)]),_:1}),e(at,null,{default:l(()=>[B(_(i[4].label),1)]),_:1}),t(T)()?D("",!0):(o(),O(at,{key:1},{default:l(()=>[B(_(i[5].label),1)]),_:1})),t(r).isLast&&!t(T)()||t(P)()||t(w)()?(o(),O(at,{key:2},{default:l(()=>[B(_(i[5].label),1)]),_:1})):D("",!0)]),_:2},1032,["props"])]),body:l(h=>[e(Fe,{"no-hover":"",props:h},{default:l(()=>[e(te,{key:"vitalSignsScreenings",props:h},{default:l(()=>[Fr,B(" "+_(h.row.weight+" Kg")+" ",1),Nr,Or,B(" "+_(h.row.height+" m")+" ",1),Ur,Yr,B(" "+_(Math.round(h.row.imc*100)/100+"")+" ",1),Br,Lr,B(" "+_(h.row.systole+" mmhHg")+" ",1),zr,Wr,B(" "+_(h.row.distort+" mmHg"),1)]),_:2},1032,["props"]),e(te,{key:"tbScreenings",props:h},{default:l(()=>[p.tbScreenings.length>0?(o(),O(J,{key:0,class:"q-pa-none",flat:"",color:"primary",label:"Ver Detalhes",onClick:Q=>t(y)(p)},null,8,["onClick"])):(o(),O(J,{key:1,disable:"true",class:"q-pa-none",flat:"",color:"grey-6",label:"Sem Rastreio"}))]),_:2},1032,["props"]),t(q)(t(r))?D("",!0):(o(),O(te,{"auto-width":"",key:"pregnancyScreenings",props:h},{default:l(()=>[p.pregnancyScreenings.length>0?(o(),O(J,{key:0,class:"q-pa-none",flat:"",color:"primary",label:"Ver Detalhes",onClick:Q=>t(m)(p)},null,8,["onClick"])):(o(),O(J,{key:1,disable:"true",class:"q-pa-none",flat:"",color:"grey-6",label:"Sem Rastreio"}))]),_:2},1032,["props"])),e(te,{"auto-width":"",key:"adherenceScreenings",props:h},{default:l(()=>[p.adherenceScreenings.length>0?(o(),O(J,{key:0,class:"q-pa-none",flat:"",color:"primary",label:"Ver Detalhes",onClick:Q=>t(Z)(p)},null,8,["onClick"])):(o(),O(J,{key:1,disable:"true",class:"q-pa-none",flat:"",color:"grey-6",label:"Sem Rastreio"}))]),_:2},1032,["props"]),e(te,{"auto-width":"",key:"ramScreenings",props:h},{default:l(()=>[p.ramScreenings.length>0?(o(),O(J,{key:0,class:"q-pa-none",flat:"",color:"primary",label:"Ver Detalhes",onClick:Q=>t(f)(p)},null,8,["onClick"])):(o(),O(J,{key:1,disable:"true",class:"q-pa-none",flat:"",color:"grey-6",label:"Sem Rastreio"}))]),_:2},1032,["props"]),!t(T)()||t(P)()||t(w)()?(o(),O(te,{"auto-width":"",key:"opts",props:h},{default:l(()=>[a("div",Hr,[e(J,{flat:"",onClick:Q=>t(N)(p),round:"",disable:!(t(c)[0].vitalSignsScreenings[0].id===h.row.id&&t(c)[0].id===p.id),color:t(c)[0].vitalSignsScreenings[0].id===h.row.id&&t(c)[0].id===p.id?"orange-5":"grey-5",icon:"edit"},{default:l(()=>[e($t,{class:"bg-amber-5"},{default:l(()=>[B("Editar")]),_:1})]),_:2},1032,["onClick","disable","color"]),e(J,{flat:"",onClick:ct(Q=>W(p),["stop"]),round:"",disable:!(t(c)[0].vitalSignsScreenings[0].id===h.row.id&&t(c)[0].id===p.id),color:t(c)[0].vitalSignsScreenings[0].id===h.row.id&&t(c)[0].id===p.id?"red":"grey-5",icon:"delete"},{default:l(()=>[e($t,{class:"bg-red"},{default:l(()=>[B("Remover")]),_:1})]),_:2},1032,["onClick","disable","color"])])]),_:2},1032,["props"])):D("",!0)]),_:2},1032,["props"])]),_:2},1032,["rows"])])]),_:2},1024),e(ke,{persistent:"",modelValue:t(s),"onUpdate:modelValue":b[0]||(b[0]=h=>yt(s)?s.value=h:null)},{default:l(()=>[e(ye,{style:{"max-width":"1500px",width:"1200px",height:"700px"}},{default:l(()=>[e(he,{class:"q-pa-none"},{default:l(()=>[e(_a)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(q)(t(r))?D("",!0):(o(),O(ke,{key:0,persistent:"",modelValue:t(u),"onUpdate:modelValue":b[1]||(b[1]=h=>yt(u)?u.value=h:null)},{default:l(()=>[e(ye,{style:{"max-width":"1500px",width:"900px",height:"400px"}},{default:l(()=>[e(he,{class:"q-pa-none"},{default:l(()=>[e(ha)]),_:1})]),_:1})]),_:1},8,["modelValue"])),e(ke,{persistent:"",modelValue:t(g),"onUpdate:modelValue":b[2]||(b[2]=h=>yt(g)?g.value=h:null)},{default:l(()=>[e(ye,{style:{"max-width":"1500px",width:"900px",height:"350px"}},{default:l(()=>[e(he,{class:"q-pa-none"},{default:l(()=>[e(ya)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(ke,{persistent:"",modelValue:t(v),"onUpdate:modelValue":b[3]||(b[3]=h=>yt(v)?v.value=h:null)},{default:l(()=>[e(ye,{style:{"max-width":"1500px",width:"900px",height:"350px"}},{default:l(()=>[e(he,{class:"q-pa-none"},{default:l(()=>[e(ba)]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:2},1024)]),_:2},1032,["default-opened"]),e(ue)]))),128))}},Gr={key:1},da={__name:"PharmaceuticalAtentionInfo",setup(j){ze();const{isProvincialInstalation:q,isProvincialInstalationPharmacysMode:A,isProvincialInstalationMobileClinic:M}=Le(),{hasEpisodes:x,hasOneAndClosedIdentifier:k,hasNoObitOrTransferedForEpisode:d}=Me(),V=n(!0),R=n(!1),T=n("Aten\xE7\xE3o Farmac\xEAutica"),P=n("Nenhuma Aten\xE7\xE3o Farmac\xEAutica Adicionada"),w=n("bg-primary"),i=n(!0),r=n(!1),c=n(!1),s=n(!1),u=n(!1),g=n(!1),v=n(!1),y=n(new At),m=U("patient"),Z=G=>{V.value=!G},f=()=>{R.value=!0,r.value=!1,c.value=!1,s.value=!1,u.value=!1,g.value=!1,v.value=!1},N=G=>{y.value=G,R.value=!0,r.value=!0,c.value=!1},W=()=>{R.value=!0,r.value=!1,c.value=!0},E=G=>{y.value.tbScreenings[0]=G.tbScreenings[0],s.value=!0,u.value=!1,g.value=!1,v.value=!1,c.value=!0},b=G=>{y.value.pregnancyScreenings[0]=G.pregnancyScreenings[0],s.value=!1,u.value=!0,g.value=!1,v.value=!1,c.value=!0},p=G=>{y.value.adherenceScreenings[0]=G.adherenceScreenings[0],s.value=!1,u.value=!1,g.value=!0,v.value=!1,c.value=!0},h=G=>{y.value.ramScreenings[0]=G.ramScreenings[0],s.value=!1,u.value=!1,g.value=!1,v.value=!0,c.value=!0},Q=()=>{R.value=!1,y.value=new At,s.value=!1,u.value=!1,g.value=!1,v.value=!1,c.value=!1},ae=$(()=>Ee.getLastFourWithVitalSignByPatientId(m.value.id)),le=$(()=>{if(x(m.value))return!!d(m.value)});return F("title",T),F("bgColor",w),F("expandLess",Z),F("addVisible",le),F("mainContainer",i),F("titleEmptyList",P),F("editMode",r),F("onlyView",c),F("viewTb",s),F("viewPregnancy",u),F("viewAdherence",g),F("viewRam",v),F("patientVisits",ae),F("showPatientVisit",y),F("addButtonActions",f),F("editButtonActions",N),F("showButtonActions",W),F("closeButtonActions",Q),F("showTB",E),F("showPregnancy",b),F("showAdherence",p),F("showAdverse",h),(G,ce)=>(o(),I("div",null,[e(xt,{title:T.value,"bg-color":w.value,"main-container":i.value,expanded:Z,"add-visible":le.value&&(!t(q)()||t(A)()||t(M)()),"expand-visible":!1,addButtonActions:f},null,8,["title","bg-color","main-container","add-visible"]),xe(a("div",null,[ae.value.length<=0?(o(),O(ut,{key:0})):(o(),I("div",Gr,[a("span",null,[e(jr)])])),e(ke,{persistent:"",modelValue:R.value,"onUpdate:modelValue":ce[0]||(ce[0]=De=>R.value=De)},{default:l(()=>[e(Tr)]),_:1},8,["modelValue"])],512),[[dt,V.value]])]))}};const Qr={key:2,class:"row q-mt-md"},Jr={key:1,class:"col-3 q-pa-md q-pl-lg q-ml-sm panel",style:{"max-width":"390px"}},Kr={class:"col q-mx-lg"},Zr={class:"col text-center"},Xr={key:1,class:""},$d={__name:"PatientPanel",setup(j){const{closeLoading:q,showloading:A}=ot(),{website:M,isDeskTop:x,isMobile:k}=ze(),d=n("clinicService"),V=n(!1),R=n("Detalhe do Utente/Paciente"),T=n({backgroundColor:"#ffffff",color:"#555"}),P=n({backgroundColor:"#eee",color:"black"}),w=n({right:"2px",borderRadius:"5px",backgroundColor:"#0ba58b",width:"5px",opacity:.75});Pe(()=>{i()});const i=async()=>{A(),q()},r=()=>{V.value=!V.value},c=$(()=>Ht.getPatientByID(localStorage.getItem("patientuuid")));return F("title",R),F("patient",c),F("website",M),F("showPatientDetails",r),(s,u)=>(o(),I("div",null,[t(M)?(o(),O(Ya,{key:1})):(o(),O(ml,{key:0})),c.value!==null?(o(),I("div",Qr,[t(M)?(o(),I("div",Jr,[e(sa)])):(o(),O(qa,{key:0,modelValue:V.value,"onUpdate:modelValue":u[0]||(u[0]=g=>V.value=g),width:405,breakpoint:500,overlay:"",bordered:"",behavior:"mobile",class:"bg-grey-1 q-pl-md q-py-md"},{default:l(()=>[e(lt,{"thumb-style":w.value,"content-style":T.value,"content-active-style":P.value,style:{height:"690px"},class:"q-pr-md"},{default:l(()=>[e(sa)]),_:1},8,["thumb-style","content-style","content-active-style"])]),_:1},8,["modelValue"])),a("div",Kr,[t(M)?D("",!0):(o(),O($a,{key:0,class:"bg-primary text-white q-mb-sm rounded-borders"},{default:l(()=>[a("div",Zr,[e(Aa,{modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=g=>d.value=g),shrink:""},{default:l(()=>[e(Bt,{name:"clinicService",label:"Servi\xE7os de Sa\xFAde"}),e(Bt,{name:"prescription",label:"Prescri\xE7\xE3o"}),e(Bt,{name:"screening",label:"Aten\xE7\xE3o Farmac\xEAutica"})]),_:1},8,["modelValue"])])]),_:1})),t(M)?D("",!0):(o(),I("div",Xr,[e(Ca,{modelValue:d.value,"onUpdate:modelValue":u[2]||(u[2]=g=>d.value=g),animated:""},{default:l(()=>[e(Lt,{name:"clinicService"},{default:l(()=>[e(lt,{"thumb-style":w.value,"content-style":T.value,"content-active-style":P.value,style:{height:"440px"},class:"q-pr-md"},{default:l(()=>[e(ia,{class:"q-mb-lg"})]),_:1},8,["thumb-style","content-style","content-active-style"])]),_:1}),e(Lt,{name:"prescription"},{default:l(()=>[e(lt,{"thumb-style":w.value,"content-style":T.value,"content-active-style":P.value,style:{height:"440px"},class:"q-pr-md"},{default:l(()=>[e(ra,{class:"q-mb-lg"})]),_:1},8,["thumb-style","content-style","content-active-style"])]),_:1}),e(Lt,{name:"screening"},{default:l(()=>[e(lt,{"thumb-style":w.value,"content-style":T.value,"content-active-style":P.value,style:{height:"440px"},class:"q-pr-md"},{default:l(()=>[e(da)]),_:1},8,["thumb-style","content-style","content-active-style"])]),_:1})]),_:1},8,["modelValue"])])),t(M)?(o(),O(lt,{key:2,"thumb-style":w.value,"content-style":T.value,"content-active-style":P.value,style:{height:"730px"},class:"q-pr-md"},{default:l(()=>[t(M)?(o(),O(ia,{key:0,class:"q-mb-lg"})):D("",!0),t(M)?(o(),O(ra,{key:1,class:"q-mb-lg"})):D("",!0),t(M)?(o(),O(da,{key:2})):D("",!0)]),_:1},8,["thumb-style","content-style","content-active-style"])):D("",!0)])])):D("",!0)]))}};export{$d as default};
