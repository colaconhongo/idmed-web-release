import{Q as Z,a as ee,b as Ie}from"./QTabPanels.fab18ecb.js";import{Q as qe}from"./QBadge.cb49eccd.js";import{Y as ce,r as c,i as P,b6 as j,ce as ve,a1 as F,c as R,d2 as ge,K as S,a_ as J,f as e,M as t,a7 as Y,L as E,U as O,P as M,a6 as C,O as d,a4 as m,a5 as g,V as q,cc as Ee,cA as Ne,cd as W,cf as G,b2 as Be,b3 as Qe,d3 as Te,R as se,S as be,N as ae,a8 as _e,bP as me,W as fe,be as de,$ as z,b8 as De,d4 as oe,a$ as ne,b4 as pe,b_ as ye,o as ie,cn as Oe,b1 as U,a9 as le,F as Ue,d5 as Fe,bO as H,c2 as Ye,d6 as Re,d7 as re,w as Ae,cv as te,bc as ze,d8 as Ce,d9 as Ve,da as Pe}from"./index.28c7e456.js";import{Q as Ge}from"./QTabs.9968ab83.js";import{u as je,_ as Je}from"./InvnetoryMethod.3c0c56e2.js";import{_ as He}from"./TitleBar.f7be41e1.js";import{a as A,c as x,b as V,Q as L}from"./QTable.f91943bc.js";import{b as Me}from"./QSelect.caa108f8.js";import{Q as K}from"./QTooltip.f3ef7ac8.js";import{Q as ue}from"./QInnerLoading.e80e6b25.js";import{S as $e}from"./StockAlertService.3ee5a37f.js";import{_ as Le}from"./plugin-vue_export-helper.21dcd24c.js";import{Q as ke,a as we}from"./QPopupProxy.bc9f6d75.js";import{C as he}from"./ClosePopup.20eb2e56.js";import{Q as We}from"./QScrollArea.288f8a37.js";import{R as Ke,D as Xe}from"./StockMethod.5d6dd1ce.js";import{s as Ze}from"./stockLevelService.ff3920be.js";import"./TouchPan.90ce57a2.js";import"./position-engine.b3fa6cbd.js";import"./use-render-cache.3aae9b27.js";import"./QMenu.9a83401e.js";import"./QList.d4521672.js";import"./QLinearProgress.c6927d78.js";const et=T=>(Be("data-v-1e207ea0"),T=T(),Qe(),T),tt={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},lt=et(()=>d("span",null," Sem resultados para visualizar ",-1)),at={class:"col"},ot={__name:"StockTable",setup(T){const{isMobile:_,isOnline:b}=ce(),D=c(!1),a=P("isExecutedStockAlert"),i=j(),y=c(!0),k=[{name:"order",required:!0,label:"Ordem",align:"left",sortable:!1},{name:"drug",required:!0,label:"Medicamento",align:"left",field:f=>f.drug,format:f=>`${f}`},{name:"avgConsuption",required:!0,label:"M\xE9dia de Consumo Mensal",align:"center",field:f=>f.avgConsuption,format:f=>`${f}`},{name:"balance",required:!0,label:"Saldo actual",align:"center",field:f=>f.balance,format:f=>`${f}`},{name:"state",required:!0,label:"Estado",align:"left",field:f=>f.state,format:f=>`${f}`},{name:"options",align:"center",label:"Op\xE7\xF5es",sortable:!1}],o=P("isCharts"),r=c(""),u=c(""),l=c(""),s=ve(c(null));F("drug",s),c([]);const p=f=>{D.value=!0,s.value=W.getDrugById(f.id),localStorage.setItem("selectedDrug",s.value.id),b||G.getMobile(),i.push("/stock/drugFile")},$=()=>o?"width: 1000px":"",I=f=>f==="Sem Consumo"?"blue":f==="Ruptura de Stock"?"red":f==="Acima do Consumo M\xE1ximo"?"info":"primary",N=R(()=>{const f=$e.getStockAlertsByClinic();return(f.length>0||f.length===0&&a.value===!0)&&(y.value=!1),f});return ge(f=>{f.value==="true"?y.value=!1:y.value=!0}),(f,v)=>(S(),J("div",null,[e(L,{loading:y.value,class:Ee(u.value),dense:"",rows:N.value,columns:k,filter:r.value,"row-key":"id",style:Ne($()),title:l.value},{"top-right":t(()=>[Y(o)?C("",!0):(S(),E(O,{key:0,outlined:"",dense:"",style:{width:"400px"},debounce:"300",modelValue:r.value,"onUpdate:modelValue":v[0]||(v[0]=n=>r.value=n),placeholder:"Pesquisar por medicamento"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"]))]),"no-data":t(({icon:n,filter:w})=>[d("div",tt,[lt,e(M,{size:"2em",name:w?"filter_b_and_w":n},null,8,["name"])])]),header:t(n=>[e(A,{class:"text-left bg-grey-3",props:n},{default:t(()=>[C("",!0),e(x,{class:"col"},{default:t(()=>[m(g(k[1].label),1)]),_:1}),e(x,{class:"text-center",style:{width:"190px"}},{default:t(()=>[m(g(k[2].label),1)]),_:1}),e(x,{class:"text-center",style:{width:"190px"}},{default:t(()=>[m(g(k[3].label),1)]),_:1}),e(x,{class:"text-center",style:{width:"190px"}},{default:t(()=>[m(g(k[4].label),1)]),_:1}),Y(o)?C("",!0):(S(),E(x,{key:1,class:"text-center",style:{width:"110px"}},{default:t(()=>[m(g(k[5].label),1)]),_:1}))]),_:2},1032,["props"])]),body:t(n=>[e(A,{props:n},{default:t(()=>[C("",!0),e(V,{key:"drug",props:n},{default:t(()=>[m(g(Y(b)?n.row.drug:n.row.drug.name),1)]),_:2},1032,["props"]),e(V,{key:"avgConsuption",props:n},{default:t(()=>[m(g(n.row.avgConsuption),1)]),_:2},1032,["props"]),e(V,{key:"balance",props:n},{default:t(()=>[m(g(Number(n.row.balance)),1)]),_:2},1032,["props"]),e(V,{key:"state",props:n},{default:t(()=>[e(Me,{color:I(n.row.state),"text-color":"white"},{default:t(()=>[m(g(n.row.state),1)]),_:2},1032,["color"])]),_:2},1032,["props"]),Y(o)?C("",!0):(S(),E(V,{key:"options",props:n},{default:t(()=>[d("div",at,[Y(o)?C("",!0):(S(),E(q,{key:0,flat:"",round:"",color:"primary",icon:"description",onClick:w=>p(n.row),loading:D.value},{default:t(()=>[e(K,{class:"bg-primary"},{default:t(()=>[m("Visualizar Ficha")]),_:1})]),_:2},1032,["onClick","loading"]))])]),_:2},1032,["props"]))]),_:2},1032,["props"])]),loading:t(()=>[e(ue,{showing:"",color:"primary"})]),_:1},8,["loading","class","rows","filter","style","title"])]))}};var rt=Le(ot,[["__scopeId","data-v-1e207ea0"]]);const st={class:"q-pt-lg bg-green-2"},nt={class:"row items-center q-mb-md q-ml-md"},it=d("span",{class:"q-pl-sm text-subtitle1"},"Dados da Guia",-1),ut={class:"q-mt-md"},dt={class:"row"},ct={class:"row items-center justify-end"},mt={class:"row"},ft={__name:"EntranceRegister",setup(T){const _=de(),{showloading:b,closeLoading:D}=ne();let a=ve(new Te({dateReceived:new Date}));const i=c(_.getDDMMYYYFromJSDate(new Date)),y=c(_.getDDMMYYYFromJSDate(new Date)),k=c(null),o=c(null),r=j(),{alertError:u}=pe(),l=p=>oe.getStockEntranceByNumber(String(p).trim()),s=()=>{b(),a.dateReceived=_.getDateFromHyphenDDMMYYYYWithTime(i.value),a.creationDate=_.getDateFromHyphenDDMMYYYYWithTime(y.value),l(a.orderNumber)!==null&&l(a.orderNumber)!==void 0?(u("O n\xFAmero da Guia n\xE3o pode ser vazio e deve ser \xFAnico."),D()):a.dateReceived>new Date?(u("A data de cria\xE7\xE3o da guia n\xE3o pode ser superior a data corrente."),D()):(k.value.validate(),k.value.hasError||(a.clinic=z.currClinic(),a.clinic_id=z.currClinic().id,a.id=De(),oe.post(a).then(p=>{a.clinic=null,localStorage.setItem("currStockEntrance",JSON.stringify(a.id)),D(),r.push("/stock/entrance")}).catch(p=>{console.log("ERRO: ",p),D(),u("Ocorreu um erro inesperado, contacte o administrador!")})))};return F("stockEntrance",a),(p,$)=>(S(),E(fe,{style:{width:"800px","max-width":"90vw"},class:""},{default:t(()=>[d("div",st,[d("div",nt,[e(M,{name:"subject",size:"sm"}),it]),e(se,{color:"grey-13",size:"1px"})]),d("form",{onSubmit:be(s,["prevent"])},[e(ae,{class:"q-px-md"},{default:t(()=>[d("div",ut,[d("div",dt,[e(O,{outlined:"",modelValue:Y(a).orderNumber,"onUpdate:modelValue":$[0]||($[0]=I=>Y(a).orderNumber=I),label:"N\xFAmero *",ref_key:"orderNumberRef",ref:k,rules:[I=>!!I||"Por favor indicar o n\xFAmero da guia"],dense:"",class:"col"},null,8,["modelValue","rules"]),e(O,{dense:"",outlined:"",class:"col q-ml-md",modelValue:i.value,"onUpdate:modelValue":$[2]||($[2]=I=>i.value=I),label:"Data de Cria\xE7\xE3o *"},{append:t(()=>[e(M,{name:"event",class:"cursor-pointer"},{default:t(()=>[e(ke,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(we,{modelValue:i.value,"onUpdate:modelValue":$[1]||($[1]=I=>i.value=I),mask:"DD-MM-YYYY"},{default:t(()=>[d("div",ct,[_e(e(q,{label:"Close",color:"primary",flat:""},null,512),[[he]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),d("div",mt,[e(O,{outlined:"",modelValue:Y(a).notes,"onUpdate:modelValue":$[3]||($[3]=I=>Y(a).notes=I),label:"Notas",ref_key:"notesRef",ref:o,dense:"",class:"col",type:"textarea"},null,8,["modelValue"])])])]),_:1}),e(me,{align:"right",class:"q-mb-md q-mr-sm"},{default:t(()=>[e(q,{label:"Cancelar",color:"red",onClick:$[4]||($[4]=I=>p.$emit("close"))}),e(q,{type:"submit",label:"Avan\xE7ar",color:"primary"})]),_:1})],32)]),_:1}))}},pt={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},vt=d("span",null," Sem resultados para visualizar ",-1),gt={class:"col"},bt={__name:"EntranceTable",setup(T){const _=P("isExecutedEntrance"),b=[{name:"order",required:!0,label:"Ordem",align:"left",sortable:!1},{name:"orderNumber",align:"left",label:"Nr. de Guia",field:r=>r.orderNumber,sortable:!0},{name:"dateReceived",align:"center",label:"Data de Entrada",sortable:!1},{name:"options",align:"center",label:"Op\xE7\xF5es",sortable:!1}],D=c(""),a=j(),i=c(!0),y=r=>ye.formatDate(r,"DD-MM-YYYY"),k=r=>{r.clinic=null,localStorage.setItem("currStockEntrance",JSON.stringify(r.id)),a.push("/stock/entrance")},o=R(()=>{const r=oe.getStockEntrances();return(r.length>0||r.length===0&&_.value===!0)&&(i.value=!1),r});return ge(r=>{r.value==="true"?i.value=!1:i.value=!0}),(r,u)=>(S(),J("div",null,[e(L,{class:"col",dense:"",rows:o.value,columns:b,filter:D.value,"row-key":"id",loading:i.value},{"top-right":t(()=>[e(O,{outlined:"",dense:"",style:{width:"400px"},debounce:"300",modelValue:D.value,"onUpdate:modelValue":u[0]||(u[0]=l=>D.value=l),placeholder:"Pesquisar pela guia"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),header:t(l=>[e(A,{class:"text-left bg-grey-3",props:l},{default:t(()=>[C("",!0),e(x,{class:"col"},{default:t(()=>[m(g(b[1].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(b[2].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(b[3].label),1)]),_:1})]),_:2},1032,["props"])]),"no-data":t(({icon:l,filter:s})=>[d("div",pt,[vt,e(M,{size:"2em",name:s?"filter_b_and_w":l},null,8,["name"])])]),body:t(l=>[e(A,{props:l},{default:t(()=>[C("",!0),e(V,{key:"orderNumber",props:l},{default:t(()=>[m(g(l.row.orderNumber),1)]),_:2},1032,["props"]),e(V,{key:"dateReceived",props:l},{default:t(()=>[m(g(y(l.row.dateReceived)),1)]),_:2},1032,["props"]),e(V,{key:"options",props:l},{default:t(()=>[d("div",gt,[e(q,{flat:"",round:"",color:"amber-8",icon:"reorder",onClick:s=>k(l.row)},{default:t(()=>[e(K,{class:"bg-amber-5"},{default:t(()=>[m("Visualizar Guia")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:2},1032,["props"])]),loading:t(()=>[e(ue,{showing:"",color:"primary"})]),_:1},8,["rows","filter","loading"])]))}};const _t={class:"q-pa-md"},Dt={class:"row items-center"},yt=d("span",{class:"q-pl-sm text-subtitle2"},"Medicamentos Inventariados",-1),kt={class:"row q-mt-md"},wt={__name:"InventoryDetails",setup(T){const{closeLoading:_,showloading:b}=ne(),D=P("inventoryDetail"),a=c(""),i=c([]),y=[{name:"fnmCode",required:!0,label:"C\xF3digo FNM",align:"left",field:o=>o.fnmCode,format:o=>`${o}`,sortable:!0},{name:"name",required:!0,label:"Nome",align:"left",field:o=>o.name,format:o=>`${o}`,sortable:!0}];ie(()=>{b();const o=D.value;var r=JSON.parse(o.generic),u=JSON.parse(o.open);if(u){const l=[];r?(Object.keys(G.getValidStock()).forEach(s=>{let p=W.getDrugById(s);p!=null&&i.value.push(p)}),_()):(Object.keys(o.adjustments).forEach(function(s){o.adjustments[s].adjustedStock=G.getStockById(o.adjustments[s].adjusted_stock_id),k(o.adjustments[s],l)}.bind(this)),i.value=l,_())}else W.getInventoryDrugs(o.id).then(l=>{i.value=l,_()})});const k=(o,r)=>{let u=!0;o.adjustedStock===null&&(o.adjustedStock=G.getStockById(o.adjusted_stock_id));const l=W.getDrugById(o.adjustedStock.drug_id);r.length<=0&&G.getValidStockByDrug(l,z.currClinic().id)?r.push(l):(Object.keys(r).forEach(function(s){r[s].id===l.id&&(u=!1)}),u&&r.push(l))};return(o,r)=>(S(),E(fe,{style:{width:"900px","max-width":"90vw"}},{default:t(()=>[e(ae,{class:"q-pa-none bg-green-2"},{default:t(()=>[d("div",_t,[d("div",Dt,[e(M,{name:"local_hospital",size:"sm"}),yt])]),e(se,{color:"grey-13",size:"1px"})]),_:1}),e(We,{style:{height:"600px"}},{default:t(()=>[e(ae,{class:"q-px-md"},{default:t(()=>[d("div",kt,[e(L,{class:"col",title:"Medicamentos",rows:i.value,columns:y,filter:a.value,"row-key":"fnmCode",selected:i.value,"onUpdate:selected":r[1]||(r[1]=u=>i.value=u)},{"top-right":t(()=>[e(O,{outlined:"",dense:"",debounce:"300",modelValue:a.value,"onUpdate:modelValue":r[0]||(r[0]=u=>a.value=u),placeholder:"Procurar"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),_:1},8,["rows","filter","selected"])])]),_:1}),e(Oe)]),_:1}),e(me,{align:"right",class:"q-mb-md"},{default:t(()=>[e(q,{label:"Fechar",color:"red",onClick:r[2]||(r[2]=u=>o.$emit("close"))})]),_:1})]),_:1}))}},ht={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},St=d("span",null," Sem resultados para visualizar ",-1),xt={class:"col"},Yt={__name:"InventoryTable",setup(T){const _=c(!1),b=c(!1),D=je(),{isOnline:a}=ce(),{showloading:i}=ne(),y=c(!0),k=P("isExecutedInventory"),o=[{name:"order",required:!0,label:"Ordem",align:"left",sortable:!1},{name:"generic",align:"left",label:"Tipo de Invent\xE1rio",sortable:!0},{name:"startDate",align:"center",label:"Data de Abertura",sortable:!1},{name:"endDate",align:"center",label:"Data de Fecho",sortable:!0},{name:"open",align:"center",label:"Estado",sortable:!0},{name:"options",align:"center",label:"Op\xE7\xF5es",sortable:!1}],r=j(),u=c(""),l=c(!1),s=c(null),p=N=>{i(),localStorage.setItem("currInventory",N.id),r.push("/stock/inventory")},$=N=>{s.value=N,l.value=!0};ie(()=>{a.value?U.apiGetAllByClinicId(z.currClinic().id,0,300):U.getMobile()});const I=R(()=>{U.getMobile();const N=U.getInventories();return(N.length>0||N.length===0&&k.value===!0)&&(y.value=!1),N});return ge(N=>{N.value==="true"?y.value=!1:y.value=!0}),F("inventoryDetail",s),(N,f)=>(S(),J(Ue,null,[d("div",null,[e(L,{class:"col",dense:"",rows:I.value,columns:o,filter:u.value,"row-key":"id",loading:y.value},{"top-right":t(()=>[e(O,{outlined:"",dense:"",style:{width:"400px"},debounce:"300",modelValue:u.value,"onUpdate:modelValue":f[0]||(f[0]=v=>u.value=v),placeholder:"Pesquisar"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),header:t(v=>[e(A,{class:"text-left bg-grey-3",props:v},{default:t(()=>[C("",!0),e(x,{class:"col"},{default:t(()=>[m(g(o[1].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(o[2].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(o[3].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(o[4].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(o[5].label),1)]),_:1})]),_:2},1032,["props"])]),"no-data":t(({icon:v,filter:n})=>[d("div",ht,[St,e(M,{size:"2em",name:n?"filter_b_and_w":v},null,8,["name"])])]),body:t(v=>[e(A,{props:v},{default:t(()=>[C("",!0),e(V,{key:"generic",props:v},{default:t(()=>[m(g(Y(D).getInventoryType(v.row)),1)]),_:2},1032,["props"]),e(V,{key:"startDate",props:v},{default:t(()=>[m(g(Y(D).getformatedUTCDate(v.row)),1)]),_:2},1032,["props"]),e(V,{key:"endDate",props:v},{default:t(()=>[m(g(Y(D).getFormatedEndDate(v.row)),1)]),_:2},1032,["props"]),e(V,{key:"open",props:v},{default:t(()=>[e(Me,{color:Y(D).getChipColor(v.row),"text-color":"white"},{default:t(()=>[m(g(Y(D).getInventoryStatus(v.row)),1)]),_:2},1032,["color"])]),_:2},1032,["props"]),e(V,{key:"options",props:v},{default:t(()=>[d("div",xt,[e(q,{loading:_.value,flat:"",round:"",color:"amber-8",icon:"list_alt",onClick:n=>{_.value=!0,p(v.row)}},{default:t(()=>[e(K,{class:"bg-amber-5"},{default:t(()=>[m(g(v.row.open?"Abrir Invent\xE1rio":"Visualizar Invent\xE1rio"),1)]),_:2},1024)]),_:2},1032,["loading","onClick"]),e(q,{loading:b.value,flat:"",round:"",color:"primary",icon:"search",onClick:n=>{b.value=!0,$(v.row)}},{default:t(()=>[e(K,{class:"bg-primary"},{default:t(()=>[m(" Visualizar Medicamentos ")]),_:1})]),_:2},1032,["loading","onClick"])])]),_:2},1032,["props"])]),_:2},1032,["props"])]),loading:t(()=>[e(ue,{showing:"",color:"primary"})]),_:1},8,["rows","filter","loading"])]),e(le,{persistent:"",modelValue:l.value,"onUpdate:modelValue":f[2]||(f[2]=v=>l.value=v)},{default:t(()=>[e(wt,{onClose:f[1]||(f[1]=v=>{l.value=!1,b.value=!1})})]),_:1},8,["modelValue"])],64))}},Ct={class:"row items-center q-py-md q-pl-lg text-center bg-green-2"},Vt=d("div",{class:"text-subtitle1 q-ml-sm"},"Invent\xE1rio",-1),Mt={class:"q-mt-md"},$t={class:"row"},It={class:"row items-center justify-end"},qt={class:"row"},Et={class:"col q-ml-md",tabindex:"0"},Nt={key:0,class:"row q-mt-md"},Bt={__name:"InventoryRegister",setup(T){const{showloading:_,closeLoading:b}=ne(),D=j(),{alertError:a}=pe(),i=c(!1),{getPreviousStatisticMonthsDateFromDate:y}=de();c(!1);const k=P("currClinic"),o=c(null),r=[{name:"code",required:!0,label:"C\xF3digo FNM",field:"fnmCode",align:"left",sortable:!1},{name:"drug",align:"left",label:"Medicamento",field:"name",sortable:!0}],u=c(""),l=c(new Fe),s=c([]),p=de(),$=p.getDateFormatMMDDYYYY(new Date),I=()=>s.value.length===0?"":`${s.value.length} registo${s.value.length>1?"s":""} selecionado de ${w.value.length}`,N=()=>{i.value=!0,_();const B=U.getLastInventory();if(p.getDateFromHyphenDDMMYYYY(l.value.startDate).setHours(0,0,0,0)>new Date().setHours(0,0,0,0))b(),i.value=!1,a("A data de inicio do invent\xE1rio n\xE3o pode ser superior a data corrente.");else if(B!==null&&p.getDateFromHyphenDDMMYYYY(l.value.startDate).setHours(0,0,0,0)<new Date(B.endDate).setHours(0,0,0,0)){const h=p.getDDMMYYYFromJSDate(B.endDate);b(),i.value=!1,a("A data de inicio do invent\xE1rio n\xE3o pode ser anterior a data de fecho do \xFAtimo invent\xE1rio registado ["+h+"]")}else l.value.generic&&String(l.value.generic)==="true"?f(p.getYYYYMMDDFromJSDate(p.getDateFromHyphenDDMMYYYY(l.value.startDate)))?(b(),i.value=!1,a("Ja existe um invent\xE1rio na data seleccionada.")):v():s.value.length<=0?(b(),i.value=!1,a("Por favor, selecione pelo menos um medicamento para o invent\xE1rio.")):f(p.getYYYYMMDDFromJSDate(p.getDateFromHyphenDDMMYYYY(l.value.startDate)))?(b(),i.value=!1,a("Ja existe um invent\xE1rio geral na data seleccionada.")):v()},f=B=>U.getGeneralInventoryByDate(B)!==null&&U.getGeneralInventoryByDate(B)!==void 0,v=()=>{const B=[];l.value.id=De(),l.value.clinic={},l.value.clinic.id=k.value.id,l.value.startDate=p.getYYYYMMDDFromJSDate(p.getDateFromHyphenDDMMYYYY(l.value.startDate)),s.value!=null&&s.value.forEach(h=>{B.push(h.id)}),n.value||localStorage.setItem("selectedDrugs",B),l.value.generic=n.value,U.post(l.value).then(h=>{o.value=h,localStorage.setItem("currInventory",l.value.id),D.push("/stock/inventory")})},n=R(()=>String(l.value.generic).includes("true")),w=R(()=>W.getDrugsWithValidStockInList()),Se=B=>{const h=new Date,Q=new Date(y(h)[0].startDate),X=new Date(y(h)[0].endDate),xe=U.lastInventoryBeforeDate(h);return xe?U.getInventoryInPreviousMonth(Q,X)?B>=H(xe.endDate).format("YYYY/MM/DD")&&B<=H(h).format("YYYY/MM/DD"):(l.value.startDate=H(X).format("DD-MM-YYYY"),B===H(X).format("YYYY/MM/DD")):(l.value.startDate=H(X).format("DD-MM-YYYY"),B===H(X).format("YYYY/MM/DD"))};return ie(()=>{l.value.generic="true",(l.value.startDate===null||l.value.startDate===void 0)&&(l.value.startDate=H().format("DD-MM-YYYY")),Se(l.value.startDate)}),(B,h)=>(S(),E(fe,{style:{width:"900px","max-width":"90vw"},class:"q-pa-none q-ma-none"},{default:t(()=>[d("div",Ct,[e(M,{name:"inventory",size:"md"}),Vt]),e(se,{color:"grey-13",size:"1px"}),d("form",{onSubmit:be(N,["prevent"]),class:"q-pa-none q-ma-none"},[e(ae,{class:"q-pb-md"},{default:t(()=>[d("div",Mt,[d("div",$t,[e(O,{dense:"",outlined:"",class:"col q-ml-md q-mb-md",modelValue:l.value.startDate,"onUpdate:modelValue":h[1]||(h[1]=Q=>l.value.startDate=Q),ref_key:"startDateRef",ref:$,"lazy-rules":"",label:"Data do Invent\xE1rio *"},{append:t(()=>[e(M,{name:"event",class:"cursor-pointer"},{default:t(()=>[e(ke,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(we,{modelValue:l.value.startDate,"onUpdate:modelValue":h[0]||(h[0]=Q=>l.value.startDate=Q),mask:"DD-MM-YYYY",options:Se},{default:t(()=>[d("div",It,[_e(e(q,{label:"Close",color:"primary",flat:""},null,512),[[he]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])])]),d("div",qt,[d("div",Et,[m(" Tipo de Invent\xE1rio: "),e(Ye,{"keep-color":"",color:"primary",modelValue:l.value.generic,"onUpdate:modelValue":h[2]||(h[2]=Q=>l.value.generic=Q),val:"true",label:"Geral"},null,8,["modelValue"]),e(Ye,{"keep-color":"",color:"primary",modelValue:l.value.generic,"onUpdate:modelValue":h[3]||(h[3]=Q=>l.value.generic=Q),val:"false",label:"Parcial"},null,8,["modelValue"])])]),n.value!==!0?(S(),J("div",Nt,[e(L,{class:"col q-ml-md",dense:"",title:"Medicamentos",rows:w.value,columns:r,filter:u.value,"row-key":"id","selected-rows-label":I,selection:"multiple",selected:s.value,"onUpdate:selected":h[5]||(h[5]=Q=>s.value=Q)},{"top-right":t(()=>[e(O,{outlined:"",dense:"",style:{width:"400px"},debounce:"300",modelValue:u.value,"onUpdate:modelValue":h[4]||(h[4]=Q=>u.value=Q),placeholder:"Pesquisar"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),header:t(Q=>[e(A,{class:"text-left bg-grey-3",props:Q},{default:t(()=>[e(x,{style:{width:"70px"}}),e(x,{style:{width:"120px"}},{default:t(()=>[m(g(r[0].label),1)]),_:1}),e(x,{class:"col"},{default:t(()=>[m(g(r[1].label),1)]),_:1})]),_:2},1032,["props"])]),_:1},8,["rows","filter","selected"])])):C("",!0)]),_:1}),e(me,{align:"right",class:"q-mb-md q-mr-sm"},{default:t(()=>[e(q,{label:"Cancelar",color:"red",onClick:h[6]||(h[6]=Q=>B.$emit("close"))}),e(q,{type:"submit",label:"Avan\xE7ar",loading:i.value,color:"primary"},null,8,["loading"])]),_:1})],32)]),_:1}))}},Qt={class:"q-pt-lg bg-green-2"},Tt={class:"row items-center q-mb-md q-ml-md"},Ot=d("span",{class:"q-pl-sm text-subtitle1"},"Dados da Guia",-1),Ut={class:"q-mt-md"},Ft={class:"row"},Rt={class:"row items-center justify-end"},At={class:"row"},zt={__name:"StockDistributorRegister",setup(T){const _=de(),{showloading:b,closeLoading:D}=ne();let a=ve(new Re({creationDate:new Date}));const i=c(_.getDDMMYYYFromJSDate(new Date));c(null);const y=c(null),k=j(),{alertError:o}=pe(),r=c(null),u=()=>{b(),a.creationDate=_.getJSDateFromDDMMYYY(i.value),a.creationDate>new Date?o("A data de cria\xE7\xE3o da guia n\xE3o pode ser superior a data corrente."):(r.value.validate(),r.value.hasError||(a.clinic=z.currClinic(),a.clinic_id=z.currClinic().id,a.id=De(),a.status="P",re.post(a).then(l=>{a.clinic=null,localStorage.setItem("currStockDistributor",JSON.stringify(a.id)),D(),k.push("/stock/stockDistributor")}).catch(l=>{console.log("ERRO: ",l),D(),o("Ocorreu um erro inesperado, contacte o administrador!")})))};return F("stockDistributor",a),(l,s)=>(S(),E(fe,{style:{width:"800px","max-width":"90vw"},class:""},{default:t(()=>[d("div",Qt,[d("div",Tt,[e(M,{name:"subject",size:"sm"}),Ot]),e(se,{color:"grey-13",size:"1px"})]),d("form",{onSubmit:be(u,["prevent"])},[e(ae,{class:"q-px-md"},{default:t(()=>[d("div",Ut,[d("div",Ft,[e(O,{outlined:"",modelValue:Y(a).orderNumber,"onUpdate:modelValue":s[0]||(s[0]=p=>Y(a).orderNumber=p),label:"Ordem de Distribui\xE7\xE3o *",ref_key:"orderNumberRef",ref:r,rules:[p=>!!p||"Por favor indicar o n\xFAmero da guia"],dense:"",class:"col"},null,8,["modelValue","rules"]),e(O,{dense:"",outlined:"",class:"col q-ml-md",modelValue:i.value,"onUpdate:modelValue":s[2]||(s[2]=p=>i.value=p),label:"Data de Cria\xE7\xE3o *"},{append:t(()=>[e(M,{name:"event",class:"cursor-pointer"},{default:t(()=>[e(ke,{ref:"qDateProxy","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[e(we,{modelValue:i.value,"onUpdate:modelValue":s[1]||(s[1]=p=>i.value=p),mask:"DD-MM-YYYY"},{default:t(()=>[d("div",Rt,[_e(e(q,{label:"Close",color:"primary",flat:""},null,512),[[he]])])]),_:1},8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]),d("div",At,[e(O,{outlined:"",modelValue:Y(a).notes,"onUpdate:modelValue":s[3]||(s[3]=p=>Y(a).notes=p),label:"Notas",ref_key:"notesRef",ref:y,dense:"",class:"col",type:"textarea"},null,8,["modelValue"])])])]),_:1}),e(me,{align:"right",class:"q-mb-md q-mr-sm"},{default:t(()=>[e(q,{label:"Cancelar",color:"red",onClick:s[4]||(s[4]=p=>l.$emit("close"))}),e(q,{type:"submit",label:"Avan\xE7ar",color:"primary"})]),_:1})],32)]),_:1}))}},Pt={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},Gt=d("span",null," Sem resultados para visualizar ",-1),jt={class:"col"},Jt={__name:"StockDistributorTable",setup(T){const _=[{name:"order",required:!0,label:"Ordem",align:"left",sortable:!1},{name:"orderNumber",align:"left",label:"Nr. de Guia",field:u=>u.orderNumber,sortable:!0},{name:"creationDate",align:"center",label:"Data de Criacao",sortable:!1},{name:"status",align:"center",label:"Estado",field:u=>u.orderNumber,sortable:!0},{name:"options",align:"center",label:"Op\xE7\xF5es",sortable:!1}],b=c(""),D=j(),a=c(!0),i=P("currClinic"),y=P("isExecutedDistributor"),k=u=>ye.formatDate(u,"DD-MM-YYYY"),o=u=>{localStorage.setItem("currStockDistributor",JSON.stringify(u.id)),D.push("/stock/stockDistributor")},r=R(()=>{const u=re.getStockDistributorServices(i.value.id);return(u.length>0||u.length===0&&y.value===!0)&&(a.value=!1),u});return Ae(u=>{u.value==="true"?a.value=!1:a.value=!0}),(u,l)=>(S(),J("div",null,[e(L,{class:"col",dense:"",rows:r.value,columns:_,filter:b.value,"row-key":"id",loading:a.value},{"top-right":t(()=>[e(O,{outlined:"",dense:"",style:{width:"400px"},debounce:"300",modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=s=>b.value=s),placeholder:"Pesquisar pela guia"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),header:t(s=>[e(A,{class:"text-left bg-grey-3",props:s},{default:t(()=>[C("",!0),e(x,{class:"col"},{default:t(()=>[m(g(_[1].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(_[2].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(_[3].label),1)]),_:1})]),_:2},1032,["props"])]),"no-data":t(({icon:s,filter:p})=>[d("div",Pt,[Gt,e(M,{size:"2em",name:p?"filter_b_and_w":s},null,8,["name"])])]),body:t(s=>[e(A,{props:s},{default:t(()=>[C("",!0),e(V,{key:"orderNumber",props:s},{default:t(()=>[m(g(s.row.orderNumber),1)]),_:2},1032,["props"]),e(V,{key:"creationDate",props:s},{default:t(()=>[m(g(k(s.row.creationDate)),1)]),_:2},1032,["props"]),e(V,{key:"options",props:s},{default:t(()=>[d("div",jt,[e(q,{flat:"",round:"",color:"amber-8",icon:"reorder",onClick:p=>o(s.row)},{default:t(()=>[e(K,{class:"bg-amber-5"},{default:t(()=>[m("Visualizar Guia")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:2},1032,["props"])]),loading:t(()=>[e(ue,{showing:"",color:"primary"})]),_:1},8,["rows","filter","loading"])]))}},Ht={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},Lt=d("span",null," Sem resultados para visualizar ",-1),Wt={class:"col"},Kt={__name:"StockConfirmationTable",setup(T){const _=[{name:"order",required:!0,label:"Ordem",align:"left",sortable:!1},{name:"orderNumber",align:"left",label:"Nr. de Guia",field:r=>r.orderNumber,sortable:!0},{name:"creationDate",align:"center",label:"Data de Criacao",sortable:!1},{name:"options",align:"center",label:"Op\xE7\xF5es",sortable:!1}],b=c(""),D=j(),a=c(!0),i=P("currClinic"),y=r=>ye.formatDate(r,"DD-MM-YYYY"),k=r=>{r.clinic=null,localStorage.setItem("currStockConfirmDistributor",JSON.stringify(r.id)),D.push("/stock/stockConfirmation")},o=R(()=>{const r=re.getStockDistributorConfirmation(i.value.id);return r.length>=0&&(a.value=!1),r});return(r,u)=>(S(),J("div",null,[e(L,{class:"col",dense:"",rows:o.value,columns:_,filter:b.value,"row-key":"id",loading:a.value},{"top-right":t(()=>[e(O,{outlined:"",dense:"",style:{width:"400px"},debounce:"300",modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=l=>b.value=l),placeholder:"Pesquisar pela ordem de distribuicao"},{append:t(()=>[e(M,{name:"search"})]),_:1},8,["modelValue"])]),header:t(l=>[e(A,{class:"text-left bg-grey-3",props:l},{default:t(()=>[C("",!0),e(x,{class:"col"},{default:t(()=>[m(g(_[1].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(_[2].label),1)]),_:1}),e(x,{class:"text-center"},{default:t(()=>[m(g(_[3].label),1)]),_:1})]),_:2},1032,["props"])]),"no-data":t(({icon:l,filter:s})=>[d("div",Ht,[Lt,e(M,{size:"2em",name:s?"filter_b_and_w":l},null,8,["name"])])]),body:t(l=>[e(A,{props:l},{default:t(()=>[C("",!0),e(V,{key:"orderNumber",props:l},{default:t(()=>[m(g(l.row.orderNumber),1)]),_:2},1032,["props"]),e(V,{key:"creationDate",props:l},{default:t(()=>[m(g(y(l.row.creationDate)),1)]),_:2},1032,["props"]),e(V,{key:"options",props:l},{default:t(()=>[d("div",Wt,[e(q,{flat:"",round:"",color:"amber-8",icon:"reorder",onClick:s=>k(l.row)},{default:t(()=>[e(K,{class:"bg-amber-5"},{default:t(()=>[m("Visualizar Ordem")]),_:1})]),_:2},1032,["onClick"])])]),_:2},1032,["props"])]),_:2},1032,["props"])]),loading:t(()=>[e(ue,{showing:"",color:"primary"})]),_:1},8,["rows","filter","loading"])]))}},Xt={class:"q-px-xl q-mx-xl q-mt-md"},Zt={class:"absolute-top-right q-mr-md"},el={class:"q-mt-md"},tl={__name:"Index",setup(T){const{isMobile:_,isOnline:b}=ce(),{alertError:D}=pe(),a=c({type:"",visible:!1,msg:""}),i=c("stock"),y=c(!1),k=c(!1),o=c(!1),r=c("Gest\xE3o de Stock"),u=c(""),l=()=>{i.value==="entrance"?y.value=!0:i.value==="stockDistributor"?o.value=!0:U.getOpenInventory()!==null?D("Existe registado um invent\xE1rio ainda aberto, por favor termine o mesmo antes de iniciar um novo invent\xE1rio."):k.value=!0},s=()=>{window.location.reload()},p=R(()=>z.currClinic()),$=R(()=>W.getActiveDrugs()),I=R(()=>localStorage.getItem("stockDistributionCount"));ie(()=>{const v=localStorage.getItem("activeTabStock");v===""||v===null?(i.value="stock",localStorage.setItem("activeTabStock","stock")):i.value=v,u.value=z.isClinicSector(z.currClinic())});const N=R(()=>i.value==="confirmDistribution"),f=v=>{localStorage.setItem("activeTabStock",v),i.value=v};return F("currClinic",p),F("activeDrugs",$),F("isCharts",!1),F("title",r),(v,n)=>(S(),J("div",null,[e(He),d("div",Xt,[e(Ge,{modelValue:i.value,"onUpdate:modelValue":n[5]||(n[5]=w=>i.value=w),align:"left",dense:"","inline-label":"",class:""},{default:t(()=>[e(Z,{name:"stock",label:"Stock",onClick:n[0]||(n[0]=w=>f("stock"))}),e(Z,{name:"entrance",label:"Entrada",onClick:n[1]||(n[1]=w=>f("entrance"))}),e(Z,{name:"inventory",label:"Invent\xE1rio",onClick:n[2]||(n[2]=w=>f("inventory"))}),Y(b)?(S(),E(Z,{key:0,name:"stockDistributor",label:"Distribuicao",onClick:n[3]||(n[3]=w=>f("stockDistributor"))})):C("",!0),Y(b)?C("",!0):(S(),E(Z,{key:1,name:"confirmDistribution",label:"Confirmar Distribuicao",onClick:n[4]||(n[4]=w=>f("confirmDistribution"))},{default:t(()=>[e(qe,{color:"red",floating:"",transparent:""},{default:t(()=>[m(g(I.value),1)]),_:1})]),_:1})),d("div",Zt,[e(q,{flat:"","icon-right":"refresh",label:"Actualizar Lista","no-caps":"",onClick:s})])]),_:1},8,["modelValue"]),e(se,{color:"grey-13",size:"1px"}),d("div",el,[e(Ie,{modelValue:i.value,"onUpdate:modelValue":n[6]||(n[6]=w=>i.value=w),animated:""},{default:t(()=>[e(ee,{name:"stock"},{default:t(()=>[(S(),E(te,null,[e(rt)],1024))]),_:1}),e(ee,{name:"entrance"},{default:t(()=>[(S(),E(te,null,[e(bt)],1024))]),_:1}),e(ee,{name:"inventory"},{default:t(()=>[(S(),E(te,null,[e(Yt)],1024))]),_:1}),e(ee,{name:"stockDistributor"},{default:t(()=>[(S(),E(te,null,[e(Jt)],1024))]),_:1}),e(ee,{name:"confirmDistribution"},{default:t(()=>[(S(),E(te,null,[e(Kt)],1024))]),_:1})]),_:1},8,["modelValue"])])]),i.value!=="stock"?(S(),E(ze,{key:0,position:"bottom-right",offset:[18,18]},{default:t(()=>[N.value?C("",!0):(S(),E(q,{key:0,class:"q-mb-xl q-mr-xl",fab:"",color:"primary",icon:"add",onClick:l}))]),_:1})):C("",!0),e(le,{persistent:"",modelValue:y.value,"onUpdate:modelValue":n[8]||(n[8]=w=>y.value=w)},{default:t(()=>[e(ft,{onClose:n[7]||(n[7]=w=>y.value=!1)})]),_:1},8,["modelValue"]),e(le,{persistent:"",modelValue:k.value,"onUpdate:modelValue":n[10]||(n[10]=w=>k.value=w)},{default:t(()=>[e(Bt,{onClose:n[9]||(n[9]=w=>k.value=!1)})]),_:1},8,["modelValue"]),e(le,{persistent:"",modelValue:o.value,"onUpdate:modelValue":n[12]||(n[12]=w=>o.value=w)},{default:t(()=>[e(zt,{onClose:n[11]||(n[11]=w=>o.value=!1)})]),_:1},8,["modelValue"]),e(le,{modelValue:a.value.visible,"onUpdate:modelValue":n[13]||(n[13]=w=>a.value.visible=w),persistent:""},{default:t(()=>[e(Je,{type:a.value.type,onCloseDialog:v.closeDialog,onCommitOperation:v.closeInventory},{title:t(()=>[m(" Informa\xE7\xE3o")]),msg:t(()=>[m(g(a.value.msg),1)]),_:1},8,["type","onCloseDialog","onCommitOperation"])]),_:1},8,["modelValue"])]))}},Yl={__name:"Stock",setup(T){const _=c(!1),b=c(!1),D=c(!1),a=c(!1),{website:i,isMobile:y,isOnline:k}=ce();return ie(()=>{const o=z.currClinic();$e.apiGetStockAlertAll(o.id).then(()=>{_.value=!0}),i.value||y.value&&k.value?(Ce.get(0),Ve.get(0),re.get(0).then(()=>{a.value=!0}),G.getStockDistributorWeb(o.id,0)):y.value&&oe.getCountStockEntranceFromDexie().then(r=>{r<=0&&(Ce.get(0),Ve.get(0),re.get(0).then(()=>{a.value=!0}),G.getStockDistributorWeb(o.id,0))}),G.get(0,o.id),Ze.get(0),Ke.getAllByClinic(o.id,0),Xe.getAllByClinic(o.id,0),Pe.getAllByClinic(o.id,0),U.getAllByClinic(o.id,0).then(()=>{b.value=!0}),oe.apiGetAllByClinicId(o.id,0,100).then(()=>{D.value=!0})}),F("isExecutedStockAlert",_),F("isExecutedInventory",b),F("isExecutedEntrance",D),F("isExecutedDistributor",a),(o,r)=>(S(),J("div",null,[e(tl)]))}};export{Yl as default};
