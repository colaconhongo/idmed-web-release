import{Y as Qe,Z as Ee,b6 as Ue,r as n,b7 as D,b8 as y,b9 as se,i as ie,o as ue,z as o,c as z,a1 as v,K as P,L as w,M as i,O as d,f as s,a7 as p,P as _,U as Y,ba as j,bb as J,V as N,a4 as b,a6 as k,R as ze,a5 as E,bc as Fe,a9 as $e,bd as Me,a$ as de,be as Le,bf as Ke,bg as ne,A as oe,C as Ge,H as He,b4 as Ye,b0 as je,$ as Je,bh as re,a_ as Oe}from"./index.28c7e456.js";import{Q as We}from"./QSpace.b53e3d44.js";import{Q as Ze}from"./QSelect.caa108f8.js";import{Q as U}from"./QTooltip.f3ef7ac8.js";import{Q as Xe,a as ea,b as I}from"./QTable.f91943bc.js";import{_ as aa}from"./TitleBar.f7be41e1.js";import{_ as ta}from"./PatientRegister.9f39be71.js";import{u as la}from"./patientMethods.cc912af0.js";import"./QMenu.9a83401e.js";import"./position-engine.b3fa6cbd.js";import"./QList.d4521672.js";import"./QLinearProgress.c6927d78.js";import"./QPopupProxy.bc9f6d75.js";import"./use-render-cache.3aae9b27.js";import"./ClosePopup.20eb2e56.js";const sa={class:"q-mt-lg"},ia={class:"q-mx-xl"},na={class:"row"},oa={class:"row items-center q-my-md"},ra=d("span",{class:"q-pl-sm text-subtitle2"},"Informa\xE7\xE3o inicial",-1),ua={class:"row"},da={class:"q-mt-lg q-mb-md"},ca={class:"row items-center q-mb-md"},va=d("span",{class:"q-pl-sm text-subtitle2"},"Resultado da Pesquisa",-1),ma={class:"full-width row flex-center text-primary q-gutter-sm text-body2"},fa=d("span",null," Sem resultados para visualizar ",-1),ga={class:"col"},pa={__name:"Search",setup(ce){const{alertSucess:q,alertError:S,alertInfo:V}=Ye(),{closeLoading:r,showloading:f}=de(),{idadeCalculator:F,getDDMMYYYFromJSDate:C}=Le(),{website:O,isOnline:W,isDeskTop:ba,isMobile:Z}=Qe(),{preferedIdentifierValue:X,fullName:ee}=la(),{deleteStorageWithoutPatientInfo:ve,deleteDexieInfo:me}=je(),{isProvincialInstalation:fe,isProvincialInstalationPharmacysMode:ge,isProvincialInstalationMobileClinic:pe}=Ee(),be=Ue(),x=n(""),h=n(!1),l=n(new D({id:y()})),T=n(new se({id:y()})),u=n({id:0,abbreviation:"iDMED"});n([]);const c=n("");n();const B=n(!1),ye=sessionStorage.getItem("user"),ae=n([]),$=n(!1),Pe=n("Procurar ou adicionar Utentes/Pacientes"),Se=n(),M=n(!1),L=n(5),A=n(0),g=n({sortBy:"desc",descending:!1,page:1,rowsPerPage:5}),K=n(1),G=n(5),he=[{name:"identifier",align:"left",label:"Identificador",field:t=>X(t),sortable:!1},{name:"name",align:"left",label:"Nome",field:t=>ee(t),sortable:!1},{name:"age",align:"center",label:"Idade",sortable:!1},{name:"gender",align:"left",label:"G\xE9nero",sortable:!1},{name:"options",align:"left",label:"Op\xE7\xF5es",sortable:!1}],we=ie("dataSources"),R=ie("clinic");ue(()=>{f(),l.value=new D({id:y()}),o.deleteAllFromStorage(),T.value.value=c.value,l.value.identifiers.push(T.value),l.value.clinic=R.value});const te=z(()=>c.value!==""||l.value.firstNames!==""||l.value.lastNames!==""),_e=async t=>{const{page:e,rowsPerPage:a,sortBy:m,descending:H}=t.pagination;(e!==K.value||a!==G.value)&&(M.value=!0),setTimeout(()=>{a===0&&g.value.rowsNumber;const le=(e-1)*a;l.value.limit=a,l.value.offset=le,A.value=le,(e!==K.value||a!==G.value)&&(K.value=e,G.value=a,l.value.limit=L.value,l.value.offset=A.value,o.apiSearch(l.value)),g.value.page=e,g.value.rowsPerPage=a,g.value.sortBy=m,g.value.descending=H,M.value=!1},1500)},Ie=()=>{l.value=new D({id:y()}),l.value.clinic=R.value,o.deleteAllFromStorage()},Q=()=>{u.value.id.length>4?u.value.abbreviation.length<=2?console.log(ae.value):Ne(u.value):Ae()},Ne=t=>{f();const e=c.value.replaceAll("/","-");e.length<=0?(S("N\xE3o cont\xE9m nenhum par\xE2metro de pesquisa. Por favor, introduza um N\xBA de Identificador"),r()):(l.value.clinic=R,T.value.value=c.value,l.value.identifiers.push(T.value),o.apiSearchPatientOnOpenMRS(t.id,e,sessionStorage.getItem("Btoa")).then(a=>{o.deleteAllFromStorage(),a.data.results.length>0?(a.data.results.forEach(m=>{const H=n(new D({id:y()}));o.savePatientStorage(ke(H,m))}),r()):(r(),V("Nenhum resultado encontrado para o identificador "+e))}).catch(a=>{console.log(a)}))},ke=(t,e)=>{const a=e.person.attributes.find(m=>m.attributeType.uuid==="e2e3fd64-1d5f-11e0-b929-000c29ad1d07");return t.value.hisUuid=e.uuid,t.value.his=u.value.id.length>4?u.value:null,t.value.hisLocation=e.identifiers[0].location.uuid,t.value.hisLocationName=e.identifiers[0].location.display,t.value.firstNames=e.person.names[0].givenName,t.value.middleNames=e.person.names[0].middleName,t.value.lastNames=e.person.names[0].familyName,t.value.gender=e.person.gender==="M"?"Masculino":"Feminino",t.value.dateOfBirth=e.person.birthdate,t.value.identifiers.push(De(e.identifiers[0])),t.value.cellphone=a!=null?String(a.value):"",t.value.address=e.person.addresses.length>0?e.person.addresses[0].address3:"",t.value.addressReference=e.person.addresses.length>0?e.person.addresses[0].address1:"",t.value.district=e.person.addresses.length>0?Ke.getAllDistrictByDescription(e.person.addresses[0].countyDistrict):"",t.value.province=t.value.district!==null&&t.value.district!==void 0?t.value.district.province:null,t.value},De=t=>{let e="TARV";String(t.identifierType.display).includes("TARV")?e="TARV":String(t.identifierType.display).includes("PREP")?e="PREP":String(t.identifierType.display).includes("TB")?e="TB":String(t.identifierType.display).includes("CCR")&&(e="CCR");const a=n(new se({id:y()}));return a.value.startDate=new Date,a.value.value=t.identifier,a.value.state="Activo",a.value.prefered=!0,a.value.service=ne.getByIdentifierTypeCode(e),a.value.identifierType=ne.getByIdentifierTypeCode(e).identifierType,a.value.clinic=R.value,a.value},qe=t=>{l.value=t,h.value=!0,B.value=!0},Ve=t=>{f(),t.limit=L.value,t.offset=A.value,o.apiSearch(t).then(e=>{(e==null||e.length===0)&&(e.data=[]),e.data.length>=1?(V("J\xE1 existe um Paciente com o NID:[ "+t.identifiers[0].value+" ] no IDMED. Use A pesquisa do Idmed"),o.deleteAllFromStorage(),r()):(r(),l.value=t,h.value=!0,B.value=!0,$.value=!0)}).catch(e=>{r(),console.log(e)})},Ce=()=>{h.value=!1,B.value=!1,$.value=!1},xe=async t=>{f(),ve(),await o.deleteAllExceptIdFromStorage(t.id),l.value=t,localStorage.setItem("patientuuid",l.value.id),Z.value&&!W.value?await o.getPatientMobileWithAllByPatientId(l.value):(me(),localStorage.setItem("patientuuid",l.value.id),await o.getPatientByID(l.value.id),await oe.apiGetAllByPatientId(l.value.id),await Ge.apiGetAllByPatientId(l.value.id),await He.apiGetPatientVisitDetailsByPatientId(l.value.id)),localStorage.setItem("patientuuid",l.value.id),be.push("/patientpanel/")},Te=()=>{o.deleteAllFromStorage(),f(),u.value.id.length>4?u.value.abbreviation.length<=2?r():Re(u.value):(q("Pesquisa iDMED","Pesquisa de Pacientes no iDMED em funcionamento"),setTimeout(()=>{r()},400))},Be=z(()=>o.getPatientSearchList()),Ae=async()=>{if(l.value.identifiers[0].value=c.value,O.value||Z.value&&W.value){f();const t=await o.countPatientSearchResult(l.value);g.value.rowsNumber=t.data,l.value.limit=L.value,l.value.offset=A.value,o.apiSearch(l.value)}else o.getMobile(),oe.getMobile()},Re=t=>{o.apiCheckOpenmRSisOn(t.id,sessionStorage.getItem("Btoa")).then(e=>{e.data.authenticated===!1||e.data.authenticated===void 0||e.data.authenticated===null?(S("O Utilizador ["+ye+"] n\xE3o se encontra no OpenMRS ou servi\xE7o rest no OpenMRS n\xE3o se encontra em funcionamento."),r()):(q("Pesquisa de Pacientes no OpenMRS em funcionamento"),r())}).catch(e=>{String(e).includes("Network Error")?(S("O Servidor OpenMRS encontra-se desligado ou existe um problema de conex\xE3o"),r()):(console.log(e),S("Falha inesperada, por favor contacte o administrador."),r())})};return v("title",Pe),v("newPatient",B),v("patient",l),v("openMrsPatient",$),v("transferencePatientData",ae),v("closePatient",Ce),v("showPatientRegister",h),(t,e)=>(P(),w(Me,{ratio:16/9},{default:i(()=>[d("div",sa,[s(aa),d("div",ia,[d("div",na,[s(We),s(Ze,{class:"col-2 q-mt-md",dense:"",outlined:"","option-label":"abbreviation",modelValue:u.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>u.value=a),e[1]||(e[1]=a=>Te())],options:p(we),label:"Fonte de dados"},null,8,["modelValue","options"])]),d("div",oa,[s(_,{name:"person_outline",size:"sm"}),ra]),d("div",ua,[s(Y,{onKeyup:j(Q,["enter"]),outlined:"",label:"Nr. Identificador",dense:"",ref:"identifierRef",class:"col",modelValue:c.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>c.value=a),e[4]||(e[4]=a=>x.value=a)],rules:[a=>!!a||"Por favor indicar o identificador"],"lazy-rules":""},J({_:2},[c.value!==null&&c.value!==void 0&&c.value!==""?{name:"append",fn:i(()=>[s(_,{name:"close",onClick:e[2]||(e[2]=a=>c.value=""),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","rules"]),s(Y,{onKeyup:j(Q,["enter"]),outlined:"",ref:"firstNamesRef",modelValue:l.value.firstNames,"onUpdate:modelValue":[e[6]||(e[6]=a=>l.value.firstNames=a),e[7]||(e[7]=a=>x.value=a)],type:"text","lazy-rules":"",label:"Nome *",dense:"",class:"col q-ml-md",rules:[a=>!!a||"Por favor indicar o nome"],readonly:u.value.id.length>4},J({_:2},[l.value.firstNames!==null&&l.value.firstNames!==void 0&&l.value.firstNames!==""?{name:"append",fn:i(()=>[s(_,{name:"close",onClick:e[5]||(e[5]=a=>l.value.firstNames=""),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","rules","readonly"]),s(Y,{onKeyup:j(Q,["enter"]),outlined:"",ref:"lastNamesRef",modelValue:l.value.lastNames,"onUpdate:modelValue":[e[9]||(e[9]=a=>l.value.lastNames=a),e[10]||(e[10]=a=>x.value=a)],type:"text","lazy-rules":"",label:"Apelido",dense:"",class:"col q-ml-md",rules:[a=>!!a||"Por favor indicar o nome"],readonly:u.value.id.length>4},J({_:2},[l.value.lastNames!==null&&l.value.lastNames!==void 0&&l.value.lastNames!==""?{name:"append",fn:i(()=>[s(_,{name:"close",onClick:e[8]||(e[8]=a=>l.value.lastNames=""),class:"cursor-pointer"})]),key:"0"}:void 0]),1032,["modelValue","rules","readonly"]),te.value?(P(),w(N,{key:0,onClick:Q,class:"q-ml-md q-mb-xs",square:"",color:"primary",icon:"search"},{default:i(()=>[s(U,{class:"bg-green-5"},{default:i(()=>[b("Pesquisar")]),_:1})]),_:1})):k("",!0),te.value?(P(),w(N,{key:1,onClick:Ie,class:"q-ml-md q-mb-xs",square:"",color:"amber",icon:"clear"},{default:i(()=>[s(U,{class:"bg-amber-5"},{default:i(()=>[b("Limpar")]),_:1})]),_:1})):k("",!0)]),d("div",da,[d("div",ca,[s(_,{name:"search",size:"sm"}),va]),s(ze,{color:"grey-13",size:"1px"})]),d("div",null,[s(Xe,{class:"col",dense:"",rows:Be.value,columns:he,"row-key":"id",filter:x.value,loading:M.value,ref_key:"tableRef",ref:Se,pagination:g.value,"onUpdate:pagination":e[11]||(e[11]=a=>g.value=a),"binary-state-sort":"",onRequest:_e},{"no-data":i(({icon:a,filter:m})=>[d("div",ma,[fa,s(_,{size:"2em",name:m?"filter_b_and_w":a},null,8,["name"])])]),body:i(a=>[s(ea,{props:a},{default:i(()=>[s(I,{key:"order",props:a},null,8,["props"]),s(I,{key:"identifier",props:a},{default:i(()=>[b(E(p(X)(a.row)),1)]),_:2},1032,["props"]),s(I,{key:"name",props:a},{default:i(()=>[b(E(p(ee)(a.row)),1)]),_:2},1032,["props"]),s(I,{key:"age",props:a},{default:i(()=>[b(E(p(F)(p(C)(a.row.dateOfBirth))),1)]),_:2},1032,["props"]),s(I,{key:"gender",props:a},{default:i(()=>[b(E(a.row.gender),1)]),_:2},1032,["props"]),s(I,{key:"options",props:a},{default:i(()=>[d("div",ga,[u.value.id.length>4?k("",!0):(P(),w(N,{key:0,flat:"",round:"",class:"q-ml-md",color:"green-8",icon:"person_search",onClick:m=>xe(a.row)},{default:i(()=>[s(U,{class:"bg-green-5"},{default:i(()=>[b("Visualizar")]),_:1})]),_:2},1032,["onClick"])),u.value.id.length>4?(P(),w(N,{key:1,flat:"",round:"",class:"q-ml-md",color:"green-8",icon:"file_download",onClick:m=>Ve(a.row)},{default:i(()=>[s(U,{class:"bg-green-5"},{default:i(()=>[b("Carregar")]),_:1})]),_:2},1032,["onClick"])):k("",!0)])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","filter","loading","pagination"]),!p(fe)()||!p(ge)()||p(pe)()?(P(),w(Fe,{key:0,position:"bottom-right",offset:[18,18]},{default:i(()=>[s(N,{class:"q-mb-xl q-mr-xl",fab:"",color:"primary",icon:"add",onClick:e[12]||(e[12]=a=>qe(l.value))})]),_:1})):k("",!0)])]),s($e,{persistent:"",modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=a=>h.value=a)},{default:i(()=>[s(ta)]),_:1},8,["modelValue"])])]),_:1}))}},Ba={__name:"Patient",setup(ce){const{showloading:q,closeLoading:S}=de(),V=n(new D({id:y()}));ue(()=>{q(),F()});const r=z(()=>Je.currClinic()),f=z(()=>re.getAllActive()),F=()=>{const C={id:"-1",abbreviation:"iDMED",description:"iDMED",active:!0};re.localSave(C),S()};return v("clinic",r),v("dataSources",f),v("currPatient",V),(C,O)=>(P(),Oe("div",null,[s(pa)]))}};export{Ba as default};
